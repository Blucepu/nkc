!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t}).apply(this,arguments)}var e=NKC.methods.getDataById("forumInfo"),o=e.fid,n=e.page,a=e.digest,i=e.sort;$((function(){var t=$("#navbar_custom_dom"),e=$("#leftDom");t.html(e.html()),NKC.configs.lid&&(window.Library=new NKC.modules.Library({lid:NKC.configs.lid,folderId:NKC.configs.folderId,tLid:NKC.configs.tLid,closed:NKC.configs.closed,uploadResourcesId:NKC.configs.uploadResourcesId?NKC.configs.uploadResourcesId.split("-"):[]}));var o=$("#threadUrlSwitch");o.length&&(d(s()),o.on("click",(function(){d($(this).prop("checked"))})));NKC.configs.uid&&f()}));var r="forum_thread_a_target";function d(t){var e=t?"_blank":"_self";$(".thread-panel-url").attr("target",e),$("#threadUrlSwitch").prop("checked",!!t),c(t)}function s(){return"true"===localStorage.getItem(r)}function c(t){localStorage.setItem(r,t)}function l(){socket.emit("joinRoom",{type:"forum",data:{forumId:o}})}function f(){socket.on("connect",(function(){l()})),socket.on("forumMessage",(function(t){var e=t.html,o=t.tid,r=t.contentType,d=$("div.normal-thread-list"),s=d.find('div[data-tid="'+o+'"]');if(0!==n||!(!a||a&&t.digest)||"thread"!==r&&"tlm"!==i){if(!s)return}else s.length?s.remove():v(),s=$(e),d.prepend(s);var c=NKC.methods.getThreadListNewPostCount(o);c++,NKC.methods.setThreadListNewPostCount(o,c),g(o,c),p()})),socket.connected&&l(),u(),h(),m()}function u(){setTimeout((function(){m(),u()}),1e4)}function h(){document.body.addEventListener("click",(function(t){var e=t.target;if("a"===e.tagName.toLowerCase()){var o=(e=$(e)).attr("href");if(/^\/t\/([0-9]+)\??/gi.test(o)){var n=RegExp.$1;NKC.methods.setThreadListNewPostCount(n,0),g(n,0)}}}))}function m(){for(var t=$("div.normal-thread-list").find(".thread-panel"),e=0;e<t.length;e++){var o=t.eq(e).attr("data-tid");g(o,NKC.methods.getThreadListNewPostCount(o))}}function p(){floatUserPanel.initPanel(),floatForumPanel.initPanel()}function g(t,e){var o=$("div.normal-thread-list");o.find('div[data-tid="'+t+'"] .thread-panel-author-info').length&&o.find('div[data-tid="'+t+'"] span.thread-panel-point').remove()}function v(){var t=$("div.normal-thread-list>.thread-panel"),e=t.length;0!==e&&t.eq(e-1).remove()}window.openEditSite=function(){var t=window.location.origin+"/editor?type=forum&id="+o;"reactNative"===NKC.configs.platform?NKC.methods.rn.emit("openEditorPage",{url:t}):"apiCloud"===NKC.configs.platform?api.openWin({name:t,url:"widget://html/common/editorInfo.html",pageParam:{realUrl:t,shareType:"common"}}):NKC.methods.visitUrl(t,!0)},t(window,{threadUrlSwitchKey:r,modifyThreadUrl:d,getThreadUrlSwitchStatus:s,setThreadUrlSwitchStatus:c,joinRoom:l,connectForumRoom:f,createTimeoutToUpdateThreadListCount:u,createClickEventToUpdateThreadListCount:h,updateThreadListCount:m,createMouseEvents:p,setThreadListNewCount:g,removeLastThreadPanel:v})}));
