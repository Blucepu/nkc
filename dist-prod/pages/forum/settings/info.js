!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}var t=NKC.methods.getDataById("data").forum;t._noticeThreadsId=(t.noticeThreadsId||[]).join(", "),t._basicThreadsId=(t.basicThreadsId||[]).join(", "),t._valuableThreadsId=(t.valuableThreadsId||[]).join(", ");var o=new NKC.methods.selectImage,n=new Vue({el:"#app",data:{logoData:"",logoFile:"",bannerData:"",bannerFile:"",submitting:!1,forum:t},mounted:function(){var e=this;setTimeout((function(){NKC.methods.initSelectColor((function(t){e.forum.color=t}))}),100)},methods:{getUrl:NKC.methods.tools.getUrl,str2arr:function(e){var t=e.split(","),o=[];return t.map((function(e){(e=e.trim())&&o.push(e)})),o},selectLogo:function(){var e=this;o.show((function(t){var n=NKC.methods.blobToFile(t);NKC.methods.fileToUrl(n).then((function(t){e.logoData=t,e.logoFile=n,o.close()}))}),{aspectRatio:1})},selectBanner:function(){var e=this;o.show((function(t){var n=NKC.methods.blobToFile(t);NKC.methods.fileToUrl(n).then((function(t){e.bannerData=t,e.bannerFile=n,o.close()}))}),{aspectRatio:4})},toEditor:function(){NKC.methods.visitUrl("/editor?type=forum_declare&id="+this.forum.fid,!0)},toLatestNoticeEditor:function(){NKC.methods.visitUrl("/editor?type=forum_latest_notice&id="+this.forum.fid,!0)},save:function(){var e=this,t=e.forum;Promise.resolve().then((function(){e.submitting=!0,t.noticeThreadsId=e.str2arr(t._noticeThreadsId),t.basicThreadsId=e.str2arr(t._basicThreadsId),t.valuableThreadsId=e.str2arr(t._valuableThreadsId);var o=new FormData;return o.append("forum",JSON.stringify(t)),e.logoFile&&o.append("logo",e.logoFile),e.bannerFile&&o.append("banner",e.bannerFile),nkcUploadFile("/f/".concat(e.forum.fid,"/settings/info"),"PUT",o)})).then((function(t){t.logo&&(e.logoData="",e.logoFile="",e.forum.logo=t.logo),t.banner&&(e.bannerData="",e.bannerFile="",e.forum.banner=t.banner),sweetSuccess("保存成功"),e.submitting=!1})).catch((function(t){e.submitting=!1,sweetError(t)}))}}});e(window,{forum:t,selectImage:o,app:n})}));
