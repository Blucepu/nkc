!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e={init:function(o){var t=$("#moduleToColumn"),i=t.attr("data-uid"),n=t.attr("data-column-id");e.callback=o,e.app=new Vue({el:"#moduleToColumnVue",data:{uid:i,selectMul:!1,columnId:n,mainCategories:[],minorCategories:[],exclude:[],category:"",column:"",loading:!0,mainCategoryId:"",minorCategoryId:"",categoryType:"all",showOperationType:!1,showCategoryType:!1,mainCategoriesId:[],minorCategoriesId:[],operationType:"add",createCategory:!1,newCategory:{parentId:"",name:"",description:"",type:"main"},info:"",error:""},mounted:function(){var e=this;$("#moduleToColumn").modal({show:!1}),$("#moduleCrop").on("hidden.bs.modal",(function(){e.createCategory=!1}))},computed:{excludes:function(){var e=this,o=this.exclude,t=[].concat(o);return function o(i){for(var n=0;n<i.length;n++){var a=i[n],r=e.getChildren(a);t=t.concat(r),o(r)}}(o),t}},methods:{saveCategory:function(){var e=this,o=this.newCategory;return o.name?o.description?void nkcAPI("/m/"+this.column._id+"/category","POST",o).then((function(){e.getCategories(),e.createCategory=!1,e.newCategory={name:"",description:"",parentId:"",type:"main"}})).catch((function(o){e.error=o.error||o})):this.error="请输入分类介绍":this.error="请输入分类名"},addCategory:function(){this.createCategory=!0},cancelAddCategory:function(){this.createCategory=!1},getChildren:function(e){for(var o=[],t=0;t<this.mainCategories.length;t++){var i=this.mainCategories[t];i.parentId===e&&o.push(i._id)}return o},getCategories:function(){var e=this;nkcAPI("/m/"+this.columnId+"/category?from=dialog","GET").then((function(o){e.column=o.column;for(var t=0;t<o.mainCategories.length;t++){for(var i=o.mainCategories[t],n="",a=0;a<i.level;a++)n+="&nbsp;&nbsp;&nbsp;";i.str=n}e.mainCategories=o.mainCategories,e.minorCategories=o.minorCategories,e.loading=!1,e.mainCategories.length>0&&(e.mainCategoryId=e.mainCategories[0]._id)})).catch((function(o){e.error=o.error||o}))},show:function(o,t){o&&(e.callback=o),t&&(this.exclude=t.exclude||[],this.selectMul=t.selectMul||!1,this.mainCategoriesId=t.selectedMainCategoriesId||t.selectedCid||[],this.minorCategoriesId=t.selectedMinorCategoriesId||[],this.showOperationType=t.showOperationType||!1,this.showCategoryType=t.showCategoryType||!1),$("#moduleToColumn").modal("show"),this.getCategories()},hide:function(){$("#moduleToColumn").modal("hide"),this.mainCategoryId="",this.minorCategoryId="",this.minorCategoriesId=[],this.mainCategoriesId=[]},complete:function(){if(!this.columnId||!this.uid)return screenTopWarning("数据加载中，请稍后重试");e.callback({mainCategoryId:this.mainCategoryId,minorCategoryId:this.minorCategoryId,columnId:this.columnId,uid:this.uid,mainCategoriesId:this.mainCategoriesId,minorCategoriesId:this.minorCategoriesId,operationType:this.operationType,categoryType:this.categoryType})}}}),e.show=function(o,t){e.app.show(o,t)},e.hide=function(){e.app.hide()}}};window.moduleToColumn=e}));
