!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e={init:function(t){var o=$("#moduleToColumn"),i=o.attr("data-uid"),n=o.attr("data-column-id");e.callback=t,e.app=new Vue({el:"#moduleToColumnVue",data:{uid:i,selectMul:!1,columnId:n,mainCategories:[],minorCategories:[],exclude:[],category:"",column:"",loading:!0,mainCategoryId:"",minorCategoryId:"",categoryType:"all",showCategoryType:!1,mainCategoriesId:[],minorCategoriesId:[],createCategory:!1,newCategory:{parentId:"",name:"",description:"",type:"main"},info:"",error:""},mounted:function(){var e=this;$("#moduleToColumn").modal({show:!1}),$("#moduleCrop").on("hidden.bs.modal",(function(){e.createCategory=!1}))},computed:{excludes:function(){var e=this,t=this.exclude,o=[].concat(t);return function t(i){for(var n=0;n<i.length;n++){var a=i[n],r=e.getChildren(a);o=o.concat(r),t(r)}}(t),o}},methods:{saveCategory:function(){var e=this,t=this.newCategory;return t.name?t.description?void nkcAPI("/m/"+this.column._id+"/category","POST",t).then((function(){e.getCategories(),e.createCategory=!1,e.newCategory={name:"",description:"",parentId:"",type:"main"}})).catch((function(t){e.error=t.error||t})):this.error="请输入分类介绍":this.error="请输入分类名"},addCategory:function(){this.createCategory=!0},cancelAddCategory:function(){this.createCategory=!1},getChildren:function(e){for(var t=[],o=0;o<this.mainCategories.length;o++){var i=this.mainCategories[o];i.parentId===e&&t.push(i._id)}return t},getCategories:function(){var e=this;nkcAPI("/m/"+this.columnId+"/category?from=dialog","GET").then((function(t){e.column=t.column;for(var o=0;o<t.mainCategories.length;o++){for(var i=t.mainCategories[o],n="",a=0;a<i.level;a++)n+="&nbsp;&nbsp;&nbsp;";i.str=n}e.mainCategories=t.mainCategories,e.minorCategories=t.minorCategories,e.loading=!1,e.mainCategories.length>0&&(e.mainCategoryId=e.mainCategories[0]._id)})).catch((function(t){e.error=t.error||t}))},show:function(t,o){t&&(e.callback=t),o&&(this.exclude=o.exclude||[],this.selectMul=o.selectMul||!1,this.mainCategoriesId=o.selectedMainCategoriesId||o.selectedCid||[],this.minorCategoriesId=o.selectedMinorCategoriesId||[],this.showCategoryType=o.showCategoryType||!1),this.categoryType="all",$("#moduleToColumn").modal("show"),this.getCategories()},hide:function(){$("#moduleToColumn").modal("hide"),this.mainCategoryId="",this.minorCategoryId="",this.minorCategoriesId=[],this.mainCategoriesId=[]},complete:function(){if(!this.columnId||!this.uid)return screenTopWarning("数据加载中，请稍后重试");e.callback({mainCategoryId:this.mainCategoryId,minorCategoryId:this.minorCategoryId,columnId:this.columnId,uid:this.uid,mainCategoriesId:this.mainCategoriesId,minorCategoriesId:this.minorCategoriesId,categoryType:this.categoryType})}}}),e.show=function(t,o){e.app.show(t,o)},e.hide=function(){e.app.hide()}}};window.moduleToColumn=e}));
