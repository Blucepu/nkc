!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";NKC.modules.SelectUser=function(){var e=this;e.dom=$("#moduleSelectUser"),e.dom.modal({show:!1,backdrop:"static"}),e.app=new Vue({el:"#moduleSelectUserApp",data:{users:[],searchUsers:[],selectedUsersId:[],userCount:0,searchInfo:"",type:"username",keyword:"",paging:""},mounted:function(){},computed:{selectedUsers:function(){for(var e=this.selectedUsersId,s=[],t=0;t<e.length;t++){var r=this.getUserById(e[t]);r&&s.push(r)}return s}},methods:{checkString:NKC.methods.checkData.checkString,getUrl:NKC.methods.tools.getUrl,removeUser:function(e){this.selectedUsersId.splice(e,1)},getUserById:function(e){for(var s=this.users,t=0;t<s.length;t++){var r=s[t];if(r.uid===e)return r}},selectUser:function(e){-1===this.selectedUsersId.indexOf(e.uid)&&(this.selectedUsersId.length<this.userCount&&this.selectedUsersId.push(e.uid))},search:function(){var e=this;this.searchInfo="",Promise.resolve().then((function(){var s=e.keyword;e.checkString(s,{name:"输入的关键词",minLength:1});var t="/u";return"username"===e.type?t+="?username="+s:t+="?uid="+s,nkcAPI(t,"GET")})).then((function(s){e.searchUsers=s.targetUsers,e.users=e.users.concat(e.searchUsers),s.targetUsers.length||(e.searchInfo="未找到相关用户")})).catch((function(e){sweetError(e)}))},getTypeName:function(e){return{uid:"用户ID",username:"用户名"}[e]},selectType:function(e){this.type=e},open:function(s,t){t=t||{},e.app.userCount=t.userCount||99,e.callback=s,e.dom.modal("show")},close:function(){e.dom.modal("hide"),setTimeout((function(){e.app.searchUsers=[],e.app.type="username",e.app.selectedUsersId=[],e.app.userCount=0}),1e3)},done:function(){e.callback({usersId:this.selectedUsersId,users:this.selectedUsers}),e.close()}}}),e.open=e.app.open,e.close=e.app.close}}));
