!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e,n,o,i,r,u){try{var s=t[r](u),a=s.value}catch(t){return void n(t)}s.done?e(a):Promise.resolve(a).then(o,i)}function e(e){return function(){var n=this,o=arguments;return new Promise((function(i,r){var u=e.apply(n,o);function s(e){t(u,i,r,s,a,"next",e)}function a(e){t(u,i,r,s,a,"throw",e)}s(void 0)}))}}window.floatUserPanel=new Vue({el:"#floatUserPanel",data:{user:"",uid:NKC.configs.uid,over:!1,show:!1,count:1,onPanel:!1,users:{},timeoutName:""},mounted:function(){var t=$(this.$el);if(t.css({top:0,left:0}),t.css({top:300,left:300}),this.uid&&!window.SubscribeTypes){if(!NKC.modules.SubscribeTypes)return sweetError("未引入与关注相关的模块");window.SubscribeTypes=new NKC.modules.SubscribeTypes}this.initPanel()},methods:{getUrl:NKC.methods.tools.getUrl,format:NKC.methods.format,fromNow:NKC.methods.fromNow,initPanel:function(){for(var t=$("[data-float-uid]"),e=0;e<t.length;e++){var n=t.eq(e);if("true"!==n.attr("data-float-init")){var o=n.attr("data-float-position");this.initEvent(t.eq(e),o)}}},reset:function(){this.show=!1,this.onPanel=!1,this.over=!1,this.user=""},initEvent:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",o=this;t.on("mouseleave",(function(){o.timeoutName=setTimeout((function(){o.reset()}),200)})),t.on("mouseover",function(){var i=e(regeneratorRuntime.mark((function e(i){var r,u,s,a,c,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(o.timeoutName),o.count++,o.over=!0,u=o.count,o.timeout(300).then((function(){if(u!==o.count)throw"timeout 1";if(!o.over)throw"timeout 2";return r=t.attr("data-float-uid"),s=t.offset().left,a=t.offset().top,c=t.width(),f=t.height(),o.getUserById(r)})).then((function(t){var e=t.user,i=t.subscribed;if(u!==o.count)throw"timeout 3";if(!o.over)throw"timeout 4";o.user=e,o.subscribed=i;var r=$(o.$el);o.show=!0,r.on("mouseleave",(function(){o.reset()})),r.on("mouseover",(function(){clearTimeout(o.timeoutName),o.onPanel=!0}));var d=$(document).width()-10;"bottom"===n?(a+=f+10,s-=c+10):(s+=c+10,a+=f+10),s+312>d&&(s=d-312),r.css({top:a,left:s})})).catch((function(t){}));case 5:case"end":return e.stop()}}),e)})));return function(t){return i.apply(this,arguments)}}()),t.attr("data-float-init","true")},timeout:function(t){return new Promise((function(e,n){setTimeout((function(){e()}),t)}))},getUserById:function(t){var e=this;return new Promise((function(n,o){var i=e.users[t];i?n(i):nkcAPI("/u/".concat(t,"?from=panel"),"GET").then((function(t){if(!t.targetUser.hidden){var o={subscribed:t.subscribed,user:t.targetUser};e.users[t.targetUser.uid]=o,n(o)}})).catch((function(t){console.log(t),o(t)}))}))},subscribe:function(){var t=this.user,e=this.subscribed;SubscribeTypes.subscribeUser(t.uid,!e)}}})}));
