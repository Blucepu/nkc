!function(o){"function"==typeof define&&define.amd?define(o):o()}((function(){"use strict";NKC.methods.selectImage=function(o){$("#moduleCrop").modal({show:!1,backdrop:"static"});var e={viewMode:1,checkCrossOrigin:!1,movable:!1,canSelectNewImage:!0};if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);var r=this,c=$("#module_crop_image");c.cropper(e),this.cropper=c.data("cropper"),$("#module_crop_input").on("change",(function(){r.selectedFile()})),$("#module_crop_rotate_left").on("click",(function(){r.rotate("left")})),$("#module_crop_rotate_right").on("click",(function(){r.rotate("right")})),$("#module_crop_button").on("click",(function(){r.complete()})),$("#moduleCrop").on("hidden.bs.modal",(function(){$("#module_crop_input").val(""),$("#module_crop_info").text("")})),this.show=function(o,e){e&&(e.aspectRatio&&r.cropper.setAspectRatio(e.aspectRatio),e.url&&setTimeout((function(){r.cropper.replace(e.url)}),200)),r.callback=o,$("#moduleCrop").modal("show")},this.selectedFile=function(){var o=$("#module_crop_input").prop("files");NKC.methods.fileToUrl(o[0]).then((function(o){r.cropper.replace(o)}))},this.complete=function(){$("#module_crop_info").text("图片处理中，请稍候...");try{r.cropper.getCroppedCanvas().toBlob((function(o){r.callback(o)}))}catch(o){console.log(o),e.errorInfo&&screenTopWarning(e.errorInfo)}},this.close=function(){$("#moduleCrop").modal("hide")},this.rotate=function(o){if("left"===o?r.cropper.rotate(-90):r.cropper.rotate(90),e.resetCrop){var t=r.cropper.getImageData(),c=t.height,n=t.top,i=t.left,p=t.width;c<0&&(c=0),n<0&&(n=0),i<0&&(i=0),p<0&&(p=0),r.cropper.setCropBoxData({height:c,width:p,top:n,left:i})}}}}));
