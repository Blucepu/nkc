!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,o,t){for(var r=atob(this.toDataURL(o,t).split(",")[1]),n=r.length,c=new Uint8Array(n),p=0;p<n;p++)c[p]=r.charCodeAt(p);e(new Blob([c],{type:o||"image/png"}))}});var e={cropper:{},init:function(o,t){var r={viewMode:0,aspectRatio:1,checkCrossOrigin:!1,movable:!1,canSelectNewImage:!0};if(t)for(var n in t)r[n]=t[n];r.canSelectNewImage?$(".crop-select-panel").css("display","inline-block"):$(".crop-select-panel").css("display","none"),e.cropper&&e.cropper.destroy&&r.aspectRatio&&e.cropper.setAspectRatio(r.aspectRatio);var c=$("#module_crop_image");c.cropper(r),e.cropper=c.data("cropper"),e.complete=function(){$(".doing-info.hidden").removeClass("hidden"),setTimeout((function(){try{e.cropper.getCroppedCanvas().toBlob((function(t){o(t,e.name)}))}catch(e){console.log(e),r.errorInfo&&screenTopWarning(r.errorInfo)}e.cancel(),$(".doing-info").addClass("hidden")}),500)},e.show=function(o){o&&(o.name&&(e.name=o.name),o.aspectRatio&&e.cropper.setAspectRatio(o.aspectRatio)),$("#module_crop").show(),stopBodyScroll(!0)},e.hide=function(){$("#module_crop").hide(),stopBodyScroll(!1)},e.selectFile=function(){$("#module_crop_input").click()},e.selectedFile=function(){var o=$("#module_crop_input").prop("files");NKC.methods.fileToUrl(o[0]).then((function(o){e.replace(o)}))},e.replace=function(o){e.cropper.replace(o)},e.cancel=function(){$("#module_crop_input").val(""),e.cropper.destroy(),e.hide()},e.rotate=function(o){if("left"===o?e.cropper.rotate(-90):e.cropper.rotate(90),r.resetCrop){var t=e.cropper.getImageData(),n=t.height,c=t.top,p=t.left,i=t.width;n<0&&(n=0),c<0&&(c=0),p<0&&(p=0),i<0&&(i=0),e.cropper.setCropBoxData({height:n,width:i,top:c,left:p})}}}};window.moduleCrop=e}));
