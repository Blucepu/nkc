!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}NKC.modules.Attachments=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=this,i=t.pid,o=t.fid;if(!i)return sweetError("附件模块初始化失败，id不能为空");this.app=new Vue({el:"#moduleAttachments",data:{pid:i,fid:o,loaded:!1,mark:!1,hidden:!1,createFilePermission:!1,attachments:[]},mounted:function(){this.getAttachments(),window.ResourceInfo||(NKC.modules.ResourceInfo?window.ResourceInfo=new NKC.modules.ResourceInfo:sweetError("未引入资源信息模块"))},computed:{selectedAttachmentCount:function(){var t=0;return this.attachments.map((function(e){e.mark&&t++})),t}},methods:{getUrl:NKC.methods.tools.getUrl,getSize:NKC.methods.tools.getSize,visitUrl:NKC.methods.visitUrl,format:NKC.methods.format,displayResourceInfo:function(t){ResourceInfo.open({rid:t.rid})},postToLibrary:function(){var t=this.attachments,e=[];t.map((function(t){t.mark&&e.push(t.rid)})),0!==e.length&&(e=e.join("-"),this.visitUrl("/f/".concat(o,"/library?t=upload&id=").concat(e),!0))},markAttachment:function(t){this.attachments.map((function(t){return t.mark=!1})),this.mark=!!t},markAll:function(){var t=this.attachments,e=0;this.attachments.map((function(t){t.mark&&e++}));var n=t.length!==e;this.attachments.map((function(t){return t.mark=n}))},getAttachments:function(){this.request().then((function(t){n.app.createFilePermission=t.createFilePermission,t.resources.map((function(t){t.mark=!1})),n.app.attachments=t.resources,n.app.loaded=!0})).catch((function(t){sweetError(t)}))},request:function(){var t=this.pid;return nkcAPI("/p/".concat(t,"/resources?d=attachment"),"GET")}}})}var n,i,o;return n=e,(i=[{key:"hide",value:function(){this.app.hidden=!0}},{key:"show",value:function(){this.app.hidden=!1}}])&&t(n.prototype,i),o&&t(n,o),e}()}));
