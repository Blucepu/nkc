!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e){return(t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?o(e):t}function i(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,i=t(e);if(r){var s=t(this).constructor;o=Reflect.construct(i,arguments,s)}else o=i.apply(this,arguments);return n(this,o)}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){a=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(a)throw i}}}}var a=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(l,NKC.modules.DraggablePanel);var n,s,a,c=i(l);function l(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var t="#moduleForumSelector",r=o(e=c.call(this,t));return r.dom=$(t),r.app=new Vue({el:t+"App",data:{loading:!0,forums:[],forumCategories:[],subscribeForumsId:[],selectedForumCategory:"",selectedParentForum:"",selectedForum:"",selectedThreadType:"",selectedForumsId:[],disabledForumsId:[],highlightForumId:"",needThreadType:!0,showThreadTypes:!1},computed:{forumData:function(){var e,t=this.forumCategories,r=[],o=[],n=u(this.forums);try{for(n.s();!(e=n.n()).done;){var i=e.value;o[i.categoryId]||(o[i.categoryId]=[]),o[i.categoryId].push(i)}}catch(e){n.e(e)}finally{n.f()}var s,a=u(t);try{for(a.s();!(s=a.n()).done;){var c=s.value,l=o[c._id];l&&(c.forums=l,r.push(c))}}catch(e){a.e(e)}finally{a.f()}return r},subscribeForums:function(){var e=this.forums,t=this.subscribeForumsId;if(!t.length)return[];var r,o=[],n=u(e);try{for(n.s();!(r=n.n()).done;){var i,s=u(r.value.childForums);try{for(s.s();!(i=s.n()).done;){var a=i.value;t.includes(a.fid)&&o.push(a)}}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}return o},forumsObj:function(){var e,t={},r=u(this.forums);try{for(r.s();!(e=r.n()).done;){var o=e.value;t[o.fid]=o;var n,i=u(o.childForums);try{for(i.s();!(n=i.n()).done;){var s=n.value;t[s.fid]=s}}catch(e){i.e(e)}finally{i.f()}}}catch(e){r.e(e)}finally{r.f()}return t},disabledForumCategoriesId:function(){var e=this.selectedForumsId,t=this.forumsObj;this.forumCategoriesId;var r,o=this.forumCategoriesObj,n=[],i=[],s=u(e);try{for(s.s();!(r=s.n()).done;){var a=t[r.value];if(a)if(-1===n.indexOf(a.categoryId)){var c=o[a.categoryId];if(c){var l=c.excludedCategoriesId;i=i.concat(l)}}}}catch(e){s.e(e)}finally{s.f()}n=[];var d,f=u(i);try{for(f.s();!(d=f.n()).done;){var h=d.value;n.includes(h)||n.push(h)}}catch(e){f.e(e)}finally{f.f()}return n},disabledAllForumsId:function(){return this.disabledForumsId.concat(this.selectedForumsId)},forumCategoriesId:function(){return this.forumCategories.map((function(e){return e._id}))},forumCategoriesObj:function(){var e,t={},r=u(this.forumCategories);try{for(r.s();!(e=r.n()).done;){var o=e.value;t[o._id]=o}}catch(e){r.e(e)}finally{r.f()}return t}},mounted:function(){},methods:{getUrl:NKC.methods.tools.getUrl,open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.callback=e;var o=t.disabledForumsId,n=void 0===o?[]:o,i=t.selectedForumsId,s=void 0===i?[]:i,u=t.from,a=void 0===u?"writable":u,c=t.needThreadType,l=void 0===c||c,d=t.highlightForumId,f=void 0===d?"":d;this.disabledForumsId=n,this.selectedForumsId=s,this.needThreadType=l,this.highlightForumId=f,this.resetSelector(),r.showPanel(),nkcAPI("/f?t=selector&f=".concat(a),"GET").then((function(e){r.app.loading=!1,r.app.initForums(e)})).catch((function(e){console.log(e),sweetError(e)}))},close:function(){r.hidePanel(),this.resetSelector()},selectForumCategory:function(e){this.disabledForumCategoriesId.includes(e._id)||(this.selectedForumCategory=e,this.selectedForum="",this.selectedParentForum="",this.selectedThreadType="")},initForums:function(e){var t,r=e.forumCategories,o=e.forums,n=e.subscribeForumsId,i=[],s=u(o);try{for(s.s();!(t=s.n()).done;){var a=t.value;i[a.categoryId]||(i[a.categoryId]=[]),i[a.categoryId].push(a)}}catch(e){s.e(e)}finally{s.f()}var c,l=u(r);try{for(l.s();!(c=l.n()).done;){var d=c.value;d.forums=i[d._id]||[]}}catch(e){l.e(e)}finally{l.f()}this.forums=o,this.forumCategories=r,this.subscribeForumsId=n;for(var f=null,h=r.length-1;h>=0;h--){var m=r[h];if(!this.disabledForumCategoriesId.includes(m._id)&&(f=m,this.selectedForumCategory&&this.selectedForumCategory._id===m._id))break}f?this.selectForumCategory(f):this.resetSelector(),this.highlightForum()},highlightForum:function(){var e=this.forumData,t=this.highlightForumId;if(t){var r,o,n,i,s=u(e);try{e:for(s.s();!(i=s.n()).done;){var a=i.value;r=a;var c,l=u(a.forums);try{for(l.s();!(c=l.n()).done;){var d=c.value;o=d;var f,h=u(d.childForums);try{for(h.s();!(f=h.n()).done;){var m=f.value;if(t===m.fid){n=m;break e}}}catch(e){h.e(e)}finally{h.f()}}}catch(e){l.e(e)}finally{l.f()}}}catch(e){s.e(e)}finally{s.f()}n&&(this.selectedForumCategory=r,this.selectedParentForum=o,this.selectedForum=n)}},selectParentForum:function(e){this.disabledAllForumsId.includes(e.fid)||(this.selectedParentForum=e,this.selectedForum="",this.selectedThreadType="",1===this.selectedParentForum.childForums.length?this.selectForum(this.selectedParentForum.childForums[0]):0===this.selectedParentForum.childForums.length&&this.selectForum(this.selectedParentForum))},selectForum:function(e){this.disabledAllForumsId.includes(e.fid)||(this.selectedThreadType="",this.selectedForum=e,0===e.threadTypes.length&&this.selectThreadType("none"))},selectThreadType:function(e){this.selectedThreadType=e},next:function(){this.showThreadTypes=!0},previous:function(){this.showThreadTypes=!1,this.selectedThreadType=""},resetSelector:function(){this.selectedForumCategory="",this.selectedForum="",this.selectedParentForum="",this.selectedThreadType="",this.showThreadTypes=!1},submit:function(){var e=this.selectedForum,t=this.selectedThreadType;return e?t?(r.callback({forum:e,threadType:"none"===t?null:t,fid:e.fid,cid:"none"===t?"":t.cid}),void this.close()):sweetError("请选择文章分类"):sweetError("请选择专业")},fastSubmit:function(){var e=this.selectedForum;if(!e)return sweetError("请选择专业");r.callback({forum:e,fid:e.fid}),this.close()}}}),e}return n=l,(s=[{key:"open",value:function(e,t){this.app.open(e,t)}}])&&e(n.prototype,s),a&&e(n,a),l}();NKC.modules.ForumSelector=a}));
