!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";NKC.modules.SubscribeTypes=function(){var e=this;e.dom=$("#moduleSubscribeTypes"),e.app=new Vue({el:"#moduleSubscribeTypesApp",data:{edit:!1,editType:!1,fastAdd:!1,uid:e.dom.attr("data-uid"),loaded:!1,types:[],selectTypesWhenSubscribe:[],selectedTypesId:[],hideInfo:!1,type:{name:"",pid:null}},computed:{selectedTypes:function(){for(var e=[],t=0;t<this.selectedTypesId.length;t++){var s=this.selectedTypesId[t],c=this.getTypeById(s);c&&e.push(c)}return e},parentTypes:function(){for(var e=[],t=0;t<this.types.length;t++){var s=this.types[t];s.pid||e.push(s)}return e}},methods:{getTypeById:function(e){for(var t=0;t<this.types.length;t++){var s=this.types[t];if(s._id===e)return s}},getTypes:function(){return nkcAPI("/account/subscribe_types","GET").then((function(t){return e.app.types=t.types,e.app.loaded=!0,Promise.resolve()})).catch((function(e){sweetError(e)}))},addType:function(){this.fastAdd=!0,this.edit=!0},complete:function(){var t=this.selectedTypesId;if(!this.hideInfo&&this.selectTypesWhenSubscribe&&this.selectTypesWhenSubscribe.length>0){var s=NKC.configs.uid;nkcAPI("/u/"+s+"/settings/apps","PUT",{selectTypesWhenSubscribe:!1}).then((function(){NKC.configs.selectTypesWhenSubscribe=!1})).catch((function(e){screenTopWarning(e)}))}e.callback(t)},closeForm:function(){this.fastAdd?(this.edit=!1,this.fastAdd=!1):(this.edit=!1,this.type=""),this.type={name:"",pid:null}},modifyType:function(e){this.type=this.types[e],this.edit=!0},moveType:function(e,t){var s=this.types[e],c=this;nkcAPI("/account/subscribe_types/"+s._id,"PUT",{type:"order",direction:t}).then((function(){c.getTypes()})).catch((function(e){sweetError(e)}))},removeType:function(e){var t=this.types[e],s=this;sweetConfirm("确定要删除分类“"+t.name+"”吗？").then((function(){nkcAPI("/account/subscribe_types/"+t._id,"DELETE").then((function(){s.getTypes()})).catch((function(e){sweetError(e)}))}))},save:function(){var t=this.type.name,s=this.type.pid,c=this.type._id,n="/account/subscribe_types",i="POST",o={name:t,pid:s};c&&(n="/account/subscribe_types/"+c,i="PUT",o.type="info"),nkcAPI(n,i,o).then((function(){e.app.getTypes(),e.app.closeForm()})).catch((function(e){sweetError(e)}))}}}),e.dom.modal({show:!1,backdrop:"statics"}),e.open=function(t,s){if(void 0===(s=s||{}).selectTypesWhenSubscribe&&(s.selectTypesWhenSubscribe=!!NKC.configs.selectTypesWhenSubscribe),!s.selectTypesWhenSubscribe)return t([]);e.app.editType=s.editType||!1,e.app.hideInfo=s.hideInfo||!1,e.app.edit=!!s.edit,e.app.selectedTypesId=[],e.callback=t,e.dom.modal("show"),e.app.getTypes().then((function(){if(e.app.edit&&s.typeId){var t=e.app.getTypeById(s.typeId);t&&(e.app.type=t)}if(s.selectedTypesId&&s.selectedTypesId.length>0){e.app.selectedTypesId=[];for(var c=0;c<s.selectedTypesId.length;c++){var n=s.selectedTypesId[c],i=e.app.getTypeById(n);i&&e.app.selectedTypesId.push(i._id)}}}))},e.close=function(){e.dom.modal("hide")},e.subscribeForumPromise=function(e,t,s){var c;return c=t?"POST":"DELETE",nkcAPI("/f/"+e+"/subscribe",c,{cid:s||[]})},e.subscribeForum=function(t,s){e.subscribeForumPromise(t,s).then((function(){e.close(),s?sweetSuccess("关注成功"):sweetSuccess("关注已取消")})).catch(sweetError)},e.subscribeColumnPromise=function(e,t,s){return nkcAPI("/m/"+e+"/subscribe","POST",{type:t?"subscribe":"",cid:s||[]})},e.subscribeColumn=function(t,s){e.subscribeColumnPromise(t,s).then((function(){e.close(),s?sweetSuccess("关注成功"):sweetSuccess("关注已取消")})).catch(sweetError)},e.subscribeUserPromise=function(e,t,s){return nkcAPI("/u/"+e+"/subscribe",t?"POST":"DELETE",{cid:s||[]})},e.subscribeUser=function(t,s){s?e.open((function(c){e.subscribeUserPromise(t,s,c).then((function(){e.close(),sweetSuccess("关注成功")})).catch((function(e){sweetError(e)}))})):e.subscribeUserPromise(t,s).then((function(){sweetSuccess("关注已取消")})).catch((function(e){sweetError(e)}))},e.subscribeThreadPromise=function(e,t,s){return nkcAPI("/t/"+e+"/subscribe",t?"POST":"DELETE",{cid:s||[]})},e.subscribeThread=function(t,s){s?e.open((function(c){e.subscribeThreadPromise(t,s,c).then((function(){e.close(),sweetSuccess("关注成功")})).catch((function(e){sweetError(e)}))})):e.subscribeThreadPromise(t,s).then((function(){e.close(),sweetSuccess("关注已取消")})).catch((function(e){sweetError(e)}))},e.collectionThreadPromise=function(e,t,s){return nkcAPI("/t/"+e+"/collection","POST",{type:!!t,cid:s||[]})},e.collectionThread=function(t,s){s?e.open((function(c){e.collectionThreadPromise(t,s,c).then((function(){e.close(),sweetSuccess("收藏成功")})).catch((function(e){sweetError(e)}))})):e.collectionThreadPromise(t,s).then((function(){e.close(),sweetSuccess("收藏已取消")})).catch((function(e){sweetError(e)}))}}}));
