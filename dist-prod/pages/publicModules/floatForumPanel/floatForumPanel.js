!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e,n,o,r,i,u){try{var c=t[i](u),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,r)}function e(e){return function(){var n=this,o=arguments;return new Promise((function(r,i){var u=e.apply(n,o);function c(e){t(u,r,i,c,s,"next",e)}function s(e){t(u,r,i,c,s,"throw",e)}c(void 0)}))}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}window.floatForumPanel=new Vue({el:"#floatForumPanel",data:{forum:"",uid:NKC.configs.uid,subscribed:!1,over:!1,show:!1,count:1,onPanel:!1,forums:{},timeoutName:""},mounted:function(){if($(this.$el).css({top:0,left:0}),this.uid&&!window.SubscribeTypes){if(!NKC.modules.SubscribeTypes)return sweetError("未引入与关注相关的模块");window.SubscribeTypes=new NKC.modules.SubscribeTypes}this.initPanel()},methods:{getUrl:NKC.methods.tools.getUrl,initPanel:function(){for(var t=$("[data-float-fid]"),e=0;e<t.length;e++){var n=t.eq(e);if("true"!==n.attr("data-float-init")){var o=n.attr("data-float-position");this.initEvent(t.eq(e),o)}}},reset:function(){this.show=!1,this.onPanel=!1,this.over=!1,this.forum=""},initEvent:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",o=this;t.on("mouseleave",(function(){o.timeoutName=setTimeout((function(){o.reset()}),200)})),t.on("mouseover",function(){var r=e(regeneratorRuntime.mark((function e(r){var i,u,c,s,f,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(o.timeoutName),o.count++,o.over=!0,u=o.count,o.timeout(300).then((function(){if(u!==o.count)throw"timeout 1";if(!o.over)throw"timeout 2";return i=t.attr("data-float-fid"),c=t.offset().left,s=t.offset().top,f=t.width(),a=t.height(),o.getForumById(i)})).then((function(t){var e=t.forum,r=t.subscribed;if(u!==o.count)throw"timeout 3";if(!o.over)throw"timeout 4";o.forum=e,o.subscribed=r;var i=$(o.$el);o.show=!0,i.on("mouseleave",(function(){o.reset()})),i.on("mouseover",(function(){clearTimeout(o.timeoutName),o.onPanel=!0}));var m=$(document).width()-10;"bottom"===n?(s+=a+10,c-=f+10):(c+=f+10,s+=a+10),c+288>m&&(c=m-288),i.css({top:s,left:c})})).catch((function(t){}));case 5:case"end":return e.stop()}}),e)})));return function(t){return r.apply(this,arguments)}}()),t.attr("data-float-init","true")},timeout:function(t){return new Promise((function(e,n){setTimeout((function(){e()}),t)}))},getForumById:function(t){var e=this;return new Promise((function(n,o){var i=e.forums[t];i?n(i):nkcAPI("/f/".concat(t,"/card"),"GET").then((function(t){i={forum:r(r({},t.forum),{},{latestThreads:t.latestThreads}),subscribed:t.subscribed},e.forums[t.forum.fid]=i,n(i)})).catch((function(t){o(t)}))}))},subscribe:function(){var t=this.forum,e=this.subscribed;SubscribeTypes.subscribeForum(t.fid,!e)},close:function(){}}})}));
