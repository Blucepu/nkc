!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}var i=function(){function e(){t(this,e),this.dom=$('<a class="bullet" target="_blank"><img class="bullet-avatar" /><p class="bullet-content"></p></a>'),this.working=!1,this.top=0,this.speed=0,this.width=0,this.left=0,this.timeout=null}return o(e,[{key:"initMouseEvent",value:function(){var t=this,e=this,o=function(o){var i=e.dom.offset().left,n=e.dom.width(),s=e.getTransitionTimeByDistance(i+n);e.dom.css({transform:"translatex(0)",transition:"transform ".concat(s,"ms linear 0s"),"z-index":"5555"}),t.createTimeout(s)},i=function(t){e.removeTimeout();var o=e.dom.offset().left;e.dom.css({transform:"translatex(".concat(o-e.left,"px)"),transition:"transform 0ms linear 0s","z-index":"9999"})};this.dom.on("mouseover",i),this.dom.on("touchstart",i),this.dom.on("mouseleave",o),this.dom.on("touchend",o)}},{key:"clearMouseEvent",value:function(){this.dom.off("mouseover").off("mouseleave").off("touchstart").off("touchend")}},{key:"setInfo",value:function(t){this.clearMouseEvent(),this.working=!0;var e=t.contentUrl,o=t.id,i=t.avatarUrl,n=t.content,s=t.username;this.dom.attr({href:e,"data-id":o}),this.dom.find(".bullet-avatar").attr({src:i,alt:s}),this.dom.find(".bullet-content").text(n)}},{key:"setPosition",value:function(t){var e=t.top,o=t.speed;this.clearMouseEvent(),this.speed=o,this.top=e;var i=$(body).width(),n=this.dom.width();this.left=-n,this.dom.css({transform:"translatex(".concat(i+n,"px)"),transition:"transform 0ms",left:this.left+"px",top:e+"px"}),this.initMouseEvent()}},{key:"getTransitionTimeByDistance",value:function(t){return Math.round(t/(this.speed/1e3))}},{key:"removeTimeout",value:function(){clearTimeout(this.timeout)}},{key:"createTimeout",value:function(t){var e=this;this.timeout=setTimeout((function(){e.working=!1}),t)}},{key:"getDom",value:function(){return this.dom}},{key:"move",value:function(){var t=this.dom.width(),e=$(body).width(),o=this.getTransitionTimeByDistance(t+e);this.dom.css({transform:"translatex(0)",transition:"transform ".concat(o,"ms linear 0s")}),this.createTimeout(o)}}]),e}(),n=function e(o){t(this,e),this.id="nkcBullet_".concat(o.postId),o.id=this.id,this.info=o},s=function(){function e(o){var i=o.top;t(this,e),$(body).width()>768?this.speed=Math.round(50*Math.random()+60):this.speed=Math.round(50*Math.random()+40),this.top=i,this.boat=null}return o(e,[{key:"isFree",value:function(){var t=!0;if(this.boat){var e=this.boat.getDom();e.offset().left+e.width()>$("body").width()&&(t=!1)}return t}}]),e}(),a=function(){function e(o){t(this,e);var i=o||{},n=i.trackCount,a=void 0===n?8:n,r=i.offsetTop,u=void 0===r?60:r,h=i.boatCount,f=void 0===h?64:h;this.id="nkcBullet".concat(Date.now()).concat(Math.round(1e3*Math.random())),this.setTimeoutId=null,this.bullets=[],this.boats=[],this.boatCount=f,this.tracks=[];for(var l=0;l<a;l++)this.tracks.push(new s({top:u+46*l}))}return o(e,[{key:"add",value:function(t){var e=new n(t);this.bullets.push(e),this.setTimeoutId||this.transition()}},{key:"getFreeBoats",value:function(){for(var t=this.tracks.length,e=[],o=0;o<this.boats.length;o++){var n=this.boats[o];if(!n.working&&(e.push(n),e>=t))break}var s=t-e.length;if(s>0)for(var a=this.boatCount-this.boats.length,r=0;r<(s>a?a:s);r++){var u=new i;this.boats.push(u),e.push(u)}return e}},{key:"transition",value:function(){var t=this,e=this,o=this.tracks,i=this.bullets;this.setTimeoutId=setTimeout((function(){for(var n=e.getFreeBoats(),s=0;s<o.length;s++){var a=o[s];if(a.isFree()){var r=i.shift();if(r){var u=a.top,h=a.speed,f=n.pop();if(f){f.setInfo(r.info),a.boat=f;var l=f.getDom();$(body).append(l),f.setPosition({top:u,speed:h}),f.move()}}}}i.length?e.transition():t.setTimeoutId=null}),300)}}]),e}();NKC.modules.BulletComments=a}));
