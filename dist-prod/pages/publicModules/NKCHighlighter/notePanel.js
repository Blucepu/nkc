!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";NKC.modules.NotePanel=function(){return function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=this;n.app=new Vue({el:"#moduleNotePanel",data:{uid:NKC.configs.uid,disableNoteContent:!1,show:!1,edit:!1,submitting:!1,content:"",note:""},updated:function(){this.resetDom()},methods:{fromNow:NKC.methods.fromNow,getUrl:NKC.methods.tools.getUrl,visitUrl:NKC.methods.visitUrl,setTextareaSize:function(t){this.$el.getElementsByClassName("create-textarea")[0].style.height=t},resetTextarea:function(){this.content="",this.setTextareaSize("2.5rem")},autoResize:function(t){var e=t.target;e.style.height="2.5rem",30<e.scrollHeight&&(e.style.height=e.scrollHeight+"px")},saveNewNote:function(){var t=this.content,e=this.note;Promise.resolve().then((function(){if(!t)throw"请输入笔记内容";var o=e.type,i=e.targetId,c=e.node,s=e._id;return n.app.submitting=!0,nkcAPI("/note","POST",{_id:s,type:o,targetId:i,content:t,node:c})})).then((function(t){n.app.content="",n.app.resetTextarea(),n.app.resetDom(),n.callback(t.note),n.app.extendNoteContent(t.note),n.app.note=t.note,n.app.submitting=!1,setTimeout((function(){n.app.scrollToBottom()}),200)})).catch((function(t){sweetError(t),n.app.submitting=!1}))},modifyNoteContent:function(t){t.edit?t.edit=!1:(t.edit=!0,t._content||(t._content=t.content))},extendNoteContent:function(t){t.notes.map((function(t){t.edit=!1,t._content=""}))},saveNote:function(t){var e,o,i=this.note,c=this.uid,s={};t.uid===c?(e="/note/".concat(i._id,"/c/").concat(t._id),o="PUT",s.content=t._content):(e="/nkc/note",o="POST",s.type="modify",s.noteId=i._id,s.noteContentId=t._id,s.content=t._content),nkcAPI(e,o,s).then((function(e){t.content=t._content,t.html=e.noteContentHTML,n.app.modifyNoteContent(t),Vue.set(i.notes,i.notes.indexOf(t),t)})).catch(sweetError)},open:function(t,e){var o=this;new Promise((function(o,i){n.app.resetDom(),n.callback=t;var c=e.id,s=e.note;s?(n.app.note=s,o()):nkcAPI("/note/".concat(c),"GET").then((function(t){n.app.extendNoteContent(t.note),n.app.note=t.note,o()})).catch(i)})).then((function(){o.show=!0,NKC.methods.initUnfixedPanel()})).catch(sweetError)},close:function(){this.show=!1},resetDom:function(){this.$el.style.height="auto"},scrollToBottom:function(){var t=this.$el.getElementsByClassName("note-panel-notes")[0];t.scrollTop=t.scrollHeight+1e4},deleteNoteContent:function(t,e){var n,o,i=this.note,c={};"delete"===e?(n="/note/".concat(i._id,"/c/").concat(t._id),o="DELETE"):(o="POST",n="/nkc/note",t.disabled?c.type="cancelDisable":c.type="disable",c.noteId=i._id,c.noteContentId=t._id),sweetQuestion("确定要执行此操作？").then((function(){return nkcAPI(n,o,c)})).then((function(){"delete"===e?t.deleted=!0:t.disabled=!t.disabled,sweetSuccess("操作成功")})).catch(sweetError)}}}),n.open=n.app.open,n.close=n.app.close,n.isOpen=function(){return!!e.app.show}}}()}));
