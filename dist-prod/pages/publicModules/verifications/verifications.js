!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var t=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=this;e.dom=$("#moduleVerifications"),e.dom.modal({show:!1,backdrop:"static"}),e.app=new Vue({el:"#moduleVerificationsApp",data:{type:"",error:"",vernierCaliper:{init:!1,answer:0,data:{question:"",backgroundColor:"",mainImageBase64:"",secondaryImageBase64:""}},touchCaptcha:{answer:[],data:{question:"",image:{base64:"",width:0,height:0}}}},methods:{getData:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.error="",nkcAPI("/verifications","GET").then((function(n){if("unEnabled"===n.verificationData.type)return e.done({secret:n.verificationData.type});t&&e.dom.modal("show"),e.app.type=n.verificationData.type,e.app[e.app.type].data=n.verificationData;var a=e.app["".concat(e.app.type,"Init")];a&&a()})).catch((function(n){console.log(n),e.app.error=n.error||n.message||n,e.app.type="error",t&&e.dom.modal("show")}))},close:function(){e.close()},vernierCaliperInit:function(){var e=this,t=0,n=0,a=!1;if(this.vernierCaliper.answer=0,!this.vernierCaliper.init){var i=this;setTimeout((function(){var r=i.$refs.button,o=function(e){return void 0===e.screenX?e.touches[0].screenX:e.screenX},c=function(e){e.preventDefault(),n=o(e),a=!0},s=function(e){a=!1,t=i.vernierCaliper.answer},u=function(e){a&&(i.vernierCaliper.answer=t+o(e)-n)};r.addEventListener("mousedown",c),document.addEventListener("mousemove",u),document.addEventListener("mouseup",s),r.addEventListener("touchstart",c),document.addEventListener("touchmove",u),document.addEventListener("touchend",s);var p=e.$refs,l=p.moveLeft,h=p.moveRight;l.onclick=function(){i.vernierCaliper.answer--,i.vernierCaliper.tempLeft=i.vernierCaliper.answer},h.onclick=function(){i.vernierCaliper.answer++,i.vernierCaliper.tempLeft=i.vernierCaliper.answer}}),300)}},touchCaptchaInit:function(){this.touchCaptcha.answer.length=0},touchCaptchaClick:function(e){var t=e.offsetX,n=e.offsetY,a=e.target;3!==this.touchCaptcha.answer.length&&this.touchCaptcha.answer.push({x:t,y:n,w:a.width,h:a.height})},submit:function(){var t=this[this.type],n=t.data,a=t.answer;nkcAPI("/verifications","POST",{verificationData:{answer:a,_id:n._id,type:n.type}}).then((function(t){e.done({secret:t.secret}),e.close()})).catch((function(t){console.log(t),screenTopWarning(t),e.app.getData()}))}}})}var n,a,i;return n=t,(a=[{key:"open",value:function(e){var t=this;if(!e)return new Promise((function(e,n){t.resolve=e,t.reject=n,t.callback=void 0,t.app.getData(!0)}));this.resolve=void 0,this.reject=void 0,this.callback=e,this.app.getData(!0)}},{key:"close",value:function(){var e=new Error("验证失败");this.callback?this.callback(e):this.reject(e),this.dom.modal("hide")}},{key:"done",value:function(e){this.callback?this.callback(void 0,e):this.resolve(e)}}])&&e(n.prototype,a),i&&e(n,i),t}();NKC.modules.Verifications=t}));
