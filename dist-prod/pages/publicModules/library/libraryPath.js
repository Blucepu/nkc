!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}NKC.modules.LibraryPath=function(){function r(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);var e=this;e.dom=$("#moduleLibraryPath"),e.dom.modal({show:!1,backdrop:"static"}),e.app=new Vue({el:"#moduleLibraryPathApp",data:{uid:NKC.configs.uid,folders:[],warning:"",folder:"",originFolders:[],permission:[],form:{type:"",folder:"",name:"",description:""}},computed:{originFoldersId:function(){return this.originFolders.map((function(e){return e._id}))},selectedFolderId:function(){if(this.folder)return this.folder._id},activeLine:function(){var e=this.folders,r=this.folder,t=0;return function e(n){for(var o=0;o<n.length;o++){var i=n[o];if(t++,i._id===r._id)return;if(i.folders&&i.folders.length)return e(i.folders)}}(e),t},nav:function(){if(this.folder)return this.getFolderNav(this.folder)},path:function(){if(this.nav)return"/"+this.nav.map((function(e){return e.name})).join("/")}},methods:{per:function(e){return this.permission.includes(e)},submitForm:function(){var r,t,n=this.form,o=n.type,i=n.folder,a=n.name,s=n.description;"create"===o?(r="POST",t="/library/".concat(i._id,"/list")):(r="PUT",t="/library/".concat(i._id)),nkcAPI(t,r,{name:a,description:s}).then((function(){e.app.form.folder="","create"===o?(i.close=!0,i.loaded=!1,i.folderCount=(i.folderCount||0)+1,e.app.switchFolder(i)):(i.name=a,i.description=s)})).catch((function(e){sweetError(e)}))},toForm:function(e,r){this.form.type=e,"modify"===e?(this.form.name=r.name,this.form.description=r.description):(this.form.name="",this.form.description=""),this.form.folder=r},getFolderNav:function(e){for(var r=this.originFolders,n=e.lid,o=[e];n;){var i,a=t(r);try{for(a.s();!(i=a.n()).done;){var s=i.value;s._id===n&&(o.unshift(s),n=s.lid)}}catch(e){a.e(e)}finally{a.f()}}return o},saveToOrigin:function(r){var n,o=e.app,i=o.originFoldersId,a=o.originFolders,s=t(r);try{for(s.s();!(n=s.n()).done;){var l=n.value;i.includes(l._id)||a.push(l);var f=l.folders,c=void 0===f?[]:f;e.app.saveToOrigin(c)}}catch(e){s.e(e)}finally{s.f()}},scrollToActive:function(){var e=this;setTimeout((function(){var r=e.activeLine,t=30*(r=(r-=3)>0?r:0),n=e.$refs.listBody;NKC.methods.scrollTop(n,t)}),100)},submit:function(){this.folder&&(e.callback({folder:this.folder,nav:this.nav,path:this.path}),this.close())},switchFolder:function(e){this.selectFolder(e),e.close?(e.close=!1,e.loaded||this.getFolders(e)):e.close=!0},selectFolder:function(e){this.folder=e},initFolders:function(r){var t="/library?type=init&lid=".concat(r,"&t=").concat(Date.now());nkcAPI(t,"GET").then((function(t){e.app.folders=t.folders,e.app.folder=t.folder,e.app.permission=t.permission,e.app.saveToOrigin(t.folders),r&&e.app.scrollToActive()})).catch((function(e){sweetError(e)}))},getFolders:function(r){var t;t=r?"/library?type=getFolders&lid=".concat(r._id,"&t=").concat(Date.now()):"/library?type=getFolders&t=".concat(Date.now()),nkcAPI(t,"GET").then((function(t){e.app.permission=t.permission,r&&(r.loaded=!0),t.folders.map((function(e){e.close=!0,e.loaded=!1,e.folders=[],r&&(e.parent=r)})),r?r.folders=t.folders:e.app.folders=t.folders,e.app.saveToOrigin(t.folders)})).catch((function(e){r&&(r.close=!0),sweetError(e)}))},open:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.lid,n=r.warning,o=void 0===n?"":n;this.warning=o,t?(this.folder="",this.initFolders(t)):this.folders&&this.folders.length||this.getFolders(),e.dom.modal("show")},close:function(){e.dom.modal("hide")}}})}var n,o,i;return n=r,(o=[{key:"open",value:function(e,r){this.callback=e,this.app.open(r)}},{key:"close",value:function(){this.app.close()}}])&&e(n.prototype,o),i&&e(n,i),r}()}));
