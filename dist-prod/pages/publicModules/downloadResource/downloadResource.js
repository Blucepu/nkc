!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t;NKC.modules.downloadResource=function(){return function t(){!function(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this,t);var o=this;o.dom=$("#moduleDownloadResource"),o.app=new Vue({el:"#moduleDownloadResourceApp",data:{uid:NKC.configs.uid,rid:"",fileName:"未知",type:"",size:0,costs:[],hold:[],status:"loading",fileCountLimitInfo:"",errorInfo:"",settingNoNeed:!1,description:""},computed:{costMessage:function(){return this.costs.map((function(t){return t.name+t.number})).join("、")},holdMessage:function(){return this.hold.map((function(t){return t.name+t.number})).join("、")}},methods:{fromNow:NKC.methods.fromNow,initDom:function(){o.dom.css({height:"37rem"}),o.dom.draggable({scroll:!1,handle:".module-sd-title",drag:function(t,e){e.position.top<0&&(e.position.top=0);var n=$(window).height();e.position.top>n-30&&(e.position.top=n-30);var i=o.dom.width();e.position.left<100-i&&(e.position.left=100-i);var r=$(window).width();e.position.left>r-100&&(e.position.left=r-100)}});var t=$(window).width();t<700?o.dom.css({width:.8*t,top:0,right:0}):o.dom.css("left",.5*(t-o.dom.width())-20),o.dom.show()},getResourceInfo:function(t){var o=this;o.status="loading",o.errorInfo="",nkcAPI("/r/".concat(t,"/detail"),"GET").then((function(t){var e=t.detail,n=e.free,i=e.paid,r=e.resource,s=e.costScores,a=e.fileCountLimitInfo;e.needScore;var c=e.description;o.description=c,o.fileCountLimitInfo=a,r.isFileExist?(o.status=n||i?"noNeedScore":"needScore",o.free=n,o.paid=i,o.fileName=r.oname,o.rid=r.rid,o.type=r.ext,o.size=NKC.methods.getSize(r.size),s&&(o.costs=s.map((function(t){return{name:t.name,number:t.addNumber/100*-1}})),o.hold=s.map((function(t){return{name:t.name,number:t.number/100}})))):o.status="fileNotExist"})).catch((function(t){o.fileCountLimitInfo=t.detail.fileCountLimitInfo,o.status="error",o.errorInfo=t.error||t.message||t}))},download:function(){var t=this,o=this.rid;this.fileName,nkcAPI("/r/".concat(o,"/pay"),"POST").then((function(){window.location.href="/r/".concat(o,"?d=attachment")})).catch(sweetError).then((function(){return t.getResourceInfo(t.rid)}))},fetchResource:function(){var t=this.rid;this.fileName,window.location.href="/r/".concat(t,"?d=attachment")},open:function(t){this.status="loading",this.initDom(),this.getResourceInfo(t)},close:function(){o.dom.hide()}}}),o.open=o.app.open,o.close=o.app.close}}(),t=new NKC.modules.downloadResource,NKC.methods.openFilePanel=function(o){t.open(o)},$("#wrap, .post").on("click",(function(o){if("clickAttachmentTitle"===$(o.target).attr("data-type")){o.preventDefault(),o.stopPropagation();var e=$(o.target).attr("data-id");return t.open(e),!1}}))}));
