!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";NKC.modules.SelectSticker=function(){var e=this;e.dom=$("#moduleSelectSticker"),e.app=new Vue({el:"#moduleSelectStickerApp",data:{type:"own",pageNumber:"",perpage:20,sharePerpage:24,emoji:[],share:!1,localStickers:[],stickers:[],paging:{}},mounted:function(){},methods:{getUrl:NKC.methods.tools.getUrl,initModule:function(){e.dom.css({height:"43.5rem"}),e.dom.draggable({scroll:!1,handle:".module-ss-title",drag:function(t,i){i.position.top<0&&(i.position.top=0);var o=$(window).height();i.position.top>o-30&&(i.position.top=o-30);var n=e.dom.width();i.position.left<100-n&&(i.position.left=100-n);var a=$(window).width();i.position.left>a-100&&(i.position.left=a-100)}})},resetDomPosition:function(){var t=e.dom,i=$(window).width();$(window).height(),i<700?t.css({width:.8*i,top:0,right:0}):t.css("left",.5*(i-t.width())-40)},selectType:function(e){this.type=e,["own","share"].includes(e)&&this.getStickers()},changePage:function(e){var t=this.paging;if(!(t.buttonValue.length<=1||"last"===e&&0===t.page||"next"===e&&t.page+1===t.pageCount)){var i="last"===e?-1:1;this.getStickers(t.page+i)}},getStickers:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=this.type;if(["own","share"].includes(i)){var o="/sticker?page=".concat(t,"&c=own&reviewed=true&perpage=").concat(this.perpage);"share"===i&&(o="/stickers?page=".concat(t,"&perpage=").concat(this.sharePerpage)),nkcAPI(o,"GET").then((function(t){e.app.stickers=t.stickers,e.app.paging=t.paging,t.emoji&&(e.app.emoji=t.emoji)})).catch(sweetError)}},fastSelectPage:function(){var e=this.pageNumber-1,t=this.paging;if(t&&t.buttonValue.length){var i=t.buttonValue[t.buttonValue.length-1].num;if(e<0||i<e)return sweetInfo("输入的页数超出范围");this.getStickers(e)}},selectSticker:function(t){e.callback({type:"sticker",data:t})},selectEmoji:function(t,i){e.callback({type:"emoji",data:t})},addLocalFile:function(t){this.fileToSticker(t).then((function(t){e.app.localStickers.push(t),e.app.uploadLocalSticker(t)}))},fileToSticker:function(e){return new Promise((function(t,i){var o={file:e,status:"unUploaded",progress:0};NKC.methods.fileToUrl(e).then((function(e){o.url=e,t(o)})).catch(i)}))},selectedLocalFile:function(){for(var t=$("#moduleSelectStickerInput")[0].files,i=0;i<t.length;i++){var o=t[i];e.app.addLocalFile(o)}},selectLocalFile:function(){$("#moduleSelectStickerInput").click()},uploadLocalSticker:function(t){Promise.resolve().then((function(){t.status="uploading";var i=new FormData;return i.append("file",t.file),i.append("type","sticker"),i.append("fileName",t.file.name),e.app.share&&i.append("share","true"),nkcUploadFile("/r","POST",i,(function(e,i){t.progress=i}))})).then((function(){t.status="uploaded",e.app.localStickers.splice(e.app.localStickers.indexOf(t),1),e.app.localStickers.length||e.app.selectType("own")})).catch((function(e){screenTopWarning(e.error||e),t.error=e.error||e,t.status="unUploaded"}))},restartUpload:function(e){this.uploadLocalSticker(e)},open:function(t,i){e.callback=t,this.resetDomPosition(),this.initModule(),e.dom.show(),this.getStickers()},close:function(){e.dom.hide()}}}),e.open=e.app.open,e.close=e.app.close}}));
