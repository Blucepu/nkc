!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e}).apply(this,arguments)}var n={operationId:NKC.configs.refererOperationId,data:NKC.configs.socketData||{}},o=io("/common",{forceNew:!1,reconnection:!0,autoConnect:!0,transports:["polling","websocket"],reconnectionDelay:5e3,reconnectionDelayMax:1e4,query:n,extraHeaders:{"X-socket-io":"polling"}});o.on("connect",(function(){console.log("socket连接成功")})),o.on("error",(function(){console.log("socket连接出错"),o.disconnect()})),o.on("disconnect",(function(){console.log("socket连接已断开")}));var t=function(){var e=$(".message-count").html();return e=Number(e)},c=function(e){var n=$(".message-switch"),o=$(".message-count");n.removeClass("hidden"),o.html(e)};function i(e){beep(e);var n=t();c(n+1)}NKC.configs.isApp||o.on("message",(function(e){if(e.message){var n=e.message.ty;if(n)if("STE"===n)i("notice");else if("STU"===n)i("reminder");else if("UTU"===n){var o=e.user,t=e.myUid;o.uid!==t&&i("message")}else"friendsApplication"===n&&i("friendsApplication")}})),e(window,{pageName:"",query:n,addSocketStatusChangedEvent:function(e){for(var n=[{type:"connect",name:"已连接"},{type:"disconnect",name:"连接已断开"},{type:"error",name:"连接出错"},{type:"connecting",name:"正在连接"},{type:"reconnecting",name:"正在重连"},{type:"reconnect",name:"重连成功"},{type:"connect_failed",name:"连接失败"},{type:"reconnect_failed",name:"重连失败"},{type:"connect_timeout",name:"连接超时"}],t=function(n){o.on(n.type,(function(){e(n)}))},c=0;c<n.length;c++){t(n[c])}},getNewMessageNumber:t,setNewMessageNumber:c,newMessageRemind:i,socket:o})}));
