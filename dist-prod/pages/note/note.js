!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t=NKC.methods.getDataById("data");t.note.notes.map((function(t){t.edit=!1,t.options=!1}));var e=new Vue({el:"#note",data:{uid:NKC.configs.uid,note:t.note,submitting:!1,content:""},mounted:function(){document.body.addEventListener("click",(function(t){t.target.classList.contains("note-options-icon")||e.note.notes.map((function(t){return t.options=!1}))}))},methods:{visitUrl:NKC.methods.visitUrl,getUrl:NKC.methods.tools.getUrl,fromNow:NKC.methods.fromNow,openOptions:function(t){e.note.notes.map((function(t){return t.options=!1})),t.options=!t.options},resetTextarea:function(t){var e;if(e=t?this.$refs[t._id][0]:this.$refs.newNote){e.style.height="5rem",60<e.scrollHeight&&(e.style.height=e.scrollHeight+"px")}},saveNewNote:function(){var t=this.content,n=this.note;Promise.resolve().then((function(){if(!t)throw"请输入笔记内容";var o=n.type,i=n.targetId,s=n._id,c=n.node;return e.submitting=!0,nkcAPI("/note","POST",{_id:s,type:o,targetId:i,node:c,content:t})})).then((function(t){e.content="",t.note.notes.map((function(t){t.options=!1,t.edit=!1})),e.note=t.note,e.submitting=!1,setTimeout((function(){e.resetTextarea()}),50)})).catch((function(t){e.submitting=!1,sweetError(t)}))},saveNote:function(t){var n,o,i=this.note,s=this.uid,c={};t.uid===s?(n="/note/".concat(i._id,"/c/").concat(t._id),o="PUT",c.content=t.content):(n="/nkc/note",o="POST",c.type="modify",c.noteId=i._id,c.noteContentId=t._id,c.content=t.content),nkcAPI(n,o,c).then((function(n){t.html=n.noteContentHTML,e.modifyNoteContent(t),Vue.set(i.notes,i.notes.indexOf(t),t)})).catch(sweetError)},modifyNoteContent:function(t){t.edit=!t.edit,t.edit&&setTimeout((function(){e.resetTextarea(t)}),50)},deleteNoteContent:function(t,e){var n,o,i=this.note,s={};"delete"===e?(n="/note/".concat(i._id,"/c/").concat(t._id),o="DELETE"):(o="POST",n="/nkc/note",t.disabled?s.type="cancelDisable":s.type="disable",s.noteId=i._id,s.noteContentId=t._id),sweetQuestion("确定要执行此操作？").then((function(){return nkcAPI(n,o,s)})).then((function(){"delete"===e?t.deleted=!0:t.disabled=!t.disabled,sweetSuccess("操作成功")})).catch(sweetError)}}});window.app=e}));
