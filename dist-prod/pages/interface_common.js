!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function n(e){return document.getElementById(e)}function o(e,t,n,o,a){return o=o||{},new Promise((function(r,i){var s,l=new XMLHttpRequest;"upload"===e&&a&&(l.upload.onprogress=function(e){s=e;var t=e.loaded/e.total*100;t>=100&&(t=100);var n=t.toFixed(1);a(e,Number(n))}),l.onreadystatechange=function(){var t;if(4===l.readyState){try{t=JSON.parse(l.responseText)}catch(e){t=l.responseText}0===l.status?i("发起请求失败，请检查网络连接"):l.status>=400||t.error||t instanceof Error?i(t):(a&&"upload"===e&&s&&a(s,100),r(t))}};try{"upload"===e?(l.open(n||"POST",t,!0),l.setRequestHeader("FROM","nkcAPI"),l.setRequestHeader("Accept","*/*"),l.send(o)):(l.open(n,t,!0),l.setRequestHeader("Content-type","application/json"),l.setRequestHeader("FROM","nkcAPI"),l.setRequestHeader("Accept","*/*"),l.send(JSON.stringify(o)))}catch(e){i(e)}}))}function a(e,t,n){return o("post",e,t,n)}function r(e,t,n,a){return o("upload",e,t,n,a)}function i(e){if(f)return f(JSON.stringify(e));alert(JSON.stringify(e))}function s(e){var t=!1;return window.addEventListener("popstate",(function n(o){e(),window.removeEventListener("popstate",n),t=!0})),window.history.pushState({sign:"swal"},"alert",""),window.history.go(1),function(){t||window.history.go(-1)}}function l(e,t){var n=s((function(){Swal.close()}));return e+="",(t=t||{autoHide:!0,timer:2e3}).autoHide?Swal({type:"success",confirmButtonText:"关闭",timer:t.timer,text:e}).then(n):Swal({type:"success",confirmButtonText:"关闭",text:e}).then(n)}function c(e){var t=s((function(){Swal.close()}));return console.log(e),e=e.error||e,e+="",Swal({type:"error",confirmButtonText:"关闭",text:e.error||e}).then(t)}function u(e){var t=s((function(){Swal.close()}));e+="",Swal({type:"warning",confirmButtonText:"关闭",text:e}).then(t)}function d(e){return m(e,"success")}function f(e){return m(e=e.error||e,"warning")}window.lastEditRange=void 0,t(window,{geid:n,gv:function(e){return n(e).value},ga:function(e,t){return n(e).getAttribute(t)},hset:function(e,t){n(e).innerHTML=t},display:function(e){n(e).style="display:inherit;"}}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var o=atob(this.toDataURL(t,n).split(",")[1]),a=o.length,r=new Uint8Array(a),i=0;i<a;i++)r[i]=o.charCodeAt(i);e(new Blob([r],{type:t||"image/png"}))}});var p=0;function m(e,t){var n=$("<div/>").text(e).html(),o=h();return new Promise((function(e,a){$("#alertOverlay").append('<div class="alert alert-'+t+'" id="'+o+'" role="alert" style="opacity:0.9;text-align:center;display:block; pointer-events:none; position:relative;margin:auto; top:0;max-width:500px; width:100%; margin-bottom:3px">'+n+"</div>");var r="#"+o;setTimeout((function(){$(r).fadeOut("slow",(function(){$(r).remove(),e(r)}))}),2e3)}))}function h(){return"alert"+(++p).toString()}function g(){$("body").prepend('<div id="alertOverlay" style="z-index:10001; display:block; position:fixed; top:0; width:100%;"></div>')}g(),window.ReHighlightEverything=function(){$("pre code").each((function(e,t){hljs.highlightBlock(t)}))},window.HighlightEverything=function(){hljs.configure({tabReplace:"    "}),hljs.initHighlighting()};var w,v,y,b=function(){var e={},t=/([^“”‘’\/<\'\"\(\[\]\=]|^)\b((?:(?:https?|ftp|file):\/\/|www\.|ftp\.)[-A-Z0-9+&@#/%=~_|$?!:,.]*[A-Z0-9+&@#\/%=~_|$])/gi;e.URLifyMarkdown=function(e){return e.replace(t,(function(e,t,n){return t+"<"+n+">"}))},e.URLifyBBcode=function(e){return e.replace(t,(function(e,t,n){return t+"[url]"+n+"[/url]"}))};var o=/([^“”‘’\/<\'\"\(\[\]\=]|^)\b((?:(?:https?|ftp|file):\/\/|www\.|ftp\.)[-A-Z0-9+&@#/%=~_|$?!:,.]*[A-Z0-9+&@#\/%=~_|$])/gi;return e.URLifyHTML=function(e){return e.replace(o,(function(e,t,n,o,a){return-1===t.indexOf(">")?n.indexOf("http")>-1?t+'<a href="'+n+'" target="_blank">'+n+"</a>":t+'<a href="http://'+n+'" target="_blank">'+n+"</a>":e}))},e.mapWithPromise=function e(t,n,o){return o=o||0,Promise.resolve().then((function(){if(t.length&&o!==t.length)return console.log("run func on #"+o+" element"),n(t[o]);throw"mapping ended"})).then((function(){return e(t,n,o+1)})).catch((function(e){return console.log(e),e}))},e.backcolorChange=function(e){n("body").style.backgroundColor=e},e}();function T(e){var t,n;if(window.getSelection){if(document.getElementById("text-elem").focus(),t=window.getSelection(),lastEditRange&&(t.removeAllRanges(),t.addRange(lastEditRange)),t.getRangeAt&&t.rangeCount){(n=t.getRangeAt(0)).deleteContents();var o=document.createElement("div");o.innerHTML=e;for(var a,r,i=document.createDocumentFragment();a=o.firstChild;)r=i.appendChild(a);n.insertNode(i),r&&((n=n.cloneRange()).setStartAfter(r),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(e);window.lastEditRange=t.getRangeAt(0)}function C(e,t,n,o){var a=new XMLHttpRequest;a.upload.onprogress=function(e){o&&o(e);var t=e.loaded/e.total*100;t=t.toFixed(1),$("#uploadInfo").css("display","block"),$("#uploadInfo span").text(t+"%"),console.log("Uploaded "+t+"%")},a.onreadystatechange=function(){if(4==a.readyState)if(a.status>=200&&a.status<300)setTimeout((function(){$("#uploadInfo").css("display","none")}),5e3),n(JSON.parse(a.responseText));else{var e;setTimeout((function(){$("#uploadInfo").css("display","none")}),5e3);try{e=JSON.parse(a.responseText)}catch(t){console.log(t),e=a.responseText}f(e.error)}},a.open("POST",e,!0),a.setRequestHeader("FROM","nkcAPI"),a.send(t)}function x(e,t,n){var o;return o=-1!==["hr","br","input"].indexOf(e)?$("<"+e+">"):$("<"+e+"></"+e+">"),t&&(o.attr(t),n&&o.css(n)),o}function S(){$(".fa-switch-icon,.fa-switch").on("click",(function(){$(this).hasClass("fa-toggle-on")?$(this).removeClass("fa-toggle-on").addClass("fa-toggle-off"):$(this).hasClass("fa-toggle-off")&&$(this).removeClass("fa-toggle-off").addClass("fa-toggle-on"),$(this).children(".fa").hasClass("fa-caret-down")?$(this).children(".fa").removeClass("fa-caret-down").addClass("fa-caret-up"):$(this).children(".fa").removeClass("fa-caret-up").addClass("fa-caret-down")}))}$("document").ready((function(){$("#text-elem").on("click",(function(){var e=document.getSelection();window.lastEditRange=e.getRangeAt(0)})),$("#text-elem").on("keyup",(function(){var e=document.getSelection();window.lastEditRange=e.getRangeAt(0)}))}));var k="";function E(){$(".progressBar").parent("div").remove();var e=x("div",{},{}),t=x("div",{class:"progressBar progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"45",valuemin:"0","aria-valuemax":"100"},{width:"0%"});e.append(t),$("body").append(e),t.width("70%")}function B(){var e=$(".progressBar");e.css({width:"100%","transition-duration":"0s","-moz-transition-duration":"0s","-webkit-transition-duration":"0s","-o-transition-duration":"0s"}),e.fadeOut(500,(function(){e.parent("div").remove()}))}function A(e,t){a("/t/"+e+"/hometop","POST",t?{latest:!0}:{}).then((function(){window.location.reload()})).catch((function(e){f(e.error||e)}))}function P(e,t){var n="/t/"+e+"/hometop";t&&(n+="?latest=true"),a(n,"DELETE",{}).then((function(){window.location.reload()})).catch((function(e){f(e.error||e)}))}$((function(){var e;$('[data-toggle="tooltip"]').length>0&&$('[data-toggle="tooltip"]').tooltip(),S(),0!==(w=$("#digestModel")).length&&w.modal({show:!1}),0!==(v=$("#creditModel")).length&&(v.modal({show:!1}),k=v.attr("data-credit-score-name")),0!==(y=$("#module_post_warning")).length&&y.modal({show:!1}),(e=document.getElementById("paging_nav_input"))&&(e.onkeydown=function(e){if("Enter"===e.key||13===e.keyCode){var t=document.getElementById("paging_nav_button");if(!t)return;t.click()}}),function(){for(var e=function(e){var t=e.attr("id");e.keydown((function(e){13===e.keyCode&&NKC.methods.search(t)}))},t=$(".navbar-search input"),n=0;n<t.length;n++){e(t.eq(n))}}(),function e(){setTimeout((function(){for(var t=$('[data-type="nkcTimestamp"]'),n=0;n<t.length;n++){var o,a=t.eq(n),r=a.attr("data-time-type"),i=a.attr("data-time");if(i=Number(i),"fromNow"===r)o=NKC.methods.tools.fromNow;else{if("briefTime"!==r)continue;o=NKC.methods.tools.briefTime}var s=o(i);a.text()!==s&&a.text(s)}e()}),3e4)}()})),0!==$('input[data-control="hue"]').length&&$('input[data-control="hue"]').minicolors&&$('input[data-control="hue"]').minicolors({control:$(void 0).attr("data-control")||"hue",defaultValue:$(void 0).attr("data-defaultValue")||"",inline:"true"===$(void 0).attr("data-inline"),letterCase:$(void 0).attr("data-letterCase")||"lowercase",opacity:$(void 0).attr("data-opacity"),position:$(void 0).attr("data-position")||"bottom left",change:function(e,t){e&&t&&(e+=", "+t)},theme:"bootstrap"});var O=$("#postRecycleModal");function L(e){return e=(e/100).toFixed(2)}$("#recycleModal");var N=0;function R(e){$(".nkc-drawer-"+e).addClass("active"),$(".nkc-drawer-"+e+"-body").addClass("active"),$(".nkc-drawer-"+e+"-mask").addClass("active"),I("left"===e?"right":"left"),D(!0)}function I(e){"app"===localStorage.getItem("apptype")&&"left"===e&&api.setRefreshHeaderInfo({bgColor:"#eeeeee",textColor:"#aaaaaa",textDown:"下拉刷新",textUp:"松开刷新",textLoading:"刷新成功，正在加载资源...",showTime:!1},(function(e,t){window.location.reload()})),$(".nkc-drawer-"+e).removeClass("active"),$(".nkc-drawer-"+e+"-mask").removeClass("active"),$(".nkc-drawer-"+e+"-body").removeClass("active"),D(!1)}function D(e){var t=document.body;e?(N=window.scrollY,t.style.position="fixed",t.style.top=-N+"px"):(t.style.position="",t.style.top="",window.scrollTo(0,N))}function F(e,t){return NKC.methods.visitUrl(e,t)}function q(e){var t=e.indexOf("#");t>0&&(e=e.substring(0,t));var n,o=e.split("?")[0],a="",r=-1!==e.indexOf("?")?e.split("?")[1]:"";if(a=o+"?apptype=app",""!==r){n=r.split("&");for(var i=0;i<n.length;i++)a+="&"+n[i]}return a}t(window,{generalRequest:o,nkcAPI:a,nkcUploadFile:r,jalert:function(e){if(d)return d(JSON.stringify(e));alert(JSON.stringify(e))},jwarning:i,toAlertOpenState:s,sweetAlert:function(e){var t=s((function(){Swal.close()}));return e=(e.error||e)+"",Swal({confirmButtonText:"关闭",text:e}).then(t)},sweetSuccess:l,sweetError:c,sweetInfo:function(e){var t=s((function(){Swal.close()}));e+="",Swal({type:"info",confirmButtonText:"关闭",text:e}).then(t)},sweetWarning:u,sweetConfirm:function(e){var t=s((function(){Swal.close()}));return e+="",new Promise((function(n,o){Swal({type:"warning",confirmButtonText:"确定",cancelButtonText:"取消",text:e,showCancelButton:!0,reverseButtons:!0}).then((function(e){!0===e.value?n():t()}))}))},sweetQuestion:function(e){var t=s((function(){Swal.close()}));return e+="",new Promise((function(n,o){Swal({type:"question",confirmButtonText:"确定",cancelButtonText:"取消",text:e,showCancelButton:!0,reverseButtons:!0}).then((function(e){!0===e.value?n():t()}))}))},asyncSweetCustom:function(e){var t=s((function(){Swal.close()}));return Swal({confirmButtonText:"关闭",html:e||""}).then(t)},asyncSweetSuccess:function(e,t){var n=s((function(){Swal.close()}));return new Promise((function(n,o){return e+="",(t=t||{autoHide:!0,timer:2e3}).autoHide?Swal({type:"success",confirmButtonText:"关闭",timer:t.timer,text:e}).then((function(){n()})):Swal({type:"success",confirmButtonText:"关闭",text:e}).then((function(){n()}))})).then(n)},asyncSweetError:function(e){var t=s((function(){Swal.close()}));return new Promise((function(t,n){return e=e.error||e,e+="",Swal({type:"error",confirmButtonText:"关闭",text:e.error||e}).then((function(){t()}))})).then(t)},screenTopAlert:d,screenTopWarning:f,screenTopAlertOfStyle:m,getID:h,screenTopQuestion:function(e,t){e=$("<div/>").text(e).html();var o=h(),a=h(),r='<select id="'+a+'">'+t.map((function(e){return"<option>"+e+"</option>"})).join("")+"</select>",i=h(),s='<button id="'+i+'">确认</button>',l=h(),c='<button id="'+l+'">取消</button>';return new Promise((function(t,u){function d(){$("#"+o).remove()}$("#alertOverlay").append('<div style="padding:10px;background-color:#cef;opacity:0.9;text-align:center;display:block;margin:auto;" id="'+o+'"><p>'+e+"</p>"+r+"<p>"+s+c+"</p></div>"),$("#"+i).click((function(){t(n(a).value),d()})),$("#"+l).click((function(){u(),d()}))}))},screenTopAlertInit:g,redirect:function(e){e.slice(0,e.indexOf("#")),F(e)},common:b,edInsertContent:function(e,t,n,o){if(myField=document.getElementById(e),"content"==e)if(myField.selectionStart||"0"==myField.selectionStart){var a=myField.selectionStart,r=myField.selectionEnd,i=myField.scrollTop;myField.value=myField.value.substring(0,a)+t+myField.value.substring(r,myField.value.length),myField.selectionStart=a+t.length,myField.selectionEnd=a+t.length,myField.scrollTop=i}else document.selection?(myField.focus(),sel=document.selection.createRange(),sel.text=t,myField.focus()):myField.value+=t;if("text-elem"==e){T(("jpg"===(n=n.toLowerCase())||"png"===n||"gif"===n||"bmp"===n||"jpeg"===n||"svg"===n?"<p><img src="+t+" class='editImgSingle'></p>":"mp4"===n?"<video src="+t+" controls style=width:640px;>video</video>":"mp3"===n?"<audio src="+t+" controls>Your browser does not support the audio element</audio>":"<p><a href="+t+"><img src=/default/default_thumbnail.png>"+o+"</a></p>")+"&nbsp;"),$("#text-elem").focus()}},insertHtmlAtCaret:T,postUpload:C,uploadFile:function(e,t,n){$(t).on("change",(function(){var o,a=$(t).get(0);if(!(a.files.length>0))return i("未选择文件");o=a.files[0];var r=new FormData;r.append("file",o),C(e,r,n)}))},uploadFilePromise:function(e,t,n,o){return r(e,o,t,n)},deleteBill:function(e){!1!==confirm("确定要删除该条记录？")&&a("/fund/bills/"+e,"DELETE",{}).then((function(){window.location.reload()})).catch((function(e){f(e.error)}))},bannedUser:function(e,t){var n="PUT";t&&(n="DELETE"),a("/u/"+e+"/banned",n,{}).then((function(){window.location.reload()})).catch((function(e){f(e.error||e)}))},newElement:x,iconSwitch:S,deleteForum:function(e){!1!==confirm("确定要删除？")&&a("/f/"+e,"DELETE",{}).then((function(){d("删除成功"),setTimeout((function(){F("/f")}),1500)})).catch((function(e){f(e.error||e)}))},openPostWarningDom:function(e){var t=$("#module_post_warning");t.attr("data-pid",e).show(),t.modal("show")},submitPostWarning:function(){var e=$("#module_post_warning"),t=e.attr("data-pid"),n=$("#module_post_warning textarea"),o=n.val();if(!o)return f("请输入修改建议");a("/p/"+t+"/warning","POST",{reason:o}).then((function(){e.modal("hide"),e.attr("data-pid",""),n.val(""),l("提交成功")})).catch((function(e){c(e)}))},cancelXsf:function(e,t){var n=prompt("请输入撤销原因：");if(null!==n)return""===n?f("撤销原因不能为空！"):void a("/p/"+e+"/credit/xsf/"+t+"?reason="+n,"DELETE",{}).then((function(){window.location.reload()})).catch((function(e){f(e.error||e)}))},credit:function(e,t,n){var o={xsf:"评学术分",kcb:"鼓励"}[t];v.one("show.bs.modal",(function(r){var i=r.currentTarget.getElementsByClassName("btn"),s=r.currentTarget.getElementsByClassName("modal-title"),l=r.currentTarget.getElementsByClassName("kcb-info"),c=r.currentTarget.getElementsByClassName("xsf-info"),u=r.currentTarget.getElementsByClassName("num")[0],d=r.currentTarget.getElementsByClassName("description")[0];if("kcb"===t){for(var p=0;p<c.length;p++)c[p].style.display="none";for(p=0;p<l.length;p++)l[p].style.display="inline-block";u.value=""}else{u.value="";for(p=0;p<l.length;p++)l[p].style.display="none";for(p=0;p<c.length;p++)c[p].style.display="inline-block"}d.value="",s[0].innerText=o,i[1].onclick=function(){if(i[1].setAttribute("disabled","disabled"),"xsf"===t){var o={num:u.value,description:d.value};return a("/p/"+e+"/credit/xsf","POST",o).then((function(){v.modal("hide"),window.location.reload()})).catch((function(e){f(e.error),i[1].removeAttribute("disabled")}))}if("kcb"===t){if(100*u.value>n)return f("你的"+k+"不足");o={num:100*u.value,description:d.value};a("/p/"+e+"/credit/kcb","POST",o).then((function(){v.modal("hide"),window.location.reload()})).catch((function(e){f(e.error||e),i[1].removeAttribute("disabled")}))}}})),v.modal("show")},removedraft:function(e,t){if(!1!==confirm("确认舍弃草稿？")){a("/u/"+e+"/drafts/"+t+"?uid="+e+"&did="+t,"DELETE",{}).then((function(){l("已舍弃草稿"),"all"===t?$("#draftList").fadeOut("slow"):$("#draft"+t).fadeOut("slow")})).catch((function(e){u(e.error)}))}},htmlAPI:function(t,n,o,a){var r=a.id;return E(),new Promise((function(a,i){$.ajax({url:t,dataType:"json",method:n,headers:{FROM:"htmlAPI"},data:o}).done((function(e){if(B(),$(r).html(e.html),e.user){var t=e.user.newMessage,n=t.replies+t.message+t.system+t.at;0===n?($(".newMessage").text(""),$("#messageIco").css("display","none")):($(".newMessage").text(n),$("#messageIco").css("display","block"));var o=e.user.draftCount;0===o?$(".draftMessage").text(""):$(".draftMessage").text(o)}return a(e)})).fail((function(t){return 0===t.status?(B(),f("连接失败")):(B(),f((t="object"===e(t.responseText)?JSON.parse(t.responseText):t.responseText).error||t),i(t))}))}))},createProgressBar:E,removeProgressBar:B,homeTop:A,unHomeTop:P,latestTop:function(e){A(e,"latest")},unLatestTop:function(e){P(e,"latest")},unHomeAd:function(e){a("/t/"+e+"/ad","DELETE").then((function(){window.location.reload()})).catch(c)},openThread:function(e){a("/t/"+e+"/close","DELETE",{}).then((function(){window.location.reload()})).catch((function(e){f(e.error||e)}))},closeThread:function(e){a("/t/"+e+"/close","POST",{}).then((function(){window.location.reload()})).catch((function(e){f(e.error||e)}))},digestPost:function(e){var t=function(t){a("/p/"+e+"/digest","POST",t).then((function(){d("设置成功"),w.length>0&&w.modal("hide"),window.location.reload()})).catch((function(e){f(e.error||e)}))};if(0===w.length)return t({});w.one("show.bs.modal",(function(e){var n=e.currentTarget.getElementsByTagName("button");n[2]&&(n[2].onclick=function(){var n=e.currentTarget.getElementsByTagName("input")[0].value;if(n=Number(n),"number"!=typeof(n*=100)||n%1!=0)return f("请输入正确的数额");t({kcb:n})})})),w.modal("show")},unDigestPost:function(e){a("/p/"+e+"/digest","DELETE",{}).then((function(){d("已取消精选"),window.location.reload()})).catch((function(e){f(e.error||e)}))},beep:function(e){var t=document.getElementById("beep");t&&"true"===t.getAttribute("data-"+e)&&(t.setAttribute("src","/default/"+e+".wav?t="+Date.now()),t.play())},updateBeep:function(e){var t=document.getElementById("beep");t&&(e.systemInfo?t.setAttribute("data-notice","true"):t.setAttribute("data-notice","false"),e.usersMessage?t.setAttribute("data-message","true"):t.setAttribute("data-message","false"),e.reminder?t.setAttribute("data-reminder","true"):t.setAttribute("data-reminder","false"))},initPhotoSwipe:function(e){var t=document.querySelectorAll(".pswp")[0];if(t){var n={index:0,showHideOpacity:!0,closeOnScroll:!1,clickToCloseNonZoomable:!1,showAnimationDuration:0,hideAnimationDuration:0,mouseUsed:!0,history:!1,bgOpacity:.9},o=[],a=$(window).width(),r=$(window).height();e=e.replace(/\?.*/g,"");var i=new Image;i.src=e,i.onload=function(){var s,l;a/r>i.width/i.height?(l=r,s=i.width*l/i.height):(s=a,l=i.height*s/i.width),o.push({src:e,w:s,h:l}),new PhotoSwipe(t,PhotoSwipeUI_Default,o,n).init()}}},shareTo:function(t,o,r,i,s){var l="http://"+window.location.host+"/default/logo3.png",c=window.location.origin;if("weChat"!==o&&"link"!==o)var u=window.open();r&&a("/s","POST",{str:r,type:t,targetId:s}).then((function(a){var r=c+a.newUrl;if("link"==o){var d="copyArea"+s,p="copyLink"+s;document.getElementById(d).style.display="block",document.getElementById(p).value=r}if("qq"==o&&(u.location="http://connect.qq.com/widget/shareqq/index.html?url="+r+"&title="+i+"&pics="+l+"&summary="+document.querySelector('meta[name="description"]').getAttribute("content")),"qzone"==o&&(u.location="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+r+"&title="+i+"&pics="+l+"&summary="+document.querySelector('meta[name="description"]').getAttribute("content")),"weibo"==o&&(u.location="http://v.t.sina.com.cn/share/share.php?url="+r+"&title="+i+"&pic="+l),"weChat"==o){var m;if("post"==t){m=n(s+"Qrcode")}else{if("forum"==t){var h=document.getElementsByClassName("forumQrcode");for(var g in h){var w,v=h[g];if(v&&"object"==e(v))v.style.display="inline-block",w=(w=r).replace(/\?.*/g,""),QRCode.toCanvas(v,w,{scale:3,margin:1,width:150,color:{dark:"#000000"}},(function(e){}))}}m=n(t+"Qrcode")}if(m.style.display="inline-block",m)w=(w=r).replace(/\?.*/g,""),QRCode.toCanvas(m,w,{scale:3,margin:1,width:150,color:{dark:"#000000"}},(function(e){e&&f(e)}))}})).catch((function(e){f(e||e.error),f("请登录")}))},copyLink:function(e){if(!e)return f("链接复制失败，请手动复制");var t="copyLink"+e;document.getElementById(t).select(),document.execCommand("copy",!1,null)?d("链接复制成功"):f("链接复制失败，请手动复制")},openwin:function(e){var t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("target","_blank"),t.setAttribute("id","camnpr"),document.body.appendChild(t),t.click()},obtainPureText:function(e,t,n){return e=e.replace(/<[^>]+>/g,""),n=parseInt(n),!0===t&&e.length>n&&(e.substr(e.length-n,e.length),e=e.substr(0,n)+"..."),e},postsVote:function(e,t){if(!NKC.configs.uid||"login"===t)return NKC.methods.toLogin("login");var n="/p/"+e+"/vote/down";"up"===t&&(n="/p/"+e+"/vote/up"),a(n,"POST",{}).then((function(n){var o=n.post.voteUp,a=document.querySelector('.posts-vote-up[data-pid="'+e+'"]'),r=document.querySelector('.posts-vote-down[data-pid="'+e+'"]'),i=document.querySelector('.posts-vote-number[data-pid="'+e+'"]'),s=a.classList.contains("active"),l=r.classList.contains("active");"up"===t?s?(r.classList.remove("active"),a.classList.remove("active")):(r.classList.remove("active"),a.classList.add("active")):l?(a.classList.remove("active"),r.classList.remove("active")):(a.classList.remove("active"),r.classList.add("active")),i.innerHTML=o||""})).catch((function(e){f(e.error||e)}))},hideKcbRecordReason:function(e,t,n){a("/p/"+e+"/credit/kcb/"+t,"PUT",{hide:!!n}).then((function(){d(n?"屏蔽成功":"已取消屏蔽")})).catch((function(e){f(e)}))},lottery:function(){a("/lottery","POST",{}).then((function(e){var t=e.result,n=e.score,o=document.getElementsByClassName("lottery-close");if(0!==o.length){o=o[0];var a=document.getElementsByClassName("lottery-open");if(0!==a.length){a=a[0],o.style.display="none",a.style.display="block";var r=a.getElementsByClassName("lottery-info-header");if(0!==r.length){if(!t)return r[0].innerText="哈哈没中";r[0].innerText=t.name;var i=a.getElementsByClassName("lottery-info");0!==i.length&&(i[0].innerText="获得"+n.name+L(n.num)+n.unit)}}}})).catch((function(e){f(e.error||e)}))},closeLottery:function(){var e=document.getElementsByClassName("lottery-info-header");if(0!==e.length&&e[0].innerText){var t=document.getElementsByClassName("lottery");if(0===t.length)return;return t[0].style.display="none"}a("/lottery","DELETE",{}).then((function(){var e=document.getElementsByClassName("lottery");0!==e.length&&((e=e[0]).style.display="none")})).catch((function(e){f(e.error||e)}))},scrollToBottom:function(){var e=$("html"),t=$("body");e.css("height","auto"),t.css("height","auto"),$("html,body").animate({scrollTop:document.body.offsetHeight},300),e.css("height","100%"),t.css("height","100%")},scrollToTop:function(){var e=$("html"),t=$("body");e.css("height","auto"),t.css("height","auto"),$("html,body").animate({scrollTop:0},300),e.css("height","100%"),t.css("height","100%")},disablePostClick:function(e,t){window.localStorage.pid=e,"post"===t?O.modal():"thread"===t&&deleteThread()},disablePost:function(e,t){a("/p/"+e+"/disabled","PUT",{disabled:!0,para:t}).then((function(t){d(e+" 已屏蔽")})).catch((function(e){f(e.error)}))},enablePost:function(e){a("/threads/unblock","POST",{postsId:[e]}).then((function(){d(e+" 已解除屏蔽")})).catch((function(e){f(e.error)}))},disabledThread:function(e,t){return a("/t/"+e+"/disabled","POST",{para:t}).then((function(){d("已将ID为 "+e+" 的文章移动至回收站")})).catch((function(t){f("移动ID为 "+e+" 的文章失败："+t.error)}))},moveThread:function(e,t,n,o){return a("/t/"+e+"/moveThread","PUT",{tid:e,fid:t,cid:n,para:o}).then((function(){d("已将帖子 "+e+" 移动至板块 "+t+" 分类 "+n+"下")})).catch((function(e){f("移动失败："+e.error)}))},numToFloatTwo:L,nkcDrawerBodyTop:N,openNKCDrawer:R,closeNKCDrawer:I,toggleNKCDrawer:function(e){$(".nkc-drawer-"+e).hasClass("active")?I(e):("app"===localStorage.getItem("apptype")&&api.frameName&&api.setFrameAttr({name:api.frameName,bounces:!1}),R(e))},stopBodyScroll:D,openLeftDrawer:function(){var e=$(".drawer-dom .left"),t=$("#leftDom"),n=$(".drawer-fixed-button-left");n.addClass("active"),n.find(".fa").removeClass("fa-angle-double-right"),n.find(".fa").addClass("fa-angle-double-left"),n.attr("onclick","closeDrawer()"),e.addClass("active"),e.find(".dom").html()||e.find(".dom").html(t.html()),$(".drawer-mask").addClass("active"),D(!0)},openRightDrawer:function(){"app"===localStorage.getItem("apptype")&&api.frameName&&api.setFrameAttr({name:api.frameName,bounces:!1});var e=$(".drawer-dom .right"),t=$("#rightDom"),n=$(".drawer-fixed-button-right");if(n.addClass("active"),n.attr("onclick","closeDrawer()"),n.find(".fa").removeClass("fa-angle-double-left"),n.find(".fa").addClass("fa-angle-double-right"),e.addClass("active"),!e.find(".dom").html()&&(e.find(".dom").html(t.html()),"app"===localStorage.getItem("apptype"))){var o=document.querySelectorAll("a");Array.prototype.forEach.call(o,(function(e){e.addEventListener("click",(function(e){if(e.preventDefault(),this.href)if(siteHostLink(this.href)){var t=this.href.indexOf("?"),n="",o=!1;if((n=t>-1?this.href.substring(0,t):this.href).length>0&&api.winName.indexOf(n)>-1&&(o=!0),"/"===this.pathname&&"root"===api.winName)return void(window.location.href=q(this.href));o?appFreshUrl(this.href):appOpenUrl(this.href)}else api.openWin({name:"link",url:"widget://html/link/link.html",pageParam:{name:"link",linkUrl:this.href}})}))}))}$(".drawer-mask").addClass("active"),D(!0)},closeDrawer:function(){"app"===localStorage.getItem("apptype")&&api.setRefreshHeaderInfo({bgColor:"#eeeeee",textColor:"#aaaaaa",textDown:"下拉刷新",textUp:"松开刷新",textLoading:"刷新成功，正在加载资源...",showTime:!1},(function(e,t){window.location.reload()})),$(".drawer-dom .left").removeClass("active"),$(".drawer-dom .right").removeClass("active");var e=$(".drawer-fixed-button-left");e.removeClass("active"),e.find(".fa").removeClass("fa-angle-double-left"),e.find(".fa").addClass("fa-angle-double-right"),e.attr("onclick","openLeftDrawer()");var t=$(".drawer-fixed-button-right");t.removeClass("active"),t.find(".fa").removeClass("fa-angle-double-right"),t.find(".fa").addClass("fa-angle-double-left"),t.attr("onclick","openRightDrawer()"),$(".drawer-mask").removeClass("active"),D(!1)},openVideo:function(e,t){try{$(e).next().attr("controls","controls"),$(e).next().trigger("play"),$(e).remove()}catch(e){console.log(e)}},reviewPost:function(e){a("/review","PUT",{pid:e}).then((function(){d("执行操作成功！")})).catch((function(e){f(e)}))},switchChildren:function(e,t){$(".forum-block-children[data-fid='"+e+"']").slideToggle();var n=$(t);n.hasClass("fa-angle-down")?(n.removeClass("fa-angle-down"),n.addClass("fa-angle-up")):(n.removeClass("fa-angle-up"),n.addClass("fa-angle-down"))},reload:function(){window.location.reload()},openToNewLocation:F,addApptypeToUrl:q,sweetPrompt:function(e){return new Promise((function(t){Swal.fire({title:e,input:"textarea",inputAttributes:{autocapitalize:"off"},allowOutsideClick:!1,showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,preConfirm:function(e){t(e)}})}))}})}));
