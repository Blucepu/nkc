!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){return(t=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t}).apply(this,arguments)}var n=!0,e=parseInt($("#total").text()),i=[],r=[],o=[];function a(){for(var t=$("div.suggestMoney, div.fact"),n=0;n<t.length;n++){var e=t.eq(n).text();t.eq(n).text(parseInt(e))}}function c(){$(".suggestMoney").on("blur",(function(){u(),a()})),$(".factMoney").on("blur",(function(){s(),a()})),$("#enterBtn").on("click",(function(){p()}))}function u(){var t=$(".suggestMoney");if(0!==t.length){i=[];for(var n=0,r=0;r<t.length;r++){var o=parseFloat(t.eq(r).text());i.push(o),n+=o}$("#suggestMoney").text(n),$('input[name="moneyAudit"]:first').click(),.8*e>n?($("#projectAuditInfo").text("建议的金额小于原金额的80%，只能选择不通过。"),$('input[name="moneyAudit"]:last').click()):$("#projectAuditInfo").text("")}}function s(){var t=$(".factMoney");if(0!==t.length){r=[];for(var n=0,i=0;i<t.length;i++){var o=parseFloat(t.eq(i).text());r.push(o),n+=o}$("#factMoney").text(n),.8*e>n?($("#adminAuditInfo").text("实际的金额小于原金额的80%，只能选择不通过。"),$('input[name="adminSupport"]:last').click()):($("#adminAuditInfo").text(""),$('input[name="adminSupport"]:first').click()),p()}}function p(){var t=$("#remittanceCount").val();(t=parseInt(t))>0?f(t):(o=[],$("#remittanceList").html(""),$("#remainder").text($("#factMoney").text()))}function f(t){var n,e,i=parseFloat($("#factMoney").text());e=0!==(n=i%t)?(i-n)/t:i/t;for(var r="",o=0;o<t;o++)o===t-1&&(e+=n),r+="<div><span>第"+(o+1)+'期：</span><input id="list'+o+'" value="'+e+'"><span>元</span></div>';$("#remittanceList").html(r),d()}function d(){m(),$("#remittanceList > div > input").on("input",(function(){m()}))}function m(){var t=parseInt($("#factMoney").text());$("#remainder").text(t).removeClass("redFontColor");var n=$("#remittanceList > div > input"),e=0;o=[];for(var i=0;i<n.length;i++){var r=parseFloat(n.eq(i).val());r>0&&(e+=r,o.push(r))}t-e<0?$("#remainder").text(t-e).addClass("redFontColor"):$("#remainder").text(t-e).removeClass("redFontColor")}$((function(){u(),s(),c()})),t(window,{initNumber:a,init:c,initSuggestMoney:u,initFactMoney:s,displayRemittance:p,createList:f,submitProjectAudit:function(t,n){var e=$('input[name="userInfoAudit"]').eq(0).is(":checked"),r=$('input[name="projectAudit"]').eq(0).is(":checked"),o=$('input[name="moneyAudit"]').eq(0).is(":checked"),a=$("#userInfoComment").val(),c=$("#projectComment").val(),u=$("#moneyComment").val(),s=[];return e||a?(s.push({type:"userInfoAudit",support:e,c:a}),r||c?(s.push({type:"projectAudit",support:r,c:c}),o||u?(s.push({type:"moneyAudit",support:o,c:u}),void nkcAPI("/fund/a/"+t+"/audit","POST",{comments:s,suggestMoney:i,type:"project",refuse:n||!1}).then((function(n){screenTopAlert("提交成功！2s后跳转到申请表详情。"),setTimeout((function(){openToNewLocation("/fund/a/"+t)}),2e3)})).catch((function(t){screenTopWarning(t.error)}))):screenTopWarning("请输入资金预算不合格的原因")):screenTopWarning("请输入项目内容不合格的原因")):screenTopWarning("请输入申请人信息不合格的原因")},computeRemainder:d,displayRemainder:m,submitAdminAudit:function(t,e){var i=$('input[name="adminSupport"]:first'),a=$('input[name="needThreads"]:first');a=!!a.is(":checked"),n=!!i.is(":checked");var c=$("#adminComment").val();if(!n&&""===c)return screenTopWarning("请输入不合格的原因");if(n&&!e){for(var u=0,s=0,p=0;p<o.length;p++)u+=o[p];for(p=0;p<r.length;p++)s+=r[p];if(0===o.length)o=[s];else if(u!==s)return screenTopWarning("分期的金钱总和与实际预算总和不想等，请检查。")}nkcAPI("/fund/a/"+t+"/audit","POST",{remittance:o,factMoney:r,support:n,needThreads:a,c:c,refuse:e||!1,type:"admin"}).then((function(n){screenTopAlert("提交成功！2s后跳转到申请表详情。"),setTimeout((function(){openToNewLocation("/fund/a/"+t)}),2e3)})).catch((function(t){screenTopWarning(t.error)}))},refuse:function(t){!1!==confirm("确定要执行此操作？")&&nkcAPI("/fund/a/"+t+"?type=refuse","DELETE",{}).then((function(){openToNewLocation("/fund/a/"+t)})).catch((function(t){screenTopWarning(t.error)}))}})}));
