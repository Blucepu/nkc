!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e={type:"ch4",public:!1,hasImage:!1,volume:"A",content:"",forum:"",answer:[],answerObj:[{text:""},{text:""},{text:""},{text:""}]},t=new Vue({el:"#app",data:{auth:{status:!0,reason:""},submitted:!1,submitting:"",question:JSON.parse(JSON.stringify(e))},mounted:function(){var e=document.getElementById("data");(e=JSON.parse(e.innerHTML)).question&&("ans"===e.question.type&&(e.question.answer[1]="",e.question.answer[2]="",e.question.answer[3]=""),this.extendAnswers(e.question),e.question.public&&(e.question.forum=""),this.question=e.question),vueSelectForum.init({func:this.selectedForum})},methods:{showSelectForumPanel:function(){vueSelectForum.app.show()},selectedForum:function(e){this.question.forum=e},extendAnswers:function(e){for(var t=e.answer,n=[],i=0;i<t.length;i++)n.push({text:t[i]});e.answerObj=n},reset:function(){this.question=JSON.parse(JSON.stringify(e)),this.submitting="",this.submitted=!1},removeImage:function(){this.question.file="",this.question.baseUrl="",delete this.question.file,delete this.question.baseUrl,this.question.hasImage=!1},clickInput:function(){t.$refs.input.click()},inputChange:function(e){var n=e.target,i=n.files?n.files[0]:"";if(i){this.question.file=i;var s=new FileReader;s.readAsDataURL(i),s.onload=function(){Vue.set(t.question,"baseUrl",this.result)}}},save:function(){var e=this.question;if("true"===e.public||!0===e.public?e.public=!0:e.public=!1,!e.public){if(!e.forum)return screenTopWarning("请选择专业领域");e.fid=e.forum.fid}if(!e.content)return screenTopWarning("请输入题目内容");if("ch4"===e.type){if(4!==e.answerObj.length)return screenTopWarning("单项选择题答案个数错误");for(var n=0;n<e.answerObj.length;n++){var i=e.answerObj[n];if(!i.text)return screenTopWarning("答案不能为空");e.answer[n]=i.text}}else{if(!e.answerObj[0].text)return screenTopWarning("答案不能为空");e.answer=[e.answerObj[0].text]}var s=new FormData;e.file&&s.append("file",e.file);var u=JSON.parse(JSON.stringify(e));delete u.file,delete u.baseUrl,delete u.arr,delete u.user,delete u.forum,delete u.answerObj;var r="/exam/question",a="POST";u._id&&(document.getElementById("auth")&&(t.auth.status=-1!==[!0,"true"].indexOf(t.auth.status),s.append("auth",JSON.stringify(t.auth))),r="/exam/question/"+u._id,a="PUT"),s.append("question",JSON.stringify(u)),submitting="提交中",uploadFilePromise(r,s,(function(e){var n=(e.loaded/e.total*100).toFixed(2);n>100&&(n=100),t.submitting="提交中... "+n+"%"}),a).then((function(){e._id?openToNewLocation(document.referrer):(t.submitting="",t.submitted=!0)})).catch((function(e){screenTopWarning(e),t.submitting="",t.submitted=!1}))}}});window.defaultQuestion=e,window.app=t}));
