!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}var e=a(JSON.parse($("#panelDatas").text())),n={config:{para:null,panelData:[],shellId:"panelShell",wallId:"panelWall",closeId:"panelClose",headerId:"panelHeader",headerDomId:"headerDom",bodyDomId:"bodyDom",footerDomId:"footerDom",panelSureButtonId:"panelSureButton",contentWallId:"panelContentWall",headerText:"请选择专业",panelExist:!1,panelInit:!1,tagsLast:{id:"",name:""},contentLast:{id:"",name:""},editStatus:"",editTag:"",totalTags:[]},init:function(t){if(t)for(var e in t)n.config[e]=t[e];if(!n.config.para)return screenTopWarning("未指定dom");var a=$(n.config.para).parent("div");if($(a).css("position","relative"),!n.config.panelExist){n.createShell(a);var i=n.config.para.getBoundingClientRect();n.get(n.config.shellId).style.width=i.width+"px",n.createTags(n.config.panelData),n.createSureButton()}n.config.panelInit=!0},show:function(){n.get(n.config.shellId).style.display="block"},close:function(){n.get(n.config.shellId).style.display="none"},get:function(t){return document.getElementById(t)},createShell:function(t){var e=document.createElement("div");e.setAttribute("id",n.config.shellId),e.style.display="none",e.style.position="absolute",e.style.background="transparent",e.style.zIndex="20000",$(t).append(e),n.config.panelExist=!0;var a=document.createElement("div");a.setAttribute("id",n.config.wallId),a.className="panelWall",e.appendChild(a),o()||($("#panelShell").css("left","0"),$("#panelWall").css("width",document.body.scrollWidth));var i=document.createElement("div");i.setAttribute("id","headerDom");var l=document.createElement("span");l.innerHTML="x",l.setAttribute("id",n.config.closeId),l.className="panelClose",i.appendChild(l);var c=document.createElement("div");c.innerHTML=n.config.headerText,c.setAttribute("id",n.config.headerId),c.className="panelHeader",i.appendChild(c),a.appendChild(i);var d=document.createElement("div");d.setAttribute("id","bodyDom"),a.appendChild(d);var r=document.createElement("div");r.setAttribute("id","footerDom"),a.appendChild(r)},createTags:function(t){if(!t)return screenTopWarning("未传入tags数组");var e=document.createElement("ul");e.className="tagUl";for(var a,i="",o=0;o<t.length;o++){i+="<li class='tagLi'>"+("<a class='tagLiLink' data-id='"+t[o].id+"' data-index='"+o+"' data-name='"+t[o].name+"' data-floor='"+t[o].floor+"' onclick='clickTags(this)'>"+t[o].name+"</a>")+"</li>",a=t[o].floor}e.innerHTML=i,e.setAttribute("data-floor",a),n.get(n.config.bodyDomId).appendChild(e)},clearTagsAfter:function(t){t.nextAll().remove()},createPanelContent:function(t){document.createElement("div");var e=document.createElement("div");e.className="panelContentWall",e.setAttribute("id",n.config.contentWallId);var a=document.createElement("ul");a.className="panelContentUl",t&&0!=t.length||t.push({name:"未分类"});for(var i="",o=0;o<t.length;o++){i+="<li class='panelContentLi'>"+("<a class='panelContentLiLink' data-id='"+t[o].id+"' data-index='"+o+"' data-name='"+t[o].name+"' data-floor='"+t[o].floor+"' onclick='clickContent(this)'>"+t[o].name+"</a>")+"</li>"}a.innerHTML=i,e.appendChild(a),n.get(n.config.bodyDomId).appendChild(e)},createSureButton:function(){var t=document.createElement("div");t.className="panelButtonWall";var e=document.createElement("button");e.setAttribute("id",n.config.panelSureButtonId),e.className="panelSureButton editorBtn btn btn-primary btn-sm",e.innerHTML="确定",e.disabled=!0,e.addEventListener("click",(function(){n.outputContentLast()})),t.appendChild(e);var a=n.get(n.config.footerDomId);a.appendChild(t),panelWall.appendChild(a)},clearPanelContent:function(){$("#panelContentWall").remove()},clickTags:function(t){n.tagsActive(t);var e=t.getAttribute("data-id"),a=t.getAttribute("data-name");n.config.contentLast.id="",n.config.contentLast.name="不分类",n.config.tagsLast.id=e,n.config.tagsLast.name=a,n.clearTagsAfter($(t).parents("ul"));var o=i(e).son,l=!1,c=n.get(n.config.panelSureButtonId);if(0==o.length)return c.disabled=!1,void(c.style.backgroundColor="#2b90d9");for(var d=0;d<o.length;d++){if(!o[d].son)return void n.outputTagsLast();o[d].son.length>0&&(l=!0)}l?(c.disabled=!0,c.style.backgroundColor="#9baec8",n.createTags(o)):(c.disabled=!1,c.style.backgroundColor="#2b90d9",n.createPanelContent(o))},clickContent:function(t){n.contentActive(t);var e=t.getAttribute("data-id"),a=t.getAttribute("data-name");n.config.contentLast.id=e,n.config.contentLast.name=a},outputTagsLast:function(){var t={id:n.config.tagsLast.id,name:n.config.tagsLast.name,fid:n.config.tagsLast.id,cid:""};$("#tabPanel").tagsinput("add",t),n.config.totalTags.push(t),n.close()},outputContentLast:function(){var t={id:n.config.tagsLast.id+":"+n.config.contentLast.id,name:n.config.tagsLast.name+":"+n.config.contentLast.name,fid:n.config.tagsLast.id,cid:n.config.contentLast.id};if("ing"==n.config.editStatus)for(var e in n.config.totalTags)n.config.totalTags[e].name==n.config.editTag&&$("#tabPanel").tagsinput("remove",n.config.totalTags[e].id);$("#tabPanel").tagsinput("add",t),n.config.totalTags.push(t),$(".label-info-tagsinput").each((function(){$(this).unbind(),$(this).on("click",(function(){l($(this))}))})),n.close()},tagsActive:function(t){$(t).parents("ul").find(".tagLiLinkActive").length>0?($(t).parents("ul").find(".tagLiLinkActive").each((function(){$(this).removeClass("tagLiLinkActive")})),$(t).addClass("tagLiLinkActive")):$(t).addClass("tagLiLinkActive")},contentActive:function(t){$(t).parents("ul").find(".panelContentLiLinkActive").length>0?($(t).parents("ul").find(".panelContentLiLinkActive").each((function(){$(this).removeClass("panelContentLiLinkActive")})),$(t).addClass("panelContentLiLinkActive")):$(t).addClass("panelContentLiLinkActive")}};function a(t){var e=[];return function t(n){for(var a=0;a<n.length;a++)n[a].son.length>0&&t(n[a].son),e.push(n[a])}(t),e}function i(t){for(var e,i=a(n.config.panelData),o=0;o<i.length;o++)i[o].id==t&&(e=i[o]);return e}function o(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,a=0;a<e.length;a++)if(t.indexOf(e[a])>0){n=!1;break}return n}function l(t){n.config.editStatus="ing",n.config.editTag=$(t).text()}var c=getSearchKV();if(c&&"forum"==c.type&&c.id)for(var d=0;d<e.length;d++)if(e[d].id==c.id){var r={id:e[d].id,name:e[d].name,fid:e[d].id,cid:""};$("#tabPanel").tagsinput("add",r)}t(window,{panelArr:e,panelProto:n,openPanel:function(t){var e={para:t,panelData:JSON.parse($("#panelDatas").text())};n.config.panelInit||n.init(e),n.show(),n.get(n.config.closeId).addEventListener("click",(function(){n.close()}))},clickTags:function(t){n.clickTags(t)},clickContent:function(t){n.clickContent(t)},outChooseTags:function(){n.outputContentLast()},findNextJson:function(t,e,n){},flatten:a,getFloorArr:function(t,e){for(var n=[],a=0;a<t.length;a++)t[a].floor==e&&n.push(t[a]);return n},getItemByDataId:i,IsPC:o,editTag:l,demoQuery:c})}));
