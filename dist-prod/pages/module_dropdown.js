!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var t,r=[],n=$("#dropdownDiv"),i=JSON.parse($("#forumListData").text()),o=i.forumList,a=i.forumsThreadTypes,c=i.disabledCategory,l=i.noShowCategory;function s(){$(".dropdownSelect").on("change",(function(){if(!$(this).hasClass("categorySelect")){var e=$(this).attr("id").split("select")[1],t=$(this).val().split(":")[1];if(r.splice(e,1,t),r.length>0)for(var n=[],i=0;i<r.length;i++)i>=e&&$("#select"+i).remove(),i<=e&&n.push(r[i]);r=n,f()}}))}function d(e,t,r){var n="请选择专业",i="form-control dropdownSelect";r&&(n="请选择文章分类",i="form-control dropdownSelect categorySelect");var o=newElement("select",{class:i},{width:"auto",display:"inline-block","margin-right":"0.2rem"});o.append(newElement("option",{},{}).text(n));for(var a=0;a<e.length;a++){var c=e[a];if(r){l=newElement("option",{},{}).text(c.name);c.cid===t&&l.attr("selected",!0)}else{if("discipline"==c.forumType)var l=newElement("option",{},{}).text("(学科)"+c.displayName+":"+c.fid);else var l=newElement("option",{},{}).text("(话题)"+c.displayName+":"+c.fid);c.fid===t&&l.attr("selected",!0)}o.append(l)}return o}function f(){if(n.html(""),0!==r.length)for(var e=0;e<r.length;e++){0===e&&n.append(d(h(),r[e]).attr("id","select"+e));var i=p(r[e]);if(0===i.length){if(c)return openToNewLocation("/f/"+r[e]+"/settings");if(!l){var o=u(r[e]);o.push({name:"不分类",cid:""}),n.append(d(o,t||"",!0))}}else n.append(d(i,r[e+1]).attr("id","select"+(e+1)))}else n.append(d(h(),"").attr("id","select0"));s()}function h(){for(var e=[],t=0;t<o.length;t++)0==o[t].parentsId.length&&e.push(o[t]);return e}function p(e){for(var t=[],r=0;r<o.length;r++)o[r].parentsId.indexOf(e)>-1&&t.push(o[r]);return t}function u(e){for(var t=[],r=0;r<a.length;r++)a[r].fid===e&&t.push(a[r]);return t}function v(){for(var e,t,r,n=$("#dropdownDiv select"),i=0;i<n.length;i++)if(!n.eq(i).hasClass("categorySelect")){var o=n.eq(i).val().split(":");if(2!==o.length)throw"请选择专业";e=o[1]}if("请选择文章分类"===(t=$(".categorySelect").val()))throw"请选择文章分类";if(!e)throw"请选择专业";for(i=0;i<a.length;i++)if(a[i].fid===e&&a[i].name===t){r=a[i].cid;break}return{fid:e,cid:r}}i.selectedArr&&(r=i.selectedArr),i.cat&&(t=parseInt(i.cat)),f(),e(window,{initEvent:s,createSelect:d,displaySelect:f,parentForum:h,getChildrenForums:p,getThreadTypes:u,getResult:v,getResultForumId:function(){for(var e,t=$("#dropdownDiv select"),r=0;r<t.length;r++)if(!t.eq(r).hasClass("categorySelect")){var n=t.eq(r).val().split(":");if(2!==n.length)throw"请选择专业";e=n[1]}if(!e)throw"请选择专业";return e},getResultHaveForumId:function(){for(var e=$("#dropdownDiv select"),t="",r=0;r<e.length;r++)if(!e.eq(r).hasClass("categorySelect")){var n=e.eq(r).val().split(":");2===n.length&&(t=n[1])}return t},selectbtn:function(){for(var e=$("input.ThreadCheckboxes"),t=!1,r=0;r<e.length;r++)e.eq(r).is(":checked")&&(t=!0);t?e.prop("checked",!1):e.prop("checked",!0)},moveListThreads:function(e){var t;try{t=v()}catch(e){return screenTopWarning(e)}for(var r=$("input.ThreadCheckboxes"),n=[],i=0;i<r.length;i++){var o=r.eq(i);o.is(":checked")&&n.push(o.attr("id"))}if(0===n.length)return screenTopWarning("未勾选文章");var a={fromFid:e,toFid:t.fid,toCid:t.cid};!function e(t,r){if(r[t]){var n=r[t];nkcAPI("/t/"+n+"/forum","PUT",a).then((function(){screenTopAlert("文章 "+n+" 已移动到专业 "+a.toFid),e(t+1,r)})).catch((function(e){screenTopWarning(e.error||e)}))}}(0,n)},moveThreads:function(e){var t;try{t=v()}catch(e){return screenTopWarning(e)}var r=$("input.ThreadCheckboxes"),n=[];if(e)n.push(e);else{for(var i=0;i<r.length;i++){var o=r.eq(i);o.is(":checked")&&n.push(o.attr("id"))}if(0===n.length)return screenTopWarning("未勾选文章")}!function e(r){++r<n.length&&moveThread(n[r],t.fid,t.cid,e(r))}(-1)},moveThreadToRecycle:function(e,t){var r=$("input.ThreadCheckboxes"),n=[];if(e)n.push(e);else{for(var i=0;i<r.length;i++){var o=r.eq(i);o.is(":checked")&&n.push(o.attr("id"))}if(0===n.length)return screenTopWarning("未勾选文章")}!function e(r){++r<n.length&&disabledThread(n[r],t,e(r))}(-1)}})}));
