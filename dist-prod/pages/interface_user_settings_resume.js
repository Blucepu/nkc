!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function t(){$(".time").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd",autoclose:1,todayHighlight:1,startView:4,minView:2,forceParse:0})}var n={name:0,gender:0,birthDate:0,location:0,address:0,education:0,industry:0};$.getJSON("/location.json",(function(e){for(var t=0;t<e.length;t++){var n={id:e[t].id,name:e[t].cname,level:e[t].level,parentId:e[t].upid};e[t]=n}$(".bs-chinese-region").chineseRegion("source",e),$("#location").val($("#location").attr("data"))}));var a=[{id:10,name:"小学"},{id:20,name:"初中"},{id:30,name:"高中"},{id:40,name:"中专"},{id:50,name:"大专"},{id:60,name:"本科"},{id:70,name:"硕士"},{id:80,name:"博士"}],o=JSON.parse($("#data").text()),i=o.education,d=o.industries,c=o.forumsObj,r=o.accounts;function l(e){for(var t=$("<div></div>"),n=0;n<e.length;n++){var a=s(e[n],n);t.append(a)}return t}function p(e){for(var t=$("<div></div>"),n=0;n<e.length;n++){var a=u(e[n],n);t.append(a)}return t}function s(e,t){for(var n=$('<div class="education-list"></div>'),o=$('<div class="form-inline"></div>'),i=$('<select class="form-control" id="eduName'+t+'" onchange="changeSelect('+t+', this.value)"></select> '),d=0;d<a.length;d++){var c="";e.degree===a[d].id&&(c="selected");var r=$("<option "+c+">"+a[d].name+"</option> ");i.append(r)}var l=$('<input readonly class="form-control time" id="eduTime'+t+'" size="7" type="text" placeholder="入学时间" value="'+e.timeB+'"> '),p=$('<input class="form-control" id="eduSchool'+t+'" type="text" placeholder="学校名称" value="'+e.school+'"> '),s=$('<input class="form-control" id="eduMajor'+t+'" type="text" placeholder="专业名称" value="'+e.major+'" style="'+(e.degree>30?"":"display: none;")+'"> '),u=$('<button class="btn btn-danger btn-sm" onclick="deleteEdu('+t+')" id="edu'+t+'DeleteBtn">删除</button> ');return o.append(i),o.append("&nbsp;"),o.append(l),o.append("&nbsp;"),o.append(p),o.append("&nbsp;"),o.append(s),o.append("&nbsp;"),o.append(u),o.append("&nbsp;"),n.append(o),n}function u(e,t){for(var n=function(e){return $('<div class="'+e+'"></div>')},a=function(e){return $("<h5>"+e+"</h5>")},o=$('<div class="industries-list"></div>'),i=$('<div class="form"></div>'),d=$('<div class="row"></div>'),r=$('<select class="form-control" onchange="selectInd('+t+', this.value)"></select>'),l=$('<select class="form-control" onchange="selectDuty('+t+', this.value)" id="duty'+t+'"></select>'),p=0;p<c.length;p++){var s=c[p];if(1===s.level){var u="";s.id===e.industry&&(u="selected");var v=$("<option "+u+">"+s.name+"</option> ");r.append(v)}-1!==s.parentsId.indexOf(e.industry)&&(u="",s.id===e.duty&&(u="selected"),v=$("<option "+u+">"+s.name+"</option> "),l.append(v))}var m=n("col-xs-4 col-md-4");m.append(a("行业分类")),m.append(r);var f=n("col-xs-4 col-md-4");f.append(a("&nbsp;")),f.append(l);var h=$('<input type="text" class="form-control" id="indOccu'+t+'" placeholder="职位名称" value="'+(e.occupation||"")+'">');col3=n("col-xs-12 col-md-4"),col3.append(a("职位名称")),col3.append(h);var g=n("col-xs-12 col-md-12"),y=$('<input type="text" class="form-control" id="indOrg'+t+'" placeholder="单位名称" value="'+(e.organization||"")+'">'),b=n("col-xs-12 col-md-4");b.append(a("单位名称")),b.append(y);var x=n("row").append(n("col-xs-12 col-md-12").append(b)),w=$('<input readonly type="text" class="form-control time" id="indTimeB'+t+'" size="8" placeholder="入职日期" value="'+(e.timeB||"")+'">'),E=n("col-xs-12 col-md-3");E.append(a("入职日期")),E.append(w);var P=$('<input readonly type="text" class="form-control time" id="indTimeE'+t+'" size="8" placeholder="离职日期" value="'+(e.timeE||"")+'">'),k=n("col-xs-12 col-md-3");k.append(a("离职日期")),k.append(P);var S=$('<textarea class="form-control" rows="5" placeholder="工作内容简介" id="indDes'+t+'">'+(e.description||"")+"</textarea>"),I=n("col-xs-12 col-md-12");I.append(a("工作内容简介")),I.append(S);var T=$('<button class="btn btn-danger btn-sm" onclick="deleteInd('+t+')" id="ind'+t+'DeleteBtn">删除</button> '),D=n("col-xs-12 col-md-12");return D.append($("<br>")),D.append(T),d.append(m),d.append(f),d.append(g),d.append(x),d.append(col3),d.append(E),d.append(k),d.append(I),d.append(D),i.append(d),o.append(i),i.append("&nbsp;"),o}function v(){$("#industries-div").html(p(d)),t()}function m(){$("#education-div").html(l(i)),t()}function f(){for(var e=0;e<i.length;e++){(t=i[e]).timeB=$("#eduTime"+e).val(),t.school=$("#eduSchool"+e).val(),t.major=$("#eduMajor"+e).val()}for(e=0;e<d.length;e++){var t;(t=d[e]).timeB=$("#indTimeB"+e).val(),t.timeE=$("#indTimeE"+e).val(),t.occupation=$("#indOccu"+e).val(),t.organization=$("#indOrg"+e).val(),t.description=$("#indDes"+e).val()}h("name"),h("gender"),h("birthDate"),h("location"),h("address"),h("education"),h("industry")}function h(e){for(var t=[],a=$("#"+e+"Select option"),o=0;o<a.length;o++)t.push({data:a.eq(o).attr("data"),text:a.eq(o).text()});var i=$("#"+e+"Select");for(o=0;o<t.length;o++)if(i.val()===t[o].text){n[e]=t[o].data;break}}function g(e,t){var n=$('<div class="account-list"></div>'),a=$('<div class="col-sm-2"></div>'),o=$('<input class="form-control" id="type'+t+'" type="text" placeholder="账号平台" value="'+e.type+'">');a.append(o);var i=$('<div class="col-sm-4"></div>'),d=$('<input class="form-control" id="number'+t+'" type="text" placeholder="请输入账号" value="'+e.number+'">');i.append(d);var c=$('<div class="col-sm-5"></div>'),r=$('<button class="btn btn-danger" onclick="deleteAccount('+t+')">删除</button>');return c.append(r),n.append(a),n.append(i),n.append(c),n}function y(){var e=$("#account-div");e.html("");for(var t=0;t<r.length;t++){var n=r[t];"wechat"===n.type?$("#wechat").val(n.number):"QQ"===n.type?$("#QQ").val(n.number):"google"===n.type?$("#google").val(n.number):e.append(g(n,t))}}function b(){for(var e,t,n,a=0;a<r.length;a++){var o=r[a];"QQ"===o.type?(r[a].number=$("#QQ").val(),e=!0):"wechat"===o.type?(r[a].number=$("#wechat").val(),t=!0):"google"===o.type?(n=!0,r[a].number=$("#google").val()):(r[a].type=$("#type"+a).val(),r[a].number=$("#number"+a).val())}e||r.push({type:"QQ",number:$("#QQ").val()}),t||r.push({type:"wechat",number:$("#wechat").val()}),n||r.push({type:"google",number:$("#google").val()})}function x(e){$("#"+e).on("change",(function(){w($("#"+e)[0].files,0,e)}))}function w(e,t,n){"cert"===n?$("#certPhotoInfo").text(t+1+"/"+e.length):$("#photoInfo").text(t+1+"/"+e.length);var a=e[t],o=new FormData;o.append("file",a),o.append("photoType",n),nkcUploadFile("/photo","POST",o,(function(e,t){console.log(t)})).then((function(){++t<=e.length-1?w(e,t,n):window.location.reload()})).catch((function(e){sweetError(e)}))}v(),m(),$("#countryLi").on("click",(function(){$("#province").html("--"),$("#city").html("--"),$("#district").html("--")})),$((function(){y()})),$((function(){x("life"),x("cert")})),e(window,{initTime:t,educationRender:l,industriesRender:p,addEduElement:s,addIndElement:u,displayInd:v,displayEdu:m,deleteEdu:function(e){f(),i.splice(e,1),m()},deleteInd:function(e){f(),d.splice(e,1),v()},addEdu:function(){var e={degree:1,timeB:"",major:"",school:""},n=s(e,i.length);$("#education-div>div").append(n),i.push(e),t()},addInd:function(){var e={timeB:"",timeE:"",industry:"5",duty:"81",occupation:"",organization:""},n=u(e,d.length);$("#industries-div>div").append(n),d.push(e),t()},load:f,changeSelect:function(e,t){for(var n,o=0;o<a.length;o++)if(a[o].name===t){n=a[o].id;break}i[e].degree=n,n<40?$("#eduMajor"+e).css("display","none"):$("#eduMajor"+e).css("display","")},selectInd:function(e,t){var n,a="selected";$("#duty"+e).html("");for(var o=0;o<c.length;o++){var i=c[o];if(i.name===t){n=i.id;break}}for(o=0;o<c.length;o++)if(-1!==(i=c[o]).parentsId.indexOf(n)){var r=$("<option "+a+">"+i.name+"</option>");$("#duty"+e).append(r),a&&(a="")}d[e].industry=n},selectDuty:function(e,t){for(var n=0;n<c.length;n++){var a=c[n];if(a.name===t){d[e].duty=a.id;break}}},submit:function(e){f();var t={education:i,industries:d,name:$("#name").val(),birthDate:$("#birthDate").val(),address:$("#address").val(),location:$("#location").val(),privacy:n};$('input[name="gender"]').eq(0).is(":checked")?t.gender="men":t.gender="women",nkcAPI("/u/"+e+"/settings/resume","PUT",t).then((function(){sweetSuccess("保存成功")})).catch((function(e){sweetError(e.error||e)}))},loadDisplayResume:h,addAccountElement:g,displayAccount:y,addAccount:function(){b(),r.push({type:"",number:""}),y()},deleteAccount:function(e){b(),r.splice(e,1),y()},loadAccounts:b,submitSocial:function(e){b(),nkcAPI("/u/"+e+"/settings/social","PUT",{accounts:r}).then((function(){sweetSuccess("保存成功")})).catch((function(e){sweetError(e.error||e)}))},initEvent:x,removePhoto:function(e){nkcAPI("/photo/"+e,"DELETE",{}).then((function(e){window.location.reload()})).catch((function(e){sweetError(e.error)}))},uploadLifePhotos:w,submitPhoto:function(e){for(var t=[],n=0,a=$("#lifePhotoSelect option"),o=0;o<a.length;o++)t.push({data:a.eq(o).attr("data"),text:a.eq(o).text()});var i=$("#lifePhotoSelect");for(o=0;o<t.length;o++)if(i.val()===t[o].text){n=t[o].data;break}nkcAPI("/u/"+e+"/settings/photo","PUT",{displayPhoto:n}).then((function(){sweetSuccess("保存成功")})).catch((function(e){sweetError(e.error||e)}))},submitCert:function(e){for(var t=[],n=0,a=$("#certPhotoSelect option"),o=0;o<a.length;o++)t.push({data:a.eq(o).attr("data"),text:a.eq(o).text()});var i=$("#certPhotoSelect");for(o=0;o<t.length;o++)if(i.val()===t[o].text){n=t[o].data;break}nkcAPI("/u/"+e+"/settings/cert","PUT",{displayPhoto:n}).then((function(){sweetSuccess("保存成功")})).catch((function(e){sweetError(e.error||e)}))}})}));
