!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}for(var n=JSON.parse($("#data-forums").text()),r=n.forums,t=n.forum.fid,i=n.threadTypes,a=[],o=[],c=[{displayName:"作为主板",fid:null}],f=$("#forumsDiv"),d=$("#childrenForumsDiv"),l=[],p=[],s=0;s<i.length;s++)p.push(i[s].cid.toString());function u(e){0===e.length?d.html("暂无子版块"):d.html("");for(var n=0;n<e.length;n++){var r=e[n];"string"==typeof r&&(r=y(r));var t=newElement("span",{onclick:'exchangeChildForum("'+r.fid+'")',"data-fid":r.fid},{display:"inline-block",padding:"0.5rem","background-color":r.color,"border-radius":"5px",color:"#ffffff","margin-right":"0.5rem",cursor:"pointer",border:"2px solid #ffffff"}).text(r.displayName);d.append(t)}}function h(e,n){for(var r=newElement("select",{class:"form-control",onchange:"selectForum(this.value)"},{}),t=0;t<e.length;t++){var i=e[t];i.fid!==window.fid&&r.append(g(i,i.fid===n))}return r}function g(e,n){var r=newElement("option",{},{}).text(e.displayName);return n&&r.attr("selected",!0),r}function m(e){for(var n=null,t=0;t<r.length;t++){var i=r[t];if(i.displayName===e){n=i.fid;break}}return n}function T(e,n){for(var t=[],i=0;i<r.length;i++){var a=r[i];-1!==a.parentsId.indexOf(e)&&("fid"===n?t.push(a.fid):t.push(a))}return t}function v(e){for(var n=null,t=y(e),i=0;i<r.length;i++)-1!==t.parentsId.indexOf(r[i].fid)&&(n=r[i]);return n}function y(e){for(var n,t=0;t<r.length;t++)if(r[t].fid===e){n=r[t];break}return n}function k(){f.html("");for(var e=0;e<a.length;e++){var n=a[e];if(0===e)f.append(h(c,n));else{var r=T(a[e-1]);r.length>0&&f.append(h(r,n))}if(e===a.length-1){var t=T(n);t.length>0&&(t.unshift({fid:null,displayName:"当前"}),f.append(h(t,null)))}}0===a.length&&f.append(h(c,null))}function x(e){for(var n=0;n<i.length;n++)if(i[n].cid.toString()===e)return i[n]}function w(e){var n=$("#threadTypeDiv");0===e.length?n.html("暂无分类"):n.html("");for(var r=0;r<e.length;r++){var t=e[r];"string"==typeof t&&(t=x(t));var i=newElement("span",{onclick:'exchangeThreadTypes("'+t.cid+'")',"data-cid":t.cid},{display:"inline-block",padding:"0.5rem","background-color":"#aaaaaa","border-radius":"5px",color:"#ffffff","margin-right":"0.5rem",cursor:"pointer",border:"2px solid #ffffff"}).text(t.name);n.append(i)}}$((function(){for(var e=0;e<r.length;e++){var n=r[e];0===n.parentsId.length&&c.push(n)}u(l=T(t,"fid")),f.append(h(c)),w(i),P(i)}));var b=[];function P(e){if(0!==e.length){var n=$("#threadTypeSelect");n.html("");for(var r=0;r<e.length;r++)n.append(newElement("option",{},{}).text(e[r].name))}}function F(){return $("#threadTypeSelect").val()||""}e(window,{createChildForums:u,exchangeChildForum:function(e){if(0===o.length)o.push(e),$('span[data-fid="'+e+'"]').css("border","2px solid #555555");else{o.push(e);var n=l.indexOf(o[0]),r=l.indexOf(o[1]);l.splice(n,1,o[1]),l.splice(r,1,o[0]),$('span[data-fid="'+o[0]+'"]').css("border","2px solid #ffffff"),o=[],u(l)}},createSelect:h,createOption:g,getFid:m,selectForum:function(e){a=[];var n=m(e);if(n)for(a.push(n);;){var r=v(n);if(!r)break;a.unshift(r.fid),n=r.fid}k()},getChildrenForums:T,getParentForum:v,getForumByFid:y,showSelect:k,moveForum:function(e){var n={parentId:null,operation:"savePosition"};a.length>0&&(n.parentId=a[a.length-1]),nkcAPI("/f/"+e+"/settings/category","PUT",n).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},selectForumType:function(e){var n=$("input[name='forumType']:checked").val();nkcAPI("/f/"+e+"/settings/category","PUT",{operation:"selectForumType",forumType:n}).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},getThreadTypeByCid:x,createThreadType:w,exchangeThreadTypes:function(e){if(0===b.length)b.push(e),$('span[data-cid="'+e+'"]').css("border","2px solid #555555");else{b.push(e);var n=p.indexOf(b[0]),r=p.indexOf(b[1]);p.splice(n,1,b[1]),p.splice(r,1,b[0]),$('span[data-cid="'+b[0]+'"]').css("border","2px solid #ffffff"),b=[],w(p)}},addThreadType:function(e){var n=prompt("请输入分类名称：");if(null!==n)return""===n?screenTopWarning("分类名不能为空"):void nkcAPI("/f/"+e+"/settings/category","POST",{name:n}).then((function(e){i.push(e.newType),p.push(e.newType.cid),w(i),P(i)})).catch((function(e){screenTopWarning(e.error||e)}))},createThreadTypesSelect:P,getThreadTypeSelectValue:F,deleteThreadType:function(e){var n=F();if(!n)return screenTopWarning("暂无分类");nkcAPI("/f/"+e+"/settings/category?name="+n,"DELETE",{}).then((function(){screenTopAlert("删除成功")})).catch((function(e){screenTopWarning(e.error||e)}))},editorThreadType:function(e){var n=F();if(!n)return screenTopWarning("暂无分类");var r=prompt("请输入分类名称：",n),t={operation:"changeThreadType",name:r,oldName:n};if(n===r)return screenTopWarning("分类名未更改");nkcAPI("/f/"+e+"/settings/category","PUT",t).then((function(){screenTopAlert("修改成功")})).catch((function(e){screenTopWarning(e.error||e)}))},submit:function(e){for(var n,r=$('input[name="forumCategory"]'),t=0;t<r.length;t++){var i=r.eq(t);if(i.prop("checked")){n=i.val();break}}if(!n)return sweetError("请选择专业分类");nkcAPI("/f/"+e+"/settings/category","PUT",{operation:"saveOrder",childrenFid:l,threadTypesCid:p,categoryId:n}).then((function(){screenTopAlert("保存成功")})).catch((function(e){screenTopWarning(e.error||e)}))},saveKind:function(e){e=$("#kinds").val(),nkcAPI("/f/"+t+"/settings/kind","PUT",{kindName:e}).then((function(e){screenTopAlert("类别设置成功"),window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},clearKind:function(e){confirm("确定要清除当前专业的类别吗？")&&nkcAPI("/f/"+e+"/settings/kind/clear","PUT",{}).then((function(e){screenTopAlert("类别已清除"),window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))}})}));
