!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";window.SubscribeTypes=void 0;var e=NKC.methods.getDataById("data"),s=new Vue({el:"#subscribe",data:{type:e.t||"",category:e.c||"",paging:{},subscribes:[],selectedSubId:[],counts:{total:0,user:0,topic:0,discipline:0,column:0,thread:0},loaded:!1,types:[],postType:"",replayType:"",subUsersId:[],subForumsId:[],subColumnsId:[],subThreadsId:[],collectionThreadsId:[],management:!1},mounted:function(){$("body").show(),this.getData(),this.getTypes(),window.SubscribeTypes=new NKC.modules.SubscribeTypes},methods:{getUrl:NKC.methods.tools.getUrl,appOpenUrl:function(e){NKC.methods.visitUrl(e)},managementSub:function(){this.management?(this.management=!1,this.selectedSubId=[]):this.management=!0},selectAll:function(){for(var e=[],s=0;s<this.subscribes.length;s++)e.push(this.subscribes[s]._id);this.selectedSubId.length!==e.length?this.selectedSubId=e.concat([]):this.selectedSubId=[]},getTypes:function(){nkcAPI("/account/subscribe_types?count=true","GET").then((function(e){s.types=e.types,s.counts=e.counts})).catch((function(e){sweetError(e)}))},removeType:function(e){sweetConfirm("确定要删除分类“"+e.name+"”吗？").then((function(){nkcAPI("/account/subscribe_types/"+e._id,"DELETE").then((function(){s.getTypes()})).catch((function(e){sweetError(e)}))}))},moveType:function(e,t){nkcAPI("/account/subscribe_types/"+e._id,"PUT",{type:"order",direction:t}).then((function(){s.getTypes()})).catch((function(e){sweetError(e)}))},modifyType:function(e){SubscribeTypes.open((function(){SubscribeTypes.close(),s.getTypes()}),{edit:!0,typeId:e._id})},addType:function(){SubscribeTypes.open((function(){SubscribeTypes.close(),s.getTypes()}),{edit:!0})},removeFromArray:function(e,s){var t=e.indexOf(s);-1!==t&&e.splice(t)},saveToArray:function(e,s){-1===e.indexOf(s)&&e.push(s)},subscribeTarget:function(e,t){var n,i,c,u;"forum"===e?(c=SubscribeTypes.subscribeForumPromise,u=this.subForumsId):"column"===e?(c=SubscribeTypes.subscribeColumnPromise,u=this.subColumnsId):"thread"===e?(c=SubscribeTypes.subscribeThreadPromise,u=this.subThreadsId):"collection"===e?(c=SubscribeTypes.collectionThreadPromise,u=this.collectionThreadsId):(c=SubscribeTypes.subscribeUserPromise,u=this.subUsersId),i=u.indexOf(t),((n=-1===i)?SubscribeTypes.open:function(e){e([])})((function(o){SubscribeTypes.close(),c(t,n,o).then((function(){s.getTypes(),n?(u.push(t),"collection"===e?sweetSuccess("收藏成功"):sweetSuccess("关注成功")):(u.splice(i,1),"collection"===e?sweetSuccess("收藏已取消"):sweetSuccess("关注已取消"))})).catch((function(e){sweetError(e)}))}),{selectTypesWhenSubscribe:!0})},initManagement:function(){$(".small-forum-checkbox label").hide(),this.management=!1,this.selectedSubId=[]},selectType:function(e){this.initManagement(),this.type=e,this.paging={},this.getData()},selectCategory:function(e){this.initManagement(),this.category=e,this.paging={},this.getData()},getData:function(e,t,n){this.initManagement(),t||0===t||(t=this.type||"all"),n||(n=this.category||"all"),e||0===e||(e=this.paging.page||0),nkcAPI("/account/subscribes?page="+e+"&t="+t+"&c="+n,"GET").then((function(e){for(var t=e.subscribes,n=[],i=0;i<t.length;i++){var c=t[i];-1!==["thread","collection"].indexOf(c.type)&&-1===n.indexOf(c.tid)&&n.push(c.tid)}s.subscribes=t,s.paging=e.paging,s.subUsersId=e.subUsersId,s.subThreadsId=e.subThreadsId,s.subColumnsId=e.subColumnsId,s.subForumsId=e.subForumsId,s.collectionThreadsId=e.collectionThreadsId,s.loaded=!0})).catch((function(e){sweetError(e)}))},moveSubs:function(e){var t=[],n=[];if(!(t="number"==typeof e?[e]:this.selectedSubId).length)return sweetError("请至少勾选一个");1===t.length&&(n=this.getSubById(t[0]).cid);SubscribeTypes.open((function(e){nkcAPI("/account/subscribes","PUT",{type:"modifyType",typesId:e,subscribesId:t}).then((function(){SubscribeTypes.close(),s.getTypes(),s.getData()})).catch((function(e){sweetError(e)}))}),{selectedTypesId:n,hideInfo:!0,selectTypesWhenSubscribe:!0})},getSubById:function(e){for(var s=this.subscribes,t=0;t<s.length;t++){var n=s[t];if(n._id===e)return n}},moveSub:function(e){this.moveSubs(e._id)}}})}));
