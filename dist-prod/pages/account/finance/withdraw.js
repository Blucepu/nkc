!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t=NKC.methods.getDataById("data"),e=new Vue({el:"#app",data:{user:"",code:"",password:"",succeed:!1,submitted:!1,timeLimit:0,payment:"",info:"",succeedMoney:0,error:"",withdrawSettings:t.withdrawSettings,countToday:t.countToday,mainScore:t.mainScore,userMainScore:t.userMainScore,alipayAccounts:t.alipayAccounts,bankAccounts:t.bankAccounts,money:"",selectedAccount:"",to:"alipay"},computed:{realMoney:function(){return(this.money*(1-this.withdrawSettings.withdrawFee)).toFixed(2)},timeBegin:function(){var t=this.getHMS(this.withdrawSettings.startingTime,"string");return t.hour+":"+t.min+":"+t.sec},timeEnd:function(){var t=this.getHMS(this.withdrawSettings.endTime,"string");return t.hour+":"+t.min+":"+t.sec},outTime:function(){var t=new Date,e=60*t.getHours()*60*1e3+60*t.getMinutes()*1e3+1e3*t.getSeconds();if(e<this.withdrawSettings.withdrawTimeBegin||e>this.withdrawSettings.withdrawTimeEnd)return!0},count:function(){return this.withdrawSettings.withdrawCount-this.countToday},payments:function(){var t=[],e=this.withdrawSettings,n=e.weChat;return e.aliPay.enabled&&t.push({type:"aliPay",name:"支付宝"}),n.enabled&&t.push({type:"weChat",name:"微信支付"}),t},payInfo:function(){var t=this.payment,e=this.withdrawSettings;if(t){var n=e[t];if(n.enabled&&n.fee>0){var i=Number((100*n.fee).toFixed(4));return"服务商（非本站）将收取 ".concat(i,"% 的手续费")}}},fee:function(){var t=this.totalPrice,e=this.money;return Number((e-t).toFixed(2))},totalPrice:function(){var t=this.withdrawSettings,e=this.money,n=t[this.payment].fee;return n&&(e*=1-n),Number(e.toFixed(2))}},mounted:function(){for(var t=0;t<this.alipayAccounts.length;t++){var e=this.alipayAccounts[t];if(e.default){this.selectedAccount=e;break}}this.payments.length&&this.selectPayment(this.payments[0].type)},methods:{selectAccount:function(t){this.selectedAccount=t},selectPayment:function(t){this.payment=t},getHMS:function(t,e){var n=Math.floor(t/36e5),i=Math.floor(t/6e4)%60,o=Math.floor(t/1e3)%60;return"string"===e&&(n<10&&(n="0"+n),i<10&&(i="0"+i),o<10&&(o="0"+o)),{hour:n,min:i,sec:o}},countdown:function(){e.timeLimit<=0||(e.timeLimit--,setTimeout((function(){e.countdown()}),1e3))},sendMessage:function(){nkcAPI("/sendMessage/withdraw","POST",{}).then((function(){e.timeLimit=120,e.countdown(),screenTopAlert("短信验证码发送成功")})).catch((function(t){sweetError(t)}))},submit:function(){this.error="",this.info="";var t=this,e=this.money,n=this.password,i=this.totalPrice,o=this.code,s=this.payment,r=this.selectedAccount;Promise.resolve().then((function(){if(!(e>0))throw"提现金额不正确";if(!["aliPay","weChat"].includes(s))throw"请选择付款方式";if(!o)throw"请输入短信验证码";if(!n)throw"请输入登录密码";return t.submitted=!0,nkcAPI("/account/finance/withdraw","POST",{money:i,score:e,password:n,code:o,account:r,to:s})})).then((function(){return t.submitted=!1,t.password="",t.money="",sweetSuccess("提现成功")})).catch((function(e){sweetError(e),t.submitted=!1}))}}})}));
