!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=NKC.methods.getDataById("data"),t=NKC.modules.math;window.rechargeApp=new Vue({el:"#app",data:{defaultKCB:[10,20,50,100,500].filter((function(t){return t>=e.rechargeSettings.min/100&&t<=e.rechargeSettings.max/100})),money:10,error:"",payment:"",input:"",mainScore:e.mainScore,rechargeSettings:e.rechargeSettings},computed:{payments:function(){var e=[],t=this.rechargeSettings,n=t.weChat;return t.aliPay.enabled&&e.push({type:"aliPay",name:"支付宝"}),n.enabled&&e.push({type:"weChat",name:"微信支付"}),e},payInfo:function(){var e=this.payment,n=this.rechargeSettings;if(e){var i=n[e];if(i.enabled&&i.fee>0){var r=t.chain(t.bignumber(i.fee)).multiply(100).done().toNumber();return"服务商（非本站）将收取 ".concat(r,"% 的手续费")}}},fee:function(){var e=this.totalPrice,t=this.finalPrice;if(e)return e-t},finalPrice:function(){var e=this.money,t=this.input,n=0;return t?n=t:e&&(n=e),n&&(n=Math.ceil(100*n)),n},totalPrice:function(){var e=0,t=this.payment,n=this.rechargeSettings[t];return n&&this.finalPrice&&(e=this.finalPrice*(1+n.fee),e=Math.ceil(e)),e}},mounted:function(){this.payments.length&&this.selectPayment(this.payments[0].type)},methods:{inputNumber:function(){this.input=parseFloat(this.input.toFixed(2))},select:function(e){this.money=e},selectPayment:function(e){this.payment=e},toPay:function(){var e,t,n=this.payment,i=this.finalPrice,r=this.totalPrice,o=this.rechargeSettings,a=o.min,c=o.max;return e="reactNative"===NKC.configs.platform?"app":NKC.methods.isMobilePhoneBrowser()?"mobilePhoneBrowser":"pcBrowser",Promise.resolve().then((function(){if(r<a)throw new Error("充值金额不能小于".concat(a/100,"元"));if(r>c)throw new Error("充值金额不能大于".concat(c/100,"元"));return["pcBrowser","mobilePhoneBrowser"].includes(e)&&(t=window.open()),nkcAPI("/account/finance/recharge/payment","POST",{apiType:"pcBrowser"===e?"native":"H5",paymentType:n,totalPrice:r,finalPrice:i})})).then((function(i){var r=i.weChatPaymentInfo,o=i.aliPaymentInfo;if(r){var a="/payment/wechat/".concat(r.paymentId);"weChat"===n&&("pcBrowser"===e?t.location=a:"mobilePhoneBrowser"===e?t.location=r.url:NKC.methods.rn.emit("weChatPay",{url:window.location.origin+a,H5Url:r.url,referer:window.location.origin}))}else"app"===e?NKC.methods.visitUrl(o.url,!0):t.location=o.url;sweetInfo("请在浏览器新打开的窗口完成支付！若没有新窗口打开，请检查新窗口是否已被浏览器拦截。")})).catch((function(e){sweetError(e),t&&(t.document.body.innerHTML=e.error||e)}))},pay:function(){var e,t=this.totalPrice,n=this.payment,i=this.finalPrice,r=!1,o=NKC.methods.isPhone(),a="/account/finance/recharge?type=get_url&money=".concat(t,"&score=").concat(i,"&payment=").concat(n);Promise.resolve().then((function(){if(!["aliPay","weChat"].includes(n))throw"请选择支付方式";if(!(t>0))throw"充值金额必须大于0";if("reactNative"!==NKC.configs.platform){if(o)return a+="&redirect=true",screenTopAlert("正在前往支付宝..."),r=!0,window.location.href=a;e=window.open()}return nkcAPI(a,"GET")})).then((function(t){r||("reactNative"===NKC.configs.platform?NKC.methods.visitUrl(t.url,!0):e.location=t.url,sweetInfo("请在浏览器新打开的窗口完成支付！若没有新窗口打开，请检查新窗口是否已被浏览器拦截。"))})).catch((function(t){sweetError(t),e&&(e.document.body.innerHTML=t.error||t)}))}}})}));
