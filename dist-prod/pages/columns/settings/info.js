!function(n){"function"==typeof define&&define.amd?define(n):n()}((function(){"use strict";window.selectImage=void 0;for(var n=NKC.methods.getDataById("data"),e=/^(http|https):\/\//i,t=0;t<n.column.links.length;t++){var o=n.column.links[t];o.links||(o.links=[])}var i=new Vue({el:"#app",data:{avatar:"",banner:"",avatarUrl:NKC.methods.tools.getUrl("columnAvatar",n.column.avatar),bannerUrl:NKC.methods.tools.getUrl("columnBanner",n.column.banner),column:n.column,info:"",error:""},mounted:function(){window.selectImage=new NKC.methods.selectImage,NKC.methods.initSelectColor((function(n,e){i.column[e]=n}))},methods:{contactAdmin:function(){nkcAPI("/m/"+this.column._id+"/contact","POST",{}).then((function(){screenTopAlert("通知成功，请等待专栏管理员处理")})).catch((function(n){screenTopWarning(n)}))},replaceImageUrl:function(n){return(n=n.replace(/!\[.*?]\(.*?\)/gi,"")).replace(/\[.*?]\(.*?\)/gi,"")},changed:function(n,t,o){if(void 0===t)return this.column.notice=this.replaceImageUrl(n);var i=n[t];if(i.url)if(void 0!==o){var r=i.links[o];e.test(r.url)||(r.url="http://"+r.url)}else e.test(i.url)||(i.url="http://"+i.url);else i.content=this.replaceImageUrl(i.content)},selectedBanner:function(n){this.banner=n,NKC.methods.fileToUrl(n).then((function(n){i.bannerUrl=n,selectImage.close()}))},selectedAvatar:function(n){this.avatar=n,NKC.methods.fileToUrl(n).then((function(n){i.avatarUrl=n,selectImage.close()}))},selectBanner:function(){selectImage.show((function(n){i.selectedBanner(n)}),{aspectRatio:4})},selectAvatar:function(){selectImage.show((function(n){i.selectedAvatar(n)}),{aspectRatio:1})},submit:function(){this.error="",this.info="";var n=this.column,e=this,t=new FormData;return Promise.resolve().then((function(){if(!n.name)throw new Error("请输入专栏名");if(!n.abbr)throw new Error("请输入专栏简介");e.avatar&&t.append("avatar",e.avatar),e.banner&&t.append("banner",e.banner),n.notice&&t.append("notice",n.notice),t.append("links",JSON.stringify(n.links)),t.append("otherLinks",JSON.stringify(n.otherLinks)),t.append("name",n.name),t.append("abbr",n.abbr),t.append("description",n.description),t.append("navCategory",n.navCategory),t.append("perpage",n.perpage),t.append("hideDefaultCategory",n.hideDefaultCategory),n.color&&t.append("color",n.color),n.listColor&&t.append("listColor",n.listColor),n.toolColor&&t.append("toolColor",n.toolColor);for(var o=0;o<n.blocks.length;o++){var r=n.blocks[o];if(!r.name)throw new Error("自定义内容标题不能为空");if(!r.content)throw new Error("自定义内容不能为空");r.show=!!r.show}return t.append("blocks",JSON.stringify(n.blocks)),uploadFilePromise("/m/"+e.column._id,t,(function(n,e){i.info=100===e?"处理中，请稍候":"提交中..."+e+"%"}),"PUT")})).then((function(){i.info="",sweetSuccess("提交成功")})).catch((function(n){i.info="",sweetError(n)}))},addLink:function(n){"otherLinks"===n?this.column.otherLinks.push({name:"",url:""}):this.column.links.push({name:"",url:"",links:[]})},addChildLink:function(n){var e=this.column.links[n];e.links||(e.links=[]),e.links.push({name:"",url:""})},moveLink:function(n,e,t){var o=[];if(o=t?i.column.otherLinks:i.column.links,"up"===n){if(0===e)return;var r=o[e-1];Vue.set(o,e-1,o[e]),Vue.set(o,e,r)}else if("down"===n){if(e+1===o.length)return;var l=o[e+1];Vue.set(o,e+1,o[e]),Vue.set(o,e,l)}},moveChildLink:function(n,e,t){var o=i.column.links[e].links;if("up"===n){if(0===t)return;var r=o[t-1];Vue.set(o,t-1,o[t]),Vue.set(o,t,r)}else if("down"===n){if(t+1===o.length)return;var l=o[t+1];Vue.set(o,t+1,o[t]),Vue.set(o,t,l)}},removeChildLink:function(n,e){this.column.links[n].links.splice(e,1)},removeLink:function(n,e){var t;if((t=e?this.column.otherLinks:this.column.links)[n].links&&t[n].links.length>0)return sweetError("该链接下存在子链接，无法删除");t.splice(n,1)},addBlock:function(){this.column.blocks.length>=5||this.column.blocks.push({name:"",content:"",show:!0})},moveBlock:function(n,e){var t;if("up"===e){if(0===n)return;t=this.column.blocks[n-1],this.column.blocks[n-1]=this.column.blocks[n]}else{if(n+1===this.column.blocks.length)return;t=this.column.blocks[n+1],this.column.blocks[n+1]=this.column.blocks[n]}Vue.set(this.column.blocks,n,t)},deleteBlock:function(n){Vue.delete(this.column.blocks,n)},replacePerpage:function(){var n=this.column.perpage;n=parseInt(n),(isNaN(n)||n<=0)&&(n=1),this.column.perpage=n}}})}));
