!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}window.draft=new(function(){function t(){e(this,t)}return s(t,[{key:"removeDraft",value:function(e){nkcAPI("/u/"+NKC.configs.uid+"/drafts/"+e,"DELETE").then((function(){window.location.reload()})).catch((function(e){sweetError(e)}))}},{key:"removeDraftSingle",value:function(e){var t=this;sweetQuestion("确定要删除当前草稿？删除后不可恢复。").then((function(){t.removeDraft(e)})).catch((function(){}))}},{key:"removeAll",value:function(){var e=this;sweetQuestion("确定要删除全部草稿？删除后不可恢复。").then((function(){e.removeDraft("all")})).catch((function(){}))}},{key:"getInputs",value:function(){return $(".draft-checkbox input")}},{key:"getSelectedDraftsId",value:function(){for(var e=[],t=this.getInputs(),s=0;s<t.length;s++){var n=t.eq(s);n.prop("checked")&&e.push(n.attr("data-did"))}return e}},{key:"selectAll",value:function(){var e=this.getSelectedDraftsId(),t=this.getInputs();e.length!==t.length?t.prop("checked",!0):t.prop("checked",!1)}},{key:"removeSelectedDrafts",value:function(){var e=this.getSelectedDraftsId(),t=this;if(e.length){var s=e.join("-");sweetQuestion("确定要删除已勾选的草稿？删除后不可恢复。").then((function(){t.removeDraft(s)})).catch((function(){}))}}}]),t}());var n=NKC.methods.getDataById("subUsersId");window.SubscribeTypes||(window.SubscribeTypes=new NKC.modules.SubscribeTypes),window.user=new(function(){function t(){e(this,t),this.subUsersId=n.subUsersId,this.subForumsId=n.subForumsId,this.subColumnsId=n.subColumnsId,this.subThreadsId=n.subThreadsId,this.collectionThreadsId=n.collectionThreadsId,this.subscribes=n.subscribes}return s(t,[{key:"moveSub",value:function(e){this.moveSubs([e])}},{key:"moveSubs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[],s=this;e.map((function(e){var n=s.subscribes[e];n&&t.push(n)}));var n=[];if(1===t.length)n=t[0].cid;else if(0===t.length)return;e=t.map((function(e){return e._id})),SubscribeTypes.open((function(s){nkcAPI("/account/subscribes","PUT",{type:"modifyType",typesId:s,subscribesId:e}).then((function(){SubscribeTypes.close(),t.map((function(e){e.cid=s})),sweetSuccess("执行成功")})).catch((function(e){sweetError(e)}))}),{selectedTypesId:n,hideInfo:!0,selectTypesWhenSubscribe:!0})}},{key:"subscribe",value:function(e,t){var s,n,i=$(".account-follower-buttons[data-".concat(t,"='").concat(e,"']"));"user"===t?(s=this.subUsersId,n=SubscribeTypes.subscribeUserPromise):"forum"===t?(s=this.subForumsId,n=SubscribeTypes.subscribeForumPromise):"column"===t?(s=this.subColumnsId,e=Number(e),n=SubscribeTypes.subscribeColumnPromise):"thread"===t?(s=this.subThreadsId,n=SubscribeTypes.subscribeThreadPromise):"collection"===t&&(s=this.collectionThreadsId,n=SubscribeTypes.collectionThreadPromise);var c=!s.includes(e);new Promise((function(e,s){["user","collection","thread"].includes(t)&&c?SubscribeTypes.open((function(t){e(t)})):e()})).then((function(t){return t?n(e,c,t):n(e,c)})).then((function(){if(SubscribeTypes.close(),c){"collection"===t?sweetSuccess("收藏成功"):sweetSuccess("关注成功"),i.addClass("active"),-1===s.indexOf(e)&&s.push(e)}else{"collection"===t?sweetSuccess("收藏已取消"):sweetSuccess("关注已取消"),i.removeClass("active");var n=s.indexOf(e);-1!==n&&s.splice(n,1)}})).catch(sweetError)}},{key:"editType",value:function(){SubscribeTypes.open((function(){}),{editType:!0})}}]),t}()),window.removeBlacklist=function(e,t){NKC.methods.removeUserFromBlacklist(e).then((function(e){if(e){var s=$('[data-type="blacklist"][data-id="'.concat(t,'"]'));s&&s.length&&s.remove()}}))},NKC.configs.isApp&&window.ready().then((function(){newEvent("userChanged",(function(e){e.user&&(window.location.href=window.location.pathname.replace(/\/u\/([0-9]+\/)/gi,"/u/"+e.user.uid+"/"))}))}))}));
