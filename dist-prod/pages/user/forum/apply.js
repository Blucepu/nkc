!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var o=0,s=function(){};return{s:s,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}var r=NKC.methods.getDataById("data"),o=new Map([["protocol",function(e){return e.protocol.haveReadProtocol?{passed:!0}:{passed:!1,message:"请先仔细阅读开办指南"}}],["enter_info",function(e){var t=e.enterInfo,n=e.sendInvite;return t.newForumName&&t.reason&&t.youWantToDo?t.reason.length<200?{passed:!1,message:"申请理由至少200个字符"}:n.userId.length<3?{passed:!1,message:"请至少选择3个人作为专业共同创始人"}:void e.commitData():{passed:!1,message:"请先完整填写"}}],["sucess_section",function(e){}]]),s=Array.from(o.keys());new Vue({el:"#app",data:{step:0,protocol:{haveReadProtocol:!1},enterInfo:{newForumName:"",reason:"",youWantToDo:""},sendInvite:{userId:[],users:[]},appliedForums:r.appliedForums,reviewNewForumGuide:r.reviewNewForumGuide,buttonName:"提交",submitting:!1},computed:{stepName:function(){return s[this.step]||s[0]}},methods:{toStep:function(e){var t=(0,this.checker)(this.stepName),n=t.passed,r=t.message;return n?this.step=e:sweetError(r)},checker:function(e){if(o.has(e)){var t=o.get(e);return"function"==typeof t?t(this):{}}return{}},selectUsers:function(){var e=this;a.open((function(t){var r,o=n(t.users);try{for(o.s();!(r=o.n()).done;){var s=r.value,a=s.uid,i=s.username,u=s.avatar;e.sendInvite.userId.includes(a)||(e.sendInvite.users.push({username:i,avatarUrl:NKC.methods.tools.getUrl("userAvatar",u),uid:a}),e.sendInvite.userId.push(a))}}catch(e){o.e(e)}finally{o.f()}}),{userCount:99})},deleteFounder:function(e){this.sendInvite.users.splice(e,1),this.sendInvite.userId.splice(e,1)},commitData:function(){var e=this.enterInfo,t=this.sendInvite,n=this;return n.buttonName="提交中...",n.submitting=!0,nkcAPI("/u/".concat(NKC.configs.uid,"/forum/apply"),"POST",{info:e,invites:t.userId}).then((function(){console.log("提交成功"),n.buttonName="提交",n.submitting=!1,n.step=2})).catch((function(e){n.step=1,sweetError(e)})).finally((function(){n.buttonName="提交",n.submitting=!1}))}}});var a=new NKC.modules.SelectUser;e(window,{stepCheckerMap:o,stepNames:s,selectUserModule:a})}));
