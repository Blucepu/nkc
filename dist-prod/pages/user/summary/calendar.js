!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";NKC.modules.SummaryCalender=function(e,t){var a=this;a.dom=$(e),a.uid=a.dom.attr("data-uid"),a.createYearList=function(e){for(var t=new Date(e).getFullYear(),r=(new Date).getFullYear(),n=$("<select onchange='SummaryCalendar.setYear(this.value)'></select>"),o=r;o>=t;o--){var i;i=o===a.year?$("<option value='"+o+"' selected='true'>"+o+"</option>"):$("<option value='"+o+"'>"+o+"</option>"),n.append(i)}a.dom.append(n)},a.setYear=function(e){e&&(e=parseInt(e)),a.year=e||(new Date).getFullYear(),a.begin=new Date(a.year+"-1-1 00:00:00").getTime(),a.end=new Date(a.year+1+"-1-1 00:00:00").getTime(),a.getData()},a.getData=function(){nkcAPI("/u/"+a.uid+"/profile/summary/calendar?year="+a.year,"GET").then((function(e){a.initEcharts(e.posts),a.createYearList(e.targetUser.toc)})).catch(sweetError)},a.initEcharts=function(e){a.myChart&&a.myChart.dispose&&a.myChart.dispose();for(var t={},r=0;r<e.length;r++){var n=e[r];t[n._id]=n.count}var o={};for(r=a.begin;r<a.end;r+=864e5){var i=NKC.methods.format("YYYY-MM-DD",r);o[NKC.methods.format("YYYY-MM-DD",r)]=t[i]||0}e=[];var s=0;for(var r in o)o.hasOwnProperty(r)&&(o[r]>s&&(s=o[r]),e.push([r,o[r]]));var l=[];for(r=1;r<1e4;r*=2)l.push({min:r,max:2*r-1});var c=[];for(r=0;r<l.length;r++){var d=l[r];s>=d.min&&c.push(d)}c.length||c.push({min:1,max:1});var m={title:{left:"left",subtext:"根据用户发表的文章和回复统计",text:a.year+"年发表统计"},tooltip:{},visualMap:[{type:"piecewise",left:"center",orient:"horizontal",top:65,pieces:c}],calendar:{top:120,left:30,right:30,cellSize:["auto",13],range:a.year,dayLabel:{nameMap:"cn"},monthLabel:{nameMap:"cn"},splitLine:{lineStyle:{color:"#666",width:2}},itemStyle:{borderWidth:2,borderColor:"#fff",color:"#f5f5f5"},yearLabel:{show:!1}},series:{type:"heatmap",coordinateSystem:"calendar",data:e}};a.myChart=echarts.init(a.dom[0]),a.myChart.setOption(m)},a.setYear(t)}}));
