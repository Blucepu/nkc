!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function t(e){isNaN(e)||e<=0?window.totalPrice=firstFreightPrice:window.totalPrice=firstFreightPrice+addFreightPrice*(e-1),$("#freightPrice").text(totalPrice)}function r(e,t){var r=$("#freightTemplates option:selected").val();nkcAPI("/shop/cart","POST",{productParamId:e,count:t,freightId:r}).then((function(e){e.user?screenTopAlert("添加成功"):openToNewLocation("/login")})).catch((function(e){screenTopWarning(e)}))}function i(e){return e=(e/100).toFixed(2)}function n(e){return e=Number((e/100).toFixed(2))}window.totalPrice=void 0,window.isFreePost=void 0,window.firstFreightPrice=void 0,window.addFreightPrice=void 0,$(document).ready((function(){window.isFreePost=$("#isFreePost").val(),"freePost"==isFreePost||(window.firstFreightPrice=$("#freightTemplates option:selected").attr("datafirstprice"),window.addFreightPrice=$("#freightTemplates option:selected").attr("dataaddPrice"),window.firstFreightPrice=n(Number(firstFreightPrice)),window.addFreightPrice=n(Number(addFreightPrice)),$("#buyCount").bind("input propertychange",(function(){var e=$(this).val();t(e=Number(e))}))),$("#freightTemplates").change((function(){window.firstFreightPrice=$("#freightTemplates option:selected").attr("datafirstprice"),window.addFreightPrice=$("#freightTemplates option:selected").attr("dataaddPrice"),window.firstFreightPrice=n(Number(firstFreightPrice)),window.addFreightPrice=n(Number(addFreightPrice)),$("#freightPrice").text(firstFreightPrice),$("#addFreightPrice").text(addFreightPrice),t(Number($("#buyCount").val()))}))})),e(window,{calculateFreightPrice:t,addToCart:r,choiceProductParams:function(e,t){if(!$(e).hasClass("activeIndex")){$(".activeIndex").addClass("normalIndex"),$(".activeIndex").removeClass("activeIndex"),$(e).removeClass("normalIndex"),$(e).addClass("activeIndex");var r=$(e).attr("paraId");nkcAPI("/shop/product/"+t+"/changePara","PUT",{paraId:r}).then((function(e){var t=e.productParams;$("#originPrice").text(i(t.originPrice)),$("#newPrice").text(i(t.price)),$("#stockCount").text(t.stocksSurplus),$("#paraId").text(t._id)})).catch((function(e){screenTopWarning(e||e.error)}))}},addProductToCart:function(){var e=$("#buyCount").val();if(e=Number(e),isNaN(e)||e<0)return screenTopWarning("商品数量不得小于0");var t=$("#stockCount").text();if(e>(t=Number(t)))return screenTopWarning("库存不足");r($("#paraId").text(),parseInt(e))},submitProductToBill:function(){var e=$("#buyCount").val();if(e=Number(e),isNaN(e)||e<1)return screenTopWarning("商品数量输入有误，请检查");var t=$("#stockCount").text();if(e>(t=Number(t)))return screenTopWarning("库存不足");var r=$("#freightTemplates option:selected").val(),i=$("#paraId").text();r?openToNewLocation("/shop/bill?paraId="+i+"&productCount="+e+"&freightId="+r):openToNewLocation("/shop/bill?paraId="+i+"&productCount="+e)},addStock:function(){var e=$("#stockCount").text();e=Number(e);var r=$("#buyCount").val();((r=Number(r))<1||isNaN(r))&&(r=1),(r+=1)>e&&(screenTopWarning("数量不得大于库存"),r=e),$("#buyCount").val(r),"freePost"!==isFreePost&&t(r)},delStock:function(){$("#stockCount").text();var e=$("#buyCount").val();e=Number(e),isNaN(e)&&(e=1),(e-=1)<1&&(screenTopWarning("至少购买一件"),e=1),$("#buyCount").val(e),"freePost"!==isFreePost&&t(e)},numToFloatTwo:i,numToNumberTwo:n,banSale:function(e){confirm("确定禁售该商品吗？")&&nkcAPI("/shop/product/"+e+"/banSale","PUT",{productId:e}).then((function(e){screenTopAlert("禁售成功"),window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))}})}));
