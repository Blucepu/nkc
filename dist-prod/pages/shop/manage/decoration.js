!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}window.upLoadFile=void 0;var a=!1;function t(e){nkcAPI("/shop/manage/"+e+"/decoration/featured","GET",{}).then((function(e){var a=[],t=e.storeLeftFeatureds.length,o=e.storeLeftFeatureds;for(var s in e.products){var n;n=1==e.products[s].isFeatured?'<div class="form-group"></div><div class="media"><div class="media-left"><a href="/shop/product/'+e.products[s].productId+'"><img class="media-object" src="/r/'+e.products[s].imgMaster+'" style="width: 50px; height: 50px;" /></a></div><div class="media-body"><p class="media-heading" style="font-size:smaller;">'+e.products[s].name+'</p></div><div class="media-right"><button class="btn btn-danger btn-sm" onclick="delStoreFeatured('+e.products[s].storeId+","+e.products[s].productId+')">取消推荐</button></div></div>':'<div class="form-group"></div><div class="media"><div class="media-left"><a href="/shop/product/'+e.products[s].productId+'"><img class="media-object" src="/r/'+e.products[s].imgMaster+'" style="width: 50px; height: 50px;" /></a></div><div class="media-body"><p class="media-heading" style="font-size:smaller;">'+e.products[s].name+'</p></div><div class="media-right"><button class="btn btn-primary btn-sm" onclick="addStoreFeatured('+e.products[s].storeId+","+e.products[s].productId+')">推荐</button></div></div>',a.push(n)}$("#featuredModalBody").html(a),$("#featuredCount").html(t),$("#featuredList").val(o)})).catch((function(e){screenTopWarning(e||e.error)}))}function o(e,a){nkcAPI("/shop/manage/"+a+"/decoration/singleClass?index="+e,"GET",{}).then((function(a){var t=[],o=a.storeClassFeatureds.productsArr.length,s=a.storeClassFeatureds.productsArr;for(var n in a.classProducts){var i;i=1==a.classProducts[n].isFeatured?'<div class="form-group"></div><div class="media"><div class="media-left"><a href="/shop/product/'+a.classProducts[n].productId+'"><img class="media-object" src="/r/'+a.classProducts[n].imgMaster+'" style="width: 50px; height: 50px;" /></a></div><div class="media-body"><p class="media-heading" style="font-size:smaller;">'+a.classProducts[n].name+'</p></div><div class="media-right"><button class="btn btn-danger btn-sm" onclick="delSingleClassify('+a.classProducts[n].storeId+","+a.classProducts[n].productId+","+e+')">取消推荐</button></div></div>':'<div class="form-group"></div><div class="media"><div class="media-left"><a href="/shop/product/'+a.classProducts[n].productId+'"><img class="media-object" src="/r/'+a.classProducts[n].imgMaster+'" style="width: 50px; height: 50px;" /></a></div><div class="media-body"><p class="media-heading" style="font-size:smaller;">'+a.classProducts[n].name+'</p></div><div class="media-right"><button class="btn btn-primary btn-sm" onclick="addSingleClassify('+a.classProducts[n].storeId+","+a.classProducts[n].productId+","+e+')">推荐</button></div></div>',t.push(i)}$("#classifyModalBody").html(t),$("#classCount").html(o),$("#classList").val(s)})).catch((function(e){}))}$("#uploadSignModal").on("change",(function(){var e=$("#uploadSignModal")[0].files[0];e&&(window.upLoadFile=e);var t=new FileReader;t.onload=function(){var e='<img src="'+t.result+'" style="width: 100%" id="storeSignImageModal">';$("#storeSignImageDomModal").html(e)},t.readAsDataURL(upLoadFile),a=!0})),e(window,{editStoreSign:function(){console.log("加载招牌设置")},saveStoreSign:function(e){if(!a)return screenTopWarning("请选择背景图");var t=new FormData;t.append("file",upLoadFile),$.ajax({url:"/shop/manage/"+e+"/decoration/sign",method:"POST",cache:!1,data:t,headers:{FROM:"nkcAPI"},dataType:"json",contentType:!1,processData:!1}).done((function(){screenTopAlert("保存成功"),$("#storeSignModal").modal("hide"),location.href="/shop/manage/"+e+"/decoration#signAnchor"})).fail((function(e){screenTopWarning(JSON.parse(e.responseText).error)}))},editStoreNavigation:function(){},editStoreService:function(){},saveStoreService:function(e){var a=[$("#timeWordStart option:selected").val(),$("#timeWordEnd option:selected").val()],t=[$("#timeRestStart option:selected").val(),$("#timeRestEnd option:selected").val()],o=$("#serviceMobile").val(),s=$("#servicePhone").val();nkcAPI("/shop/manage/"+e+"/decoration/service","POST",{serviceTimeWork:a,serviceTimeRest:t,serviceMobile:o,servicePhone:s}).then((function(a){screenTopAlert("保存成功"),$("#storeServiceModal").modal("hide"),location.href="/shop/manage/"+e+"/decoration#serviceAnchor"})).catch((function(e){screenTopWarning(JSON.parse(e.responseText).error)}))},editStoreSearch:function(){},saveStoreSearch:function(e){var a=$("#presetKey").val(),t=$("#recommendKey1").val(),o=$("#recommendKey2").val(),s=$("#recommendKey3").val();nkcAPI("/shop/manage/"+e+"/decoration/search","POST",{presetKey:a,recommendKeys:[t,o,s]}).then((function(e){screenTopAlert("保存成功"),$("#storeSearchModal").modal("hide"),window.location.reload()})).catch((function(e){screenTopWarning(JSON.parse(e.responseText).error)}))},editStoreClassfy:function(){},editStoreFeatured:t,addStoreFeatured:function(e,a){a+="";var o=$("#featuredList").val().split(",");if(o.indexOf(a)>-1)return screenTopWarning("该商品已在推荐列表中");o.push(a),nkcAPI("/shop/manage/"+e+"/decoration/featured","POST",{arr:o}).then((function(a){t(e)})).catch((function(e){}))},delStoreFeatured:function(e,a){a+="";var o=$("#featuredList").val().split(","),s=o.indexOf(a);s>-1&&o.splice(s,1),nkcAPI("/shop/manage/"+e+"/decoration/featured","POST",{arr:o}).then((function(a){t(e)})).catch((function(e){}))},saveStoreFeatured:function(e){screenTopAlert("保存成功"),$("#storeFeaturedModal").modal("hide"),openToNewLocation("/shop/manage/"+e+"/decoration")},editStoreClassPick:function(){},addStoreClass:function(e){var a=$("#newClassName").val();if(!(a=a.trim()))return screenTopWarning("请输入分类名称");nkcAPI("/shop/manage/"+e+"/decoration/addClass","PUT",{newClassName:a}).then((function(a){screenTopAlert("保存成功"),$("#storeAddClassPickModal").modal("hide"),openToNewLocation("/shop/manage/"+e+"/decoration")})).catch((function(e){screenTopWarning(e||e.error)}))},delStoreClass:function(e,a){confirm("是否删除当前分类")&&nkcAPI("/shop/manage/"+e+"/decoration/delClass","PUT",{index:a}).then((function(a){screenTopAlert("删除成功"),$("#storeAddClassPickModal").modal("hide"),openToNewLocation("/shop/manage/"+e+"/decoration")})).catch((function(e){screenTopWarning(e||e.error)}))},editSingleClassify:o,addSingleClassify:function(e,a,t){a+="";var s,n=$("#classList").val();if((s=n?n.split(","):[]).indexOf(a)>-1)return screenTopWarning("该商品已在推荐列表中");s.push(a),nkcAPI("/shop/manage/"+e+"/decoration/addSingleClass","PUT",{arr:s,index:t}).then((function(a){o(t,e)})).catch((function(e){}))},delSingleClassify:function(e,a,t){a+="";var s,n=$("#classList").val(),i=(s=n?n.split(","):[]).indexOf(a);i>-1&&s.splice(i,1),nkcAPI("/shop/manage/"+e+"/decoration/addSingleClass","PUT",{arr:s,index:t}).then((function(a){o(t,e)})).catch((function(e){}))},saveStoreClassify:function(e){screenTopAlert("分类推荐成功"),$("#storeEditClassModal").modal("hide"),openToNewLocation("/shop/manage/"+e+"/decoration")}})}));
