!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function t(){$(".time").length&&$(".time").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii",autoclose:!0,todayHighlight:1,startView:2,minView:0,forceParse:0})}t(),e(window,{initTime:t,sendGoods:function(){var e=$("#newstoreid").val(),t=$("#neworderid").val(),r=$("#trackList").val();if(!t||!e)return $("#sendGoodsModal").modal("show"),sweetWarning("请重新点击发货");var o=$("#newtracknumber").val().trim();if(!o)return sweetWarning("请填写快递单号");nkcAPI("/shop/manage/"+e+"/order/sendGoods","PUT",{post:{orderId:t,trackNumber:o,trackName:r}}).then((function(e){sweetAlert("订单发货成功"),$("#sendGoodsModal").modal("hide"),window.location.reload()})).catch((function(e){sweetWarning(e||e.error)}))},sendGoodsNoLog:function(){var e=$("#newstoreid").val(),t=$("#neworderid").val();if(!t||!e)return $("#sendGoodsModal").modal("show"),sweetWarning("请重新点击发货");nkcAPI("/shop/manage/"+e+"/order/sendGoodsNoLog","PUT",{post:{orderId:t}}).then((function(e){sweetAlert("订单发货成功"),$("#sendGoodsModal").modal("hide"),window.location.reload()})).catch((function(e){sweetWarning(e||e.error)}))},openSendGoodsModal:function(e,t){$("#sendGoodsModal").modal("show"),$("#newstoreid").val(e),$("#neworderid").val(t)},editOrder:function(){var e=$("#eoorderid").val(),t=$("#eostoreid").val(),r=$("#eoPrice").val(),o=Number(r);if(!o||o<=0||isNaN(o))return sweetWarning("请填写正确的价格后再提交修改");o*=100,nkcAPI("/shop/manage/"+t+"/order/editOrder","PUT",{post:{price:o,orderId:e}}).then((function(e){sweetAlert("价格修改成功"),$("#editOrderModal").modal("hide"),window.location.reload()})).catch((function(e){sweetWarning(e||e.error)}))},openEditOrderModal:function(e,t){$("#editOrderModal").modal("show"),$("#eostoreid").val(e),$("#eoorderid").val(t)},visitLogisticsInfo:function(e,t){openToNewLocation("/shop/manage/"+e+"/order/logositics?orderId="+t)},editTrackNum:function(){$("#editTrackNum").css("display","none"),$("#saveTrackNum").css("display","inline-block");var e="<input type='text' id='trackNumVal' value='"+$("#trakcNumText").text()+"'>";$("#trakcNumText").html(e)},saveTrackNum:function(e,t){var r=$("#trackNumVal").val().trim();nkcAPI("/shop/manage/"+e+"/order/editOrderTrackNumber","PUT",{orderId:t,trackNumber:r}).then((function(e){sweetAlert("修改成功"),$("#saveTrackNum").css("display","none"),$("#editTrackNum").css("display","inline-block"),$("#trakcNumText").html(r)})).catch((function(e){sweetWarning(e.error||e)}))},editSellMessage:function(e,t){var r=$("#sellMessage"+t).text().trim();if(0==r.length)return sweetWarning("不填写备注无需保存");nkcAPI("/shop/manage/"+e+"/order/editSellMessage","PUT",{sellMessage:r,orderId:t}).then((function(e){sweetAlert("备注修改成功")})).catch((function(e){sweetWarning(e.error||e)}))},editProductSinglePrice:function(e,t,r){$("#productSinglePriceDom"+r).css("display",""),$("#productSinglePriceValue"+r).val(100),$("#editPriceBtn"+r).css("display","none"),$("#savePriceBtn"+r).css("display",""),$("#productSinglePriceValue"+r).bind("input propertychange",(function(){Number($("#productSinglePriceValue"+r).val())>999?$("#productSinglePriceValue"+r).val(999):Number($("#productSinglePriceValue"+r).val())<0&&$("#productSinglePriceValue"+r).val(1);var e=numToFloatTwo(Number($("#productSinglePriceValue"+r).val())/100*Number($("#productSinglePrice"+r).text())*100);$("#productSinglePriceResult"+r).text(e)}))},saveProductSinglePrice:function(e,t,r){$("#productSinglePriceValue"+r).val(100),$("#productSinglePriceDom"+r).css("display","none");var o=Number($("#productSinglePriceResult"+r).text()),n=(o-Number($("#productSinglePrice"+r).text()))*Number($("#productSingleCount"+r).text()),i=Number($("#productTotalPrice"+t).text()),d=Number($("#productFreightPrice"+t).text());Number($("#orderTotalPrice"+t).text()),$("#editPriceBtn"+r).css("display",""),$("#savePriceBtn"+r).css("display","none"),$("#productSinglePrice"+r).text(o),$("#productTotalPrice"+t).text(numToFloatTwo(100*(i+n))),i=Number($("#productTotalPrice"+t).text()),$("#orderTotalPrice"+t).text(numToFloatTwo(100*(i+d)));var c={singlePrice:100*Number($("#productSinglePrice"+r).text()),count:Number($("#productSingleCount"+r).text())},a={orderPrice:100*Number($("#productTotalPrice"+t).text()),orderFreightPrice:100*Number($("#productFreightPrice"+t).text())};nkcAPI("/shop/manage/"+e+"/order/editCostRecord","PUT",{costId:r,orderId:t,costObj:c,orderObj:a}).then((function(e){sweetAlert("保存成功")})).catch((function(e){sweetWarning(e.error||e)}))},editOrderFreightPrice:function(e,t){$("#editFreightBtn"+t).css("display","none"),$("#saveFreightBtn"+t).css("display","");var r="<input id='productFreightPriceInput"+t+"' type='text' value='"+Number($("#productFreightPrice"+t).text())+"' style='width:13%'>";$("#productFreightPrice"+t).html(r)},saveOrderFreightPrice:function(e,t){$("#editFreightBtn"+t).css("display",""),$("#saveFreightBtn"+t).css("display","none");var r=$("#productFreightPriceInput"+t).val();r=Number(r),$("#productFreightPrice"+t).html(numToFloatTwo(100*r));var o=Number($("#productTotalPrice"+t).text());$("#orderTotalPrice"+t).text(numToFloatTwo(100*(o+r)));var n={orderPrice:100*Number($("#productTotalPrice"+t).text()),orderFreightPrice:100*Number($("#productFreightPrice"+t).text())};nkcAPI("/shop/manage/"+e+"/order/editOrderPrice","PUT",{orderId:t,orderObj:n}).then((function(e){sweetAlert("保存成功")})).catch((function(e){sweetWarning(e.error||e)}))},editOrderProductCount:function(e,t,r){$("#editCountBtn"+t).css("display","none"),$("#saveCountBtn"+t).css("display","");var o="<input id='productCountInput"+t+"' type='text' value='"+Number($("#productSingleCount"+t).text())+"' style='width:13%'>";$("#productSingleCount"+t).html(o)},saveOrderProductCount:function(e,t,r){$("#editCountBtn"+t).css("display",""),$("#saveCountBtn"+t).css("display","none");var o=Number($("#productCountInput"+t).val());(isNaN(o)||o<0)&&(o=1);var n=Number($("#productSinglePrice"+t).text()),i=Number($("#productSingleCountHis"+t).text()),d=Number($("#productTotalPrice"+r).text()),c=Number($("#productFreightPrice"+r).text());d+=(o-i)*n,$("#productSingleCount"+t).text(o),$("#productSingleCountHis"+t).text(o),$("#productTotalPrice"+r).text(d),$("#orderTotalPrice"+r).text(numToFloatTwo(100*(d+c)));var a={singlePrice:100*Number($("#productSinglePrice"+t).text()),count:Number($("#productSingleCount"+t).text())},u={orderPrice:100*Number($("#productTotalPrice"+r).text()),orderFreightPrice:100*Number($("#productFreightPrice"+r).text())};nkcAPI("/shop/manage/"+e+"/order/editCostRecord","PUT",{costId:t,orderId:r,costObj:a,orderObj:u}).then((function(e){sweetAlert("保存成功")})).catch((function(e){sweetWarning(e.error||e)}))},openLogositicEdit:function(e,t){$("#editGoodsModal").modal("show"),$("#newstoreidEdit").val(e),$("#neworderidEdit").val(t),$("#newtracknumberEdit").val($("#trackNumber"+t).text()),$("#trackListEdit").val($("#trackName"+t).text())},editGoods:function(){var e=$("#neworderidEdit").val(),t=$("#newstoreidEdit").val(),r=$("#trackListEdit").val();if(!e||!t)return $("#sendGoodsModal").modal("show"),sweetWarning("请重新点击发货");var o=$("#newtracknumberEdit").val().trim();if(!o)return sweetWarning("请填写快递单号");nkcAPI("/shop/manage/"+t+"/order/editGoods","PUT",{post:{orderId:e,trackNumber:o,trackName:r}}).then((function(e){sweetAlert("物流信息修改成功"),$("#sendGoodsModal").modal("hide"),window.location.reload()})).catch((function(e){sweetWarning(e||e.error)}))},editNotGoods:function(){var e=$("#neworderidEdit").val(),t=$("#newstoreidEdit").val();if(!e||!t)return $("#sendGoodsModal").modal("show"),sweetWarning("请重新点击发货");nkcAPI("/shop/manage/"+t+"/order/editGoods","PUT",{post:{orderId:e,trackNumber:"no",trackName:""}}).then((function(e){sweetAlert("物流信息修改成功"),$("#sendGoodsModal").modal("hide"),window.location.reload()})).catch((function(e){sweetWarning(e||e.error)}))}})}));
