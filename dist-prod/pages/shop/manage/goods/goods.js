!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=new NKC.modules.CommonModal;window.CommonModal=e,window.modifyParam=function(t,n){var o=getParam(t,n);e.open((function(o){var a={name:o[0].value,originPrice:o[1].value,stocksSurplus:o[2].value,price:o[3].value,useDiscount:o[4].value,isEnable:o[5].value,paramId:n,productId:t};nkcAPI("/shop/manage/".concat(NKC.configs.uid,"/goodslist/editParam"),"PUT",{paramData:a}).then((function(){sweetSuccess("修改成功"),e.close(),setParam(t,n,a)})).catch(sweetError)}),{title:"修改规格",data:[{dom:"input",type:"text",label:"名称",value:o.name},{dom:"input",type:"number",label:"价格（元，精确到0.01）",value:o.originPrice},{dom:"input",type:"number",label:"库存",value:o.stocksSurplus},{dom:"input",type:"number",label:"优惠价（元，精确到0.01）",value:o.price},{dom:"radio",label:"是否使用优惠价",value:o.useDiscount,radios:[{value:!0,name:"是"},{value:!1,name:"否"}]},{dom:"radio",label:"是否屏蔽",value:o.isEnable,radios:[{value:!1,name:"是"},{value:!0,name:"否"}]}]})},window.computeStocks=function(e){},window.getNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e=(e+="").replace("￥",""),e=(e=parseFloat(e)).toFixed(t),parseFloat(e)},window.getParamDom=function(e,t){var n=$(".param[data-product-id='".concat(e,"'][data-param-id='").concat(t,"']")),o=n.find(".origin-price"),a=n.find(".price"),i=n.find(".name"),r=n.find(".stocks-surplus");return{dom:n,name:i,originPrice:o,price:a,stocksSurplus:r}},window.getParam=function(e,t){var n=getParamDom(e,t),o=n.dom,a=n.originPrice,i=n.price,r=n.name,c=n.stocksSurplus;a=getNumber(a.text(),2);var s=!1;"无"===i.text()?i="":(i=getNumber(i.text(),2),s=!0),c=getNumber(c.text());var u=!0;return o.hasClass("disabled")&&(u=!1),{name:r=r.text(),isEnable:u,useDiscount:s,originPrice:a,price:i,stocksSurplus:c}},window.setParam=function(e,t,n){var o=getParamDom(e,t),a=n.name,i=n.originPrice,r=n.price,c=n.useDiscount,s=n.stocksSurplus,u=n.isEnable,d=NKC.methods.checkData,m=d.checkString,l=d.checkNumber;Promise.resolve().then((function(){if(m(a,{name:"名称",minLength:1,maxLength:100}),l(s,{name:"库存",min:0}),l(i,{name:"价格",min:.01,fractionDigits:2}),c){if(r>=i)throw"规格优惠价必须小于原价";l(r,{name:"优惠价",min:.01,fractionDigits:2})}u?o.dom.removeClass("disabled"):o.dom.addClass("disabled"),o.name.text(a),o.originPrice.text("￥".concat(i.toFixed(2))),o.stocksSurplus.text(s),c?o.price.text("￥".concat(r.toFixed(2))).addClass("number"):o.price.text("无").removeClass("number");for(var t=$(".product[data-product-id='".concat(e,"'] .stocks-surplus")),n=$(".param[data-product-id='".concat(e,"'] .stocks-surplus")),d=0,p=0;p<n.length;p++){var f=n.eq(p);d+=getNumber(f.text())}t.text(d)})).catch(sweetError)},window.shelfNow=function(e){sweetQuestion("确认要上架该商品？").then((function(){return nkcAPI("/shop/manage/".concat(NKC.configs.uid,"/goodslist/shelfRightNow"),"PUT",{productId:e})})).then((function(){sweetSuccess("商品已上架")})).catch(sweetError)},window.stopSale=function(e){sweetQuestion("确认要停售该商品？").then((function(){return nkcAPI("/shop/manage/".concat(NKC.configs.uid,"/goodslist/productStopSale"),"PUT",{productId:e})})).then((function(){sweetSuccess("商品已停售")})).catch(sweetError)},window.goonSale=function(e){sweetQuestion("确认要复售该商品？").then((function(){return nkcAPI("/shop/manage/".concat(NKC.configs.uid,"/goodslist/productGoonSale"),"PUT",{productId:e})})).then((function(){sweetSuccess("商品已复售")})).catch(sweetError)}}));
