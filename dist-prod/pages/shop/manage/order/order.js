!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=new NKC.modules.CommonModal,t=new NKC.modules.ShopShip,r=new NKC.modules.ShopModifyPrice,a=new NKC.modules.Transfer;window.transfer=function(e){a.open((function(){}),e)},window.modifySellMessage=function(t,r){var a=$("tr[data-order-id='".concat(r,"'] .data-sell-message"));e.open((function(o){var n=o[0].value;nkcAPI("/shop/manage/"+t+"/order/editSellMessage","PUT",{sellMessage:n,orderId:r}).then((function(){a.text(n),e.close(),sweetSuccess("保存成功")})).catch(sweetWarning)}),{title:"修改备注",data:[{value:a.text(),dom:"textarea"}]})},window.getNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e=(e+="").replace("￥",""),e=(e=parseFloat(e)).toFixed(t),parseFloat(e)},window.computeOrderPrice=function(e){for(var t=$("tr[data-order-id='".concat(e,"']")),r=t.find(".data-param-price"),a=t.find(".data-param-count"),o=t.find(".data-params-freight"),n=[],c=[],d=0;d<r.length;d++){var i=r.eq(d);n.push(getNumber(i.text(),2))}for(var m=0;m<a.length;m++){var u=a.eq(m);c.push(getNumber(u.text(),0))}if(n.length!==c.length)return sweetError("订单页面错误，请刷新页面");for(var s=0,f=0;f<n.length;f++)s+=n[f]*c[f];var p=getNumber(o.text(),2);return t.find(".data-params-price").text("￥".concat(s.toFixed(2))),t.find(".data-order-price").text("￥".concat((s+p).toFixed(2))),{paramsPrice:s,freightPrice:p,orderPrice:s+p}},window.modifyParamPrice=function(t,a,o){var n=$("tr[data-order-id='".concat(a,"'][data-order-param-id='").concat(o,"'] .data-param-price")),c=$("tr[data-order-id='".concat(a,"'][data-order-param-id='").concat(o,"'] .data-param-count")),d=$("tr[data-order-id='".concat(a,"'] .data-params-freight")),i=getNumber(d.text(),2),m=getNumber(n.text(),2),u=getNumber(c.text(),0);return r.open((function(r){var c=r,d=NKC.methods.checkData.checkNumber;Promise.resolve().then((function(){return d(c,{name:"商品单价",min:.01,fractionDigits:2}),nkcAPI("/shop/manage/".concat(t,"/order/editCostRecord"),"PUT",{type:"modifyParam",costId:o,orderId:a,freightPrice:100*i,costObj:{singlePrice:100*c,count:u}})})).then((function(){n.text("￥".concat(c.toFixed(2))),computeOrderPrice(a),e.close()})).catch(sweetError)}),m)},window.modifyParamCount=function(t,r,a){var o=$("tr[data-order-id='".concat(r,"'][data-order-param-id='").concat(a,"'] .data-param-count")),n=$("tr[data-order-id='".concat(r,"'][data-order-param-id='").concat(a,"'] .data-param-price")),c=$("tr[data-order-id='".concat(r,"'] .data-params-freight")),d=getNumber(c.text(),2),i=getNumber(n.text(),2),m=getNumber(o.text(),0);e.open((function(n){var c=getNumber(n[0].value,2);Promise.resolve().then((function(){return NKC.methods.checkData.checkNumber(c,{name:"商品数量",min:1}),nkcAPI("/shop/manage/".concat(t,"/order/editCostRecord"),"PUT",{type:"modifyParam",costId:a,orderId:r,freightPrice:100*d,costObj:{singlePrice:100*i,count:c}})})).then((function(){o.text("".concat(c)),computeOrderPrice(r),e.close()})).catch(sweetError)}),{title:"修改数量",data:[{dom:"input",value:m}]})},window.modifyFreight=function(t,a){var o=$("tr[data-order-id='".concat(a,"'] .data-params-freight")),n=getNumber(o.text(),2);return r.open((function(r){var n=r;Promise.resolve().then((function(){return NKC.methods.checkData.checkNumber(n,{name:"运费",min:0,fractionDigits:2}),nkcAPI("/shop/manage/".concat(t,"/order/editCostRecord"),"PUT",{type:"modifyFreight",orderId:a,freightPrice:100*n})})).then((function(){o.text("￥".concat(n.toFixed(2))),computeOrderPrice(a),e.close()})).catch(sweetError)}),n)},window.ship=function(e){t.open((function(){}),{orderId:e})}}));
