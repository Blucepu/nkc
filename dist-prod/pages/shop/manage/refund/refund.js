!function(r){"function"==typeof define&&define.amd?define(r):r()}((function(){"use strict";var r=new Vue({el:"#app",data:{user:"",error:"",info:"",agree:"",password:"",uploadStatus:"",storeName:"",address:"",mobile:"",order:"",refund:"",refunds:[],displayInput:!1,myStore:"",reason:""},computed:{orderOriginPrice:function(){for(var r=0,e=0;e<this.order.params.length;e++)r+=this.order.params[e].productPrice;return r},param:function(){var r;if(this.refund.paramId&&(r=this.refund.paramId),!r)return"";for(var e=0;e<this.order.params.length;e++)if(this.order.params[e].costId===r)return this.order.params[e];return""},params:function(){return this.order.params},status:function(){var r=this.refunds[this.refunds.length-1];return r.logs[r.logs.length-1]},product:function(){if(this.order)return this.order.product},productParam:function(){if(this.order)return this.order.productParam},seller:function(){if(this.order)return this.order.product.user}},mounted:function(){var r=document.getElementById("data");r=JSON.parse(r.innerHTML),this.refund=r.refund,this.refunds=r.refunds,this.user=r.user,this.storeName=r.user.username,this.address=r.dealInfo.address,this.mobile=r.dealInfo.mobile[0],this.order=r.order},methods:{format:NKC.methods.format,clearInfo:function(){this.error="",this.info=""},deleteCert:function(e){this.clearInfo(),nkcAPI("/shop/cert/"+e._id,"DELETE").then((function(){var t=r.order.certs.indexOf(e);-1!==t&&r.order.certs.splice(t,1)})).catch((function(e){r.error=e.error||e}))},viewCert:function(r){window.open("/shop/cert/"+r._id)},upload:function(e,t,s){if(e.length<t+1)s.value="";else{var n=e[t],o=new FormData;o.append("type","refund"),o.append("orderId",this.order.orderId),o.append("file",n),this.param&&o.append("paramId",this.param.costId),uploadFilePromise("/shop/cert",o,(function(s){var n=s.loaded/s.total*100;n>=100&&(n=100,e.length===t+1&&setTimeout((function(){r.uploadStatus=""}),2e3)),r.uploadStatus="上传中... "+(t+1)+"/"+e.length+" "+n.toFixed(1)+"%"})).then((function(e){var t=e.cert;r.order.certs.push(t)})).catch((function(r){screenTopWarning(r)})).finally((function(){r.upload(e,t+1,s)}))}},selectedFile:function(r){var e=r.target,t=e.files;this.upload(t,0,e)},saveCerts:function(){},sellerPost:function(){var e,t=this.agree,s="POST",n="/shop/manage/"+this.refund.sellerId+"/order/refund";if(""===t&&"P_APPLY_RM"!==this.refund.status)return this.error="请选择同意或者不同意";if(-1!==["B_APPLY_RM","B_INPUT_INFO"].indexOf(this.refund.status))e=t?"agreeRM":"disagreeRM";else if(-1!==["B_APPLY_RP"].indexOf(this.refund.status))e=t?"agreeRP":"disagreeRP";else if("B_INPUT_CERT_RM"===this.refund.status)e=t?"uploadCerts":"agreeRM";else{if("P_APPLY_RM"!==this.refund.status)return this.error="申请记录状态异常，请刷新";s="PUT",n="/shop/cert",e="uploadCerts"}var o=[];if("uploadCerts"===e)for(var i=0;i<this.order.certs.length;i++)o.push(this.order.certs[i]._id);var a=this.password;if("agreeRM"===e&&""===a)return this.error="请输入登录密码";if("agreeRP"===e){if(!this.storeName)return this.error="请输入收件人姓名";if(!this.mobile)return this.error="请输入收件人手机号";if(!this.address)return this.error="请输入收件人地址"}nkcAPI(n,s,{orderId:this.order.orderId,type:e,reason:this.reason,certsId:o,password:a,sellerInfo:{name:this.storeName,address:this.address,mobile:this.mobile}}).then((function(){window.location.reload()})).catch((function(e){r.error=e.error||e}))},refundType:function(r){return{money:"只退款",product:"退货退款"}[r]}}});window.app=r}));
