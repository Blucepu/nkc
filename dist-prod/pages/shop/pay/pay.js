!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=NKC.methods.getDataById("data"),t=new Vue({el:"#app",data:{rechargeSettings:e.rechargeSettings,userMainScore:e.userMainScore,mainScore:e.mainScore,totalMoney:e.totalMoney,ordersId:e.ordersId,payment:"mainScore",password:""},computed:{aliPay:function(){var e=this.rechargeSettings.aliPay,t=this.totalMoney/(1-e.fee),r=t-this.totalMoney;return{enabled:e.enabled,fee:e.fee,_fee:Number((100*e.fee).toFixed(4)),totalPrice:Number(t.toFixed(2)),feePrice:Number(r.toFixed(2))}},weChat:function(){return this.rechargeSettings.weChat},needRecharge:function(){return this.userMainScore/100<this.totalMoney}},methods:{getUrl:NKC.methods.tools.getUrl,selectPayment:function(e){this.payment=e},submit:function(){var e=this.password,t=this.ordersId,r=this.totalMoney,o=this;Promise.resolve().then((function(){if(!e)throw"请输入登录密码";return nkcAPI("/shop/pay","POST",{ordersId:t,password:e,totalPrice:r})})).then((function(){sweetSuccess("支付成功"),o.password="",setTimeout((function(){NKC.methods.visitUrl("/shop/order")}),3e3)})).catch(sweetError)},useAliPay:function(){var e=this.ordersId,t=this.aliPay,r=t.totalPrice;t.feePrice;var o,n="/shop/pay/alipay?ordersId=".concat(e,"&money=").concat(r),i=NKC.methods.isPhone();if("reactNative"!==NKC.configs.platform){if(i)return n+="&redirect=true",screenTopAlert("正在前往支付宝..."),window.location.href=n;o=window.open()}Promise.resolve().then((function(){return nkcAPI(n,"GET").then((function(e){"reactNative"===NKC.configs.platform?NKC.methods.visitUrl(e.alipayUrl,!0):o.location=e.alipayUrl,sweetInfo("请在浏览器新打开的窗口完成支付！若没有新窗口打开，请检查新窗口是否已被浏览器拦截。")})).catch((function(e){sweetError(e),o&&(o.document.body.innerHTML=e.error||e)}))}))}}});window.app=t}));
