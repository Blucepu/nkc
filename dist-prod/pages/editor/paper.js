!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){return(t=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}window.testTh=void 0,NKC.modules.MoveThread&&(window.testTh=new NKC.modules.MoveThread);var n={config:{enableAbstract:!0,enableKeyWords:!0,enableAuthorInfos:!0,enableOriginState:!0,abstractHeader:"文章摘要(选填)",abstractCn:"",abstractEn:"",keyWordsCn:[],keyWordsEn:[],authorInfos:[],originState:"",keyWordsPanelExist:!1,useOriginState:!1},init:function(t){if($("#targetPost").length>0){var e=t;if(e)for(var a in e)for(var o in n.config)a==o&&(n.config[o]=e[a])}n.initAbstract(),n.initKeywords(),n.initAuthorInfos(),n.initOriginState()},get:function(t){return document.getElementById(t)},initAbstract:function(){if(n.config.enableAbstract){$("#abstract .edit-header").text(n.config.abstractHeader);var t=n.get("abstract");if(t){t.style.display="",n.get("abstractCn").value=n.config.abstractCn,n.get("abstractEn").value=n.config.abstractEn;var e=0,a=0;n.config.abstractCn&&(e=n.config.abstractCn.length),n.config.abstractEn&&(a=n.config.abstractEn.length),$("#abstractCnNum").text(e),$("#abstractEnNum").text(a),$("#abstractCn").on("input propertychange",(function(){$("#abstractCnNum").text($("#abstractCn").val().length)})),$("#abstractEn").on("input propertychange",(function(){$("#abstractEnNum").text($("#abstractEn").val().length)}))}}},initKeywords:function(){if(n.config.enableKeyWords){var t=n.get("keyWords");if(t){t.style.display="";for(var e="",a=0;a<n.config.keyWordsCn.length;a++)e+='<span class="keyTags"><span class="keyCn" kValue="'+n.config.keyWordsCn[a]+'">'+n.config.keyWordsCn[a]+'</span><span class="fa fa-remove" style="margin-left:5px;cursor:pointer" onclick="removeOneKeyWords(this)"></span></span>';for(var o=0;o<n.config.keyWordsEn.length;o++)e+='<span class="keyTags"><span class="keyEn" kValue="'+n.config.keyWordsEn[o]+'">'+n.config.keyWordsEn[o]+'</span><span class="fa fa-remove" style="margin-left:5px;cursor:pointer" onclick="removeOneKeyWords(this)"></span></span>';e.length>0&&$("#keyWordsTags").html(e)}}},createKeyWordsPanel:function(t){var e=$(t).parent("div"),a=t.getBoundingClientRect(),o=document.createElement("div");o.setAttribute("id","keyWordsPanelShell"),o.style.display="none",o.style.position="absolute",o.style.background="transparent",o.style.zIndex="20000",o.style.width=a.width+"px",$(e).css("position","relative"),$(e).append(o),n.keyWordsPanelShow();var r=document.createElement("div");r.setAttribute("id","keyWordsPanelWall"),r.className="keyWordsPanelWall",o.appendChild(r);var s=document.createElement("div");s.innerHTML="添加关键词(每次添加一个)",s.setAttribute("id","keyWordsPanelHeader"),s.className="keyWordsPanelHeader",r.appendChild(s);var i=document.createElement("span");i.setAttribute("id","keyWordsPanelClose"),i.className="keyWordsPanelClose",i.className+=" fa fa-remove",r.appendChild(i),i.addEventListener("click",(function(){n.keyWordsPanelClose()}));var c=document.createElement("div");c.setAttribute("id","keyWordsPanelCnDiv"),c.style.marginBottom="5px";c.innerHTML="<span style='font-weight: bold;'>中文: </span><input type='text' id='keyWordsPanelCnInput' placeholder='只接受中文字符'>";var l=document.createElement("div");l.setAttribute("id","keyWordsPanelEnDiv");l.innerHTML="<span style='font-weight: bold;'>英文: </span><input type='text' id='keyWordsPanelEnInput' placeholder='只接受英文字符'>",r.appendChild(c),r.appendChild(l);var d=document.createElement("div");d.style.textAlign="end";var p=document.createElement("a");p.innerHTML="确定",p.setAttribute("id","keyWordsPanelSureBtn"),p.className+="btn btn-primary btn-sm keyWordsPanelSureBtn",d.appendChild(p),r.appendChild(d),p.addEventListener("click",(function(){n.outputKeyWords()})),n.config.keyWordsPanelExist=!0},keyWordsPanelOpen:function(t){n.config.keyWordsPanelExist?n.keyWordsPanelShow():n.createKeyWordsPanel(t)},keyWordsPanelClose:function(){n.get("keyWordsPanelShell").style.display="none"},keyWordsPanelShow:function(){n.get("keyWordsPanelShell").style.display="block"},outputKeyWords:function(){var t=$("#keyWordsPanelCnInput").val(),e=$("#keyWordsPanelEnInput").val();if(t||e){if(t.length>50||e.length>50)return screenTopWarning("关键词字数不得超过50");if(t)if(!/.*[\u4e00-\u9fa5]+.*$/.test(t))return screenTopWarning("中文关键词中至少包含一个中文字符");if(e)if(!/[a-zA-Z]+/.test(e))return screenTopWarning("英文关键词中至少包含一个英文字符");if(t){var a='<span class="keyTags"><span class="keyCn" kValue="'+t+'">'+t+'</span><span class="fa fa-remove" style="margin-left:5px;cursor:pointer" onclick="removeOneKeyWords(this)"></span></span>';$("#keyWordsTags").append(a)}if(e){a='<span class="keyTags"><span class="keyEn" kValue="'+e+'">'+e+'</span><span class="fa fa-remove" style="margin-left:5px;cursor:pointer" onclick="removeOneKeyWords(this)"></span></span>';$("#keyWordsTags").append(a)}n.keyWordsPanelClose(),$("#keyWordsPanelCnInput").val(""),$("#keyWordsPanelEnInput").val("")}else n.keyWordsPanelClose()},initAuthorInfos:function(){if(n.config.enableAuthorInfos){var t=n.get("authorInfos");if(t){t.style.display="";var e=a(),o="";if(n.config.authorInfos.length>0)for(var r=0;r<n.config.authorInfos.length;r++){e=a(n.config.authorInfos[r].agencyCountry);var s="display:";n.config.authorInfos[r].agencyCountry&&"中国"===n.config.authorInfos[r].agencyCountry||(s="display:none"),n.config.authorInfos[r].isContract?(o+='<tr class="authorClass"><td><a class="editorBtn btn btn-primary btn-sm" onclick="delOneAuthorInfo(this)">删除</a></td><td><a class="editorBtn btn btn-primary btn-sm" onclick="upToTop(this)"><span class="fa fa-arrow-up"></span></a><a class="editorBtn btn btn-primary btn-sm" onclick="downToBottom(this)"><span class="fa fa-arrow-down"></span></a></td><td><input class="authorName" type="text" value="'+n.config.authorInfos[r].name+'" placeholder="完全公开"/></td><td><input class="authorKcid" type="text" value="'+n.config.authorInfos[r].kcid+'"/></td><td><input class="authorAgency" type="text" value="'+n.config.authorInfos[r].agency+'"/></td><td>'+e+'<input class="authorAgencyAdd" type="text" style='+s+' onclick="SetAgencyCity(this)" value="'+n.config.authorInfos[r].agencyAdd+'"/></td><td><input class="isContract" type="checkbox" onchange="useContractAuthor(this)" checked/></td></tr>',o+='<tr class="warning"><td colspan="6"><span style="margin-right:1rem;">Email(必填):<input type="text" name="" placeholder="邮箱(登录用户可见)" class="contractEmail" value="'+n.config.authorInfos[r].contractObj.contractEmail+'"/></span><span style="margin-right:1rem;">Tel(选填):<input type="text" name="" placeholder="电话号码(登录用户可见)" class="contractTel" value="'+n.config.authorInfos[r].contractObj.contractTel+'"/></span><span style="margin-right:1rem;">Address(选填):<input type="text" name="" placeholder="地址(登录用户可见)" style="width:300px" class="contractAdd" value="'+n.config.authorInfos[r].contractObj.contractAdd+'"/></span><span>ZipCode(选填):<input type="text" name="" placeholder="邮政编码" style="width:100px" class="contractCode" value="'+n.config.authorInfos[r].contractObj.contractCode+'"/></span></td></tr>'):o+='<tr class="authorClass"><td><a class="editorBtn btn btn-primary btn-sm" onclick="delOneAuthorInfo(this)">删除</a></td><td><a class="editorBtn btn btn-primary btn-sm" onclick="upToTop(this)"><span class="fa fa-arrow-up"></span></a><a class="editorBtn btn btn-primary btn-sm" onclick="downToBottom(this)"><span class="fa fa-arrow-down"></span></a></td><td><input class="authorName" type="text" value="'+n.config.authorInfos[r].name+'" placeholder="完全公开"/></td><td><input class="authorKcid" type="text" value="'+n.config.authorInfos[r].kcid+'" placeholder="KCID为纯数字组成"/></td><td><input class="authorAgency" type="text" value="'+n.config.authorInfos[r].agency+'"/></td><td>'+e+'<input class="authorAgencyAdd" type="text" style='+s+' onclick="SetAgencyCity(this)" value="'+n.config.authorInfos[r].agencyAdd+'"/></td><td><input class="isContract" type="checkbox" onchange="useContractAuthor(this)"/></td></tr>'}$("#authInfoList").find("tbody").html(o)}}},outputAuthorInfosList:function(){var t=[];return $(".authorClass").each((function(n,e){var a=$(e).find(".authorName").val(),o=$(e).find(".authorKcid").val(),r=$(e).find(".authorAgency").val(),s=$(e).find(".authorCountry").val(),i=$(e).find(".authorAgencyAdd").val();if(a.length>30||o.length>30||i.length>30)throw"姓名、kcid、机构地址字数不得大于30";var c=/.*[\u4e00-\u9fa5]+.*$/.test(a),l=/[a-zA-Z]+/.test(a);if(!c&&!l)throw"姓名不能没有中英文字符";if(r.length>100)throw"机构名称字数不得大于100";var d={contractEmail:"",contractTel:"",contractAdd:"",contractCode:""},p=$(e).find(".isContract").prop("checked");if(p){var u=$(e).next();d.contractEmail=u.find(".contractEmail").val();var f=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(d.contractEmail);if(!d.contractEmail)throw"通信Email必须填写";if(d.contractEmail.length>50)throw"Email字数不得大于50";if(!f)throw"请输入正确格式的邮箱";if(d.contractTel=u.find(".contractTel").val(),d.contractTel.length>0){var h=/.*[\u4e00-\u9fa5]+.*$/.test(d.contractTel),g=/.*[\u4e00-\u9fa5]+.*$/.test(d.contractTel);if(h||g)throw"请输入正确的电话号码"}if(d.contractTel.length>30)throw"电话号码不得超过30字";if(d.contractAdd=u.find(".contractAdd").val(),d.contractAdd.length>100)throw"通信地址不得超过100字";if(d.contractCode=u.find(".contractCode").val(),d.contractCode.length>0)if(!/^[0-9]*$/.test(d.contractCode))throw"请输入正确的邮政编码";if(d.contractCode.length>15)throw"邮政编码不得超过15个字"}var y={name:a,kcid:o,agency:r,agencyCountry:s,agencyAdd:i,isContract:p,contractObj:d};(a.length>0||o.length>0)&&t.push(y)})),t},initOriginState:function(){if(n.config.enableOriginState){var t=n.get("originState");t&&(t.style.display="",n.config.originState&&$("#originStateText").val(n.config.originState))}},clickOriginState:function(){if(n.config.useOriginState){var t="<span>声明原创</span>";$("#originBtn").removeClass("originBtnActive"),$("#originBtn").html(t),$("#originStateTextDiv").css("display","none"),n.config.useOriginState=!1}else{t="<span>声明原创</span><span class='fa fa-check'></span>";$("#originBtn").addClass("originBtnActive"),$("#originBtn").html(t),$("#originStateTextDiv").css("display",""),n.config.useOriginState=!0}},paperExport:function(){var t={};if(n.config.enableAbstract){var e=$("#abstractCn").val(),a=$("#abstractEn").val();t.abstractCn=e||"",t.abstractEn=a||""}if(n.config.enableKeyWords){var o=[],r=[];if($(".keyCn").each((function(){o.push($(this).attr("kValue"))})),$(".keyEn").each((function(){r.push($(this).attr("kValue"))})),o.length+r.length>50)throw"关键词数量不得超过50个";t.keyWordsCn=o,t.keyWordsEn=r}if(n.config.enableAuthorInfos&&(t.authorInfos=n.outputAuthorInfosList()),n.config.enableOriginState){var s=$("#agreeOrigin").prop("checked"),i=$("#originStateText").val();if("0"!==i&&0==s)throw"声明原创需仔细阅读并同意相关协议";t.originState=i||"0"}return t}};var e=["中国","阿尔巴尼亚","阿尔及利亚","阿富汗","阿根廷","阿联酋","阿鲁巴","阿曼","阿塞拜疆","阿森松岛","埃及","埃塞俄比亚","爱尔兰","爱沙尼亚","安道尔","安哥拉","安圭拉","安提瓜岛和巴布达","澳大利亚","奥地利","奥兰","巴巴多斯岛","巴布亚新几内亚","巴哈马","巴基斯坦","巴拉圭","巴勒斯坦","巴林","巴拿马","巴西","白俄罗斯","百慕大","保加利亚","北马里亚纳","贝宁","比利时","冰岛","波多黎各","波兰","玻利维亚","波黑","博茨瓦纳","伯利兹","不丹","布基纳法索","布隆迪","布韦岛","朝鲜","丹麦","德国","东帝汶","多哥","多米尼加","多米尼加共和国","俄罗斯","厄瓜多尔","厄立特里亚","法国","法罗","法属波利尼西亚","法属圭亚那","法属南部领地","梵蒂冈","菲律宾","斐济","芬兰","佛得角","弗兰克","冈比亚","刚果","刚果民主共和国","哥伦比亚","哥斯达黎加","格恩西岛","格林纳达","格陵兰","古巴","瓜德罗普","关岛","圭亚那","哈萨克斯坦","海地","韩国","荷兰","荷属安地列斯","赫德和麦克唐纳","洪都拉斯","基里巴斯","吉布提","吉尔吉斯斯坦","几内亚","几内亚比绍","加拿大","加纳","加蓬","柬埔寨","捷克共和国","津巴布韦","喀麦隆","卡塔尔","开曼","科科斯","科摩罗","科特迪瓦","科威特","克罗地亚","肯尼亚","库克","拉脱维亚","莱索托","老挝","黎巴嫩","利比里亚","利比亚","立陶宛","列支敦士登","留尼旺岛","卢森堡","卢旺达","罗马尼亚","马达加斯加","马尔代夫","马耳他","马拉维","马来西亚","马里","马其顿","马绍尔","马提尼克","马约特岛","曼岛","毛里求斯","毛里塔尼亚","美国","美属萨摩亚","美属外岛","蒙古","蒙特塞拉特","孟加拉","密克罗尼西亚","秘鲁","缅甸","摩尔多瓦","摩洛哥","摩纳哥","莫桑比克","墨西哥","纳米比亚","南非","南极洲","南乔治亚南桑德威奇","瑙鲁","尼泊尔","尼加拉瓜","尼日尔","尼日利亚","纽埃","挪威","诺福克","帕劳","皮特凯恩","葡萄牙","乔治亚","日本","瑞典","瑞士","萨尔瓦多","萨摩亚","塞拉利昂","塞内加尔","塞浦路斯","塞舌尔","沙特阿拉伯","圣诞岛","圣多美和普林西比","圣赫勒拿","圣基茨和尼维斯","圣卢西亚","圣马力诺","圣皮埃尔和米克隆","圣文森特","斯里兰卡","斯洛伐克","斯洛文尼亚","斯瓦尔巴和扬马廷","斯威士兰","苏丹","苏里南","所罗门","索马里","塔吉克斯坦","泰国","坦桑尼亚","汤加","特克斯和凯克特斯","特里斯坦达昆哈","特立尼达和多巴哥","突尼斯","图瓦卢","土耳其","土库曼斯坦","托克劳","瓦利斯和福图纳","瓦努阿图","危地马拉","维尔京，美属","维尔京，英属","委内瑞拉","文莱","乌干达","乌克兰","乌拉圭","乌兹别克斯坦","西班牙","希腊","新加坡","新喀里多尼亚","新西兰","匈牙利","叙利亚","牙买加","亚美尼亚","也门","伊拉克","伊朗","以色列","意大利","印度","印度尼西亚","英国","英属印度洋领地","约旦","越南","赞比亚","泽西岛","乍得","直布罗陀","智利","中非共和国"];function a(t){for(var n="",a=0;a<e.length;a++)n+=t&&t==e[a]?"<option selected>"+e[a]+"</option>":"<option>"+e[a]+"</option>";return"<select id='selectList' class='authorCountry' style='vertical-align:bottom;height:22px' onchange='changeCountry(this)'>"+n+"</select>"}t(window,{testThOpen:function(){var t=[],n=[];$(".chooseForum").each((function(){var n=$(this).attr("fid");n&&"undefined"!==n&&t.push(n)})),$(".chooseCate").each((function(){var t=$(this).attr("cid");t&&"undefined"!==t&&n.push(t)})),testTh.open((function(t){for(var n="",e=t.forums,a=0;a<e.length;a++)n+='<div class="move-thread-forum-name" style="background-color:'+e[a].color+' "><span class="chooseForum" fid="'+e[a].fid+'">'+e[a].fName+'<span class="chooseCate" cid="'+e[a].cid+'"> '+e[a].cName+"</span></span></div>";$("#newPanelForum").html(n),testTh.close()}),{hideMoveType:!0,selectedForumsId:t,selectedCategoriesId:n,forumCountLimit:2,showAnonymousCheckbox:!1})},paperProto:n,openKeyWordsPanel:function(t){n.keyWordsPanelOpen(t)},removeOneKeyWords:function(t){$(t).parent(".keyTags").remove()},addOneAuthorInfo:function(){var t='<tr class="authorClass"><td><a class="editorBtn btn btn-primary btn-sm" onclick="delOneAuthorInfo(this)">删除</a></td><td><a class="editorBtn btn btn-primary btn-sm" onclick="upToTop(this)"><span class="fa fa-arrow-up"></span></a><a class="editorBtn btn btn-primary btn-sm" onclick="downToBottom(this)"><span class="fa fa-arrow-down"></span></a></td><td><input class="authorName" type="text" placeholder="完全公开"/></td><td><input class="authorKcid" type="text" placeholder="KCID为纯数字组成"/></td><td><input class="authorAgency" type="text" /></td><td>'+a()+'<input class="authorAgencyAdd" style="height:22px" type="text" onclick="SetAgencyCity(this)"/></td><td><input class="isContract" type="checkbox" onchange="useContractAuthor(this)" /></td></tr>';$("#authInfoList").find("tbody").append(t)},delOneAuthorInfo:function(t){if(confirm("确定要删除当前条目？")){if($(t).parents("tr").find(".isContract").prop("checked"))return screenTopWarning("删除当前条目请先关闭通信作者");$(t).parents("tr").remove()}},upToTop:function(t){var n=$(t).parents(".authorClass"),e=n.prev();return"warning"==n.next().attr("class")?screenTopWarning("移动条目需关闭本条目通信作者"):"warning"==e.attr("class")?screenTopWarning("上移本条目需关闭上一条目通信作者"):e.attr("class")?void n.fadeOut("slow",(function(){e.before(n)})).fadeIn():screenTopWarning("已经到了最顶部")},downToBottom:function(t){var n=$(t).parents(".authorClass");n.prev();var e=n.next(),a=n.next().next();return"warning"==e.attr("class")?screenTopWarning("移动条目需关闭本条目通信作者"):"warning"==a.attr("class")?screenTopWarning("下移本条目需关闭下一条目通信作者"):e.attr("class")?void n.fadeOut("slow",(function(){e.after(n)})).fadeIn():screenTopWarning("已经到了最底部")},outputAuthorInfosList:function(){var t=[];try{$(".authorClass").each((function(n,e){var a=$(e).find(".authorName").val();if(!a)throw"有未填写完成的作者项";var o=$(e).find(".authorKcid").val(),r=$(e).find(".authorAgency").val(),s=$(e).find(".authorAgencyAdd").val(),i={contractEmail:"",contractTel:"",contractAdd:"",contractCode:""},c=$(e).find(".isContract").prop("checked");if(c){var l=$(e).next();if(i.contractEmail=l.find(".contractEmail").val(),!i.contractEmail)throw"通信Email必须填写";i.contractTel=l.find(".contractTel").val(),i.contractAdd=l.find(".contractAdd").val(),i.contractCode=l.find(".contractCode").val()}var d={name:a,kcid:o,agency:r,agencyAdd:s,isContract:c,contractObj:i};t.push(d)}))}catch(t){return screenTopWarning(t)}return t},useOriginState:function(){n.clickOriginState()},useContractAuthor:function(t){if($(t).prop("checked")){n='<tr class="warning"><td colspan="6"><span style="margin-right:1rem;">Email(必填):<input type="text" name="" placeholder="邮箱(登录用户可见)" class="contractEmail"/></span><span style="margin-right:1rem;">Tel(选填):<input type="text" name="" placeholder="电话号码(登录用户可见)" class="contractTel"/></span><span style="margin-right:1rem;">Address(选填):<input type="text" name="" placeholder="地址(登录用户可见)" class="contractAdd" style="width:300px"/></span><span>ZipCode(选填):<input type="text" name="" placeholder="邮政编码" class="contractCode" style="width:100px"/></span></td></tr>';$(t).parents("tr").after(n)}else var n=$(t).parents("tr").next().remove()},testbtn:function(){n.paperExport()},countryArr:e,getCountryList:a,changeCountry:function(t){"中国"==$(t).val()?$(t).next().css("display",""):$(t).next().css("display","none")}})}));
