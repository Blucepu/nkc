!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}var n={};function t(e){var n=$('input[name="'+e+'"]');n.on("click",(function(){n.eq(0).is(":checked")?($("#"+e+"Fund").hide(),$("#"+e+"Other").hide(),$("#"+e+"User").show()):n.eq(1).is(":checked")?($("#"+e+"User").hide(),$("#"+e+"Other").hide(),$("#"+e+"Fund").show()):n.eq(2).is(":checked")?($("#"+e+"User").hide(),$("#"+e+"Fund").hide(),$("#"+e+"Other").hide()):($("#"+e+"User").hide(),$("#"+e+"Fund").hide(),$("#"+e+"Other").show())}))}function i(){var e=$("#time").val(),t=$("#time").attr("time");if(!e){if(!t)throw"请选择时间。";e=parseInt(t)}n.toc=new Date(e).getTime();var i=$("#abstract").val();if(!i)throw"请输入摘要。";n.abstract=i,o("from"),o("to"),n.notes=$("#notes").val(),n.verify=$('input[name="verify"]').eq(0).is(":checked");var r=$("#money").val();if(!((r=parseFloat(r))>0))throw"请输入金额。";n.money=r.toFixed(1),n.otherInfo={name:$("#name").val(),account:$("#account").val(),paymentType:$("#paymentType").val(),transactionNumber:$("#transactionNumber").val()}}function o(e){n[e]={};var t=$('input[name="'+e+'"]');if(t.eq(0).is(":checked"))n[e].type="user",n[e].id=$("#"+e+"Uid").val()||"",n[e].anonymous=$('input[name="'+e+'Anonymous"]').eq(0).is(":checked");else if(t.eq(1).is(":checked")){n[e].type="fund";for(var i=$('input[name="'+e+'Fund"]'),o="",r=0;r<i.length;r++)if(i.eq(r).is(":checked")){o=i.eq(r).attr("fundId");break}if(!o)throw"请选择基金项目。";n[e].id=o}else if(t.eq(2).is(":checked"))n[e].type="fundPool";else{n[e].type="other";var a=$("#"+e+"OtherInfo").val();if(!a)throw"请输入其他途径。";n[e].id=a}}function r(e){"fundPool"===e.from.type?openToNewLocation("/fund/bills"):"fund"===e.from.type?openToNewLocation("/fund/list/"+e.from.id+"/bills"):"fund"===e.to.type?openToNewLocation("/fund/list/"+e.to.id+"/bills"):openToNewLocation("/fund/bills")}$((function(){t("from"),t("to")})),e(window,{initFromTo:t,getUser:function(e){var n=$("#"+e+"Uid").val();if(""===n)return screenTopWarning("用户UID不能为空。");nkcAPI("/u/"+n,"GET",{}).then((function(n){var t=n.targetUser;t?$("#"+e+"UserInfo").text("用户名: "+t.username).removeClass("text-danger"):$("#"+e+"UserInfo").text("未找到用户").addClass("text-danger")})).catch((function(e){screenTopWarning(e.error)}))},inputAbstract:function(e){$("#abstract").val(e)},load:i,loadFromTo:o,submit:function(e){$("#submit").addClass("disabled");try{var t,o;i(),e?(t="/fund/bills/"+e,o="PUT"):(t="/fund/bills",o="POST"),nkcAPI(t,o,{billObj:n}).then((function(){r(n)})).catch((function(e){$("#submit").removeClass("disabled"),screenTopWarning(e.error)}))}catch(e){screenTopWarning(e)}},jump:r})}));
