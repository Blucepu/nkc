!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}var n={money:500,anonymous:!1},t=$("#info").text(),o=JSON.parse(t).login;function r(){$(".choose-anonymous").on("click",(function(){$(".choose-anonymous").removeClass("active"),$(this).addClass("active"),n.anonymous="true"===$(this).attr("anonymous")}));for(var e=$(".select"),t=0;t<e.length;t++)if("已选择"===e.eq(t).text()){n.fundId=e.eq(t).attr("fundid");break}}function i(){var e=$("#message").attr("bid");e&&function n(){setTimeout((function(){nkcAPI("/fund/bills/"+e,"GET",{}).then((function(e){var t=e.bill;t.verify?($("#message").text("系统已确认，支付成功！"),setTimeout((function(){openToNewLocation("/fund")}),3e3)):t.error?$("#error").text(t.error):("....."===$("#message .point").html()&&$("#message .point").html(""),$("#message .point").html($("#message .point").html()+"."),n())})).catch((function(e){screenTopWarning(e.error)}))}),2e3)}()}$((function(){r(),i()})),e(window,{init:r,submit:function(){var e=$("#submit").attr("onclick");$("#submit").attr("onclick","").addClass("disabled");for(var t=$(".selectMoney"),r=0;r<t.length;r++)if("已选择"===t.eq(r).text()){if(void 0===t.eq(r).attr("money")){i=(i=$("#money input").val())?parseInt(i):0}else{var i=t.eq(r).attr("money");i=parseInt(i)}n.money=i;break}if(n.money<20)return $("#submit").removeClass("disabled").attr("onclick",e),screenTopWarning("单笔赞助金额不能少于20元。");if(n.money>1e4)return $("#submit").removeClass("disabled").attr("onclick",e),screenTopWarning("单笔赞助金额不能超过10000元，请分批次赞助。");if(!n.anonymous&&!o)return $("#submit").removeClass("disabled").attr("onclick",e),screenTopWarning("非匿名赞助要求用户必须登录，请登录后再试。");var a,s="/fund/donation?getUrl=true&money="+n.money+"&anonymous="+n.anonymous,c=NKC.methods.isPhone();if("reactNative"!==NKC.configs.platform){if(c)return s+="&redirect=true",screenTopAlert("正在前往支付宝..."),window.location.href=s;a=window.open()}nkcAPI(s,"GET").then((function(e){"reactNative"===NKC.configs.platform?NKC.methods.visitUrl(e.url,!0):a.location=e.url,sweetInfo("请在浏览器新打开的窗口完成支付！若没有新窗口打开，请检查新窗口是否已被浏览器拦截。")})).catch((function(n){a&&(a.document.body.innerHTML=n.error||n),sweetError(n),$("#submit").removeClass("disabled").attr("onclick",e)}))},ensureBill:i,selectFund:function(e){n.fundId=e;var t=$(".select");t.text("").css("background-color","");for(var o=0;o<t.length;o++){var r=t.eq(o);if(r.attr("fundid")===n.fundId){r.text("已选择").css("background-color","rgba(255,255,255,0.8)");break}}},selectMoney:function(e){n.money=e;var t=$(".selectMoney");t.text("未选择").css("color","#c3e9f5");for(var o=0;o<t.length;o++){var r=t.eq(o),i=r.attr("money");if(i?(i=parseInt(i),$("#money").hide()):$("#money").show(),e===i){r.text("已选择").css("color","#ffc253");break}}},disappearMask:function(){$("#donation-mask").addClass("hidden")}})}));
