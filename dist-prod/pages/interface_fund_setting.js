!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}var n={name:"科创基金",money:{fixed:null,max:null},description:{},auditType:null,display:!0,canApply:!0,history:!1,disabled:!1,censor:{certs:[],appointed:[]},expert:{certs:[],appointed:[]},financialStaff:{certs:[],appointed:[]},admin:{certs:[],appointed:[]},voter:{certs:[],appointed:[]},commentator:{certs:[],appointed:[]},color:"#7f9eb2",image:{},applicationMethod:{personal:null,team:null},applicant:{userLevel:null,threadCount:null,postCount:null,timeToRegister:null},member:{},thread:{},paper:{},detailedProject:!0,timeOfPublicity:0,modifyCount:3,supportCount:0,conflict:{self:!1,other:!1}};function t(){n._id=$("#fundId").val(),n.name=$("#fundName").val(),n.description.brief=$("#briefDescription").val(),n.description.detailed=$("#detailedDescription").val(),n.description.terms=$("#terms").val(),n.reminder={},n.reminder.inputProject=$("#inputProject").val(),n.reminder.inputUserInfo=$("#inputUserInfo").val(),n.reminder.inputProject&&n.reminder.inputUserInfo||screenTopWarning("所有温馨提示不能为空"),n.color=$("#fundColor").val()||"#7f9eb2";var e=$("#fundImageDisplay").attr("imageId");n.image.banner=e?parseInt(e):null;var t=$("#fundLogoImageDisplay").attr("imageId");n.image.logo=t?parseInt(t):null;var a=$("#fundMoney").val();a=a?parseInt(a):null,$('input[name="moneyFixed"]').eq(0).is(":checked")?(n.money.fixed=a,n.money.max=null):(n.money.max=a,n.money.fixed=null),$('input[name="auditType"]').eq(0).is(":checked")?n.auditType="person":n.auditType="system",n.display=$('input[name="display"]').eq(0).is(":checked"),n.canApply=$('input[name="canApply"]').eq(0).is(":checked"),n.history=$('input[name="history"]').eq(0).is(":checked"),n.disabled=$('input[name="disabled"]').eq(0).is(":checked");var i,r=$('input[name="expertCert"]');n.expert.certs=[];for(var o=0;o<r.length;o++)(i=r.eq(o)).is(":checked")&&n.expert.certs.push(i.attr("cert"));n.expert.appointed=s($("#expertUid").val());var c=$('input[name="financialStaffCert"]');n.financialStaff.certs=[];for(o=0;o<c.length;o++)(i=c.eq(o)).is(":checked")&&n.financialStaff.certs.push(i.attr("cert"));n.financialStaff.appointed=s($("#financialStaffUid").val());var p=$('input[name="censorCert"]');n.censor.certs=[];for(o=0;o<p.length;o++)(i=p.eq(o)).is(":checked")&&n.censor.certs.push(i.attr("cert"));n.censor.appointed=s($("#censorUid").val());var d=$('input[name="adminCert"]');n.admin.certs=[];for(o=0;o<d.length;o++)(i=d.eq(o)).is(":checked")&&n.admin.certs.push(i.attr("cert"));n.admin.appointed=s($("#adminUid").val());var l=$('input[name="commentatorCert"]');n.commentator.certs=[];for(o=0;o<l.length;o++)(i=l.eq(o)).is(":checked")&&n.commentator.certs.push(i.attr("cert"));n.commentator.appointed=s($("#commentatorUid").val());var u=$('input[name="voterCert"]');n.voter.certs=[];for(o=0;o<u.length;o++)(i=u.eq(o)).is(":checked")&&n.voter.certs.push(i.attr("cert"));n.voter.appointed=s($("#voterUid").val());var f=$("#userLevel").val();n.applicant.userLevel=f?parseInt(f):0;var m=$("#threadCount").val();n.applicant.threadCount=m?parseInt(m):0;var v=$("#postCount").val();n.applicant.postCount=v?parseInt(v):0;var h=$("#timeToRegister").val();n.applicant.timeToRegister=h?parseInt(h):0;var g=$("#applicantAuthLevel").val();n.applicant.authLevel=g?parseInt(g):1;var y=$("#memberAuthLevel").val();n.member.authLevel=y?parseInt(y):1;var I=$("#attachmentsThreads").val();n.thread.count=I?parseInt(I):0;var b=$("#attachmentsPapers").val();n.paper.count=b?parseInt(b):0,n.paper.passed=$('input[name="passed"]').eq(0).is(":checked"),n.applicationMethod.personal=$('input[name="applicationMethod"]').eq(0).is(":checked"),n.applicationMethod.team=$('input[name="applicationMethod"]').eq(1).is(":checked"),n.detailedProject=$('input[name="detailedProject"]').eq(0).is(":checked");var C=$("#modifyCount").val();n.modifyCount=C?parseInt(C):5;var k=$("#supportCount").val();n.supportCount=k?parseInt(k):0;var T=$("#timeOfPublicity").val();n.timeOfPublicity=T?parseInt(T):0;var L=$("#applicationCountLimit").val();n.applicationCountLimit=L?parseInt(L):10,n.conflict.self=$('input[name="conflict"]').eq(0).is(":checked"),n.conflict.other=$('input[name="conflict"]').eq(1).is(":checked")}function a(){var e=$("#fundColor").val()||"#7f9eb2";$("#fundColorDisplay").css("background-color",e),n.color=e}function i(){$("#fundColor").on("input",(function(){a()}))}function r(){uploadFile("/fundBanner","#fundImage",c)}function o(){uploadFile("/fundLogo","#fundLogoImage",p)}function c(e){var t=e.imageId;n.image.banner=t,$("#fundImageDisplay").css({display:"block"}).attr({src:"/fundBanner/"+t,imageId:t})}function p(e){var t=e.imageId;n.image.logo=t,$("#fundLogoImageDisplay").css({display:"block"}).attr({src:"/fundLogo/"+t,imageId:t})}function d(){var e="固定金额（人民币元，不能有小数点）";$('input[name="moneyFixed"]').eq(1).is(":checked")&&(e="最大申请金额（人民币元，不能有小数点）"),$("#fundMoney").attr("placeholder",e),$("#fundMoneyText").text(e)}function l(){$('input[name="moneyFixed"]').on("click",(function(){d()}))}function s(e){if(""===e)return[];for(var n=e.split(","),t=[],a=0;a<n.length;a++){var i=$.trim(n[a]);-1===t.indexOf(i)&&t.push(i)}return t}$((function(){t(),l(),r(),o(),i()})),e(window,{fundObj:n,loadSettings:t,colorSet:a,color:i,uploadFundImage:r,uploadfundLogoImage:o,uploadSuccess:c,uploadAvatarImgSuccess:p,moneyFixedSet:d,moneyFixed:l,deleteBanner:function(){$("#fundImageDisplay").css("display","none").attr("imageId","")},deleteLogo:function(){$("#fundLogoImageDisplay").css("display","none").attr("imageId","")},stringToArr:s,submit:function(e){if(t(),""===n._id)return screenTopWarning("基金编号不能为空。");if(!n._id.match(/[A-Z]+/g))return screenTopWarning("基金编号只能由大写字母组成。");if(n._id.length>4)return screenTopWarning("基金编号不能超过四位！");if("system"===n.auditType&&0===n.admin.appointed.length)return screenTopWarning("系统审核必须指定管理员UID。");var a="/fund/list",i="POST";void 0!==e&&(a="/fund/list/"+e,i="PUT"),nkcAPI(a,i,{fundObj:n}).then((function(e){var t=e.fund;n.disabled?openToNewLocation("/fund/list"):n.history?openToNewLocation("/fund/history"):openToNewLocation("/fund/list/"+t._id.toLowerCase())})).catch((function(e){screenTopWarning(e.error)}))}})}));
