!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function t(e){var t=new FormData;return e.forEach((function(e,i){t.append("file"+i,e)})),nkcUploadFile("/e/settings/home/list/biglogo","POST",t)}$("#inputFile").on("change",(function(){var e=$("#inputFile")[0].files[0];if(e){upLoadFile=e;var t=new FormData;t.append("file",upLoadFile),$.ajax({url:"/logo",method:"POST",cache:!1,data:t,headers:{FROM:"nkcAPI"},dataType:"json",contentType:!1,processData:!1}).done((function(){window.location.reload()})).fail((function(e){screenTopWarning(JSON.parse(e.responseText).error)}))}})),window.saveNotice=function(){var e=$("#threadId").val().split(",");nkcAPI("/e/settings/home/notice","PUT",{id:e}).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))};var i=document.getElementById("app");if(i)var n=new Vue({el:"#app",data:{homeSettings:"",info:"",list:[],recommend:[],error:"",logoFiles:[],logoFileUploadding:!1},beforeMount:function(){var e=NKC.methods.getDataById("data");e.homeSettings.list.topic&&this.list.push("topic"),e.homeSettings.list.discipline&&this.list.push("discipline"),e.homeSettings.recommend.featuredThreads&&this.recommend.push("featuredThreads"),e.homeSettings.recommend.hotThreads&&this.recommend.push("hotThreads"),this.homeSettings=e.homeSettings,e.homeBigLogo&&(this.logoFiles=this.logoFiles.concat(e.homeBigLogo))},methods:{save:function(){this.error="",this.info="";var e=this.homeSettings,t=this.list;if(e.list.topic=!1,e.list.discipline=!1,e.hotThreads.postCount<0)return this.error="热门文章最小回复数不能小于0";if(e.hotThreads.postUserCount<0)return this.error="热门文章最小回复用户总数不能小于0";var i=this.recommend;return e.recommend.hotThreads=!1,e.recommend.featuredThreads=!1,-1!==i.indexOf("hotThreads")&&(e.recommend.hotThreads=!0),-1!==i.indexOf("featuredThreads")&&(e.recommend.featuredThreads=!0),e.recommend.voteUpTotal<0?this.error="推荐条件中点赞总数不能小于0":e.recommend.voteUpMax<0?this.error="推荐条件中独立点赞数不能小于0":e.recommend.encourageTotal<0?this.error="推荐条件中鼓励次数不能小于0":(-1!==t.indexOf("topic")&&(e.list.topic=!0),-1!==t.indexOf("discipline")&&(e.list.discipline=!0),void nkcAPI("/e/settings/home/list","PUT",{topic:e.list.topic,discipline:e.list.discipline,visitorThreadList:e.visitorThreadList,hotThreads:e.hotThreads,recommend:e.recommend,subscribesDisplayMode:e.subscribesDisplayMode}).then((function(){sweetSuccess("保存成功")})).catch((function(e){n.error=e.error||e})))},pickPicture:function(){$("#inputFile").click()},addFile:function(){var e=this,i=[].slice.call($("#inputFile")[0].files);e.logoFileUploadding=!0,t(i).then((function(t){e.logoFiles=e.logoFiles.concat(t.saved),e.logoFileUploadding=!1})),$("#inputFile").val("")},deleteBigLogo:function(e){var t=this.logoFiles,i=t[e];nkcAPI("/e/settings/home/list/biglogo","POST",{type:"delete",aid:i.aid}).then((function(){t.splice(e,1),screenTopAlert("删除成功")})).catch((function(e){screenTopAlert(e.error)}))}}});e(window,{saveAdsOrder:function(){for(var e=$('input[name="threadOrder"]'),t=[],i=[],n=0;n<e.length;n++){var o=e.eq(n).attr("data-tid"),r=e.eq(n).val();if(r=parseInt(r),0===t.length)t.push(r),i.push(o);else{for(var s=!1,a=0;a<t.length;a++)if(t[a]>r){t.splice(a,0,r),i.splice(a,0,o),s=!0;break}s||(t.push(r),i.push(o))}}nkcAPI("/e/settings/home/top","PUT",{operation:"modifyOrder",ads:i}).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},defaultLogo:function(e,t){nkcAPI("/e/settings/home/logo","PUT",{id:e,type:t,operation:"saveLogo"}).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},deleteLogo:function(e){nkcAPI("/e/settings/home/logo?id="+e,"DELETE",{}).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},removeNotice:function(e){nkcAPI("/e/settings/home/notice?oc="+e,"DELETE",{}).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},saveWaterMarkSettings:function(){var e=$("#watermarkTransparency").val(),t=$("#waterLimitMinWidth").val(),i=$("#waterLimitMinHeight").val();nkcAPI("/e/settings/home/logo","PUT",{watermarkTransparency:e,waterLimitMinWidth:parseInt(t),waterLimitMinHeight:parseInt(i),operation:"saveWaterMarkSettings"}).then((function(){screenTopAlert("保存成功")})).catch((function(e){screenTopWarning(e.error||e)}))},uploadHomeBigLogo:t,saveHomeListSettings:function(){var e=$('input[name="list"]'),t=e.eq(0).is(":checked"),i=e.eq(1).is(":checked"),n=$('input[name="visitor"]');n=n.eq(0).is(":checked")?"latest":"recommend",nkcAPI("/e/settings/home/list","PUT",{topic:t,discipline:i,visitorThreadList:n}).then((function(){screenTopAlert("保存成功")})).catch((function(e){screenTopWarning(e.error||e)}))},vueDom:i})}));
