!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var r=NKC.methods.getDataById("data").keywordSetting||{enable:!1,wordGroup:[]};function t(e){e.rename=!1,e.keywordView=!1,e.pageIndex=0,e.searchInputText="",e.searchedWords=[]}var n=r.wordGroup;n.map((function(e){t(e)}));var o=new Vue({el:"#app",data:{keywordSetting:r,form:{groupName:"",keywords:null},add:!1},methods:{triggerKeyword:function(e){nkcAPI("/e/settings/review/keyword","PUT",{type:"enable",value:e}).then((function(){sweetAlert(e?"已启用":"已禁用")})).catch(sweetError)},deleteWordGroup:function(e){var r=this,t=r.keywordSetting.wordGroup[e].id;sweetConfirm("确定要删除这个关键词组吗?").then((function(){return nkcAPI("/e/settings/review/keyword","PUT",{type:"deleteWordGroup",value:t})})).then((function(){r.keywordSetting.wordGroup.splice(e,1)}))},addWordGroup:function(){var e=this;if(e.form.keywords){var r={name:e.form.groupName,keywords:e.form.keywords,conditions:{count:1,times:1,logic:"or"}};t(r),sweetConfirm("确认添加新敏感词词组:"+r.name+"吗？共包含关键词: "+r.keywords.length+"个关键词。").then((function(){return nkcAPI("/e/settings/review/keyword","PUT",{type:"addWordGroup",value:r})})).then((function(t){r.id=t.id,e.keywordSetting.wordGroup.push(r),sweetAlert("已添加")})).catch(sweetError).then((function(){e.form.groupName="",e.form.keywords=null}))}},renameGroup:function(e){var r=this.keywordSetting.wordGroup[e],t=r.name;return nkcAPI("/e/settings/review/keyword","PUT",{type:"renameWordGroup",value:{id:r.id,newName:t}}).then((function(){r.rename=!1})).catch(sweetError)},updateReviewCondition:function(e){nkcAPI("/e/settings/review/keyword","PUT",{type:"reviewCondition",value:{id:e.id,conditions:e.conditions}}).catch(sweetError)},keywordFile:function(e){var r=e.name.split(".");r.length>1&&r.pop();var t=r.join("."),n=this,o=new FileReader;o.readAsText(e),o.onload=function(){var e=o.result.split(/[\r]{0,1}\n/);if(!e.length)return sweetWarning("无新的关键字");n.form.keywords=e.filter((function(e){return!!e})),n.form.groupName||(n.form.groupName=t)}},addKeyword:function(e){var r=this.keywordSetting.wordGroup[e],t=window.prompt("请输入一个关键词(中、英(不区分大小)、数字)","");if(t){var n=t.toLowerCase();nkcAPI("/e/settings/review/keyword","PUT",{type:"addKeywords",value:{groupId:r.id,keyword:n}}).then((function(e){e.added?(sweetAlert("已添加"),r.keywords.push(n)):sweetWarning("重复添加")})).catch(sweetError)}},deleteKeyword:function(e,r){var t=this.keywordSetting.wordGroup[e],n=t.keywords[r];sweetConfirm('确认删除词组 "'+t.name+'" 中的 "'+n+'" 关键词吗?').then((function(){return nkcAPI("/e/settings/review/keyword","PUT",{type:"deleteKeywords",value:{groupId:t.id,keyword:n}})})).then((function(){sweetAlert("已删除"),t.keywords.splice(r,1)})).catch(sweetError)},exportWordGroup:function(e){var r=this.keywordSetting.wordGroup[e],t=r.keywords.join("\n"),n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+t),n.setAttribute("download","敏感词组_"+r.name+".txt"),n.click()},applyAllForums:function(e){var r=self.keywordSetting.wordGroup[e].id;sweetConfirm("确定要将这个词组应用到所有专业吗?").then((function(){return nkcAPI("/e/settings/review/keyword","PUT",{type:"applyAllForums",value:r})})).then((function(){sweetAlert("成功")})).catch(sweetError)},searchWordInputChange:function(e,r){var t=this.keywordSetting.wordGroup[r];t.searchedWords.length=0,t.searchInputText&&t.keywords.forEach((function(r){-1!==r.indexOf(e.value)&&t.searchedWords.push(r)}))},deleteSearchedKeyword:function(e,r){var t=this.keywordSetting.wordGroup[e],n=t.keywords.indexOf(r);if(n<0)return sweetWarning("删除异常，此词组中不存在此关键字");sweetConfirm('确认删除词组 "'+t.name+'" 中的 "'+r+'" 关键词吗?').then((function(){return nkcAPI("/e/settings/review/keyword","PUT",{type:"deleteKeywords",value:{groupId:t.id,keyword:r}})})).then((function(){sweetAlert("已删除"),t.keywords.splice(n,1),t.searchInputText="",t.searchedWords.length=0})).catch(sweetError)},startEdit:function(e){},endEdit:function(e,r,t){var n=parseInt(e.innerText,10);r.conditions[t]=n,this.updateReviewCondition(r)}}});e(window,{keywordSetting:r,initGroup:t,wordGroup:n,app:o})}));
