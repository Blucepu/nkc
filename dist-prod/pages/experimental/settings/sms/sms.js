!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=NKC.methods.getDataById("data");window.app=new Vue({el:"#app",data:{smsSettings:e.smsSettings,nationCodes:nationCodes,modifyApp:!1,test:{name:"register",mobile:"",nationCode:"86",content:""}},methods:{checkString:NKC.methods.checkData.checkString,saveApp:function(){var e=this.smsSettings,t=e.appId,n=e.appKey,i=e.smsSign,s=e.platform,r=this;Promise.resolve().then((function(){if(!s)throw"请选择短信平台";return r.checkString(t,{name:"App ID",minLength:1}),r.checkString(n,{name:"App Key",minLength:1}),r.checkString(i,{name:"短信签名",minLength:1}),nkcAPI("/e/settings/sms","PUT",{type:"modifyApp",smsSettings:{appId:t,appKey:n,smsSign:i,platform:s}})})).then((function(e){sweetSuccess("保存成功")})).catch(sweetError)},getChineseName:function(e){var t="";return this.nationCodes.forEach((function(n){n.code===e&&(t=n.chineseName)})),t},isDisabled:function(e){for(var t=0;t<this.smsSettings.restrictedNumber.length;t++)if(e===this.smsSettings.restrictedNumber[t].code)return!0;return!1},tran:function(e){switch(e){case"register":return"注册";case"login":return"登录";case"getback":return"找回密码";case"bindMobile":return"绑定手机";case"changeMobile":return"更改手机号";case"reset":return"绑定新手机号";case"withdraw":return"提现";case"destroy":return"账号注销";case"unbindMobile":return"解绑手机号";case"changeUnusedPhoneNumber":return"更换失效的手机号";case"verifyPhoneNumber":return"定期验证手机号"}},testSendMessage:function(){var e=this,t=e.test.name,n=e.test.mobile,i=e.test.nationCode,s=e.test.content;Promise.resolve().then((function(){if(!t)throw"请选择测试类型";if(!i)throw"请选择测试手机国际区号";if(!n)throw"请输入测试手机号码";if(!s)throw"请输入自定义验证码";return sweetQuestion("确定要发送短消息？")})).then((function(){return nkcAPI("/e/settings/sms/test","POST",{name:t,mobile:n,nationCode:i,content:s})})).then((function(){sweetSuccess("短信发送成功")})).catch(sweetError)},save:function(){var e=this.smsSettings,t=this;Promise.resolve().then((function(){e.appId+="";var n=e.appId,i=e.appKey,s=e.smsSign;t.checkString(n,{name:"App ID",minLength:1}),t.checkString(i,{name:"App Key",minLength:1}),t.checkString(s,{name:"短信签名",minLength:1});for(var r=0;r<e.templates.length;r++){var a=e.templates[r];if(e.status){if(""===a.id)throw a.name+"的模板ID不能为空";if(""===a.validityPeriod)throw a.name+"的有效时间不能为空";if(a.validityPeriod<=0)throw a.name+"的有效时间必须大于0";if(""===a.sameIpOneDay)throw a.name+"的IP次数限制不能为空";if(a.sameIpOneDay<=0)throw a.name+"的IP次数限制必须大于0";if(""===a.sameMobileOneDay)throw a.name+"的手机号码次数限制不能为空";if(a.sameMobileOneDay<=0)throw a.name+"的手机号码次数限制必须大于0"}}var o=NKC.methods.checkData.checkString;e.restrictedNumber.forEach((function(e){e.number=e.number.toString(),o(e.code,{name:"国际区号",minLength:1}),o(e.number,{name:"受限号码",minLength:"1"}),e.number=e.number.trim().split(",").filter((function(e){return e.trim()}))}))})).then((function(){return nkcAPI("/e/settings/sms","PUT",{smsSettings:e})})).then((function(){sweetSuccess("保存成功")})).catch(sweetError)}}})}));
