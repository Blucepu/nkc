!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,c=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw c}}}}var r=NKC.methods.getDataById("data"),i=new NKC.methods.selectImage,o=r.scoreSettings.scores;r.scoreSettings._withdrawTimeBegin=m(r.scoreSettings.withdrawTimeBegin),r.scoreSettings._withdrawTimeEnd=m(r.scoreSettings.withdrawTimeEnd),r.scoreSettings._creditMin=r.scoreSettings.creditMin/100,r.scoreSettings._creditMax=r.scoreSettings.creditMax/100;var c=r.scoresType;r.scoreSettings.operations.map((function(e){var t,r=n(c);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=e[i];e["_".concat(i)]=void 0===o?0:o/100}}catch(e){r.e(e)}finally{r.f()}}));var a,s=[],u=n(o);try{for(u.s();!(a=u.n()).done;){var f=a.value,d=f.type,l=f.icon;s.push({type:d,icon:l,iconFile:"",iconData:""})}}catch(e){u.e(e)}finally{u.f()}var h=new Vue({el:"#app",data:{scoreSettings:r.scoreSettings,scores:o,types:c,iconArr:s,submitting:!1},computed:{mainScoreSelect:function(){var e=[];return this.scores.map((function(t){t.enabled&&e.push({type:t.type,name:t.name})})),e},commonScoreSelect:function(){return this.mainScoreSelect}},methods:{getUrl:NKC.methods.tools.getUrl,getHMS:m,HMSToNumber:p,checkString:NKC.methods.checkData.checkString,checkNumber:NKC.methods.checkData.checkNumber,selectIcon:function(e){i.show((function(t){var n=NKC.methods.blobToFile(t);NKC.methods.fileToUrl(n).then((function(t){e.iconData=t,e.iconFile=n,i.close()}))}),{aspectRatio:1})},save:function(){var e=this,t=this.iconArr,r=JSON.parse(JSON.stringify(this.scoreSettings));r.withdrawTimeBegin=p(r._withdrawTimeBegin),r.withdrawTimeEnd=p(r._withdrawTimeEnd);var i=this;Promise.resolve().then((function(){if(r.operations.map((function(e){var t,r=n(i.types);try{for(r.s();!(t=r.n()).done;){var o=t.value,c=e["_".concat(o)];i.checkNumber(c,{name:"积分策略中加减的积分值",fractionDigits:2}),e[o]=parseInt(100*c),delete e["_".concat(o)]}}catch(e){r.e(e)}finally{r.f()}})),e.checkNumber(r._creditMin,{name:"最小鼓励金额",min:.01,fractionDigits:2}),e.checkNumber(r._creditMax,{name:"最大鼓励金额",min:.01,fractionDigits:2}),r._creditMin>r._creditMax)throw"鼓励金额设置错误";r.creditMin=parseInt(100*r._creditMin),r.creditMax=parseInt(100*r._creditMax),delete r._creditMin,delete r._creditMax,delete r._withdrawTimeEnd,delete r._withdrawTimeBegin;var o=new FormData;o.append("scoreSettings",JSON.stringify(r));var c,a=n(t);try{for(a.s();!(c=a.n()).done;){var s=c.value,u=s.iconFile,f=s.type;u&&o.append(f,u,u.name)}}catch(e){a.e(e)}finally{a.f()}return nkcUploadFile("/e/settings/score","PUT",o)})).then((function(){sweetSuccess("保存成功")})).catch((function(e){sweetError(e)}))}}});function m(e){return{hour:Math.floor(e/36e5),min:Math.floor(e/6e4)%60,sec:Math.floor(e/1e3)%60}}function p(e){return 60*e.hour*60*1e3+60*e.min*1e3+1e3*e.sec}e(window,{selectImage:i,scores:o,types:c,iconArr:s,app:h,getHMS:m,HMSToNumber:p})}));
