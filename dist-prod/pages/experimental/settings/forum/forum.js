!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,u=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw u}}}}var r=NKC.methods.getDataById("data"),n=[],o=[],i=function e(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=o.indexOf(i);-1===u&&o.push(i);var s,a=t(r);try{for(a.s();!(s=a.n()).done;){var f=s.value;f.level=i,n.push(f),f.childForums&&f.childForums.length&&e(f.childForums,i+1)}}catch(e){a.e(e)}finally{a.f()}};i(r.forums),window.app=new Vue({el:"#app",data:{levels:o,selectedLevels:o,selectedReviewForumCert:r.forumSettings.reviewNewForumCert||[],selectedNewForumCert:r.forumSettings.openNewForumCert||[],selectedNewForumGrade:r.forumSettings.openNewForumGrade||[],selectedRelationship:r.forumSettings.openNewForumRelationship,forumName:"",forums:n,forumSettings:r.forumSettings,forumCategories:r.forumCategories,reviewNewForumCerts:r.certs.roles,reviewNewForumGrades:r.certs.grades,reviewNewForumGuide:r.forumSettings.reviewNewForumGuide,founderGuide:r.forumSettings.founderGuide,updating:!1},mounted:function(){setTimeout((function(){floatForumPanel.initPanel()}),500)},computed:{listTypeCount:function(){var e,r={abstract:0,brief:0,minimalist:0},n=t(this.forums);try{for(n.s();!(e=n.n()).done;){r[e.value.threadListStyle.type]++}}catch(e){n.e(e)}finally{n.f()}return r},coverCount:function(){var e,r={left:0,right:0,null:0},n=t(this.forums);try{for(n.s();!(e=n.n()).done;){r[e.value.threadListStyle.cover]++}}catch(e){n.e(e)}finally{n.f()}return r}},methods:{getUrl:NKC.methods.tools.getUrl,updateForums:function(){var e=this;sweetQuestion("确定要刷新所有专业信息？").then((function(){return e.updating=!0,nkcAPI("/e/settings/forum","POST")})).then((function(){sweetSuccess("刷新成功"),e.updating=!1})).catch((function(t){sweetError(t),e.updating=!1}))},move:function(e,t,r){if(!(0===e&&"left"===r||e+1===t.length&&"right"===r)){var n,o=t[e],i=t[n="left"===r?e-1:e+1];t[n]=o,Vue.set(t,e,i)}},save:function(){this.forums.map((function(e){return e.fid}));var e=this.forumCategories,r=this.forumSettings,n=this.selectedReviewForumCert,o=this.reviewNewForumGuide,i=this.founderGuide,u=this.selectedNewForumCert,s=this.selectedNewForumGrade,a=this.selectedRelationship,f=r.recycle,l=r.archive,c=NKC.methods.checkData.checkString,d=this.getForumsInfo();Promise.resolve().then((function(){if(!f)throw"请输入回收站专业ID";if(!l)throw"请输入归档专业ID";var r,m=t(e);try{for(m.s();!(r=m.n()).done;){var h=r.value;c(h.name,{name:"分类名",minLength:1,maxLength:20}),c(h.description,{name:"分类介绍",minLength:0,maxLength:100})}}catch(e){m.e(e)}finally{m.f()}return nkcAPI("/e/settings/forum","PUT",{forumsInfo:d,categories:e,recycle:f,archive:l,selectedReviewForumCert:n,reviewNewForumGuide:o,founderGuide:i,selectedNewForumCert:u,selectedNewForumGrade:s,selectedRelationship:a})})).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},addForum:function(){var e=this.forumName;Promise.resolve().then((function(){if(!e)throw"专业名称不能为空";return sweetQuestion("确定要创建专业「".concat(e,"」吗？"))})).then((function(){return nkcAPI("/f","POST",{displayName:e})})).then((function(e){sweetSuccess("创建成功")})).catch(sweetError)},addForumCategory:function(){this.forumCategories.push({name:"",description:"",displayStyle:"simple"})},remove:function(e,t){t.splice(e,1)},getInput:function(){for(var e=document.getElementsByTagName("input"),t={style:[],allStyle:[],cover:[],allCover:[],order:[]},r=0;r<e.length;r++){var n=$(e[r]),o=n.attr("data-name");"forumThreadList"===o?t.style.push(n):"forumCover"===o?t.cover.push(n):"allThreadList"===o?t.allStyle.push(n):"allCover"===o?t.allCover.push(n):"forumOrder"===o&&t.order.push(n)}return t},selectAllThreadListStyle:function(e){var r,n=t(this.forums);try{for(n.s();!(r=n.n()).done;){r.value.threadListStyle.type=e}}catch(e){n.e(e)}finally{n.f()}},selectAllCover:function(e){var r,n=t(this.forums);try{for(n.s();!(r=n.n()).done;){r.value.threadListStyle.cover=e}}catch(e){n.e(e)}finally{n.f()}},getForumsInfo:function(){var e,r=[],n=t(this.forums);try{for(n.s();!(e=n.n()).done;){var o=e.value;r.push({fid:o.fid,threadListStyle:{type:o.threadListStyle.type,cover:o.threadListStyle.cover},order:o.order})}}catch(e){n.e(e)}finally{n.f()}return r}}}),window.func=i}));
