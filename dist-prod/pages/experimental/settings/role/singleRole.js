!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=new Vue({el:"#app",data:{role:"",roles:[],cloneRoleId:"",operations:[],defaultOperationsId:[],type:"",types:[],users:[]},mounted:function(){var e=document.getElementById("data");e=JSON.parse(e.innerHTML),this.role=e.role,this.roles=e.roles,this.users=e.users,this.operations=e.operations,this.defaultOperationsId=e.defaultOperationsId,this.types=this.extendCount(e.operationTypes),this.types.unshift({_id:"all",displayName:"全部权限",operations:this.operations}),this.selectType(this.types[0])},updated:function(){NKC.methods.initSelectColor(this.changeColor)},methods:{format:NKC.methods.format,cloneOperations:function(){var t=this.roles,n=this.cloneRoleId;if(n){for(var o,i=0;i<t.length;i++){var s=t[i];n===s._id&&(o=s)}o&&sweetQuestion("确定要复制“"+o.displayName+"”的权限设置？").then((function(){e.role.operationsId=[].concat(o.operationsId)})).catch(sweetError)}},isDefault:function(e){return-1!==this.defaultOperationsId.indexOf(e)},removeRole:function(){!1!==confirm("确认要删除“"+this.role.displayName+"”证书？")&&nkcAPI("/e/settings/role/"+e.role._id,"DELETE",{}).then((function(){openToNewLocation("/e/settings/role")})).catch((function(e){screenTopWarning(e)}))},extendCount:function(e){for(var t=0;t<e.length;t++){for(var n=e[t],o=[],i=0;i<this.operations.length;i++){var s=this.operations[i];-1!==s.typeId.indexOf(n._id)&&o.push(s)}n.operations=o}return e},selectType:function(e){this.type=e},changeColor:function(e){this.role.color=e},uploadIcon:function(t){var n=t.target,o=e.role,i=n.files[0],s=new FormData;s.append("file",i),n.value="",uploadFilePromise("/e/settings/role/"+o._id+"/icon",s).then((function(){o.hasIcon=!0;var t=e.$refs.img;t&&t.setAttribute("src","/statics/role_icon/"+o._id+".png?t="+Date.now())})).catch((function(e){screenTopWarning(e)}))},deleteIcon:function(){this.role.hasIcon=!1},clickIconButton:function(){this.$refs.input.click()},save:function(){var e=this.role;nkcAPI("/e/settings/role/"+e._id,"PUT",{role:e}).then((function(){screenTopAlert("保存成功")})).catch((function(e){screenTopWarning(e)}))}}})}));
