!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function r(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return l=t.done,t},e:function(t){s=!0,o=t},f:function(){try{l||null==n.return||n.return()}finally{if(s)throw o}}}}var n=NKC.methods.getDataById("data"),i=n.uploadSettings.extensionLimit;function a(t){var e,n=t.configs,i=r(n);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(a.from<0||a.to<0||a.bv<0)return{ret:!1,err:"视频尺寸范围和平均码率均不能小于0"};if(a.from>=a.to)return{ret:!1,err:"".concat(a.from," 到 ").concat(a.to,"不是一个合理的范围")};var l,s=r(n);try{for(s.s();!(l=s.n()).done;){var u=l.value;if(a!==u&&(a.type===u.type&&o({start:a.from,end:a.to},{start:u.from,end:u.to})))return{ret:!1,err:"视频尺寸范围存在重叠部分"}}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}return{ret:!0}}function o(t,e){return t.start!==t.end&&e.start!==e.end&&!(t.end<=e.start||t.start>=e.end)}i._defaultWhitelist=i.defaultWhitelist.join(", "),i._defaultBlacklist=i.defaultBlacklist.join(", "),i.others.map((function(t){t._blacklist=t.blacklist.join(", "),t._whitelist=t.whitelist.join(", ")})),n.uploadSettings.watermark.buyNoWatermark/=100,window.app=new Vue({el:"#app",data:{us:n.uploadSettings,certList:n.certList,normalWatermarkData:"",normalWatermarkFile:"",smallWatermarkData:"",smallWatermarkFile:""},methods:{getUrl:NKC.methods.tools.getUrl,resetFile:function(){this.normalWatermarkData="",this.normalWatermarkFile="",this.smallWatermarkData="",this.smallWatermarkFile=""},addSizeLimit:function(){this.us.sizeLimit.others.push({ext:"",size:0})},addCountLimit:function(){this.us.countLimit.others.push({type:"",count:0})},addExtensionLimit:function(){this.us.extensionLimit.others.push({type:"",using:"blacklist",blacklist:[],whitelist:[],_blacklist:"",_whitelist:""})},removeFromArr:function(t,e){t.splice(e,1)},selectedWatermark:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",e=this.$refs["".concat(t,"WatermarkInput")],r=e.files;if(r&&r.length){var n=r[0],i=this;NKC.methods.fileToUrl(n).then((function(e){i["".concat(t,"WatermarkData")]=e,i["".concat(t,"WatermarkFile")]=n}))}},addVideoVBRControlConfig:function(){this.us.videoVBRControl.configs.push({type:"width",from:0,to:0,bv:1.16})},deleteVideoVBRControlConfig:function(t){this.us.videoVBRControl.configs.splice(t,1)},submit:function(){var t=JSON.parse(JSON.stringify(this.us)),e=t.extensionLimit,r=this.normalWatermarkFile,n=this.smallWatermarkFile,i=this,o=this.$refs.normalWatermarkInput,l=this.$refs.smallWatermarkInput;e.defaultBlacklist=e._defaultBlacklist.split(",").map((function(t){return t.trim()})),e.defaultWhitelist=e._defaultWhitelist.split(",").map((function(t){return t.trim()})),e.others.map((function(t){t.blacklist=t._blacklist.split(",").map((function(t){return t.trim()})),t.whitelist=t._whitelist.split(",").map((function(t){return t.trim()})),delete t._blacklist,delete t._whitelist})),t.watermark.buyNoWatermark*=100;var s=a(t.videoVBRControl),u=s.ret,c=s.err;if(!u)return sweetError(c);var f=new FormData;return Promise.resolve().then((function(){return f.append("uploadSettings",JSON.stringify(t)),r&&f.append("normalWatermark",r),n&&f.append("smallWatermark",n),nkcUploadFile("/e/settings/upload","PUT",f)})).then((function(t){sweetSuccess("保存成功"),o.value=null,l.value=null;var e=t.uploadSettings.watermark,r=e.normalAttachId,n=e.smallAttachId;i.us.watermark.normalAttachId=r,i.us.watermark.smallAttachId=n,i.resetFile()})).catch(sweetError)}}}),t(window,{extensionLimit:i,verifyVideoVBRControlConfig:a,isOverlap:o})}));
