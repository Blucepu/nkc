!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function n(){var e=$("#searchInput").val();if(!e)return screenTopWarning("输入内容不能为空");var n=$("#searchType").val();n="用户名"===n?"username":"UID"===n?"uid":"手机号"===n?"mobile":"IP"===n?"ip":"email",nkcAPI("/e/settings/user?searchType="+n+"&content="+e,"GET",{}).then((function(e){if(!e.targetUsers||!e.targetUsers.length)return screenTopWarning("未找到用户");for(var n=0;n<e.targetUsers.length;n++)t(e.targetUsers)})).catch((function(e){screenTopWarning(e.error||e)}))}function t(e){var n=$("#searchResult"),t=n.find("tbody");if(t.html(""),e){for(var r=0;r<e.length;r++){var o=e[r];if(!o)return;var a=newElement("tr",{},{}),i=newElement("th",{},{}),s=newElement("img",{src:NKC.methods.tools.getUrl("userAvatar",o.avatar)},{width:"2rem",height:"2rem","margin-right":"0.5rem","border-radius":"50%"}),c=newElement("a",{href:"/u/"+o.uid},{}).text(o.username);i.append(s,c);var l=newElement("th",{},{}).text(o.threadCount),d=newElement("th",{},{}).text(o.postCount),u="text-danger",m="未通过";o.volumeA&&(m="通过",u="text-success");var p,f,h=newElement("th",{class:u},{}).text(m);u="text-danger",o.volumeB?(u="text-success",o.paperB?(p=newElement("a",{href:"/exam/categories/editor?cid="+o.paperB._id,target:"_blank",class:u}),f=newElement("span",{},{}).text("通过 - "+o.paperB.name),p.append(f)):f=newElement("span",{},{}).text("通过 - 试卷丢失")):f=newElement("span",{},{}).text("未通过");var v=newElement("th",{class:u},{});p?v.append(p):v.append(f);var w=newElement("th",{},{}).text("mobile"===o.registerType?"手机":"邮箱"),g=newElement("th",{},{}).text(NKC.methods.format("YYYY-MM-DD HH:mm:ss",o.toc)),E=newElement("th",{},{}).text(o.regIP+" : "+o.regPort),y=newElement("th",{},{});(c=newElement("button",{onclick:"editUserInfo('"+o.uid+"')"},{}).text("编辑")).addClass("btn btn-default btn-sm"),y.append(c),a.append(i,l,d,h,v,w,g,E,y),t.append(a)}n.show()}}$("#searchInput").keydown((function(e){13===e.which&&n()})),window.ModifyAccountInfo=void 0,$((function(){window.ModifyAccountInfo=new NKC.modules.ModifyAccountInfo})),e(window,{searchUser:n,createElements:t,saveUserInfo:function(e,n){var t={username:$("#username").val(),description:$("#description").val(),email:$("#email").val(),nationCode:$("#nationCodeSelect").val(),mobile:$("#mobile").val()};t.nationCode=parseInt(t.nationCode),nkcAPI("/e/settings/user/"+e,"PUT",t).then((function(){n?n():screenTopAlert("保存成功")})).catch((function(e){screenTopWarning(e.error||e)}))},editorRole:function(e,n){var t;t="add"===n?{operation:"addRole",roleDisplayName:$("#addSelect").val()}:{operation:"removeRole",roleDisplayName:$("#removeSelect").val()},nkcAPI("/e/settings/user/"+e,"PUT",t).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error||e)}))},editUserInfo:function(e){ModifyAccountInfo.open({uid:e})},showUserScores:function(e){$("#myAllScore").html(),$("#myAllScoreDialog").modal("show"),nkcAPI("/e/settings/userScores?uid="+e,"GET").then((function(e){var n=e.scores,t="";for(var r in n){var o=n[r];t+=o.name+": ",t+=o.number/100+o.unit+"<br>"}$("#myAllScore").html(t)}))}})}));
