!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";for(var e=NKC.methods.getDataById("data"),o=function(e,o){e.type=o},t=0;t<e.ads.movable.length;t++){o(e.ads.movable[t],"movable")}for(var n=0;n<e.ads.fixed.length;n++){o(e.ads.fixed[n],"fixed")}var s=new Vue({el:"#app",data:{page:{id:"other",name:"其他"},recommendThreads:e.recommendThreads,ads:e.ads,recommendForums:e.recommendForums,columns:e.columns,poolColumns:e.poolColumns,toppedColumns:e.toppedColumns,goods:e.goods,toppedThreads:e.toppedThreads,latestToppedThreads:e.latestToppedThreads,showShopGoods:e.showGoods?"t":"",originalThreadDisplayMode:e.originalThreadDisplayMode,showActivityEnter:e.showActivityEnter?"show":"hidden",updating:!1,columnUpdating:!1,columnListPosition:e.columnListPosition,columnCount:e.columnCount,columnListSort:e.columnListSort,columnPool:e.columnPool},mounted:function(){window.SelectImage=new NKC.methods.selectImage,window.MoveThread=new NKC.modules.MoveThread},computed:{selectedRecommendForumsId:function(){return e.recommendForums.map((function(e){return e.fid}))},nav:function(){var e=this.page,o=[{id:"other",name:"其他"},{id:"movable",name:"轮播图"},{id:"fixed",name:"固定图"},{id:"hotColumn",name:"热门专栏"},{id:"toppedColumn",name:"置顶专栏"}];return o.map((function(o){o.active=o.id===e.id})),o},threadCount:function(){var e=this.recommendThreads[this.page.id],o=e.automaticProportion,t=e.count,n=Math.round(t*o/(o+1));return{automaticCount:n,manualCount:t-n}}},methods:{checkString:NKC.methods.checkData.checkString,checkNumber:NKC.methods.checkData.checkNumber,getUrl:NKC.methods.tools.getUrl,floatUserInfo:NKC.methods.tools.floatUserInfo,visitUrl:NKC.methods.visitUrl,fromNow:NKC.methods.tools.fromNow,removeFromArr:function(e,o){e.splice(o,1)},moveFromArr:function(e,o,t){var n=e.length;if(!(0===o&&"left"===t||o+1===n&&"right"===t)){var s;s="left"===t?o-1:o+1;var i=e[o],c=e[s];Vue.set(e,o,c),Vue.set(e,s,i)}},getRecommendTypeName:function(e){return{movable:"轮播图",fixed:"固定图"}[e]},selectPage:function(e){this.page=e},saveRecommendThreads:function(){var e=this.page,o=this.recommendThreads[e.id];nkcAPI("/nkc/home","PUT",{operation:"saveRecommendThreads",type:e.id,options:o}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},updateThreadList:function(){var e=this.page;this.updating=!0;var o=e.id,t=this;nkcAPI("/nkc/home","PUT",{operation:"updateThreadList",type:o}).then((function(e){t.recommendThreads[o].automaticallySelectedThreads=e.automaticallySelectedThreads,Vue.set(t.saveRecommendThreads),sweetSuccess("更新成功"),t.updating=!1})).catch((function(e){sweetError(e),t.updating=!1}))},updateHomeHotColumns:function(){var e=this,o=this;this.columnUpdating=!0,nkcAPI("/nkc/home","PUT",{operation:"updateHomeHotColumns"}).then((function(t){o.poolColumns=t.poolColumns,e.columnUpdating=!1})).catch((function(o){sweetError(o),e.columnUpdating=!1}))},selectLocalFile:function(e){var o={};"movable"===e.type?o.aspectRatio=800/336:o.aspectRatio=400/253,SelectImage.show((function(o){var t=new FormData;t.append("cover",o),t.append("topType",e.type),t.append("tid",e.tid),nkcUploadFile("/nkc/home","POST",t).then((function(o){e.cover=o.coverHash,console.log(e.cover)})).catch(sweetError),SelectImage.close()}),o)},move:function(e,o){var t,n=(t="movable"===e.type?this.ads.movable:this.ads.fixed).indexOf(e);if(!("left"===o&&0===n||"right"===o&&n+1===t.length)){var s,i=t[s="left"===o?n-1:n+1];t.splice(n,1,i),t.splice(s,1,e)}},saveAds:function(){var e=this.ads,o=e.movable,t=e.fixed,n=e.movableOrder,s=e.fixedOrder,i=this;Promise.resolve().then((function(){return o.concat(t).map((function(e){if(i.checkString(e.title,{name:"标题",minLength:1,maxLength:200}),!e.cover)throw"封面图不能为空";if(!e.tid)throw"文章ID不能为空"})),nkcAPI("/nkc/home","PUT",{operation:"saveAds",movable:o,fixed:t,movableOrder:n,fixedOrder:s})})).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},remove:function(e,o){e.splice(o,1)},addForum:function(){var e=this;MoveThread.open((function(o){o.originForums.map((function(o){e.selectedRecommendForumsId.includes(o.fid)||e.recommendForums.push(o)})),MoveThread.close()}),{hideMoveType:!0})},moveForum:function(e,o,t){var n=e.indexOf(o);if(!("left"===t&&0===n||"right"===t&&n+1===e.length)){var s,i=e[s="left"===t?n-1:n+1];e.splice(n,1,i),e.splice(s,1,o)}},removeForum:function(e,o){e.splice(o,1)},saveRecommendForums:function(){var e=this.recommendForums.map((function(e){return e.fid}));nkcAPI("/nkc/home","PUT",{operation:"saveRecommendForums",forumsId:e}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},saveColumns:function(){var e=this.columns.map((function(e){return e._id})),o=this.poolColumns.map((function(e){return e._id}));nkcAPI("/nkc/home","PUT",{operation:"saveColumns",columnsId:e,columnListPosition:this.columnListPosition,columnCount:this.columnCount,columnPool:this.columnPool,columnListSort:this.columnListSort,poolColumnsId:o}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},saveToppedColumns:function(){var e=this.toppedColumns.map((function(e){return e._id}));nkcAPI("/nkc/home","PUT",{operation:"saveToppedColumns",columnsId:e}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},saveGoods:function(){var e=this.goods.map((function(e){return e.productId})),o=!!this.showShopGoods;nkcAPI("/nkc/home","PUT",{operation:"saveGoods",goodsId:e,showShopGoods:o}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},saveToppedThreads:function(){var e=this.toppedThreads.map((function(e){return e.tid})),o=this.latestToppedThreads.map((function(e){return e.tid}));nkcAPI("/nkc/home","PUT",{operation:"saveToppedThreads",toppedThreadsId:e,latestToppedThreadsId:o}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},saveOriginalThreadDisplayMode:function(){var e=this.originalThreadDisplayMode;nkcAPI("/nkc/home","PUT",{operation:"saveOriginalThreadDisplayMode",originalThreadDisplayMode:e}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)},saveShowActivityEnter:function(){var e="show"===this.showActivityEnter;nkcAPI("/nkc/home/showActivityEnter","PUT",{showActivityEnter:e}).then((function(){sweetSuccess("保存成功")})).catch(sweetError)}}});window.modifyAd=o,window.app=s}));
