!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";localStorage.setItem("apptype","app");var e=document.querySelectorAll("a");function t(e){var t=e.indexOf("#");t>0&&(e=e.substring(0,t));var i,n=e.split("?")[0],a="",r=-1!==e.indexOf("?")?e.split("?")[1]:"";if(a=n+"?apptype=app",""!==r){i=r.split("&");for(var o=0;o<i.length;o++)a+="&"+i[o]}return a}function i(e){var t={thread:"/t/",user:"/u/",post:"/p/",forum:"/f/",activity:"/activity/",column:"/m/"},i="common";for(var n in t)if(e.indexOf(t[n])>-1){"user"===(i=n)&&e.indexOf("settings")>-1&&(i="common");break}return i}document.querySelectorAll("button"),Array.prototype.forEach.call(e,(function(e){e.addEventListener("click",(function(e){e.preventDefault()}))})),$(document).ready((function(){"app"===function(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var n=t[i].split("=");if(n[0]==e)return n[1]}return!1}("apptype")&&"/"===location.pathname&&$("body").css("padding-top","10px")})),apiready=function(){var e=document.querySelectorAll("img");Array.prototype.forEach.call(e,(function(e){e.addEventListener("click",(function(){var e;this.getAttribute("dataimg")&&"content"==this.getAttribute("dataimg")&&this.src&&this.src.indexOf("/r/")>-1&&(e=this.src,api.execScript({name:"root",script:"openImage(['"+e+"'])"}))}))}));var n=document.querySelectorAll("a");Array.prototype.forEach.call(n,(function(e){e.addEventListener("click",(function(){var e,n;if(this.href.indexOf("/r/")>-1)!function(e){api.execScript({name:api.winName,script:"attachDown('"+e+"')"})}(this.href);else if(this.href){if(e=this.href,n=window.location.host,-1!==e.indexOf(n)){var a=this.href.indexOf("?"),r="",o=!1;if((r=a>-1?this.href.substring(0,a):this.href).length>0&&api.winName.indexOf(r)>-1&&(o=!0),"/"===this.pathname&&"root"===api.winName)return void(window.location.href=t(this.href));o?function(e){var i=t(e),n=api.winName,a=api.pageParam.shareType;api.openFrame({name:n,url:i,reload:!0,pageParam:{realUrl:i,shareType:a}})}(this.href):function(e){var n=window.location.origin;-1===e.indexOf("http")&&(e=n+e);var a=t(e),r="widget://html/common/commonInfo.html",o=i(a);"common"!==o&&(r="widget://html/common/shareInfo.html");var c=["/editor","/shelf","/release"];for(var l in c)if(e.indexOf(c[l])>-1){r="widget://html/common/editorInfo.html";break}api.execScript({name:"root",script:"shareReadyBan()"}),api.openWin({name:a,url:r,pageParam:{realUrl:a,shareType:o}})}(this.href)}else api.openWin({name:"link",url:"widget://html/link/link.html",pageParam:{name:"link",linkUrl:this.href}})}}))})),"common"!==i(window.location.href)&&function(){var e,t;try{e=document.getElementsByTagName("title")[0].text}catch(t){e="来自科创的分享"}try{t=document.getElementsByName("description")[0].getAttribute("content")}catch(e){t="倡导科学理性，发展科技爱好"}var i={title:e,description:t},n=JSON.stringify(i);api.execScript({name:"",script:"getAppMeta("+n+");"})}();var a=window.localStorage.getItem("withE");api.refreshHeaderLoadDone(),"/editor"!==window.location.pathname&&api.setRefreshHeaderInfo({bgColor:"#eeeeee",textColor:"#aaaaaa",textDown:"下拉刷新",textUp:"松开刷新",textLoading:"刷新成功，正在加载资源...",showTime:!1},(function(e,t){window.location.reload()})),a&&api.addEventListener({name:"keyback"},(function(e,t){api.confirm({title:"确定要退出吗？",msg:"",buttons:["确定","取消"]},(function(e,t){e?1==e.buttonIndex&&api.closeWin():api.closeWin()}))})),window.localStorage.removeItem("withE")}}));
