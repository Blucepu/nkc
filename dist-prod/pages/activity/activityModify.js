!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function r(e){var r='<img id="poster" style="width:100%;" srcs="" src="'+e+'">';$("#exampleImg").html(r)}function n(e,r){clearErrTips(r);var n=$(e).val(),t="";if(!n)return t+="请选择时间",errInfoTips(t,r),!1;var o=(new Date).getTime(),i=new Date(n).getTime();return!(parseInt(o)>parseInt(i))||(t+="不得早于当前时间",errInfoTips(t,r),!1)}function t(e,r,n){var t=new Date(e).getTime(),o=new Date(r).getTime();return!(parseInt(o)<=parseInt(t))||(errInfoTips("结束时间不得早于或等于开始时间",n),!1)}function o(){var e=new FormData;e.append("file",upLoadFile),$.ajax({url:"/poster",method:"POST",cache:!1,data:e,headers:{FROM:"nkcAPI"},dataType:"json",contentType:!1,processData:!1}).done((function(e){var r='<img style="width:100%" id="poster" srcs="'+e.picname+'" src="/poster/'+e.picname+'">';$("#exampleImg").html(r),screenTopAlert("海报上传成功")})).fail((function(e){screenTopWarning(JSON.parse(e.responseText).error)}))}window.customForm=void 0,NKC.modules.customForm&&(window.customForm=new NKC.modules.customForm),$(document).ready((function(){var e=JSON.parse($("#contionJSON").text());customForm.init(e)})),window.ue=void 0,$(document).ready((function(){var e=$("#replyxxx").text();window.ue=UE.getEditor("editor",NKC.configs.ueditor.activityConfigs),ue.ready((function(){ue.setContent(e)}))})),$("#inputFile").on("change",(function(){var e=$("#inputFile")[0].files[0];e&&(upLoadFile=e);var n=new FileReader;n.onload=function(){r(n.result)},n.readAsDataURL(upLoadFile),o()})),e(window,{htmlDecode:function(e){var r=document.createElement("div");r.innerHTML=e;var n=r.innerText||r.textContent;return r=null,n},insertToImage:r,timeStampCheck:n,deadlineCheck:t,savePoster:o,submitredit:function(e){var r=$("#activityTitle").val().trim();if(clearErrTips("#titleErr"),r&&0!=r.length){var o=$("#enrollStartTime").val(),i=$("#enrollEndTime").val(),a=$("#holdStartTime").val(),c=$("#holdEndTime").val();if(n("#enrollEndTime","#enrollEndTimeErr")&&t(o,i,"#enrollEndTimeErr")&&n("#holdEndTime","#holdEndTimeErr")&&t(a,c,"#holdEndTimeErr")){var s=$("#address").val();if(clearErrTips("#addressErr"),!s)return errInfoTips("请填写详细地址","#addressErr");clearErrTips("#posterErr");var l=$("#poster").attr("srcs");if(0==l.length)return errInfoTips("请上传一张海报","#posterErr");var u=$("#sponsor").val();if(clearErrTips("#sponsorErr"),!u.length)return errInfoTips("请填写主办方名称","#sponsorErr");var d=$("#contactNum").val().trim();if(clearErrTips("#contactNumErr"),""==d)return errInfoTips("请填写联系电话","#contactNumErr");var f=$("#activityPartNum").val();clearErrTips("#activityPartNumErr");if("0"!=f&&!/^\+?[1-9][0-9]*$/.test(f))return errInfoTips("请填写正确数字","#activityPartNumErr");var m=$("#continueTofull").is(":checked"),p=customForm.outputJSON();for(var T in p){if(0===p[T].infoName.length)return errInfoTips("表单名称不可为空！");if(p[T].errorInfo&&p[T].errorInfo.length>0)return errInfoTips(p[T].errorInfo)}var v=ue.getContent();v=common.URLifyHTML(v);var E=$("#isnotice").is(":checked"),h="";E&&(h=$("#noticeContent").val());var y={acid:e,activityTitle:r,limitNum:f,enrollStartTime:new Date(o).toJSON(),enrollEndTime:new Date(i).toJSON(),holdStartTime:new Date(a).toJSON(),holdEndTime:new Date(c).toJSON(),address:s,sponsor:u,contactNum:d,posterId:l,description:v,continueTofull:m,isnotice:E,noticeContent:h,conditions:p};nkcAPI("/activity/modify/"+e,"POST",{post:y}).then((function(r){screenTopAlert("修改成功！"),setTimeout((function(){openToNewLocation("/activity/single/"+e)}),1500)})).catch((function(e){screenTopWarning(e.error)}))}}else errInfoTips("请填写活动标题","#titleErr")},cancelApply:function(e,r){if(!1!==confirm("确认放弃报名？")){nkcAPI("/activity/modify/"+e,"DELETE",{uid:r}).then((function(){screenTopAlert("已取消报名"),setTimeout((function(){window.location.reload()}),1e3)})).catch((function(e){screenTopWarning(e.error)}))}},closeActivity:function(e){if(!1!==confirm("确认关闭活动？")){nkcAPI("/activity/modify/"+e,"DELETE",{}).then((function(){screenTopAlert("已关闭活动"),setTimeout((function(){window.location.reload()}),1e3)})).catch((function(e){screenTopWarning(e.error)}))}},sendMessage:function(e){var r=$("#noticeContent").text();nkcAPI("/activity/modify/"+e,"PUT",{noticeContent:r}).then((function(){screenTopAlert("通知已发给全体报名者")})).catch((function(e){screenTopWarning(e.error)}))},ue:ue})}));
