!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e}).apply(this,arguments)}var n=[],a=parseInt($("#applicationFormId").text());function t(e,n){var a=e.page||0,t=e.pageCount||1;if(t<=1)return"";var r,i,o="",s=a-3,d=a+3;s>0?d>t?(i=t,r=s-(d-t)<0?0:s-(d-t)):(i=d,r=s):(r=0,i=d<t?t<d-s?t:d-s:t-1),console.log(r,a,i),void 0===n&&(n="");for(var c=0;c<t;c++)if(!(c<r||c>i)){var l="";a===c&&(l="active"),o+='<li class="'+l+'"><a onclick="getThreads('+c+","+n+')">'+(c+1)+"</a></li>"}return o}function r(e,n){var a=t(e,n);$(".pageList").html(a)}function i(e,n,a){var t="",r="";a=!0===a?"disabled":"","add"===n?(t="addThread",r="glyphicon glyphicon-plus"):(t="deleteThread",r="glyphicon glyphicon-remove");for(var i="",o=0;o<e.length;o++){var s=e[o],d=s.tid,c=s.uid,l=s.pid,p=s.username,h=s.t,f=s.toc;i+='<div class="threadList">'+('<div class="col-xs-10 col-md-10"><div class="postString displayNone">'+JSON.stringify(s)+'</div><span>文号：</span><span class="threadNumber">'+l+'&nbsp;&nbsp;</span><a href="/m/'+c+'" target="_blank">'+p+"</a><span>&nbsp;发表于 "+f+'</span><br><a href="/t/'+d+'" target="_blank">'+h+"</a></div>")+('<div class="col-xs-2 col-md-2 delete '+a+" "+r+'" onclick="'+t+"('"+d+"','"+l+"');this.style.backgroundColor = '#2aabd2';\"></div>")+"</div>"}return i}function o(e,n,a,t){var r;""===(r=i(n,"add"===t?"add":"delete",a))&&(r='<div class="blank blank-selectedThread">暂无数据</div>',$(e).html()),$(e).html(r)}function s(){var e="";0===n.length&&(e="<span>暂未选择</span>");for(var a=0;a<n.length;a++)e+='<span class="fund-span selectedUser selected" onclick="deleteThread(\''+n[a].tid+"')\">"+n[a].pid+'<span class="fund-span delete glyphicon glyphicon-remove"></span></span>';$("#selectedThread").html(e)}e(window,{openToEditFundApply:function(e){openToNewLocation(e)},verifyRemittance:function(e,n){nkcAPI("/fund/a/"+n+"/remittance/verify","PUT",{number:e}).then((function(){window.location.reload()})).catch((function(e){screenTopWarning(e.error)}))},applyRemittance:function(e,a){$("#info").html("");var t={number:e},r=$("#reportContent").val();if(!r&&0!==e)return screenTopWarning("请输入中期报告。");t.c=r,t.selectedThreads=n,nkcAPI("/fund/a/"+a+"/remittance/apply","POST",t).then((function(e){window.location.reload()})).catch((function(e){screenTopWarning(e.error)}))},submitReport:function(e){var a=$("#reportContent").val();if(!a)return screenTopWarning("请输入中期报告。");nkcAPI("/fund/a/"+e+"/report","POST",{c:a,type:"applyRemittance",selectedThreads:n}).then((function(){screenTopAlert("提交成功!"),setTimeout((function(){window.location.reload()}),1200)})).catch((function(e){screenTopWarning(e.error)}))},clearLog:function(){$(".unselectedThreads").html('<div class="blank" style="color:#aaa;">暂无数据</div>')},displaySelectedThreads:s,addThread:function(e,a){for(var t=!1,r=0;r<n.length;r++)if(n[r].tid===e){t=!0;break}t||n.push({tid:e,pid:a}),s()},displayThreadsList:o,initThreadsList:function(){for(var e=$(".selectedThreads .threadList .postString"),a=e.length,t=0;t<a;t++){var r=e.eq(t).text(),i=JSON.parse(r);n.push(i)}},disabledRolling:function(e){$(window).scrollTop(e)},createThreadsList:i,displayPageList:r,createPageList:t,getThreads:function(e,n){var t;if(e=void 0!==e?"page="+e+"&":"",void 0===n){var i=$("#searchThread").val();if(""===i)return screenTopWarning("输入不能为空！");t="/t?"+e+"from=applicationForm&applicationFormId="+a+"&keywords="+i}else t="/t?"+e+"from=applicationForm&self=true";$(".unselectedThreads").html('<div class="blank blank-selectedThread">搜索中...</div>'),nkcAPI(t,"GET",{}).then((function(e){tempThreads=e.threads,r(e.paging,n),0===tempThreads.length&&screenTopAlert("什么也没找到..."),o(".unselectedThreads",tempThreads,!1,"add")})).catch((function(e){screenTopWarning(e.error);$(".unselectedThreads").html('<div class="blank blank-selectedThread">error</div>')}))}})}));
