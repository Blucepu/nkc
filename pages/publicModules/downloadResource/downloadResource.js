(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

NKC.modules.downloadResource = /*#__PURE__*/function () {
  function _class() {
    _classCallCheck(this, _class);

    var self = this;
    self.dom = $("#moduleDownloadResource");
    self.app = new Vue({
      el: "#moduleDownloadResourceApp",
      data: {
        rid: "",
        fileName: "未知",
        type: "",
        size: 0,
        costs: [],
        hold: [],
        loadding: true
      },
      computed: {
        costMessage: function costMessage() {
          return this.costs.map(function (c) {
            return c.name + c.number;
          }).join("、");
        },
        holdMessage: function holdMessage() {
          return this.hold.map(function (c) {
            return c.name + c.number;
          }).join("、");
        }
      },
      methods: {
        fromNow: NKC.methods.fromNow,
        initDom: function initDom() {
          var height = "20rem";
          self.dom.css({
            height: height
          });
          self.dom.draggable({
            scroll: false,
            handle: ".module-sd-title",
            drag: function drag(event, ui) {
              if (ui.position.top < 0) ui.position.top = 0;
              var height = $(window).height();
              if (ui.position.top > height - 30) ui.position.top = height - 30;
              var width = self.dom.width();
              if (ui.position.left < 100 - width) ui.position.left = 100 - width;
              var winWidth = $(window).width();
              if (ui.position.left > winWidth - 100) ui.position.left = winWidth - 100;
            }
          });
          var width = $(window).width();

          if (width < 700) {
            // 小屏幕
            self.dom.css({
              "width": width * 0.8,
              "top": 0,
              "right": 0
            });
          } else {
            // 宽屏
            self.dom.css("left", (width - self.dom.width()) * 0.5 - 20);
          }

          self.dom.show();
        },
        getResourceInfo: function getResourceInfo(rid) {
          var self = this;
          var infoUrl = "/r/".concat(rid, "?t=attachment");
          var dataUrl = "/r/".concat(rid, "?t=attachment&c=download&random=").concat(Math.random()); // 下载此附件是否需要积分

          nkcAPI("/r/".concat(rid, "/q"), "GET", {}).then(function (data) {
            if (!data.need) {
              var downloadLink = $("<a></a>");
              downloadLink.attr("href", dataUrl);
              downloadLink[0].click();
              self.close();
            } else {
              return nkcAPI(infoUrl, "GET", {});
            }
          }).then(function (data) {
            if (!data) return;
            console.log(data);
            self.loadding = false;
            self.rid = data.rid;
            self.fileName = data.resource.oname;
            self.type = data.resource.ext;
            self.size = NKC.methods.getSize(data.resource.size);
            var myAllScore = data.myAllScore;
            self.costs = myAllScore.map(function (score) {
              return {
                name: score.name,
                number: score.addNumber / 100 * -1
              };
            });
            self.hold = myAllScore.map(function (score) {
              return {
                name: score.name,
                number: score.number / 100
              };
            });
          });
        },
        open: function open(rid) {
          this.loadding = true;
          this.initDom();
          this.getResourceInfo(rid);
        },
        close: function close() {
          self.dom.hide();
        }
      }
    });
    self.open = self.app.open;
    self.close = self.app.close;
  }

  return _class;
}();

(function () {
  var dr = new NKC.modules.downloadResource();
  var attachments = [].slice.call($("[data-tag='nkcsource'][data-type='attachment']"));
  attachments.forEach(function (attachment) {
    $(attachment).find(".article-attachment-name").on("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      var rid = $(attachment).attr("data-id");
      dr.open(rid);
      return false;
    });
  });
})();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9wdWJsaWNNb2R1bGVzL2Rvd25sb2FkUmVzb3VyY2UvZG93bmxvYWRSZXNvdXJjZS5tanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0FDQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxnQkFBWjtBQUNFLG9CQUFjO0FBQUE7O0FBQ1osUUFBTSxJQUFJLEdBQUcsSUFBYjtBQUNBLElBQUEsSUFBSSxDQUFDLEdBQUwsR0FBVyxDQUFDLENBQUMseUJBQUQsQ0FBWjtBQUNBLElBQUEsSUFBSSxDQUFDLEdBQUwsR0FBVyxJQUFJLEdBQUosQ0FBUTtBQUNqQixNQUFBLEVBQUUsRUFBRSw0QkFEYTtBQUVqQixNQUFBLElBQUksRUFBRTtBQUNKLFFBQUEsR0FBRyxFQUFFLEVBREQ7QUFFSixRQUFBLFFBQVEsRUFBRSxJQUZOO0FBR0osUUFBQSxJQUFJLEVBQUUsRUFIRjtBQUlKLFFBQUEsSUFBSSxFQUFFLENBSkY7QUFLSixRQUFBLEtBQUssRUFBRSxFQUxIO0FBTUosUUFBQSxJQUFJLEVBQUUsRUFORjtBQU9KLFFBQUEsUUFBUSxFQUFFO0FBUE4sT0FGVztBQVdqQixNQUFBLFFBQVEsRUFBRTtBQUNSLFFBQUEsV0FEUSx5QkFDTTtBQUNaLGlCQUFPLEtBQUssS0FBTCxDQUFXLEdBQVgsQ0FBZSxVQUFBLENBQUM7QUFBQSxtQkFBSSxDQUFDLENBQUMsSUFBRixHQUFTLENBQUMsQ0FBQyxNQUFmO0FBQUEsV0FBaEIsRUFBdUMsSUFBdkMsQ0FBNEMsR0FBNUMsQ0FBUDtBQUNELFNBSE87QUFJUixRQUFBLFdBSlEseUJBSU07QUFDWixpQkFBTyxLQUFLLElBQUwsQ0FBVSxHQUFWLENBQWMsVUFBQSxDQUFDO0FBQUEsbUJBQUksQ0FBQyxDQUFDLElBQUYsR0FBUyxDQUFDLENBQUMsTUFBZjtBQUFBLFdBQWYsRUFBc0MsSUFBdEMsQ0FBMkMsR0FBM0MsQ0FBUDtBQUNEO0FBTk8s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Q1IsZUFBSyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsZUFBSyxPQUFMO0FBQ0EsZUFBSyxlQUFMLENBQXFCLEdBQXJCO0FBQ0QsU0E3RU07QUE4RVAsUUFBQSxLQTlFTyxtQkE4RUM7QUFDTixVQUFBLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBVDtBQUNEO0FBaEZNO0FBbkJRLEtBQVIsQ0FBWDtBQXNHQSxJQUFBLElBQUksQ0FBQyxJQUFMLEdBQVksSUFBSSxDQUFDLEdBQUwsQ0FBUyxJQUFyQjtBQUNBLElBQUEsSUFBSSxDQUFDLEtBQUwsR0FBYSxJQUFJLENBQUMsR0FBTCxDQUFTLEtBQXRCO0FBQ0Q7O0FBNUdIO0FBQUE7O0FBZ0hDLGFBQVc7QUFDVixNQUFNLEVBQUUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFKLENBQVksZ0JBQWhCLEVBQVg7QUFDQSxNQUFJLFdBQVcsR0FBRyxHQUFHLEtBQUgsQ0FBUyxJQUFULENBQWMsQ0FBQyxDQUFDLGdEQUFELENBQWYsQ0FBbEI7QUFDQSxFQUFBLFdBQVcsQ0FBQyxPQUFaLENBQW9CLFVBQUEsVUFBVSxFQUFJO0FBQ2hDLElBQUEsQ0FBQyxDQUFDLFVBQUQsQ0FBRCxDQUFjLElBQWQsQ0FBbUIsMEJBQW5CLEVBQStDLEVBQS9DLENBQWtELE9BQWxELEVBQTJELFVBQUEsQ0FBQyxFQUFJO0FBQzlELE1BQUEsQ0FBQyxDQUFDLGNBQUY7QUFDQSxNQUFBLENBQUMsQ0FBQyxlQUFGO0FBQ0EsVUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLFVBQUQsQ0FBRCxDQUFjLElBQWQsQ0FBbUIsU0FBbkIsQ0FBVjtBQUNBLE1BQUEsRUFBRSxDQUFDLElBQUgsQ0FBUSxHQUFSO0FBQ0EsYUFBTyxLQUFQO0FBQ0QsS0FORDtBQU9ELEdBUkQ7QUFTRCxDQVpBLEdBQUQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJOS0MubW9kdWxlcy5kb3dubG9hZFJlc291cmNlID0gY2xhc3Mge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLmRvbSA9ICQoXCIjbW9kdWxlRG93bmxvYWRSZXNvdXJjZVwiKTtcclxuICAgIHNlbGYuYXBwID0gbmV3IFZ1ZSh7XHJcbiAgICAgIGVsOiBcIiNtb2R1bGVEb3dubG9hZFJlc291cmNlQXBwXCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICByaWQ6IFwiXCIsXHJcbiAgICAgICAgZmlsZU5hbWU6IFwi5pyq55+lXCIsXHJcbiAgICAgICAgdHlwZTogXCJcIixcclxuICAgICAgICBzaXplOiAwLFxyXG4gICAgICAgIGNvc3RzOiBbXSxcclxuICAgICAgICBob2xkOiBbXSxcclxuICAgICAgICBsb2FkZGluZzogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICBjb21wdXRlZDoge1xyXG4gICAgICAgIGNvc3RNZXNzYWdlKCkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29zdHMubWFwKGMgPT4gYy5uYW1lICsgYy5udW1iZXIpLmpvaW4oXCLjgIFcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBob2xkTWVzc2FnZSgpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmhvbGQubWFwKGMgPT4gYy5uYW1lICsgYy5udW1iZXIpLmpvaW4oXCLjgIFcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgZnJvbU5vdzogTktDLm1ldGhvZHMuZnJvbU5vdyxcclxuICAgICAgICBpbml0RG9tKCkge1xyXG4gICAgICAgICAgY29uc3QgaGVpZ2h0ID0gXCIyMHJlbVwiO1xyXG4gICAgICAgICAgc2VsZi5kb20uY3NzKHtcclxuICAgICAgICAgICAgaGVpZ2h0XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHNlbGYuZG9tLmRyYWdnYWJsZSh7XHJcbiAgICAgICAgICAgIHNjcm9sbDogZmFsc2UsXHJcbiAgICAgICAgICAgIGhhbmRsZTogXCIubW9kdWxlLXNkLXRpdGxlXCIsXHJcbiAgICAgICAgICAgIGRyYWc6IGZ1bmN0aW9uKGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgICAgIGlmKHVpLnBvc2l0aW9uLnRvcCA8IDApIHVpLnBvc2l0aW9uLnRvcCA9IDA7XHJcbiAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xyXG4gICAgICAgICAgICAgIGlmKHVpLnBvc2l0aW9uLnRvcCA+IGhlaWdodCAtIDMwKSB1aS5wb3NpdGlvbi50b3AgPSBoZWlnaHQgLSAzMDtcclxuICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHNlbGYuZG9tLndpZHRoKCk7XHJcbiAgICAgICAgICAgICAgaWYodWkucG9zaXRpb24ubGVmdCA8IDEwMCAtIHdpZHRoKSB1aS5wb3NpdGlvbi5sZWZ0ID0gMTAwIC0gd2lkdGg7XHJcbiAgICAgICAgICAgICAgY29uc3Qgd2luV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgICAgICAgICAgICBpZih1aS5wb3NpdGlvbi5sZWZ0ID4gd2luV2lkdGggLSAxMDApIHVpLnBvc2l0aW9uLmxlZnQgPSB3aW5XaWR0aCAtIDEwMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb25zdCB3aWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gICAgICAgICAgaWYod2lkdGggPCA3MDApIHtcclxuICAgICAgICAgICAgLy8g5bCP5bGP5bmVXHJcbiAgICAgICAgICAgIHNlbGYuZG9tLmNzcyh7XHJcbiAgICAgICAgICAgICAgXCJ3aWR0aFwiOiB3aWR0aCAqIDAuOCxcclxuICAgICAgICAgICAgICBcInRvcFwiOiAwLFxyXG4gICAgICAgICAgICAgIFwicmlnaHRcIjogMFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOWuveWxj1xyXG4gICAgICAgICAgICBzZWxmLmRvbS5jc3MoXCJsZWZ0XCIsICh3aWR0aCAtIHNlbGYuZG9tLndpZHRoKCkpKjAuNSAtIDIwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHNlbGYuZG9tLnNob3coKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldFJlc291cmNlSW5mbyhyaWQpIHtcclxuICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICAgIGxldCBpbmZvVXJsID0gYC9yLyR7cmlkfT90PWF0dGFjaG1lbnRgO1xyXG4gICAgICAgICAgbGV0IGRhdGFVcmwgPSBgL3IvJHtyaWR9P3Q9YXR0YWNobWVudCZjPWRvd25sb2FkJnJhbmRvbT0ke01hdGgucmFuZG9tKCl9YDtcclxuICAgICAgICAgIC8vIOS4i+i9veatpOmZhOS7tuaYr+WQpumcgOimgeenr+WIhlxyXG4gICAgICAgICAgbmtjQVBJKGAvci8ke3JpZH0vcWAsIFwiR0VUXCIsIHt9KVxyXG4gICAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICBpZighZGF0YS5uZWVkKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZG93bmxvYWRMaW5rID0gJChcIjxhPjwvYT5cIik7XHJcbiAgICAgICAgICAgICAgICBkb3dubG9hZExpbmsuYXR0cihcImhyZWZcIiwgZGF0YVVybCk7XHJcbiAgICAgICAgICAgICAgICBkb3dubG9hZExpbmtbMF0uY2xpY2soKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5rY0FQSShpbmZvVXJsLCBcIkdFVFwiLCB7fSlcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgIGlmKCFkYXRhKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgc2VsZi5sb2FkZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgIHNlbGYucmlkID0gZGF0YS5yaWQ7XHJcbiAgICAgICAgICAgICAgc2VsZi5maWxlTmFtZSA9IGRhdGEucmVzb3VyY2Uub25hbWU7XHJcbiAgICAgICAgICAgICAgc2VsZi50eXBlID0gZGF0YS5yZXNvdXJjZS5leHQ7XHJcbiAgICAgICAgICAgICAgc2VsZi5zaXplID0gTktDLm1ldGhvZHMuZ2V0U2l6ZShkYXRhLnJlc291cmNlLnNpemUpO1xyXG4gICAgICAgICAgICAgIGxldCBteUFsbFNjb3JlID0gZGF0YS5teUFsbFNjb3JlO1xyXG4gICAgICAgICAgICAgIHNlbGYuY29zdHMgPSBteUFsbFNjb3JlLm1hcChzY29yZSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICBuYW1lOiBzY29yZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICBudW1iZXI6IHNjb3JlLmFkZE51bWJlciAvIDEwMCAqIC0xXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgc2VsZi5ob2xkID0gbXlBbGxTY29yZS5tYXAoc2NvcmUgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgbmFtZTogc2NvcmUubmFtZSxcclxuICAgICAgICAgICAgICAgICAgbnVtYmVyOiBzY29yZS5udW1iZXIgLyAxMDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9wZW4ocmlkKSB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgIHRoaXMuaW5pdERvbSgpO1xyXG4gICAgICAgICAgdGhpcy5nZXRSZXNvdXJjZUluZm8ocmlkKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNsb3NlKCkge1xyXG4gICAgICAgICAgc2VsZi5kb20uaGlkZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBzZWxmLm9wZW4gPSBzZWxmLmFwcC5vcGVuO1xyXG4gICAgc2VsZi5jbG9zZSA9IHNlbGYuYXBwLmNsb3NlO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgY29uc3QgZHIgPSBuZXcgTktDLm1vZHVsZXMuZG93bmxvYWRSZXNvdXJjZSgpO1xyXG4gIGxldCBhdHRhY2htZW50cyA9IFtdLnNsaWNlLmNhbGwoJChcIltkYXRhLXRhZz0nbmtjc291cmNlJ11bZGF0YS10eXBlPSdhdHRhY2htZW50J11cIikpO1xyXG4gIGF0dGFjaG1lbnRzLmZvckVhY2goYXR0YWNobWVudCA9PiB7XHJcbiAgICAkKGF0dGFjaG1lbnQpLmZpbmQoXCIuYXJ0aWNsZS1hdHRhY2htZW50LW5hbWVcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICBsZXQgcmlkID0gJChhdHRhY2htZW50KS5hdHRyKFwiZGF0YS1pZFwiKTtcclxuICAgICAgZHIub3BlbihyaWQpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KVxyXG4gIH0pXHJcbn0oKSk7Il19
