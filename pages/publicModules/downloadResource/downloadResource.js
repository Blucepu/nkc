(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

NKC.modules.downloadResource = /*#__PURE__*/function () {
  function _class() {
    _classCallCheck(this, _class);

    var self = this;
    self.dom = $("#moduleDownloadResource");
    self.app = new Vue({
      el: "#moduleDownloadResourceApp",
      data: {
        rid: "",
        fileName: "未知",
        type: "",
        size: 0,
        costs: [],
        hold: [],
        status: "loadding",
        fileCountLimitInfo: '',
        errorInfo: '',
        settingNoNeed: false
      },
      computed: {
        costMessage: function costMessage() {
          return this.costs.map(function (c) {
            return c.name + c.number;
          }).join("、");
        },
        holdMessage: function holdMessage() {
          return this.hold.map(function (c) {
            return c.name + c.number;
          }).join("、");
        }
      },
      methods: {
        fromNow: NKC.methods.fromNow,
        initDom: function initDom() {
          var height = "37rem";
          self.dom.css({
            height: height
          });
          self.dom.draggable({
            scroll: false,
            handle: ".module-sd-title",
            drag: function drag(event, ui) {
              if (ui.position.top < 0) ui.position.top = 0;
              var height = $(window).height();
              if (ui.position.top > height - 30) ui.position.top = height - 30;
              var width = self.dom.width();
              if (ui.position.left < 100 - width) ui.position.left = 100 - width;
              var winWidth = $(window).width();
              if (ui.position.left > winWidth - 100) ui.position.left = winWidth - 100;
            }
          });
          var width = $(window).width();

          if (width < 700) {
            // 小屏幕
            self.dom.css({
              "width": width * 0.8,
              "top": 0,
              "right": 0
            });
          } else {
            // 宽屏
            self.dom.css("left", (width - self.dom.width()) * 0.5 - 20);
          }

          self.dom.show();
        },
        getResourceInfo: function getResourceInfo(rid) {
          var self = this;
          self.status = 'loadding';
          self.errorInfo = '';
          nkcAPI("/r/".concat(rid, "/detail"), "GET").then(function (data) {
            var _data$detail = data.detail,
                free = _data$detail.free,
                paid = _data$detail.paid,
                resource = _data$detail.resource,
                costScores = _data$detail.costScores,
                fileCountLimitInfo = _data$detail.fileCountLimitInfo;
            self.fileCountLimitInfo = fileCountLimitInfo;

            if (!resource.isFileExist) {
              self.status = "fileNotExist";
              return;
            }

            self.status = !free && !paid ? "needScore" : "noNeedScore";
            self.free = free;
            self.paid = paid;
            self.fileName = resource.oname;
            self.rid = resource.rid;
            self.type = resource.ext;
            self.size = NKC.methods.getSize(resource.size);
            if (!costScores) return;
            self.costs = costScores.map(function (score) {
              return {
                name: score.name,
                number: score.addNumber / 100 * -1
              };
            });
            self.hold = costScores.map(function (score) {
              return {
                name: score.name,
                number: score.number / 100
              };
            });
          })["catch"](function (data) {
            self.fileCountLimitInfo = data.fileCountLimitInfo;
            self.status = 'error';
            self.errorInfo = data.error || data.message || data;
          });
        },
        download: function download() {
          var self = this;
          var rid = this.rid,
              fileName = this.fileName;
          nkcAPI("/r/".concat(rid, "/pay"), "POST").then(function () {
            var downloader = document.createElement("a");
            downloader.setAttribute("download", fileName);
            downloader.href = "/r/".concat(rid);
            downloader.click();
          })["catch"](sweetError).then(function () {
            return self.getResourceInfo(self.rid);
          });
        },
        open: function open(rid) {
          this.status = "loadding";
          this.initDom();
          this.getResourceInfo(rid);
        },
        close: function close() {
          self.dom.hide();
        }
      }
    });
    self.open = self.app.open;
    self.close = self.app.close;
  }

  return _class;
}();

(function () {
  var dr = new NKC.modules.downloadResource();

  NKC.methods.openFilePanel = function (rid) {
    dr.open(rid);
  }; // 监听评论盒子


  $("#wrap").on("click", function (e) {
    var type = $(e.target).attr("data-type");

    if (type === "clickAttachmentTitle") {
      e.preventDefault();
      e.stopPropagation();
      var rid = $(e.target).attr("data-id");
      dr.open(rid);
      return false;
    }
  }); // let attachments = [].slice.call($("[data-tag='nkcsource'][data-type='attachment']"));
  // attachments.forEach(attachment => {
  //   $(attachment).find("a.article-attachment-name").on("click", e => {
  //     e.preventDefault();
  //     e.stopPropagation();
  //     let rid = $(attachment).attr("data-id");
  //     dr.open(rid);
  //     return false;
  //   })
  // })
})();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9wdWJsaWNNb2R1bGVzL2Rvd25sb2FkUmVzb3VyY2UvZG93bmxvYWRSZXNvdXJjZS5tanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0FDQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxnQkFBWjtBQUNFLG9CQUFjO0FBQUE7O0FBQ1osUUFBTSxJQUFJLEdBQUcsSUFBYjtBQUNBLElBQUEsSUFBSSxDQUFDLEdBQUwsR0FBVyxDQUFDLENBQUMseUJBQUQsQ0FBWjtBQUNBLElBQUEsSUFBSSxDQUFDLEdBQUwsR0FBVyxJQUFJLEdBQUosQ0FBUTtBQUNqQixNQUFBLEVBQUUsRUFBRSw0QkFEYTtBQUVqQixNQUFBLElBQUksRUFBRTtBQUNKLFFBQUEsR0FBRyxFQUFFLEVBREQ7QUFFSixRQUFBLFFBQVEsRUFBRSxJQUZOO0FBR0osUUFBQSxJQUFJLEVBQUUsRUFIRjtBQUlKLFFBQUEsSUFBSSxFQUFFLENBSkY7QUFLSixRQUFBLEtBQUssRUFBRSxFQUxIO0FBTUosUUFBQSxJQUFJLEVBQUUsRUFORjtBQU9KLFFBQUEsTUFBTSxFQUFFLFVBUEo7QUFRSixRQUFBLGtCQUFrQixFQUFFLEVBUmhCO0FBU0osUUFBQSxTQUFTLEVBQUUsRUFUUDtBQVVKLFFBQUEsYUFBYSxFQUFFO0FBVlgsT0FGVztBQWNqQixNQUFBLFFBQVEsRUFBRTtBQUNSLFFBQUEsV0FEUSx5QkFDTTtBQUNaLGlCQUFPLEtBQUssS0FBTCxDQUFXLEdBQVgsQ0FBZSxVQUFBLENBQUM7QUFBQSxtQkFBSSxDQUFDLENBQUMsSUFBRixHQUFTLENBQUMsQ0FBQyxNQUFmO0FBQUEsV0FBaEIsRUFBdUMsSUFBdkMsQ0FBNEMsR0FBNUMsQ0FBUDtBQUNELFNBSE87QUFJUixRQUFBLFdBSlEseUJBSU07QUFDWixpQkFBTyxLQUFLLElBQUwsQ0FBVSxHQUFWLENBQWMsVUFBQSxDQUFDO0FBQUEsbUJBQUksQ0FBQyxD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QjtBQUNBLElBQUEsSUFBSSxDQUFDLEtBQUwsR0FBYSxJQUFJLENBQUMsR0FBTCxDQUFTLEtBQXRCO0FBQ0Q7O0FBNUhIO0FBQUE7O0FBZ0lDLGFBQVc7QUFDVixNQUFNLEVBQUUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFKLENBQVksZ0JBQWhCLEVBQVg7O0FBQ0EsRUFBQSxHQUFHLENBQUMsT0FBSixDQUFZLGFBQVosR0FBNEIsVUFBUyxHQUFULEVBQWM7QUFDeEMsSUFBQSxFQUFFLENBQUMsSUFBSCxDQUFRLEdBQVI7QUFDRCxHQUZELENBRlUsQ0FNVjs7O0FBQ0EsRUFBQSxDQUFDLENBQUMsT0FBRCxDQUFELENBQVcsRUFBWCxDQUFjLE9BQWQsRUFBdUIsVUFBUyxDQUFULEVBQVk7QUFDakMsUUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFILENBQUQsQ0FBWSxJQUFaLENBQWlCLFdBQWpCLENBQVg7O0FBQ0EsUUFBRyxJQUFJLEtBQUssc0JBQVosRUFBb0M7QUFDbEMsTUFBQSxDQUFDLENBQUMsY0FBRjtBQUNBLE1BQUEsQ0FBQyxDQUFDLGVBQUY7QUFDQSxVQUFJLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUgsQ0FBRCxDQUFZLElBQVosQ0FBaUIsU0FBakIsQ0FBVjtBQUNBLE1BQUEsRUFBRSxDQUFDLElBQUgsQ0FBUSxHQUFSO0FBQ0EsYUFBTyxLQUFQO0FBQ0Q7QUFDRixHQVRELEVBUFUsQ0FpQlY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRCxDQTNCQSxHQUFEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiTktDLm1vZHVsZXMuZG93bmxvYWRSZXNvdXJjZSA9IGNsYXNzIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5kb20gPSAkKFwiI21vZHVsZURvd25sb2FkUmVzb3VyY2VcIik7XHJcbiAgICBzZWxmLmFwcCA9IG5ldyBWdWUoe1xyXG4gICAgICBlbDogXCIjbW9kdWxlRG93bmxvYWRSZXNvdXJjZUFwcFwiLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgcmlkOiBcIlwiLFxyXG4gICAgICAgIGZpbGVOYW1lOiBcIuacquefpVwiLFxyXG4gICAgICAgIHR5cGU6IFwiXCIsXHJcbiAgICAgICAgc2l6ZTogMCxcclxuICAgICAgICBjb3N0czogW10sXHJcbiAgICAgICAgaG9sZDogW10sXHJcbiAgICAgICAgc3RhdHVzOiBcImxvYWRkaW5nXCIsXHJcbiAgICAgICAgZmlsZUNvdW50TGltaXRJbmZvOiAnJyxcclxuICAgICAgICBlcnJvckluZm86ICcnLFxyXG4gICAgICAgIHNldHRpbmdOb05lZWQ6IGZhbHNlLFxyXG4gICAgICB9LFxyXG4gICAgICBjb21wdXRlZDoge1xyXG4gICAgICAgIGNvc3RNZXNzYWdlKCkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29zdHMubWFwKGMgPT4gYy5uYW1lICsgYy5udW1iZXIpLmpvaW4oXCLjgIFcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBob2xkTWVzc2FnZSgpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmhvbGQubWFwKGMgPT4gYy5uYW1lICsgYy5udW1iZXIpLmpvaW4oXCLjgIFcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgZnJvbU5vdzogTktDLm1ldGhvZHMuZnJvbU5vdyxcclxuICAgICAgICBpbml0RG9tKCkge1xyXG4gICAgICAgICAgY29uc3QgaGVpZ2h0ID0gXCIzN3JlbVwiO1xyXG4gICAgICAgICAgc2VsZi5kb20uY3NzKHtcclxuICAgICAgICAgICAgaGVpZ2h0XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHNlbGYuZG9tLmRyYWdnYWJsZSh7XHJcbiAgICAgICAgICAgIHNjcm9sbDogZmFsc2UsXHJcbiAgICAgICAgICAgIGhhbmRsZTogXCIubW9kdWxlLXNkLXRpdGxlXCIsXHJcbiAgICAgICAgICAgIGRyYWc6IGZ1bmN0aW9uKGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgICAgIGlmKHVpLnBvc2l0aW9uLnRvcCA8IDApIHVpLnBvc2l0aW9uLnRvcCA9IDA7XHJcbiAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xyXG4gICAgICAgICAgICAgIGlmKHVpLnBvc2l0aW9uLnRvcCA+IGhlaWdodCAtIDMwKSB1aS5wb3NpdGlvbi50b3AgPSBoZWlnaHQgLSAzMDtcclxuICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHNlbGYuZG9tLndpZHRoKCk7XHJcbiAgICAgICAgICAgICAgaWYodWkucG9zaXRpb24ubGVmdCA8IDEwMCAtIHdpZHRoKSB1aS5wb3NpdGlvbi5sZWZ0ID0gMTAwIC0gd2lkdGg7XHJcbiAgICAgICAgICAgICAgY29uc3Qgd2luV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgICAgICAgICAgICBpZih1aS5wb3NpdGlvbi5sZWZ0ID4gd2luV2lkdGggLSAxMDApIHVpLnBvc2l0aW9uLmxlZnQgPSB3aW5XaWR0aCAtIDEwMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb25zdCB3aWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gICAgICAgICAgaWYod2lkdGggPCA3MDApIHtcclxuICAgICAgICAgICAgLy8g5bCP5bGP5bmVXHJcbiAgICAgICAgICAgIHNlbGYuZG9tLmNzcyh7XHJcbiAgICAgICAgICAgICAgXCJ3aWR0aFwiOiB3aWR0aCAqIDAuOCxcclxuICAgICAgICAgICAgICBcInRvcFwiOiAwLFxyXG4gICAgICAgICAgICAgIFwicmlnaHRcIjogMFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOWuveWxj1xyXG4gICAgICAgICAgICBzZWxmLmRvbS5jc3MoXCJsZWZ0XCIsICh3aWR0aCAtIHNlbGYuZG9tLndpZHRoKCkpKjAuNSAtIDIwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHNlbGYuZG9tLnNob3coKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldFJlc291cmNlSW5mbyhyaWQpIHtcclxuICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICAgIHNlbGYuc3RhdHVzID0gJ2xvYWRkaW5nJztcclxuICAgICAgICAgIHNlbGYuZXJyb3JJbmZvID0gJyc7XHJcbiAgICAgICAgICBua2NBUEkoYC9yLyR7cmlkfS9kZXRhaWxgLCBcIkdFVFwiKVxyXG4gICAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICBsZXQge2ZyZWUsIHBhaWQsIHJlc291cmNlLCBjb3N0U2NvcmVzLCBmaWxlQ291bnRMaW1pdEluZm99ID0gZGF0YS5kZXRhaWw7XHJcbiAgICAgICAgICAgICAgc2VsZi5maWxlQ291bnRMaW1pdEluZm8gPSBmaWxlQ291bnRMaW1pdEluZm87XHJcbiAgICAgICAgICAgICAgaWYoIXJlc291cmNlLmlzRmlsZUV4aXN0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnN0YXR1cyA9IFwiZmlsZU5vdEV4aXN0XCI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHNlbGYuc3RhdHVzID0gKCFmcmVlICYmICFwYWlkKSA/IFwibmVlZFNjb3JlXCI6IFwibm9OZWVkU2NvcmVcIjtcclxuICAgICAgICAgICAgICBzZWxmLmZyZWUgPSBmcmVlO1xyXG4gICAgICAgICAgICAgIHNlbGYucGFpZCA9IHBhaWQ7XHJcbiAgICAgICAgICAgICAgc2VsZi5maWxlTmFtZSA9IHJlc291cmNlLm9uYW1lO1xyXG4gICAgICAgICAgICAgIHNlbGYucmlkID0gcmVzb3VyY2UucmlkO1xyXG4gICAgICAgICAgICAgIHNlbGYudHlwZSA9IHJlc291cmNlLmV4dDtcclxuICAgICAgICAgICAgICBzZWxmLnNpemUgPSBOS0MubWV0aG9kcy5nZXRTaXplKHJlc291cmNlLnNpemUpO1xyXG4gICAgICAgICAgICAgIGlmKCFjb3N0U2NvcmVzKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgc2VsZi5jb3N0cyA9IGNvc3RTY29yZXMubWFwKHNjb3JlID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgIG5hbWU6IHNjb3JlLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIG51bWJlcjogc2NvcmUuYWRkTnVtYmVyIC8gMTAwICogLTFcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICBzZWxmLmhvbGQgPSBjb3N0U2NvcmVzLm1hcChzY29yZSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICBuYW1lOiBzY29yZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICBudW1iZXI6IHNjb3JlLm51bWJlciAvIDEwMFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgc2VsZi5maWxlQ291bnRMaW1pdEluZm8gPSBkYXRhLmZpbGVDb3VudExpbWl0SW5mbztcclxuICAgICAgICAgICAgICBzZWxmLnN0YXR1cyA9ICdlcnJvcic7XHJcbiAgICAgICAgICAgICAgc2VsZi5lcnJvckluZm8gPSBkYXRhLmVycm9yIHx8IGRhdGEubWVzc2FnZSB8fCBkYXRhO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZG93bmxvYWQoKSB7XHJcbiAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICBsZXQge3JpZCwgZmlsZU5hbWV9ID0gdGhpcztcclxuICAgICAgICAgIG5rY0FQSShgL3IvJHtyaWR9L3BheWAsIFwiUE9TVFwiKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgbGV0IGRvd25sb2FkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICAgICAgICAgICAgICBkb3dubG9hZGVyLnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGZpbGVOYW1lKTtcclxuICAgICAgICAgICAgICBkb3dubG9hZGVyLmhyZWYgPSBgL3IvJHtyaWR9YDtcclxuICAgICAgICAgICAgICBkb3dubG9hZGVyLmNsaWNrKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiBzZWxmLmdldFJlc291cmNlSW5mbyhzZWxmLnJpZCkpXHJcbiAgICAgICAgfSxcclxuICAgICAgICBvcGVuKHJpZCkge1xyXG4gICAgICAgICAgdGhpcy5zdGF0dXMgPSBcImxvYWRkaW5nXCI7XHJcbiAgICAgICAgICB0aGlzLmluaXREb20oKTtcclxuICAgICAgICAgIHRoaXMuZ2V0UmVzb3VyY2VJbmZvKHJpZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgIHNlbGYuZG9tLmhpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgc2VsZi5vcGVuID0gc2VsZi5hcHAub3BlbjtcclxuICAgIHNlbGYuY2xvc2UgPSBzZWxmLmFwcC5jbG9zZTtcclxuICB9XHJcbn07XHJcblxyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gIGNvbnN0IGRyID0gbmV3IE5LQy5tb2R1bGVzLmRvd25sb2FkUmVzb3VyY2UoKTtcclxuICBOS0MubWV0aG9kcy5vcGVuRmlsZVBhbmVsID0gZnVuY3Rpb24ocmlkKSB7XHJcbiAgICBkci5vcGVuKHJpZCk7XHJcbiAgfVxyXG5cclxuICAvLyDnm5HlkKzor4Torrrnm5LlrZBcclxuICAkKFwiI3dyYXBcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgdHlwZSA9ICQoZS50YXJnZXQpLmF0dHIoXCJkYXRhLXR5cGVcIik7XHJcbiAgICBpZih0eXBlID09PSBcImNsaWNrQXR0YWNobWVudFRpdGxlXCIpIHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICBsZXQgcmlkID0gJChlLnRhcmdldCkuYXR0cihcImRhdGEtaWRcIik7XHJcbiAgICAgIGRyLm9wZW4ocmlkKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH0pXHJcbiAgLy8gbGV0IGF0dGFjaG1lbnRzID0gW10uc2xpY2UuY2FsbCgkKFwiW2RhdGEtdGFnPSdua2Nzb3VyY2UnXVtkYXRhLXR5cGU9J2F0dGFjaG1lbnQnXVwiKSk7XHJcbiAgLy8gYXR0YWNobWVudHMuZm9yRWFjaChhdHRhY2htZW50ID0+IHtcclxuICAvLyAgICQoYXR0YWNobWVudCkuZmluZChcImEuYXJ0aWNsZS1hdHRhY2htZW50LW5hbWVcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAvLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIC8vICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gIC8vICAgICBsZXQgcmlkID0gJChhdHRhY2htZW50KS5hdHRyKFwiZGF0YS1pZFwiKTtcclxuICAvLyAgICAgZHIub3BlbihyaWQpO1xyXG4gIC8vICAgICByZXR1cm4gZmFsc2U7XHJcbiAgLy8gICB9KVxyXG4gIC8vIH0pXHJcbn0oKSk7XHJcbiJdfQ==
