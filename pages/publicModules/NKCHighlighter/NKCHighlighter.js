!function o(r,i,a){function s(t,e){if(!i[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=i[t]={exports:{}},r[t][0].call(n.exports,function(e){return s(r[t][1][e]||e)},n,n.exports,o,r,i,a)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){"use strict";function k(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw r}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}window.Source=function(){function a(e){f(this,a);var t=e.hl,n=e.node,o=e.id,r=e._id,e=e.content,o=o||r,u=this;this.hl=t,this.node=n,this.content=t.getNodesContent(n),this.dom=[],this.id=o,this._id="nkc-hl-id-".concat(o);var i,n=this.node,o=n.offset,n=n.length,c=u.getNodes(this.hl.root,o,n);0!==n&&c.length||(n=(o=t.root).nextSibling,t=o.parentNode,null===n?(i=document.createElement("div")).classList.add("nkc-free-notes"):i=n,(o=document.createElement("span")).innerText=e,i.appendChild(o),n||t.appendChild(i),c=[o]),c.map(function(n){if(n.textContent.length){var o=n.parentNode;if(o.classList.contains("nkc-hl")){var r=o.getAttribute("data-nkc-hl-id");if(r){r=r.split("-");var i=[],t=k(r);try{for(t.s();!(e=t.n()).done;){var e=e.value;i.push(u.hl.getSourceByID(Number(e)))}}catch(e){t.e(e)}finally{t.f()}var a,s=k(o.childNodes);try{for(s.s();!(a=s.n()).done;)(function(){var e=a.value;if(!e.textContent.length)return;var t=document.createElement("span");t.className="nkc-hl",t.onmouseover=o.onmouseover,t.onmouseout=o.onmouseout,t.onclick=o.onclick,i.map(function(e){e.dom.push(t)}),e===n?(1===o.childNodes.length&&1!==c.length||(t.onmouseover=function(){u.hl.emit(u.hl.eventNames.hover,u)},t.onmouseout=function(){u.hl.emit(u.hl.eventNames.hoverOut,u)},t.onclick=function(){u.hl.emit(u.hl.eventNames.click,u)}),t.className+=" nkc-hl-cover",t.setAttribute("data-nkc-hl-id",r.concat([u.id]).join("-")),u.dom.push(t)):t.setAttribute("data-nkc-hl-id",r.join("-")),t.appendChild(e.cloneNode(!1)),o.replaceChild(t,e)})()}catch(e){s.e(e)}finally{s.f()}i.map(function(e){var t=e.dom.indexOf(o);-1!==t&&e.dom.splice(t,1)}),o.onmouseout=null,o.onmouseover=null,o.onclick=null}}else{var l=document.createElement("span");l.classList.add("nkc-hl"),l.setAttribute("data-nkc-hl-id",u.id),l.onmouseover=function(){u.hl.emit(u.hl.eventNames.hover,u)},l.onmouseout=function(){u.hl.emit(u.hl.eventNames.hoverOut,u)},l.onclick=function(){u.hl.emit(u.hl.eventNames.click,u)},u.dom.push(l),l.appendChild(n.cloneNode(!0)),n.parentNode.replaceChild(l,n)}}}),this.hl.sources.push(this),this.hl.emit(this.hl.eventNames.create,this)}return r(a,[{key:"addClass",value:function(t){this.dom.map(function(e){e.classList.add(t)})}},{key:"removeClass",value:function(t){this.dom.map(function(e){e.classList.remove(t)})}},{key:"destroy",value:function(){this.dom.map(function(e){e.className=""})}},{key:"getSources",value:function(){return this.sources}},{key:"getNodes",value:function(e,t,n){for(var o,r=[e],i=0,a=n,s=[],l=!1;o=r.pop();){for(var u=o.childNodes,c=u.length-1;0<=c;c--){var f=u[c];this.hl.isClown(f)||r.push(f)}if(3===o.nodeType&&o.textContent.length&&t<(i+=o.textContent.length)){if(a<=0)break;var d=void 0,d=l?0:o.textContent.length-(i-t),l=!0,h=void 0;a<=o.textContent.length-d?(h=a,a=0):a-=h=o.textContent.length-d,s.push({node:o,startOffset:d,needLength:h})}}return s=s.map(function(e){var t=e.node,n=e.startOffset,e=e.needLength;return(t=0<n?t.splitText(n):t).textContent.length!==e&&t.splitText(e),t})}}]),a}(),window.NKCHighlighter=function(){function l(e){f(this,l);var t,n=e.rootElementId,o=e.excludedElementClass,r=void 0===o?[]:o,i=e.excludedElementTagName,a=void 0===i?[]:i,o=e.clownClass,i=void 0===o?[]:o,o=e.clownAttr,o=void 0===o?[]:o,e=e.clownTagName,e=void 0===e?[]:e,s=this;s.root=document.getElementById(n),s.excludedElementClass=r,s.excludedElementTagName=a,s.clownClass=i,s.clownAttr=o,s.clownTagName=e,s.range={},s.sources=[],s.events={},s.disabled=!1,s.eventNames={create:"create",hover:"hover",hoverOut:"hoverOut",select:"select"},document.addEventListener("mousedown",function(){clearInterval(t)}),document.addEventListener("selectionchange",function(){s.range={},clearInterval(t),t=setTimeout(function(){s.initEvent()},500)})}return r(l,[{key:"initEvent",value:function(){try{if(this.disabled)return;var e=this.getRange();if(!e||e.collapsed)return;if(e.startContainer===this.range.startContainer&&e.endContainer===this.range.endContainer&&e.startOffset===this.range.startOffset&&e.endOffset===this.range.endOffset)return;if(!this.contains(e.startContainer)||!this.contains(e.endContainer))return;this.range=e,this.emit(this.eventNames.select,{range:e})}catch(e){console.log(e.message||e)}}},{key:"contains",value:function(e){for(;e=e.parentNode;)if(e===this.root)return!0;return!1}},{key:"getParent",value:function(e,t){if(t!==e.root){if(this.isClown(t))throw new Error("划词越界");t.parentNode&&e.getParent(e,t.parentNode)}}},{key:"getRange",value:function(){var t=this;try{var e=window.getSelection().getRangeAt(0),n=e.startOffset,o=e.endOffset,r=e.startContainer,i=e.endContainer;return this.getParent(this,r),this.getParent(this,i),this.findNodes(r,i).map(function(e){t.getParent(t,e)}),n===o&&r===i?void 0:e}catch(e){console.log(e.message||e)}}},{key:"destroy",value:function(e){(e="string"==typeof e?this.getSourceByID(e):e).destroy()}},{key:"restoreSources",value:function(){var t=k(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]);try{for(t.s();!(e=t.n()).done;){var e=e.value;e.hl=this,new Source(e)}}catch(e){t.e(e)}finally{t.f()}}},{key:"getNodes",value:function(e){var t,n,o=e.startContainer,r=e.endContainer,i=e.startOffset,e=e.endOffset,a=[];if(o===r)n=t=o,a.push({node:t,offset:i,length:e-i});else{n=r,3===(t=o).nodeType&&a.push({node:t,offset:i,length:t.textContent.length-i});var s=k(this.findNodes(t,n));try{for(s.s();!(l=s.n()).done;){var l=l.value;a.push({node:l,offset:0,length:l.textContent.length})}}catch(e){s.e(e)}finally{s.f()}a.push({node:n,offset:0,length:e})}for(var u=[],c=0,f=a;c<f.length;c++){var d=f[c],h=d.node,v=d.offset,m=d.length,d=h.textContent.slice(v,v+m),h=this.getOffset(h);u.push({content:d,offset:h+v,length:m})}if(!u.length)return null;for(var g="",p=0,y=0,N=0;N<u.length;N++){var C=u[N];g+=C.content,y+=C.length,0===N&&(p=C.offset)}return{content:g,offset:p,length:y}}},{key:"getNodesContent",value:function(e){return e.content}},{key:"createSource",value:function(e,t){return new Source({hl:this,id:e,node:t})}},{key:"getSourceByID",value:function(e){var t=k(this.sources);try{for(t.s();!(n=t.n()).done;){var n=n.value;if(n.id===e)return n}}catch(e){t.e(e)}finally{t.f()}}},{key:"addClass",value:function(e,t){e="string"==typeof e?this.getSourceByID(e):e;e.addClass(t)}},{key:"removeClass",value:function(e,t){e="string"==typeof e?this.getSourceByID(e):e;e.removeClass(t)}},{key:"getOffset",value:function(e){for(var t,n=[this.root],o=0;t=n.pop();){for(var r=t.childNodes,i=r.length-1;0<=i;i--){var a=r[i];this.isClown(a)||n.push(a)}if(3===t.nodeType&&t!==e)o+=t.textContent.length;else if(3===t.nodeType)break}return o}},{key:"findNodes",value:function(r,i){var a,s,l=[],e=this.getSameParentNode(r,i);return e&&(s=a=!1,function e(t){if(t.hasChildNodes()){var n=k(t.childNodes);try{for(n.s();!(o=n.n()).done;){var o=o.value;if(s||o===i)return void(s=!0);a&&3===o.nodeType?l.push(o):o===r&&(a=!0),e(o)}}catch(e){n.e(e)}finally{n.f()}}}(e)),l}},{key:"isClown",value:function(e){if(1===e.nodeType){var t=e.classList,n=k(this.clownClass);try{for(n.s();!(o=n.n()).done;){var o=o.value;if(t.contains(o))return!0}}catch(e){n.e(e)}finally{n.f()}var r,i=e.tagName.toLowerCase();if(this.clownTagName.includes(i))return!0;for(r in this.clownAttr)if(this.clownAttr.hasOwnProperty(r)&&e.getAttribute(r)===this.clownAttr[r])return!0}}},{key:"getSameParentNode",value:function(e,t){var n=this;if(!t||e===t)return e.parentNode;function o(e,t){t.push(e),e!==n.root&&e.parentNode&&o(e.parentNode,t)}var r,i=[],a=[];o(e,i),o(t,a);for(var s=0,l=i;s<l.length;s++){var u=l[s];if(a.includes(u)){r=u;break}}return r}},{key:"getSourceById",value:function(e){var t=k(this.sources);try{for(t.s();!(n=t.n()).done;){var n=n.value;if(n.id===e)return n}}catch(e){t.e(e)}finally{t.f()}}},{key:"offset",value:function(e){var o,r=0,i=0;return function e(t,n){1===t.nodeType&&(o=window.getComputedStyle(t).position,void 0!==n||"static"!==o?(r=t.offsetTop+r-t.scrollTop,i=t.offsetLeft+i-t.scrollLeft,"fixed"!==o&&e(t.parentNode)):e(t.parentNode))}(e,!0),{top:r,left:i}}},{key:"getStartNodeOffset",value:function(e){var t=document.createElement("span");t.style.display="inline-block",t.style.verticalAlign="top",e.insertNode(t);var n=t.parentNode;t.style.width="30px";e=this.offset(t);return n.removeChild(t),e}},{key:"lock",value:function(){this.disabled=!0}},{key:"unlock",value:function(){this.disabled=!1}},{key:"on",value:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}},{key:"emit",value:function(e,t){(this.events[e]||[]).map(function(e){e(t)})}}]),l}()},{}]},{},[1]);