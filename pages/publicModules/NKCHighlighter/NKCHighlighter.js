!function i(a,s,l){function u(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var r=s[t]={exports:{}};a[t][0].call(r.exports,function(e){return u(a[t][1][e]||e)},r,r.exports,i,a,s,l)}return s[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,n){"use strict";function O(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}window.Source=function(){function g(e){p(this,g);var t=e.hl,n=e.node,o=e.id,r=e._id,i=e.content,o=o||r,c=this;this.hl=t,this.node=n,this.content=t.getNodesContent(n),this.dom=[],this.id=o,this._id="nkc-hl-id-".concat(o);var a,s,l,u,f,d=this.node,h=d.offset,v=d.length,m=c.getNodes(this.hl.root,h,v);0!==v&&m.length||(s=(a=t.root).nextSibling,l=a.parentNode,null===s?(u=document.createElement("div")).classList.add("nkc-free-notes"):u=s,(f=document.createElement("span")).innerText=i,u.appendChild(f),s||l.appendChild(u),m=[f]),m.map(function(n){if(n.textContent.length){var o=n.parentNode;if(o.classList.contains("nkc-hl")){var r=o.getAttribute("data-nkc-hl-id");if(!r)return;r=r.split("-");var e,i=[],t=O(r);try{for(t.s();!(e=t.n()).done;){var a=e.value;i.push(c.hl.getSourceByID(Number(a)))}}catch(e){t.e(e)}finally{t.f()}var s,l=O(o.childNodes);try{for(l.s();!(s=l.n()).done;)(function(){var e=s.value;if(!e.textContent.length)return;var t=document.createElement("span");t.className="nkc-hl",t.onmouseover=o.onmouseover,t.onmouseout=o.onmouseout,t.onclick=o.onclick,i.map(function(e){e.dom.push(t)}),e===n?(1===o.childNodes.length&&1!==m.length||(t.onmouseover=function(){c.hl.emit(c.hl.eventNames.hover,c)},t.onmouseout=function(){c.hl.emit(c.hl.eventNames.hoverOut,c)},t.onclick=function(){c.hl.emit(c.hl.eventNames.click,c)}),t.className+=" nkc-hl-cover",t.setAttribute("data-nkc-hl-id",r.concat([c.id]).join("-")),c.dom.push(t)):t.setAttribute("data-nkc-hl-id",r.join("-")),t.appendChild(e.cloneNode(!1)),o.replaceChild(t,e)})()}catch(e){l.e(e)}finally{l.f()}i.map(function(e){var t=e.dom.indexOf(o);-1!==t&&e.dom.splice(t,1)}),o.onmouseout=null,o.onmouseover=null,o.onclick=null}else{var u=document.createElement("span");u.classList.add("nkc-hl"),u.setAttribute("data-nkc-hl-id",c.id),u.onmouseover=function(){c.hl.emit(c.hl.eventNames.hover,c)},u.onmouseout=function(){c.hl.emit(c.hl.eventNames.hoverOut,c)},u.onclick=function(){c.hl.emit(c.hl.eventNames.click,c)},c.dom.push(u),u.appendChild(n.cloneNode(!0)),n.parentNode.replaceChild(u,n)}}}),this.hl.sources.push(this),this.hl.emit(this.hl.eventNames.create,this)}return r(g,[{key:"addClass",value:function(t){this.dom.map(function(e){e.classList.add(t)})}},{key:"removeClass",value:function(t){this.dom.map(function(e){e.classList.remove(t)})}},{key:"destroy",value:function(){this.dom.map(function(e){e.className=""})}},{key:"getSources",value:function(){return this.sources}},{key:"getNodes",value:function(e,t,n){for(var o,r=[e],i=0,a=n,s=[],l=!1;o=r.pop();){for(var u=o.childNodes,c=u.length-1;0<=c;c--){var f=u[c];this.hl.isClown(f)||r.push(f)}if(3===o.nodeType&&o.textContent.length&&t<(i+=o.textContent.length)){if(a<=0)break;var d=void 0,d=l?0:o.textContent.length-(i-t),l=!0,h=void 0;a<=o.textContent.length-d?(h=a,a=0):a-=h=o.textContent.length-d,s.push({node:o,startOffset:d,needLength:h})}}return s=s.map(function(e){var t=e.node,n=e.startOffset,o=e.needLength;return 0<n&&(t=t.splitText(n)),t.textContent.length!==o&&t.splitText(o),t})}}]),g}(),window.NKCHighlighter=function(){function v(e){p(this,v);var t,n=e.rootElementId,o=e.excludedElementClass,r=void 0===o?[]:o,i=e.excludedElementTagName,a=void 0===i?[]:i,s=e.clownClass,l=void 0===s?[]:s,u=e.clownAttr,c=void 0===u?[]:u,f=e.clownTagName,d=void 0===f?[]:f,h=this;h.root=document.getElementById(n),h.excludedElementClass=r,h.excludedElementTagName=a,h.clownClass=l,h.clownAttr=c,h.clownTagName=d,h.range={},h.sources=[],h.events={},h.disabled=!1,h.eventNames={create:"create",hover:"hover",hoverOut:"hoverOut",select:"select"},document.addEventListener("mousedown",function(){clearInterval(t)}),document.addEventListener("selectionchange",function(){h.range={},clearInterval(t),t=setTimeout(function(){h.initEvent()},500)})}return r(v,[{key:"initEvent",value:function(){try{if(this.disabled)return;var e=this.getRange();if(!e||e.collapsed)return;if(e.startContainer===this.range.startContainer&&e.endContainer===this.range.endContainer&&e.startOffset===this.range.startOffset&&e.endOffset===this.range.endOffset)return;if(!this.contains(e.startContainer)||!this.contains(e.endContainer))return;this.range=e,this.emit(this.eventNames.select,{range:e})}catch(e){console.log(e.message||e)}}},{key:"contains",value:function(e){for(;e=e.parentNode;)if(e===this.root)return!0;return!1}},{key:"getParent",value:function(e,t){if(t!==e.root){if(this.isClown(t))throw new Error("划词越界");t.parentNode&&e.getParent(e,t.parentNode)}}},{key:"getRange",value:function(){var t=this;try{var e=window.getSelection().getRangeAt(0),n=e.startOffset,o=e.endOffset,r=e.startContainer,i=e.endContainer;if(this.getParent(this,r),this.getParent(this,i),this.findNodes(r,i).map(function(e){t.getParent(t,e)}),n===o&&r===i)return;return e}catch(e){console.log(e.message||e)}}},{key:"destroy",value:function(e){"string"==typeof e&&(e=this.getSourceByID(e)),e.destroy()}},{key:"restoreSources",value:function(e){var t,n=O(0<arguments.length&&void 0!==e?e:[]);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.hl=this,new Source(o)}}catch(e){n.e(e)}finally{n.f()}}},{key:"getNodes",value:function(e){var t,n,o=e.startContainer,r=e.endContainer,i=e.startOffset,a=e.endOffset,s=[];if(o===r)n=t=o,s.push({node:t,offset:i,length:a-i});else{n=r,3===(t=o).nodeType&&s.push({node:t,offset:i,length:t.textContent.length-i});var l,u=O(this.findNodes(t,n));try{for(u.s();!(l=u.n()).done;){var c=l.value;s.push({node:c,offset:0,length:c.textContent.length})}}catch(e){u.e(e)}finally{u.f()}s.push({node:n,offset:0,length:a})}for(var f=[],d=0,h=s;d<h.length;d++){var v=h[d],m=v.node,g=v.offset,p=v.length,y=m.textContent.slice(g,g+p),N=this.getOffset(m);f.push({content:y,offset:N+g,length:p})}if(!f.length)return null;for(var C="",k=0,w=0,b=0;b<f.length;b++){var x=f[b];C+=x.content,w+=x.length,0===b&&(k=x.offset)}return{content:C,offset:k,length:w}}},{key:"getNodesContent",value:function(e){return e.content}},{key:"createSource",value:function(e,t){return new Source({hl:this,id:e,node:t})}},{key:"getSourceByID",value:function(e){var t,n=O(this.sources);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.id===e)return o}}catch(e){n.e(e)}finally{n.f()}}},{key:"addClass",value:function(e,t){var n="string"==typeof e?this.getSourceByID(e):e;n.addClass(t)}},{key:"removeClass",value:function(e,t){var n="string"==typeof e?this.getSourceByID(e):e;n.removeClass(t)}},{key:"getOffset",value:function(e){for(var t,n=[this.root],o=0;t=n.pop();){for(var r=t.childNodes,i=r.length-1;0<=i;i--){var a=r[i];this.isClown(a)||n.push(a)}if(3===t.nodeType&&t!==e)o+=t.textContent.length;else if(3===t.nodeType)break}return o}},{key:"findNodes",value:function(i,a){var s,l,u=[],e=this.getSameParentNode(i,a);return e&&(l=s=!1,function e(t){if(t.hasChildNodes()){var n,o=O(t.childNodes);try{for(o.s();!(n=o.n()).done;){var r=n.value;if(l||r===a)return void(l=!0);s&&3===r.nodeType?u.push(r):r===i&&(s=!0),e(r)}}catch(e){o.e(e)}finally{o.f()}}}(e)),u}},{key:"isClown",value:function(e){if(1===e.nodeType){var t,n=e.classList,o=O(this.clownClass);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(n.contains(r))return!0}}catch(e){o.e(e)}finally{o.f()}var i,a=e.tagName.toLowerCase();if(this.clownTagName.includes(a))return!0;for(i in this.clownAttr)if(this.clownAttr.hasOwnProperty(i)&&e.getAttribute(i)===this.clownAttr[i])return!0}}},{key:"getSameParentNode",value:function(e,t){var n=this;if(!t||e===t)return e.parentNode;function o(e,t){t.push(e),e!==n.root&&e.parentNode&&o(e.parentNode,t)}var r,i=[],a=[];o(e,i),o(t,a);for(var s=0,l=i;s<l.length;s++){var u=l[s];if(a.includes(u)){r=u;break}}return r}},{key:"getSourceById",value:function(e){var t,n=O(this.sources);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.id===e)return o}}catch(e){n.e(e)}finally{n.f()}}},{key:"offset",value:function(e){var o,r=0,i=0;return function e(t,n){1===t.nodeType&&(o=window.getComputedStyle(t).position,void 0!==n||"static"!==o?(r=t.offsetTop+r-t.scrollTop,i=t.offsetLeft+i-t.scrollLeft,"fixed"!==o&&e(t.parentNode)):e(t.parentNode))}(e,!0),{top:r,left:i}}},{key:"getStartNodeOffset",value:function(e){var t=document.createElement("span");t.style.display="inline-block",t.style.verticalAlign="top",e.insertNode(t);var n=t.parentNode;t.style.width="30px";var o=this.offset(t);return n.removeChild(t),o}},{key:"lock",value:function(){this.disabled=!0}},{key:"unlock",value:function(){this.disabled=!1}},{key:"on",value:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}},{key:"emit",value:function(e,t){(this.events[e]||[]).map(function(e){e(t)})}}]),v}()},{}]},{},[1]);