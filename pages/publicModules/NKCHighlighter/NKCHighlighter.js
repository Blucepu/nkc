!function o(r,i,a){function s(t,e){if(!i[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=i[t]={exports:{}},r[t][0].call(n.exports,function(e){return s(r[t][1][e]||e)},n,n.exports,o,r,i,a)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){"use strict";function w(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw r}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}window.Source=function(){function a(e){u(this,a);var t=e.hl,n=e.node,o=e.id,r=e._id,e=e.content,o=o||r,c=this;this.hl=t,this.node=n,this.content=t.getNodesContent(n),this.dom=[],this.id=o,this._id="nkc-hl-id-".concat(o);var i,n=this.node,o=n.offset,n=n.length,f=c.getNodes(this.hl.root,o,n);0!==n&&f.length||(n=(o=t.root).nextSibling,t=o.parentNode,null===n?(i=document.createElement("div")).classList.add("nkc-free-notes"):i=n,(o=document.createElement("span")).innerText=e,i.appendChild(o),n||t.appendChild(i),f=[o]),f.map(function(n){if(n.textContent.length){var o=n.parentNode;if(o.classList.contains("nkc-hl")){if(r=o.getAttribute("data-nkc-hl-id")){var e,r=r.split("-"),i=[],t=w(r);try{for(t.s();!(e=t.n()).done;){var a=e.value;i.push(c.hl.getSourceByID(Number(a)))}}catch(e){t.e(e)}finally{t.f()}var s,l=w(o.childNodes);try{for(l.s();!(s=l.n()).done;)(function(){var e=s.value;if(!e.textContent.length)return;var t=document.createElement("span");t.className="nkc-hl",t.onmouseover=o.onmouseover,t.onmouseout=o.onmouseout,t.onclick=o.onclick,i.map(function(e){e.dom.push(t)}),e===n?(1===o.childNodes.length&&1!==f.length||(t.onmouseover=function(){c.hl.emit(c.hl.eventNames.hover,c)},t.onmouseout=function(){c.hl.emit(c.hl.eventNames.hoverOut,c)},t.onclick=function(){c.hl.emit(c.hl.eventNames.click,c)}),t.className+=" nkc-hl-cover",t.setAttribute("data-nkc-hl-id",r.concat([c.id]).join("-")),c.dom.push(t)):t.setAttribute("data-nkc-hl-id",r.join("-")),t.appendChild(e.cloneNode(!1)),o.replaceChild(t,e)})()}catch(e){l.e(e)}finally{l.f()}i.map(function(e){var t=e.dom.indexOf(o);-1!==t&&e.dom.splice(t,1)}),o.onmouseout=null,o.onmouseover=null,o.onclick=null}}else{var u=document.createElement("span");u.classList.add("nkc-hl"),u.setAttribute("data-nkc-hl-id",c.id),u.onmouseover=function(){c.hl.emit(c.hl.eventNames.hover,c)},u.onmouseout=function(){c.hl.emit(c.hl.eventNames.hoverOut,c)},u.onclick=function(){c.hl.emit(c.hl.eventNames.click,c)},c.dom.push(u),u.appendChild(n.cloneNode(!0)),n.parentNode.replaceChild(u,n)}}}),this.hl.sources.push(this),this.hl.emit(this.hl.eventNames.create,this)}return r(a,[{key:"addClass",value:function(t){this.dom.map(function(e){e.classList.add(t)})}},{key:"removeClass",value:function(t){this.dom.map(function(e){e.classList.remove(t)})}},{key:"destroy",value:function(){this.dom.map(function(e){e.className=""})}},{key:"getSources",value:function(){return this.sources}},{key:"getNodes",value:function(e,t,n){for(var o,r=[e],i=0,a=n,s=[],l=!1;o=r.pop();){for(var u=o.childNodes,c=u.length-1;0<=c;c--){var f=u[c];this.hl.isClown(f)||r.push(f)}if(3===o.nodeType&&o.textContent.length&&t<(i+=o.textContent.length)){if(a<=0)break;var d=void 0,d=l?0:o.textContent.length-(i-t),l=!0,h=void 0;a<=o.textContent.length-d?(h=a,a=0):a-=h=o.textContent.length-d,s.push({node:o,startOffset:d,needLength:h})}}return s=s.map(function(e){var t=e.node,n=e.startOffset,e=e.needLength;return(t=0<n?t.splitText(n):t).textContent.length!==e&&t.splitText(e),t})}}]),a}(),window.NKCHighlighter=function(){function l(e){u(this,l);var t,n=e.rootElementId,o=e.excludedElementClass,r=void 0===o?[]:o,i=e.excludedElementTagName,a=void 0===i?[]:i,o=e.clownClass,i=void 0===o?[]:o,o=e.clownAttr,o=void 0===o?[]:o,e=e.clownTagName,e=void 0===e?[]:e,s=this;s.root=document.getElementById(n),s.excludedElementClass=r,s.excludedElementTagName=a,s.clownClass=i,s.clownAttr=o,s.clownTagName=e,s.range={},s.sources=[],s.events={},s.disabled=!1,s.eventNames={create:"create",hover:"hover",hoverOut:"hoverOut",select:"select"},document.addEventListener("mousedown",function(){clearInterval(t)}),document.addEventListener("selectionchange",function(){s.range={},clearInterval(t),t=setTimeout(function(){s.initEvent()},500)})}return r(l,[{key:"initEvent",value:function(){try{if(this.disabled)return;var e=this.getRange();if(!e||e.collapsed)return;if(e.startContainer===this.range.startContainer&&e.endContainer===this.range.endContainer&&e.startOffset===this.range.startOffset&&e.endOffset===this.range.endOffset)return;if(!this.contains(e.startContainer)||!this.contains(e.endContainer))return;this.range=e,this.emit(this.eventNames.select,{range:e})}catch(e){console.log(e.message||e)}}},{key:"contains",value:function(e){for(;e=e.parentNode;)if(e===this.root)return!0;return!1}},{key:"getParent",value:function(e,t){if(t!==e.root){if(this.isClown(t))throw new Error("划词越界");t.parentNode&&e.getParent(e,t.parentNode)}}},{key:"getRange",value:function(){var t=this;try{var e=window.getSelection().getRangeAt(0),n=e.startOffset,o=e.endOffset,r=e.startContainer,i=e.endContainer;return this.getParent(this,r),this.getParent(this,i),this.findNodes(r,i).map(function(e){t.getParent(t,e)}),n===o&&r===i?void 0:e}catch(e){console.log(e.message||e)}}},{key:"destroy",value:function(e){(e="string"==typeof e?this.getSourceByID(e):e).destroy()}},{key:"restoreSources",value:function(){var e,t=w(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.hl=this,new Source(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"getNodes",value:function(e){var t,n,o=e.startContainer,r=e.endContainer,i=e.startOffset,e=e.endOffset,a=[];if(o===r)a.push({node:n=t=o,offset:i,length:e-i});else{n=r,3===(t=o).nodeType&&a.push({node:t,offset:i,length:t.textContent.length-i});var s,l=w(this.findNodes(t,n));try{for(l.s();!(s=l.n()).done;){var u=s.value;a.push({node:u,offset:0,length:u.textContent.length})}}catch(e){l.e(e)}finally{l.f()}a.push({node:n,offset:0,length:e})}for(var c=[],f=0,d=a;f<d.length;f++){var h=d[f],v=h.node,m=h.offset,g=h.length,h=v.textContent.slice(m,m+g),v=this.getOffset(v);c.push({content:h,offset:v+m,length:g})}if(!c.length)return null;for(var p="",y=0,N=0,C=0;C<c.length;C++){var k=c[C];p+=k.content,N+=k.length,0===C&&(y=k.offset)}return{content:p,offset:y,length:N}}},{key:"getNodesContent",value:function(e){return e.content}},{key:"createSource",value:function(e,t){return new Source({hl:this,id:e,node:t})}},{key:"getSourceByID",value:function(e){var t,n=w(this.sources);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.id===e)return o}}catch(e){n.e(e)}finally{n.f()}}},{key:"addClass",value:function(e,t){e="string"==typeof e?this.getSourceByID(e):e;e.addClass(t)}},{key:"removeClass",value:function(e,t){e="string"==typeof e?this.getSourceByID(e):e;e.removeClass(t)}},{key:"getOffset",value:function(e){for(var t,n=[this.root],o=0;t=n.pop();){for(var r=t.childNodes,i=r.length-1;0<=i;i--){var a=r[i];this.isClown(a)||n.push(a)}if(3===t.nodeType&&t!==e)o+=t.textContent.length;else if(3===t.nodeType)break}return o}},{key:"findNodes",value:function(i,a){var s,l,u=[],e=this.getSameParentNode(i,a);return e&&(l=s=!1,function e(t){if(t.hasChildNodes()){var n,o=w(t.childNodes);try{for(o.s();!(n=o.n()).done;){var r=n.value;if(l||r===a)return void(l=!0);s&&3===r.nodeType?u.push(r):r===i&&(s=!0),e(r)}}catch(e){o.e(e)}finally{o.f()}}}(e)),u}},{key:"isClown",value:function(e){if(1===e.nodeType){var t,n=e.classList,o=w(this.clownClass);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(n.contains(r))return!0}}catch(e){o.e(e)}finally{o.f()}var i,a=e.tagName.toLowerCase();if(this.clownTagName.includes(a))return!0;for(i in this.clownAttr)if(this.clownAttr.hasOwnProperty(i)&&e.getAttribute(i)===this.clownAttr[i])return!0}}},{key:"getSameParentNode",value:function(e,t){var n=this;if(!t||e===t)return e.parentNode;function o(e,t){t.push(e),e!==n.root&&e.parentNode&&o(e.parentNode,t)}var r,i=[],a=[];o(e,i),o(t,a);for(var s=0,l=i;s<l.length;s++){var u=l[s];if(a.includes(u)){r=u;break}}return r}},{key:"getSourceById",value:function(e){var t,n=w(this.sources);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.id===e)return o}}catch(e){n.e(e)}finally{n.f()}}},{key:"offset",value:function(e){var o,r=0,i=0;return function e(t,n){1===t.nodeType&&(o=window.getComputedStyle(t).position,void 0!==n||"static"!==o?(r=t.offsetTop+r-t.scrollTop,i=t.offsetLeft+i-t.scrollLeft,"fixed"!==o&&e(t.parentNode)):e(t.parentNode))}(e,!0),{top:r,left:i}}},{key:"getStartNodeOffset",value:function(e){var t=document.createElement("span");t.style.display="inline-block",t.style.verticalAlign="top",e.insertNode(t);var n=t.parentNode;t.style.width="30px";e=this.offset(t);return n.removeChild(t),e}},{key:"lock",value:function(){this.disabled=!0}},{key:"unlock",value:function(){this.disabled=!1}},{key:"on",value:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}},{key:"emit",value:function(e,t){(this.events[e]||[]).map(function(e){e(t)})}}]),l}()},{}]},{},[1]);