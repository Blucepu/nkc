(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

NKC.modules.NotePanel =
/*#__PURE__*/
function () {
  function _class() {
    var _this2 = this;

    _classCallCheck(this, _class);

    var self = this;
    self.app = new Vue({
      el: "#moduleNotePanel",
      data: {
        uid: NKC.configs.uid,
        disableNoteContent: false,
        show: false,
        edit: false,
        submitting: false,
        // 新添加的笔记内容
        content: "",
        // 显示笔记
        note: ""
        /* note的数据结构
        {
          _id: Number,
          type,
          targetId,
          notes: [
            {
              toc: Date,
              uid: String,
              user: {
                username: String,
                avatar: String,
                uid: String
              },
              content: String
            }
          ],
        }
        */

      },
      updated: function updated() {
        this.resetDom();
      },
      methods: {
        fromNow: NKC.methods.fromNow,
        getUrl: NKC.methods.tools.getUrl,
        visitUrl: NKC.methods.visitUrl,
        setTextareaSize: function setTextareaSize(size) {
          var textarea = this.$el.getElementsByClassName("create-textarea")[0];
          textarea.style.height = size;
        },
        resetTextarea: function resetTextarea() {
          this.content = "";
          this.setTextareaSize("2.5rem");
        },
        autoResize: function autoResize(e) {
          var textArea = e.target;
          var num = 2.5 * 12;
          textArea.style.height = '2.5rem';

          if (num < textArea.scrollHeight) {
            textArea.style.height = textArea.scrollHeight + 'px';
          }
        },
        saveNewNote: function saveNewNote() {
          // 创建新的
          var content = this.content,
              note = this.note;
          Promise.resolve().then(function () {
            if (!content) throw "请输入笔记内容";
            var type = note.type,
                targetId = note.targetId,
                node = note.node,
                _id = note._id;
            self.app.submitting = true;
            return nkcAPI("/note", "POST", {
              _id: _id,
              type: type,
              targetId: targetId,
              content: content,
              node: node
            });
          }).then(function (data) {
            self.app.content = "";
            self.app.resetTextarea();
            self.app.resetDom();
            self.callback(data.note);
            self.app.extendNoteContent(data.note);
            self.app.note = data.note;
            self.app.submitting = false;
            setTimeout(function () {
              self.app.scrollToBottom();
            }, 200);
          })["catch"](function (err) {
            sweetError(err);
            self.app.submitting = false;
          });
        },
        modifyNoteContent: function modifyNoteContent(n) {
          if (n.edit) {
            n.edit = false;
          } else {
            n.edit = true;
            if (!n._content) n._content = n.content;
          }
        },
        extendNoteContent: function extendNoteContent(note) {
          note.notes.map(function (n) {
            n.edit = false;
            n._content = "";
          });
        },
        saveNote: function saveNote(n) {
          // 保存编辑
          var note = this.note,
              uid = this.uid;
          var url,
              method,
              data = {};

          if (n.uid === uid) {
            url = "/note/".concat(note._id, "/c/").concat(n._id);
            method = "PATCH";
            data.content = n._content;
          } else {
            url = "/nkc/note";
            method = "POST";
            data.type = "modify";
            data.noteId = note._id;
            data.noteContentId = n._id;
            data.content = n._content;
          }

          nkcAPI(url, method, data).then(function (data) {
            n.content = n._content;
            n.html = data.noteContentHTML;
            self.app.modifyNoteContent(n);
            Vue.set(note.notes, note.notes.indexOf(n), n);
          })["catch"](sweetError);
        },
        open: function open(callback, options) {
          var _this = this;

          new Promise(function (resolve, reject) {
            self.app.resetDom();
            self.callback = callback;
            var id = options.id,
                note = options.note;

            if (note) {
              self.app.note = note;
              resolve();
            } else {
              nkcAPI("/note/".concat(id), "GET").then(function (data) {
                self.app.extendNoteContent(data.note);
                self.app.note = data.note;
                resolve();
              })["catch"](reject);
            }
          }).then(function () {
            _this.show = true;
            NKC.methods.initUnfixedPanel();
          })["catch"](sweetError);
        },
        close: function close() {
          this.show = false;
        },
        resetDom: function resetDom() {
          var dom = this.$el;
          dom.style.height = "auto";
        },
        scrollToBottom: function scrollToBottom() {
          var dom = this.$el.getElementsByClassName("note-panel-notes")[0];
          dom.scrollTop = dom.scrollHeight + 10000;
        },
        deleteNoteContent: function deleteNoteContent(n, type) {
          var note = this.note;
          var url,
              method,
              data = {};

          if (type === "delete") {
            url = "/note/".concat(note._id, "/c/").concat(n._id);
            method = "DELETE";
          } else {
            method = "POST";
            url = "/nkc/note";

            if (n.disabled) {
              data.type = "cancelDisable";
            } else {
              data.type = "disable";
            }

            data.noteId = note._id;
            data.noteContentId = n._id;
          }

          sweetQuestion("确定要执行此操作？").then(function () {
            return nkcAPI(url, method, data);
          }).then(function () {
            if (type === "delete") {
              n.deleted = true;
            } else {
              n.disabled = !n.disabled;
            }

            sweetSuccess("操作成功");
          })["catch"](sweetError);
        }
      }
    });
    self.open = self.app.open;
    self.close = self.app.close;

    self.isOpen = function () {
      return !!_this2.app.show;
    };
  }

  return _class;
}();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3B1YmxpY01vZHVsZXMvTktDSGlnaGxpZ2h0ZXIvbm90ZVBhbmVsLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNBQSxHQUFHLENBQUMsT0FBSixDQUFZLFNBQVo7QUFBQTtBQUFBO0FBQ0Usb0JBQWM7QUFBQTs7QUFBQTs7QUFDWixRQUFNLElBQUksR0FBRyxJQUFiO0FBQ0EsSUFBQSxJQUFJLENBQUMsR0FBTCxHQUFXLElBQUksR0FBSixDQUFRO0FBQ2pCLE1BQUEsRUFBRSxFQUFFLGtCQURhO0FBRWpCLE1BQUEsSUFBSSxFQUFFO0FBQ0osUUFBQSxHQUFHLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxHQURiO0FBRUosUUFBQSxrQkFBa0IsRUFBRSxLQUZoQjtBQUdKLFFBQUEsSUFBSSxFQUFFLEtBSEY7QUFJSixRQUFBLElBQUksRUFBRSxLQUpGO0FBS0osUUFBQSxVQUFVLEVBQUUsS0FMUjtBQU1KO0FBQ0EsUUFBQSxPQUFPLEVBQUUsRUFQTDtBQVFKO0FBQ0EsUUFBQSxJQUFJLEVBQUU7QUFDSjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFWRSxPQUZXO0FBZ0NqQixNQUFBLE9BaENpQixxQkFnQ1A7QUFDUixhQUFLLFFBQUw7QUFDRCxPQWxDZ0I7QUFtQ2pCLE1BQUEsT0FBTyxFQUFFO0FBQ1AsUUFBQSxPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxPQURkO0FBRVAsUUFBQSxNQUFNLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxLQUFaLENBQWtCLE1BRm5CO0FBR1AsUUFBQSxRQUFRLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUhmO0FBSVAsUUFBQSxlQUpPLDJCQUlTLElBSlQsRUFJZTtBQUNwQixjQUFNLFFBQVEsR0FBRyxLQUFLLEdBQUwsQ0FBUyxzQkFBVCxDQUFnQyxpQkFBaEMsRUFBbUQs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Q0FBQyxHQUFuQjtBQUNBLFlBQUEsSUFBSSxDQUFDLGFBQUwsR0FBcUIsQ0FBQyxDQUFDLEdBQXZCO0FBQ0Q7O0FBQ0QsVUFBQSxhQUFhLENBQUMsV0FBRCxDQUFiLENBQ0csSUFESCxDQUNRLFlBQU07QUFDVixtQkFBTyxNQUFNLENBQUMsR0FBRCxFQUFNLE1BQU4sRUFBYyxJQUFkLENBQWI7QUFDRCxXQUhILEVBSUcsSUFKSCxDQUlRLFlBQVc7QUFDZixnQkFBRyxJQUFJLEtBQUssUUFBWixFQUFzQjtBQUNwQixjQUFBLENBQUMsQ0FBQyxPQUFGLEdBQVksSUFBWjtBQUNELGFBRkQsTUFFTztBQUNMLGNBQUEsQ0FBQyxDQUFDLFFBQUYsR0FBYSxDQUFDLENBQUMsQ0FBQyxRQUFoQjtBQUNEOztBQUNELFlBQUEsWUFBWSxDQUFDLE1BQUQsQ0FBWjtBQUNELFdBWEgsV0FZUyxVQVpUO0FBYUQ7QUE3Sk07QUFuQ1EsS0FBUixDQUFYO0FBbU1BLElBQUEsSUFBSSxDQUFDLElBQUwsR0FBWSxJQUFJLENBQUMsR0FBTCxDQUFTLElBQXJCO0FBQ0EsSUFBQSxJQUFJLENBQUMsS0FBTCxHQUFhLElBQUksQ0FBQyxHQUFMLENBQVMsS0FBdEI7O0FBQ0EsSUFBQSxJQUFJLENBQUMsTUFBTCxHQUFjLFlBQU07QUFDbEIsYUFBTyxDQUFDLENBQUMsTUFBSSxDQUFDLEdBQUwsQ0FBUyxJQUFsQjtBQUNELEtBRkQ7QUFHRDs7QUEzTUg7QUFBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIk5LQy5tb2R1bGVzLk5vdGVQYW5lbCA9IGNsYXNzIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5hcHAgPSBuZXcgVnVlKHtcclxuICAgICAgZWw6IFwiI21vZHVsZU5vdGVQYW5lbFwiLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdWlkOiBOS0MuY29uZmlncy51aWQsXHJcbiAgICAgICAgZGlzYWJsZU5vdGVDb250ZW50OiBmYWxzZSxcclxuICAgICAgICBzaG93OiBmYWxzZSxcclxuICAgICAgICBlZGl0OiBmYWxzZSxcclxuICAgICAgICBzdWJtaXR0aW5nOiBmYWxzZSxcclxuICAgICAgICAvLyDmlrDmt7vliqDnmoTnrJTorrDlhoXlrrlcclxuICAgICAgICBjb250ZW50OiBcIlwiLFxyXG4gICAgICAgIC8vIOaYvuekuueslOiusFxyXG4gICAgICAgIG5vdGU6IFwiXCIsXHJcbiAgICAgICAgICAvKiBub3Rl55qE5pWw5o2u57uT5p6EXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIF9pZDogTnVtYmVyLFxyXG4gICAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgICB0YXJnZXRJZCxcclxuICAgICAgICAgICAgbm90ZXM6IFtcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0b2M6IERhdGUsXHJcbiAgICAgICAgICAgICAgICB1aWQ6IFN0cmluZyxcclxuICAgICAgICAgICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IFN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgYXZhdGFyOiBTdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgIHVpZDogU3RyaW5nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogU3RyaW5nXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgKi9cclxuICAgICAgfSxcclxuICAgICAgdXBkYXRlZCgpIHtcclxuICAgICAgICB0aGlzLnJlc2V0RG9tKCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIG1ldGhvZHM6IHtcclxuICAgICAgICBmcm9tTm93OiBOS0MubWV0aG9kcy5mcm9tTm93LFxyXG4gICAgICAgIGdldFVybDogTktDLm1ldGhvZHMudG9vbHMuZ2V0VXJsLFxyXG4gICAgICAgIHZpc2l0VXJsOiBOS0MubWV0aG9kcy52aXNpdFVybCxcclxuICAgICAgICBzZXRUZXh0YXJlYVNpemUoc2l6ZSkge1xyXG4gICAgICAgICAgY29uc3QgdGV4dGFyZWEgPSB0aGlzLiRlbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY3JlYXRlLXRleHRhcmVhXCIpWzBdO1xyXG4gICAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gc2l6ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc2V0VGV4dGFyZWEoKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBcIlwiO1xyXG4gICAgICAgICAgdGhpcy5zZXRUZXh0YXJlYVNpemUoXCIyLjVyZW1cIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhdXRvUmVzaXplKGUpIHtcclxuICAgICAgICAgIGNvbnN0IHRleHRBcmVhID0gZS50YXJnZXQ7XHJcbiAgICAgICAgICBjb25zdCBudW0gPSAyLjUgKiAxMjtcclxuICAgICAgICAgIHRleHRBcmVhLnN0eWxlLmhlaWdodCA9ICcyLjVyZW0nO1xyXG4gICAgICAgICAgaWYobnVtIDwgdGV4dEFyZWEuc2Nyb2xsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRleHRBcmVhLnN0eWxlLmhlaWdodCA9IHRleHRBcmVhLnNjcm9sbEhlaWdodCArICdweCc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzYXZlTmV3Tm90ZSgpIHtcclxuICAgICAgICAgIC8vIOWIm+W7uuaWsOeahFxyXG4gICAgICAgICAgY29uc3Qge2NvbnRlbnQsIG5vdGV9ID0gdGhpcztcclxuICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICBpZighY29udGVudCkgdGhyb3cgXCLor7fovpPlhaXnrJTorrDlhoXlrrlcIjtcclxuICAgICAgICAgICAgICBjb25zdCB7dHlwZSwgdGFyZ2V0SWQsIG5vZGUsIF9pZH0gPSBub3RlO1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLnN1Ym1pdHRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIHJldHVybiBua2NBUEkoXCIvbm90ZVwiLCBcIlBPU1RcIiwge1xyXG4gICAgICAgICAgICAgICAgX2lkLFxyXG4gICAgICAgICAgICAgICAgdHlwZSxcclxuICAgICAgICAgICAgICAgIHRhcmdldElkLFxyXG4gICAgICAgICAgICAgICAgY29udGVudCxcclxuICAgICAgICAgICAgICAgIG5vZGVcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAuY29udGVudCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAucmVzZXRUZXh0YXJlYSgpO1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLnJlc2V0RG9tKCk7XHJcbiAgICAgICAgICAgICAgc2VsZi5jYWxsYmFjayhkYXRhLm5vdGUpO1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLmV4dGVuZE5vdGVDb250ZW50KGRhdGEubm90ZSk7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAubm90ZSA9IGRhdGEubm90ZTtcclxuICAgICAgICAgICAgICBzZWxmLmFwcC5zdWJtaXR0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmFwcC5zY3JvbGxUb0JvdHRvbSgpO1xyXG4gICAgICAgICAgICAgIH0sIDIwMClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgc3dlZXRFcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLnN1Ym1pdHRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtb2RpZnlOb3RlQ29udGVudChuKSB7XHJcbiAgICAgICAgICBpZihuLmVkaXQpIHtcclxuICAgICAgICAgICAgbi5lZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuLmVkaXQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZighbi5fY29udGVudCkgbi5fY29udGVudCA9IG4uY29udGVudDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGV4dGVuZE5vdGVDb250ZW50KG5vdGUpIHtcclxuICAgICAgICAgIG5vdGUubm90ZXMubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICBuLmVkaXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgbi5fY29udGVudCA9IFwiXCI7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNhdmVOb3RlKG4pIHtcclxuICAgICAgICAgIC8vIOS/neWtmOe8lui+kVxyXG4gICAgICAgICAgY29uc3Qge25vdGUsIHVpZH0gPSB0aGlzO1xyXG4gICAgICAgICAgbGV0IHVybCwgbWV0aG9kLCBkYXRhID0ge307XHJcbiAgICAgICAgICBpZihuLnVpZCA9PT0gdWlkKSB7XHJcbiAgICAgICAgICAgIHVybCA9IGAvbm90ZS8ke25vdGUuX2lkfS9jLyR7bi5faWR9YDtcclxuICAgICAgICAgICAgbWV0aG9kID0gXCJQQVRDSFwiO1xyXG4gICAgICAgICAgICBkYXRhLmNvbnRlbnQgPSBuLl9jb250ZW50O1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdXJsID0gYC9ua2Mvbm90ZWA7XHJcbiAgICAgICAgICAgIG1ldGhvZCA9IFwiUE9TVFwiO1xyXG4gICAgICAgICAgICBkYXRhLnR5cGUgPSBcIm1vZGlmeVwiO1xyXG4gICAgICAgICAgICBkYXRhLm5vdGVJZCA9IG5vdGUuX2lkO1xyXG4gICAgICAgICAgICBkYXRhLm5vdGVDb250ZW50SWQgPSBuLl9pZDtcclxuICAgICAgICAgICAgZGF0YS5jb250ZW50ID0gbi5fY29udGVudDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIG5rY0FQSSh1cmwsIG1ldGhvZCwgZGF0YSlcclxuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICBuLmNvbnRlbnQgPSBuLl9jb250ZW50O1xyXG4gICAgICAgICAgICAgIG4uaHRtbCA9IGRhdGEubm90ZUNvbnRlbnRIVE1MO1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLm1vZGlmeU5vdGVDb250ZW50KG4pO1xyXG4gICAgICAgICAgICAgIFZ1ZS5zZXQobm90ZS5ub3Rlcywgbm90ZS5ub3Rlcy5pbmRleE9mKG4pLCBuKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3BlbihjYWxsYmFjaywgb3B0aW9ucykge1xyXG4gICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmFwcC5yZXNldERvbSgpO1xyXG4gICAgICAgICAgICBzZWxmLmNhbGxiYWNrID0gY2FsbGJhY2s7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpZCwgbm90ZX0gPSBvcHRpb25zO1xyXG4gICAgICAgICAgICBpZihub3RlKSB7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAubm90ZSA9IG5vdGU7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIG5rY0FQSShgL25vdGUvJHtpZH1gLCBcIkdFVFwiKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHNlbGYuYXBwLmV4dGVuZE5vdGVDb250ZW50KGRhdGEubm90ZSk7XHJcbiAgICAgICAgICAgICAgICAgIHNlbGYuYXBwLm5vdGUgPSBkYXRhLm5vdGU7XHJcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2gocmVqZWN0KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICBOS0MubWV0aG9kcy5pbml0VW5maXhlZFBhbmVsKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNsb3NlKCkge1xyXG4gICAgICAgICAgdGhpcy5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXNldERvbSgpIHtcclxuICAgICAgICAgIGNvbnN0IGRvbSA9IHRoaXMuJGVsO1xyXG4gICAgICAgICAgZG9tLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKSB7XHJcbiAgICAgICAgICBjb25zdCBkb20gPSB0aGlzLiRlbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibm90ZS1wYW5lbC1ub3Rlc1wiKVswXTtcclxuICAgICAgICAgIGRvbS5zY3JvbGxUb3AgPSBkb20uc2Nyb2xsSGVpZ2h0ICsgMTAwMDA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkZWxldGVOb3RlQ29udGVudChuLCB0eXBlKSB7XHJcbiAgICAgICAgICBjb25zdCB7bm90ZX0gPSB0aGlzO1xyXG4gICAgICAgICAgbGV0IHVybCwgbWV0aG9kLCBkYXRhID0ge307XHJcbiAgICAgICAgICBpZih0eXBlID09PSBcImRlbGV0ZVwiKSB7XHJcbiAgICAgICAgICAgIHVybCA9IGAvbm90ZS8ke25vdGUuX2lkfS9jLyR7bi5faWR9YDtcclxuICAgICAgICAgICAgbWV0aG9kID0gXCJERUxFVEVcIjtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1ldGhvZCA9IFwiUE9TVFwiO1xyXG4gICAgICAgICAgICB1cmwgPSBgL25rYy9ub3RlYDtcclxuICAgICAgICAgICAgaWYobi5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICAgIGRhdGEudHlwZSA9IFwiY2FuY2VsRGlzYWJsZVwiO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGRhdGEudHlwZSA9IFwiZGlzYWJsZVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRhdGEubm90ZUlkID0gbm90ZS5faWQ7XHJcbiAgICAgICAgICAgIGRhdGEubm90ZUNvbnRlbnRJZCA9IG4uX2lkO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgc3dlZXRRdWVzdGlvbihcIuehruWumuimgeaJp+ihjOatpOaTjeS9nO+8n1wiKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG5rY0FQSSh1cmwsIG1ldGhvZCwgZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgIGlmKHR5cGUgPT09IFwiZGVsZXRlXCIpIHtcclxuICAgICAgICAgICAgICAgIG4uZGVsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG4uZGlzYWJsZWQgPSAhbi5kaXNhYmxlZDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgc3dlZXRTdWNjZXNzKFwi5pON5L2c5oiQ5YqfXCIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcilcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgc2VsZi5vcGVuID0gc2VsZi5hcHAub3BlbjtcclxuICAgIHNlbGYuY2xvc2UgPSBzZWxmLmFwcC5jbG9zZTtcclxuICAgIHNlbGYuaXNPcGVuID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gISF0aGlzLmFwcC5zaG93O1xyXG4gICAgfVxyXG4gIH1cclxufTsiXX0=
