(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

NKC.modules.NotePanel =
/*#__PURE__*/
function () {
  function _class() {
    var _this2 = this;

    _classCallCheck(this, _class);

    var self = this;
    self.app = new Vue({
      el: "#moduleNotePanel",
      data: {
        uid: NKC.configs.uid,
        disableNoteContent: false,
        show: false,
        edit: false,
        // 新添加的笔记内容
        content: "",
        // 显示笔记
        note: ""
        /* note的数据结构
        {
          _id: Number,
          type,
          targetId,
          notes: [
            {
              toc: Date,
              uid: String,
              user: {
                username: String,
                avatar: String,
                uid: String
              },
              content: String
            }
          ],
        }
        */

      },
      updated: function updated() {
        this.resetDom();
      },
      methods: {
        fromNow: NKC.methods.fromNow,
        getUrl: NKC.methods.tools.getUrl,
        visitUrl: NKC.methods.visitUrl,
        setTextareaSize: function setTextareaSize(size) {
          var textarea = this.$el.getElementsByClassName("create-textarea")[0];
          textarea.style.height = size;
        },
        resetTextarea: function resetTextarea() {
          this.content = "";
          this.setTextareaSize("2.5rem");
        },
        autoResize: function autoResize(e) {
          var textArea = e.target;
          var num = 2.5 * 12;
          textArea.style.height = '2.5rem';

          if (num < textArea.scrollHeight) {
            textArea.style.height = textArea.scrollHeight + 'px';
          }
        },
        saveNewNote: function saveNewNote() {
          // 创建新的
          var content = this.content,
              note = this.note;
          Promise.resolve().then(function () {
            if (!content) throw "请输入笔记内容";
            var type = note.type,
                targetId = note.targetId,
                node = note.node,
                _id = note._id;
            return nkcAPI("/note", "POST", {
              _id: _id,
              type: type,
              targetId: targetId,
              content: content,
              node: node
            });
          }).then(function (data) {
            self.app.content = "";
            self.app.resetTextarea();
            self.app.resetDom();
            self.callback(data.note);
            self.app.extendNoteContent(data.note);
            self.app.note = data.note;
            setTimeout(function () {
              self.app.scrollToBottom();
            }, 200);
          })["catch"](sweetError);
        },
        modifyNoteContent: function modifyNoteContent(n) {
          if (n.edit) {
            n.edit = false;
          } else {
            n.edit = true;
            if (!n._content) n._content = n.content;
          }
        },
        extendNoteContent: function extendNoteContent(note) {
          note.notes.map(function (n) {
            n.edit = false;
            n._content = "";
          });
        },
        saveNote: function saveNote(n) {
          // 保存编辑
          var note = this.note,
              uid = this.uid;
          var url,
              method,
              data = {};

          if (n.uid === uid) {
            url = "/note/".concat(note._id, "/c/").concat(n._id);
            method = "PATCH";
            data.content = n._content;
          } else {
            url = "/nkc/note";
            method = "POST";
            data.type = "modify";
            data.noteId = note._id;
            data.noteContentId = n._id;
            data.content = n._content;
          }

          nkcAPI(url, method, data).then(function (data) {
            n.content = n._content;
            n.html = data.noteContentHTML;
            self.app.modifyNoteContent(n);
            Vue.set(note.notes, note.notes.indexOf(n), n);
          })["catch"](sweetError);
        },
        open: function open(callback, options) {
          var _this = this;

          new Promise(function (resolve, reject) {
            self.app.resetDom();
            self.callback = callback;
            var id = options.id,
                note = options.note;

            if (note) {
              self.app.note = note;
              resolve();
            } else {
              nkcAPI("/note/".concat(id), "GET").then(function (data) {
                self.app.extendNoteContent(data.note);
                self.app.note = data.note;
                resolve();
              })["catch"](reject);
            }
          }).then(function () {
            _this.show = true;
            NKC.methods.initUnfixedPanel();
          })["catch"](sweetError);
        },
        close: function close() {
          this.show = false;
        },
        resetDom: function resetDom() {
          var dom = this.$el;
          dom.style.height = "auto";
        },
        scrollToBottom: function scrollToBottom() {
          var dom = this.$el.getElementsByClassName("note-panel-notes")[0];
          dom.scrollTop = dom.scrollHeight + 10000;
        },
        deleteNoteContent: function deleteNoteContent(n, type) {
          var note = this.note;
          var url,
              method,
              data = {};

          if (type === "delete") {
            url = "/note/".concat(note._id, "/c/").concat(n._id);
            method = "DELETE";
          } else {
            method = "POST";
            url = "/nkc/note";

            if (n.disabled) {
              data.type = "cancelDisable";
            } else {
              data.type = "disable";
            }

            data.noteId = note._id;
            data.noteContentId = n._id;
          }

          sweetQuestion("确定要执行此操作？").then(function () {
            return nkcAPI(url, method, data);
          }).then(function () {
            if (type === "delete") {
              n.deleted = true;
            } else {
              n.disabled = !n.disabled;
            }

            sweetSuccess("操作成功");
          })["catch"](sweetError);
        }
      }
    });
    self.open = self.app.open;
    self.close = self.app.close;

    self.isOpen = function () {
      return !!_this2.app.show;
    };
  }

  return _class;
}();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3B1YmxpY01vZHVsZXMvTktDSGlnaGxpZ2h0ZXIvbm90ZVBhbmVsLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNBQSxHQUFHLENBQUMsT0FBSixDQUFZLFNBQVo7QUFBQTtBQUFBO0FBQ0Usb0JBQWM7QUFBQTs7QUFBQTs7QUFDWixRQUFNLElBQUksR0FBRyxJQUFiO0FBQ0EsSUFBQSxJQUFJLENBQUMsR0FBTCxHQUFXLElBQUksR0FBSixDQUFRO0FBQ2pCLE1BQUEsRUFBRSxFQUFFLGtCQURhO0FBRWpCLE1BQUEsSUFBSSxFQUFFO0FBQ0osUUFBQSxHQUFHLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxHQURiO0FBRUosUUFBQSxrQkFBa0IsRUFBRSxLQUZoQjtBQUdKLFFBQUEsSUFBSSxFQUFFLEtBSEY7QUFJSixRQUFBLElBQUksRUFBRSxLQUpGO0FBS0o7QUFDQSxRQUFBLE9BQU8sRUFBRSxFQU5MO0FBT0o7QUFDQSxRQUFBLElBQUksRUFBRTtBQUNKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVRFLE9BRlc7QUErQmpCLE1BQUEsT0EvQmlCLHFCQStCUDtBQUNSLGFBQUssUUFBTDtBQUNELE9BakNnQjtBQWtDakIsTUFBQSxPQUFPLEVBQUU7QUFDUCxRQUFBLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLE9BRGQ7QUFFUCxRQUFBLE1BQU0sRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLEtBQVosQ0FBa0IsTUFGbkI7QUFHUCxRQUFBLFFBQVEsRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLFFBSGY7QUFJUCxRQUFBLGVBSk8sMkJBSVMsSUFKVCxFQUllO0FBQ3BCLGNBQU0sUUFBUSxHQUFHLEtBQUssR0FBTCxDQUFTLHNCQUFULENBQWdDLGlCQUFoQyxFQUFtRCxDQUFuRCxDQUFqQjtBQUNBLFVBQUEsUUFB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UUFBWixFQUFzQjtBQUNwQixjQUFBLENBQUMsQ0FBQyxPQUFGLEdBQVksSUFBWjtBQUNELGFBRkQsTUFFTztBQUNMLGNBQUEsQ0FBQyxDQUFDLFFBQUYsR0FBYSxDQUFDLENBQUMsQ0FBQyxRQUFoQjtBQUNEOztBQUNELFlBQUEsWUFBWSxDQUFDLE1BQUQsQ0FBWjtBQUNELFdBWEgsV0FZUyxVQVpUO0FBYUQ7QUF4Sk07QUFsQ1EsS0FBUixDQUFYO0FBNkxBLElBQUEsSUFBSSxDQUFDLElBQUwsR0FBWSxJQUFJLENBQUMsR0FBTCxDQUFTLElBQXJCO0FBQ0EsSUFBQSxJQUFJLENBQUMsS0FBTCxHQUFhLElBQUksQ0FBQyxHQUFMLENBQVMsS0FBdEI7O0FBQ0EsSUFBQSxJQUFJLENBQUMsTUFBTCxHQUFjLFlBQU07QUFDbEIsYUFBTyxDQUFDLENBQUMsTUFBSSxDQUFDLEdBQUwsQ0FBUyxJQUFsQjtBQUNELEtBRkQ7QUFHRDs7QUFyTUg7QUFBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIk5LQy5tb2R1bGVzLk5vdGVQYW5lbCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5hcHAgPSBuZXcgVnVlKHtcbiAgICAgIGVsOiBcIiNtb2R1bGVOb3RlUGFuZWxcIixcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdWlkOiBOS0MuY29uZmlncy51aWQsXG4gICAgICAgIGRpc2FibGVOb3RlQ29udGVudDogZmFsc2UsXG4gICAgICAgIHNob3c6IGZhbHNlLFxuICAgICAgICBlZGl0OiBmYWxzZSxcbiAgICAgICAgLy8g5paw5re75Yqg55qE56yU6K6w5YaF5a65XG4gICAgICAgIGNvbnRlbnQ6IFwiXCIsXG4gICAgICAgIC8vIOaYvuekuueslOiusFxuICAgICAgICBub3RlOiBcIlwiLFxuICAgICAgICAgIC8qIG5vdGXnmoTmlbDmja7nu5PmnoRcbiAgICAgICAgICB7XG4gICAgICAgICAgICBfaWQ6IE51bWJlcixcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICB0YXJnZXRJZCxcbiAgICAgICAgICAgIG5vdGVzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0b2M6IERhdGUsXG4gICAgICAgICAgICAgICAgdWlkOiBTdHJpbmcsXG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IFN0cmluZyxcbiAgICAgICAgICAgICAgICAgIGF2YXRhcjogU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgdWlkOiBTdHJpbmdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFN0cmluZ1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH1cbiAgICAgICAgICAqL1xuICAgICAgfSxcbiAgICAgIHVwZGF0ZWQoKSB7XG4gICAgICAgIHRoaXMucmVzZXREb20oKTtcbiAgICAgIH0sXG4gICAgICBtZXRob2RzOiB7XG4gICAgICAgIGZyb21Ob3c6IE5LQy5tZXRob2RzLmZyb21Ob3csXG4gICAgICAgIGdldFVybDogTktDLm1ldGhvZHMudG9vbHMuZ2V0VXJsLFxuICAgICAgICB2aXNpdFVybDogTktDLm1ldGhvZHMudmlzaXRVcmwsXG4gICAgICAgIHNldFRleHRhcmVhU2l6ZShzaXplKSB7XG4gICAgICAgICAgY29uc3QgdGV4dGFyZWEgPSB0aGlzLiRlbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY3JlYXRlLXRleHRhcmVhXCIpWzBdO1xuICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9IHNpemU7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc2V0VGV4dGFyZWEoKSB7XG4gICAgICAgICAgdGhpcy5jb250ZW50ID0gXCJcIjtcbiAgICAgICAgICB0aGlzLnNldFRleHRhcmVhU2l6ZShcIjIuNXJlbVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgYXV0b1Jlc2l6ZShlKSB7XG4gICAgICAgICAgY29uc3QgdGV4dEFyZWEgPSBlLnRhcmdldDtcbiAgICAgICAgICBjb25zdCBudW0gPSAyLjUgKiAxMjtcbiAgICAgICAgICB0ZXh0QXJlYS5zdHlsZS5oZWlnaHQgPSAnMi41cmVtJztcbiAgICAgICAgICBpZihudW0gPCB0ZXh0QXJlYS5zY3JvbGxIZWlnaHQpIHtcbiAgICAgICAgICAgIHRleHRBcmVhLnN0eWxlLmhlaWdodCA9IHRleHRBcmVhLnNjcm9sbEhlaWdodCArICdweCc7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzYXZlTmV3Tm90ZSgpIHtcbiAgICAgICAgICAvLyDliJvlu7rmlrDnmoRcbiAgICAgICAgICBjb25zdCB7Y29udGVudCwgbm90ZX0gPSB0aGlzO1xuICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIGlmKCFjb250ZW50KSB0aHJvdyBcIuivt+i+k+WFpeeslOiusOWGheWuuVwiO1xuICAgICAgICAgICAgICBjb25zdCB7dHlwZSwgdGFyZ2V0SWQsIG5vZGUsIF9pZH0gPSBub3RlO1xuICAgICAgICAgICAgICByZXR1cm4gbmtjQVBJKFwiL25vdGVcIiwgXCJQT1NUXCIsIHtcbiAgICAgICAgICAgICAgICBfaWQsXG4gICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICB0YXJnZXRJZCxcbiAgICAgICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgICAgIG5vZGVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgIHNlbGYuYXBwLmNvbnRlbnQgPSBcIlwiO1xuICAgICAgICAgICAgICBzZWxmLmFwcC5yZXNldFRleHRhcmVhKCk7XG4gICAgICAgICAgICAgIHNlbGYuYXBwLnJlc2V0RG9tKCk7XG4gICAgICAgICAgICAgIHNlbGYuY2FsbGJhY2soZGF0YS5ub3RlKTtcbiAgICAgICAgICAgICAgc2VsZi5hcHAuZXh0ZW5kTm90ZUNvbnRlbnQoZGF0YS5ub3RlKTtcbiAgICAgICAgICAgICAgc2VsZi5hcHAubm90ZSA9IGRhdGEubm90ZTtcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2VsZi5hcHAuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgICAgICAgICAgfSwgMjAwKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcbiAgICAgICAgfSxcbiAgICAgICAgbW9kaWZ5Tm90ZUNvbnRlbnQobikge1xuICAgICAgICAgIGlmKG4uZWRpdCkge1xuICAgICAgICAgICAgbi5lZGl0ID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG4uZWRpdCA9IHRydWU7XG4gICAgICAgICAgICBpZighbi5fY29udGVudCkgbi5fY29udGVudCA9IG4uY29udGVudDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGV4dGVuZE5vdGVDb250ZW50KG5vdGUpIHtcbiAgICAgICAgICBub3RlLm5vdGVzLm1hcChuID0+IHtcbiAgICAgICAgICAgIG4uZWRpdCA9IGZhbHNlO1xuICAgICAgICAgICAgbi5fY29udGVudCA9IFwiXCI7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNhdmVOb3RlKG4pIHtcbiAgICAgICAgICAvLyDkv53lrZjnvJbovpFcbiAgICAgICAgICBjb25zdCB7bm90ZSwgdWlkfSA9IHRoaXM7XG4gICAgICAgICAgbGV0IHVybCwgbWV0aG9kLCBkYXRhID0ge307XG4gICAgICAgICAgaWYobi51aWQgPT09IHVpZCkge1xuICAgICAgICAgICAgdXJsID0gYC9ub3RlLyR7bm90ZS5faWR9L2MvJHtuLl9pZH1gO1xuICAgICAgICAgICAgbWV0aG9kID0gXCJQQVRDSFwiO1xuICAgICAgICAgICAgZGF0YS5jb250ZW50ID0gbi5fY29udGVudDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdXJsID0gYC9ua2Mvbm90ZWA7XG4gICAgICAgICAgICBtZXRob2QgPSBcIlBPU1RcIjtcbiAgICAgICAgICAgIGRhdGEudHlwZSA9IFwibW9kaWZ5XCI7XG4gICAgICAgICAgICBkYXRhLm5vdGVJZCA9IG5vdGUuX2lkO1xuICAgICAgICAgICAgZGF0YS5ub3RlQ29udGVudElkID0gbi5faWQ7XG4gICAgICAgICAgICBkYXRhLmNvbnRlbnQgPSBuLl9jb250ZW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICBua2NBUEkodXJsLCBtZXRob2QsIGRhdGEpXG4gICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICBuLmNvbnRlbnQgPSBuLl9jb250ZW50O1xuICAgICAgICAgICAgICBuLmh0bWwgPSBkYXRhLm5vdGVDb250ZW50SFRNTDtcbiAgICAgICAgICAgICAgc2VsZi5hcHAubW9kaWZ5Tm90ZUNvbnRlbnQobik7XG4gICAgICAgICAgICAgIFZ1ZS5zZXQobm90ZS5ub3Rlcywgbm90ZS5ub3Rlcy5pbmRleE9mKG4pLCBuKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcik7XG4gICAgICAgIH0sXG4gICAgICAgIG9wZW4oY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBzZWxmLmFwcC5yZXNldERvbSgpO1xuICAgICAgICAgICAgc2VsZi5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgY29uc3Qge2lkLCBub3RlfSA9IG9wdGlvbnM7XG4gICAgICAgICAgICBpZihub3RlKSB7XG4gICAgICAgICAgICAgIHNlbGYuYXBwLm5vdGUgPSBub3RlO1xuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBua2NBUEkoYC9ub3RlLyR7aWR9YCwgXCJHRVRcIilcbiAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgICAgICAgICAgIHNlbGYuYXBwLmV4dGVuZE5vdGVDb250ZW50KGRhdGEubm90ZSk7XG4gICAgICAgICAgICAgICAgICBzZWxmLmFwcC5ub3RlID0gZGF0YS5ub3RlO1xuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKHJlamVjdClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnNob3cgPSB0cnVlO1xuICAgICAgICAgICAgICBOS0MubWV0aG9kcy5pbml0VW5maXhlZFBhbmVsKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xuICAgICAgICB9LFxuICAgICAgICBjbG9zZSgpIHtcbiAgICAgICAgICB0aGlzLnNob3cgPSBmYWxzZTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzZXREb20oKSB7XG4gICAgICAgICAgY29uc3QgZG9tID0gdGhpcy4kZWw7XG4gICAgICAgICAgZG9tLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgICAgICB9LFxuICAgICAgICBzY3JvbGxUb0JvdHRvbSgpIHtcbiAgICAgICAgICBjb25zdCBkb20gPSB0aGlzLiRlbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibm90ZS1wYW5lbC1ub3Rlc1wiKVswXTtcbiAgICAgICAgICBkb20uc2Nyb2xsVG9wID0gZG9tLnNjcm9sbEhlaWdodCArIDEwMDAwO1xuICAgICAgICB9LFxuICAgICAgICBkZWxldGVOb3RlQ29udGVudChuLCB0eXBlKSB7XG4gICAgICAgICAgY29uc3Qge25vdGV9ID0gdGhpcztcbiAgICAgICAgICBsZXQgdXJsLCBtZXRob2QsIGRhdGEgPSB7fTtcbiAgICAgICAgICBpZih0eXBlID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICB1cmwgPSBgL25vdGUvJHtub3RlLl9pZH0vYy8ke24uX2lkfWA7XG4gICAgICAgICAgICBtZXRob2QgPSBcIkRFTEVURVwiO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtZXRob2QgPSBcIlBPU1RcIjtcbiAgICAgICAgICAgIHVybCA9IGAvbmtjL25vdGVgO1xuICAgICAgICAgICAgaWYobi5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICBkYXRhLnR5cGUgPSBcImNhbmNlbERpc2FibGVcIjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRhdGEudHlwZSA9IFwiZGlzYWJsZVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGF0YS5ub3RlSWQgPSBub3RlLl9pZDtcbiAgICAgICAgICAgIGRhdGEubm90ZUNvbnRlbnRJZCA9IG4uX2lkO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzd2VldFF1ZXN0aW9uKFwi56Gu5a6a6KaB5omn6KGM5q2k5pON5L2c77yfXCIpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBua2NBUEkodXJsLCBtZXRob2QsIGRhdGEpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpZih0eXBlID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICAgICAgbi5kZWxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBuLmRpc2FibGVkID0gIW4uZGlzYWJsZWQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc3dlZXRTdWNjZXNzKFwi5pON5L2c5oiQ5YqfXCIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgc2VsZi5vcGVuID0gc2VsZi5hcHAub3BlbjtcbiAgICBzZWxmLmNsb3NlID0gc2VsZi5hcHAuY2xvc2U7XG4gICAgc2VsZi5pc09wZW4gPSAoKSA9PiB7XG4gICAgICByZXR1cm4gISF0aGlzLmFwcC5zaG93O1xuICAgIH1cbiAgfVxufTsiXX0=
