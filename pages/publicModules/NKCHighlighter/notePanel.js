(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

NKC.modules.NotePanel = /*#__PURE__*/function () {
  function _class() {
    var _this2 = this;

    _classCallCheck(this, _class);

    var self = this;
    self.app = new Vue({
      el: "#moduleNotePanel",
      data: {
        uid: NKC.configs.uid,
        disableNoteContent: false,
        show: false,
        edit: false,
        submitting: false,
        // 新添加的笔记内容
        content: "",
        // 显示笔记
        note: ""
        /* note的数据结构
        {
          _id: Number,
          type,
          targetId,
          notes: [
            {
              toc: Date,
              uid: String,
              user: {
                username: String,
                avatar: String,
                uid: String
              },
              content: String
            }
          ],
        }
        */

      },
      updated: function updated() {
        this.resetDom();
      },
      methods: {
        fromNow: NKC.methods.fromNow,
        getUrl: NKC.methods.tools.getUrl,
        visitUrl: NKC.methods.visitUrl,
        setTextareaSize: function setTextareaSize(size) {
          var textarea = this.$el.getElementsByClassName("create-textarea")[0];
          textarea.style.height = size;
        },
        resetTextarea: function resetTextarea() {
          this.content = "";
          this.setTextareaSize("2.5rem");
        },
        autoResize: function autoResize(e) {
          var textArea = e.target;
          var num = 2.5 * 12;
          textArea.style.height = '2.5rem';

          if (num < textArea.scrollHeight) {
            textArea.style.height = textArea.scrollHeight + 'px';
          }
        },
        saveNewNote: function saveNewNote() {
          // 创建新的
          var content = this.content,
              note = this.note;
          Promise.resolve().then(function () {
            if (!content) throw "请输入笔记内容";
            var type = note.type,
                targetId = note.targetId,
                node = note.node,
                _id = note._id;
            self.app.submitting = true;
            return nkcAPI("/note", "POST", {
              _id: _id,
              type: type,
              targetId: targetId,
              content: content,
              node: node
            });
          }).then(function (data) {
            self.app.content = "";
            self.app.resetTextarea();
            self.app.resetDom();
            self.callback(data.note);
            self.app.extendNoteContent(data.note);
            self.app.note = data.note;
            self.app.submitting = false;
            setTimeout(function () {
              self.app.scrollToBottom();
            }, 200);
          })["catch"](function (err) {
            sweetError(err);
            self.app.submitting = false;
          });
        },
        modifyNoteContent: function modifyNoteContent(n) {
          if (n.edit) {
            n.edit = false;
          } else {
            n.edit = true;
            if (!n._content) n._content = n.content;
          }
        },
        extendNoteContent: function extendNoteContent(note) {
          note.notes.map(function (n) {
            n.edit = false;
            n._content = "";
          });
        },
        saveNote: function saveNote(n) {
          // 保存编辑
          var note = this.note,
              uid = this.uid;
          var url,
              method,
              data = {};

          if (n.uid === uid) {
            url = "/note/".concat(note._id, "/c/").concat(n._id);
            method = "PATCH";
            data.content = n._content;
          } else {
            url = "/nkc/note";
            method = "POST";
            data.type = "modify";
            data.noteId = note._id;
            data.noteContentId = n._id;
            data.content = n._content;
          }

          nkcAPI(url, method, data).then(function (data) {
            n.content = n._content;
            n.html = data.noteContentHTML;
            self.app.modifyNoteContent(n);
            Vue.set(note.notes, note.notes.indexOf(n), n);
          })["catch"](sweetError);
        },
        open: function open(callback, options) {
          var _this = this;

          new Promise(function (resolve, reject) {
            self.app.resetDom();
            self.callback = callback;
            var id = options.id,
                note = options.note;

            if (note) {
              self.app.note = note;
              resolve();
            } else {
              nkcAPI("/note/".concat(id), "GET").then(function (data) {
                self.app.extendNoteContent(data.note);
                self.app.note = data.note;
                resolve();
              })["catch"](reject);
            }
          }).then(function () {
            _this.show = true;
            NKC.methods.initUnfixedPanel();
          })["catch"](sweetError);
        },
        close: function close() {
          this.show = false;
        },
        resetDom: function resetDom() {
          var dom = this.$el;
          dom.style.height = "auto";
        },
        scrollToBottom: function scrollToBottom() {
          var dom = this.$el.getElementsByClassName("note-panel-notes")[0];
          dom.scrollTop = dom.scrollHeight + 10000;
        },
        deleteNoteContent: function deleteNoteContent(n, type) {
          var note = this.note;
          var url,
              method,
              data = {};

          if (type === "delete") {
            url = "/note/".concat(note._id, "/c/").concat(n._id);
            method = "DELETE";
          } else {
            method = "POST";
            url = "/nkc/note";

            if (n.disabled) {
              data.type = "cancelDisable";
            } else {
              data.type = "disable";
            }

            data.noteId = note._id;
            data.noteContentId = n._id;
          }

          sweetQuestion("确定要执行此操作？").then(function () {
            return nkcAPI(url, method, data);
          }).then(function () {
            if (type === "delete") {
              n.deleted = true;
            } else {
              n.disabled = !n.disabled;
            }

            sweetSuccess("操作成功");
          })["catch"](sweetError);
        }
      }
    });
    self.open = self.app.open;
    self.close = self.app.close;

    self.isOpen = function () {
      return !!_this2.app.show;
    };
  }

  return _class;
}();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3B1YmxpY01vZHVsZXMvTktDSGlnaGxpZ2h0ZXIvbm90ZVBhbmVsLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNBQSxHQUFHLENBQUMsT0FBSixDQUFZLFNBQVo7QUFDRSxvQkFBYztBQUFBOztBQUFBOztBQUNaLFFBQU0sSUFBSSxHQUFHLElBQWI7QUFDQSxJQUFBLElBQUksQ0FBQyxHQUFMLEdBQVcsSUFBSSxHQUFKLENBQVE7QUFDakIsTUFBQSxFQUFFLEVBQUUsa0JBRGE7QUFFakIsTUFBQSxJQUFJLEVBQUU7QUFDSixRQUFBLEdBQUcsRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLEdBRGI7QUFFSixRQUFBLGtCQUFrQixFQUFFLEtBRmhCO0FBR0osUUFBQSxJQUFJLEVBQUUsS0FIRjtBQUlKLFFBQUEsSUFBSSxFQUFFLEtBSkY7QUFLSixRQUFBLFVBQVUsRUFBRSxLQUxSO0FBTUo7QUFDQSxRQUFBLE9BQU8sRUFBRSxFQVBMO0FBUUo7QUFDQSxRQUFBLElBQUksRUFBRTtBQUNKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVZFLE9BRlc7QUFnQ2pCLE1BQUEsT0FoQ2lCLHFCQWdDUDtBQUNSLGFBQUssUUFBTDtBQUNELE9BbENnQjtBQW1DakIsTUFBQSxPQUFPLEVBQUU7QUFDUCxRQUFBLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLE9BRGQ7QUFFUCxRQUFBLE1BQU0sRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLEtBQVosQ0FBa0IsTUFGbkI7QUFHUCxRQUFBLFFBQVEsRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLFFBSGY7QUFJUCxRQUFBLGVBSk8sMkJBSVMsSUFKVCxFQUllO0FBQ3BCLGNBQU0sUUFBUSxHQUFHLEtBQUssR0FBTCxDQUFTLHNCQUFULENBQWdDLGlCQUFoQyxFQUFtRCxDQUFuRCxDQUFq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O0FBQ0EsWUFBQSxJQUFJLENBQUMsYUFBTCxHQUFxQixDQUFDLENBQUMsR0FBdkI7QUFDRDs7QUFDRCxVQUFBLGFBQWEsQ0FBQyxXQUFELENBQWIsQ0FDRyxJQURILENBQ1EsWUFBTTtBQUNWLG1CQUFPLE1BQU0sQ0FBQyxHQUFELEVBQU0sTUFBTixFQUFjLElBQWQsQ0FBYjtBQUNELFdBSEgsRUFJRyxJQUpILENBSVEsWUFBVztBQUNmLGdCQUFHLElBQUksS0FBSyxRQUFaLEVBQXNCO0FBQ3BCLGNBQUEsQ0FBQyxDQUFDLE9BQUYsR0FBWSxJQUFaO0FBQ0QsYUFGRCxNQUVPO0FBQ0wsY0FBQSxDQUFDLENBQUMsUUFBRixHQUFhLENBQUMsQ0FBQyxDQUFDLFFBQWhCO0FBQ0Q7O0FBQ0QsWUFBQSxZQUFZLENBQUMsTUFBRCxDQUFaO0FBQ0QsV0FYSCxXQVlTLFVBWlQ7QUFhRDtBQTdKTTtBQW5DUSxLQUFSLENBQVg7QUFtTUEsSUFBQSxJQUFJLENBQUMsSUFBTCxHQUFZLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBckI7QUFDQSxJQUFBLElBQUksQ0FBQyxLQUFMLEdBQWEsSUFBSSxDQUFDLEdBQUwsQ0FBUyxLQUF0Qjs7QUFDQSxJQUFBLElBQUksQ0FBQyxNQUFMLEdBQWMsWUFBTTtBQUNsQixhQUFPLENBQUMsQ0FBQyxNQUFJLENBQUMsR0FBTCxDQUFTLElBQWxCO0FBQ0QsS0FGRDtBQUdEOztBQTNNSDtBQUFBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiTktDLm1vZHVsZXMuTm90ZVBhbmVsID0gY2xhc3Mge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLmFwcCA9IG5ldyBWdWUoe1xyXG4gICAgICBlbDogXCIjbW9kdWxlTm90ZVBhbmVsXCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB1aWQ6IE5LQy5jb25maWdzLnVpZCxcclxuICAgICAgICBkaXNhYmxlTm90ZUNvbnRlbnQ6IGZhbHNlLFxyXG4gICAgICAgIHNob3c6IGZhbHNlLFxyXG4gICAgICAgIGVkaXQ6IGZhbHNlLFxyXG4gICAgICAgIHN1Ym1pdHRpbmc6IGZhbHNlLFxyXG4gICAgICAgIC8vIOaWsOa3u+WKoOeahOeslOiusOWGheWuuVxyXG4gICAgICAgIGNvbnRlbnQ6IFwiXCIsXHJcbiAgICAgICAgLy8g5pi+56S656yU6K6wXHJcbiAgICAgICAgbm90ZTogXCJcIixcclxuICAgICAgICAgIC8qIG5vdGXnmoTmlbDmja7nu5PmnoRcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgX2lkOiBOdW1iZXIsXHJcbiAgICAgICAgICAgIHR5cGUsXHJcbiAgICAgICAgICAgIHRhcmdldElkLFxyXG4gICAgICAgICAgICBub3RlczogW1xyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRvYzogRGF0ZSxcclxuICAgICAgICAgICAgICAgIHVpZDogU3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgICAgICAgICB1c2VybmFtZTogU3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICBhdmF0YXI6IFN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgdWlkOiBTdHJpbmdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBTdHJpbmdcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAqL1xyXG4gICAgICB9LFxyXG4gICAgICB1cGRhdGVkKCkge1xyXG4gICAgICAgIHRoaXMucmVzZXREb20oKTtcclxuICAgICAgfSxcclxuICAgICAgbWV0aG9kczoge1xyXG4gICAgICAgIGZyb21Ob3c6IE5LQy5tZXRob2RzLmZyb21Ob3csXHJcbiAgICAgICAgZ2V0VXJsOiBOS0MubWV0aG9kcy50b29scy5nZXRVcmwsXHJcbiAgICAgICAgdmlzaXRVcmw6IE5LQy5tZXRob2RzLnZpc2l0VXJsLFxyXG4gICAgICAgIHNldFRleHRhcmVhU2l6ZShzaXplKSB7XHJcbiAgICAgICAgICBjb25zdCB0ZXh0YXJlYSA9IHRoaXMuJGVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJjcmVhdGUtdGV4dGFyZWFcIilbMF07XHJcbiAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSBzaXplO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzZXRUZXh0YXJlYSgpIHtcclxuICAgICAgICAgIHRoaXMuY29udGVudCA9IFwiXCI7XHJcbiAgICAgICAgICB0aGlzLnNldFRleHRhcmVhU2l6ZShcIjIuNXJlbVwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGF1dG9SZXNpemUoZSkge1xyXG4gICAgICAgICAgY29uc3QgdGV4dEFyZWEgPSBlLnRhcmdldDtcclxuICAgICAgICAgIGNvbnN0IG51bSA9IDIuNSAqIDEyO1xyXG4gICAgICAgICAgdGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gJzIuNXJlbSc7XHJcbiAgICAgICAgICBpZihudW0gPCB0ZXh0QXJlYS5zY3JvbGxIZWlnaHQpIHtcclxuICAgICAgICAgICAgdGV4dEFyZWEuc3R5bGUuaGVpZ2h0ID0gdGV4dEFyZWEuc2Nyb2xsSGVpZ2h0ICsgJ3B4JztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHNhdmVOZXdOb3RlKCkge1xyXG4gICAgICAgICAgLy8g5Yib5bu65paw55qEXHJcbiAgICAgICAgICBjb25zdCB7Y29udGVudCwgbm90ZX0gPSB0aGlzO1xyXG4gICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKClcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmKCFjb250ZW50KSB0aHJvdyBcIuivt+i+k+WFpeeslOiusOWGheWuuVwiO1xyXG4gICAgICAgICAgICAgIGNvbnN0IHt0eXBlLCB0YXJnZXRJZCwgbm9kZSwgX2lkfSA9IG5vdGU7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAuc3VibWl0dGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG5rY0FQSShcIi9ub3RlXCIsIFwiUE9TVFwiLCB7XHJcbiAgICAgICAgICAgICAgICBfaWQsXHJcbiAgICAgICAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0SWQsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50LFxyXG4gICAgICAgICAgICAgICAgbm9kZVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICBzZWxmLmFwcC5jb250ZW50ID0gXCJcIjtcclxuICAgICAgICAgICAgICBzZWxmLmFwcC5yZXNldFRleHRhcmVhKCk7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAucmVzZXREb20oKTtcclxuICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrKGRhdGEubm90ZSk7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAuZXh0ZW5kTm90ZUNvbnRlbnQoZGF0YS5ub3RlKTtcclxuICAgICAgICAgICAgICBzZWxmLmFwcC5ub3RlID0gZGF0YS5ub3RlO1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLnN1Ym1pdHRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHNlbGYuYXBwLnNjcm9sbFRvQm90dG9tKCk7XHJcbiAgICAgICAgICAgICAgfSwgMjAwKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgICAgICBzd2VldEVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAuc3VibWl0dGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1vZGlmeU5vdGVDb250ZW50KG4pIHtcclxuICAgICAgICAgIGlmKG4uZWRpdCkge1xyXG4gICAgICAgICAgICBuLmVkaXQgPSBmYWxzZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG4uZWRpdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmKCFuLl9jb250ZW50KSBuLl9jb250ZW50ID0gbi5jb250ZW50O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXh0ZW5kTm90ZUNvbnRlbnQobm90ZSkge1xyXG4gICAgICAgICAgbm90ZS5ub3Rlcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIG4uZWRpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBuLl9jb250ZW50ID0gXCJcIjtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2F2ZU5vdGUobikge1xyXG4gICAgICAgICAgLy8g5L+d5a2Y57yW6L6RXHJcbiAgICAgICAgICBjb25zdCB7bm90ZSwgdWlkfSA9IHRoaXM7XHJcbiAgICAgICAgICBsZXQgdXJsLCBtZXRob2QsIGRhdGEgPSB7fTtcclxuICAgICAgICAgIGlmKG4udWlkID09PSB1aWQpIHtcclxuICAgICAgICAgICAgdXJsID0gYC9ub3RlLyR7bm90ZS5faWR9L2MvJHtuLl9pZH1gO1xyXG4gICAgICAgICAgICBtZXRob2QgPSBcIlBBVENIXCI7XHJcbiAgICAgICAgICAgIGRhdGEuY29udGVudCA9IG4uX2NvbnRlbnQ7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB1cmwgPSBgL25rYy9ub3RlYDtcclxuICAgICAgICAgICAgbWV0aG9kID0gXCJQT1NUXCI7XHJcbiAgICAgICAgICAgIGRhdGEudHlwZSA9IFwibW9kaWZ5XCI7XHJcbiAgICAgICAgICAgIGRhdGEubm90ZUlkID0gbm90ZS5faWQ7XHJcbiAgICAgICAgICAgIGRhdGEubm90ZUNvbnRlbnRJZCA9IG4uX2lkO1xyXG4gICAgICAgICAgICBkYXRhLmNvbnRlbnQgPSBuLl9jb250ZW50O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgbmtjQVBJKHVybCwgbWV0aG9kLCBkYXRhKVxyXG4gICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgIG4uY29udGVudCA9IG4uX2NvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgbi5odG1sID0gZGF0YS5ub3RlQ29udGVudEhUTUw7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAubW9kaWZ5Tm90ZUNvbnRlbnQobik7XHJcbiAgICAgICAgICAgICAgVnVlLnNldChub3RlLm5vdGVzLCBub3RlLm5vdGVzLmluZGV4T2YobiksIG4pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBvcGVuKGNhbGxiYWNrLCBvcHRpb25zKSB7XHJcbiAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHNlbGYuYXBwLnJlc2V0RG9tKCk7XHJcbiAgICAgICAgICAgIHNlbGYuY2FsbGJhY2sgPSBjYWxsYmFjaztcclxuICAgICAgICAgICAgY29uc3Qge2lkLCBub3RlfSA9IG9wdGlvbnM7XHJcbiAgICAgICAgICAgIGlmKG5vdGUpIHtcclxuICAgICAgICAgICAgICBzZWxmLmFwcC5ub3RlID0gbm90ZTtcclxuICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgbmtjQVBJKGAvbm90ZS8ke2lkfWAsIFwiR0VUXCIpXHJcbiAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgc2VsZi5hcHAuZXh0ZW5kTm90ZUNvbnRlbnQoZGF0YS5ub3RlKTtcclxuICAgICAgICAgICAgICAgICAgc2VsZi5hcHAubm90ZSA9IGRhdGEubm90ZTtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChyZWplY3QpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIE5LQy5tZXRob2RzLmluaXRVbmZpeGVkUGFuZWwoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY2xvc2UoKSB7XHJcbiAgICAgICAgICB0aGlzLnNob3cgPSBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc2V0RG9tKCkge1xyXG4gICAgICAgICAgY29uc3QgZG9tID0gdGhpcy4kZWw7XHJcbiAgICAgICAgICBkb20uc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzY3JvbGxUb0JvdHRvbSgpIHtcclxuICAgICAgICAgIGNvbnN0IGRvbSA9IHRoaXMuJGVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJub3RlLXBhbmVsLW5vdGVzXCIpWzBdO1xyXG4gICAgICAgICAgZG9tLnNjcm9sbFRvcCA9IGRvbS5zY3JvbGxIZWlnaHQgKyAxMDAwMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRlbGV0ZU5vdGVDb250ZW50KG4sIHR5cGUpIHtcclxuICAgICAgICAgIGNvbnN0IHtub3RlfSA9IHRoaXM7XHJcbiAgICAgICAgICBsZXQgdXJsLCBtZXRob2QsIGRhdGEgPSB7fTtcclxuICAgICAgICAgIGlmKHR5cGUgPT09IFwiZGVsZXRlXCIpIHtcclxuICAgICAgICAgICAgdXJsID0gYC9ub3RlLyR7bm90ZS5faWR9L2MvJHtuLl9pZH1gO1xyXG4gICAgICAgICAgICBtZXRob2QgPSBcIkRFTEVURVwiO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbWV0aG9kID0gXCJQT1NUXCI7XHJcbiAgICAgICAgICAgIHVybCA9IGAvbmtjL25vdGVgO1xyXG4gICAgICAgICAgICBpZihuLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgZGF0YS50eXBlID0gXCJjYW5jZWxEaXNhYmxlXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZGF0YS50eXBlID0gXCJkaXNhYmxlXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGF0YS5ub3RlSWQgPSBub3RlLl9pZDtcclxuICAgICAgICAgICAgZGF0YS5ub3RlQ29udGVudElkID0gbi5faWQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzd2VldFF1ZXN0aW9uKFwi56Gu5a6a6KaB5omn6KGM5q2k5pON5L2c77yfXCIpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gbmtjQVBJKHVybCwgbWV0aG9kLCBkYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgaWYodHlwZSA9PT0gXCJkZWxldGVcIikge1xyXG4gICAgICAgICAgICAgICAgbi5kZWxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbi5kaXNhYmxlZCA9ICFuLmRpc2FibGVkO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBzd2VldFN1Y2Nlc3MoXCLmk43kvZzmiJDlip9cIik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBzZWxmLm9wZW4gPSBzZWxmLmFwcC5vcGVuO1xyXG4gICAgc2VsZi5jbG9zZSA9IHNlbGYuYXBwLmNsb3NlO1xyXG4gICAgc2VsZi5pc09wZW4gPSAoKSA9PiB7XHJcbiAgICAgIHJldHVybiAhIXRoaXMuYXBwLnNob3c7XHJcbiAgICB9XHJcbiAgfVxyXG59OyJdfQ==
