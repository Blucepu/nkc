(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

NKC.modules.SelectDraft =
/*#__PURE__*/
function () {
  function _class() {
    _classCallCheck(this, _class);

    var self = this;
    self.dom = $("#moduleSelectDraft");
    self.app = new Vue({
      el: "#moduleSelectDraftApp",
      data: {
        uid: NKC.configs.uid,
        paging: {},
        perpage: 7,
        loading: true,
        drafts: []
      },
      methods: {
        fromNow: NKC.methods.fromNow,
        initDom: function initDom() {
          var height = "43.5rem";
          self.dom.css({
            height: height
          });
          self.dom.draggable({
            scroll: false,
            handle: ".module-sd-title",
            drag: function drag(event, ui) {
              if (ui.position.top < 0) ui.position.top = 0;
              var height = $(window).height();
              if (ui.position.top > height - 30) ui.position.top = height - 30;
              var width = self.dom.width();
              if (ui.position.left < 100 - width) ui.position.left = 100 - width;
              var winWidth = $(window).width();
              if (ui.position.left > winWidth - 100) ui.position.left = winWidth - 100;
            }
          });
          var width = $(window).width();

          if (width < 700) {
            // 小屏幕
            self.dom.css({
              "width": width * 0.8,
              "top": 0,
              "right": 0
            });
          } else {
            // 宽屏
            self.dom.css("left", (width - self.dom.width()) * 0.5 - 20);
          }

          self.dom.show();
        },
        getDraftInfo: function getDraftInfo(draft) {
          var type = draft.type,
              thread = draft.thread,
              forum = draft.forum;
          var info = "";

          if (type === "newThread") {
            info = "\u53D1\u8868\u6587\u7AE0";
          } else if (type === "newPost") {
            info = "\u5728\u6587\u7AE0\u300A".concat(thread.title, "\u300B\u4E0B\u53D1\u8868\u56DE\u590D");
          } else if (type === "modifyPost") {
            info = "\u4FEE\u6539\u6587\u7AE0\u300A".concat(thread.title, "\u300B\u4E0B\u7684\u56DE\u590D");
          } else if (type === "modifyThread") {
            info = "\u4FEE\u6539\u6587\u7AE0\u300A".concat(thread.title, "\u300B");
          } else {
            info = "\u4FEE\u6539\u4E13\u4E1A\u300A".concat(forum.title, "\u300B\u7684\u4E13\u4E1A\u8BF4\u660E");
          }

          return info;
        },
        insert: function insert(data) {
          var content = NKC.methods.ueditor.setContent(data.content);
          self.callback({
            content: content
          });
          data.delay = 3;

          var func = function func() {
            setTimeout(function () {
              data.delay--;

              if (data.delay > 0) {
                func();
              }
            }, 1000);
          };

          func();
        },
        removeDraft: function removeDraft(draft) {
          var _this = this;

          sweetQuestion("确定要删除草稿吗？").then(function () {
            nkcAPI('/u/' + _this.uid + "/drafts/" + draft.did, "DELETE").then(function () {
              self.app.getDrafts(self.app.paging.page);
            })["catch"](function (data) {
              sweetError(data);
            });
          });
        },
        getDrafts: function getDrafts() {
          var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
          nkcAPI("/u/".concat(this.uid, "/profile/draft?page=").concat(page, "&perpage=").concat(this.perpage), "GET").then(function (data) {
            data.drafts.map(function (d) {
              d.delay = 0;
            });
            self.app.drafts = data.drafts;
            self.app.paging = data.paging;
            self.app.loading = false;
          })["catch"](sweetError);
        },
        loadDraft: function loadDraft(d) {
          sweetQuestion("\u7EE7\u7EED\u521B\u4F5C\u5C06\u4F1A\u8986\u76D6\u7F16\u8F91\u5668\u4E2D\u5168\u90E8\u5185\u5BB9\uFF0C\u786E\u5B9A\u7EE7\u7EED\uFF1F").then(function () {
            if (window.PostInfo && window.PostInfo.showCloseInfo) {
              window.PostInfo.showCloseInfo = false;
            }

            window.location.href = "/editor?type=redit&id=".concat(d.did);
          })["catch"](sweetError);
        },
        refresh: function refresh() {
          this.getDrafts(self.app.paging.page);
        },
        open: function open(callback) {
          self.callback = callback;
          this.initDom();
          this.getDrafts();
        },
        close: function close() {
          self.dom.hide();
        }
      }
    });
    self.open = self.app.open;
    self.close = self.app.close;
  }

  return _class;
}();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3B1YmxpY01vZHVsZXMvc2VsZWN0RHJhZnQvc2VsZWN0RHJhZnQubWpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0FBLEdBQUcsQ0FBQyxPQUFKLENBQVksV0FBWjtBQUFBO0FBQUE7QUFDRSxvQkFBYztBQUFBOztBQUNaLFFBQU0sSUFBSSxHQUFHLElBQWI7QUFDQSxJQUFBLElBQUksQ0FBQyxHQUFMLEdBQVcsQ0FBQyxDQUFDLG9CQUFELENBQVo7QUFDQSxJQUFBLElBQUksQ0FBQyxHQUFMLEdBQVcsSUFBSSxHQUFKLENBQVE7QUFDakIsTUFBQSxFQUFFLEVBQUUsdUJBRGE7QUFFakIsTUFBQSxJQUFJLEVBQUU7QUFDSixRQUFBLEdBQUcsRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLEdBRGI7QUFFSixRQUFBLE1BQU0sRUFBRSxFQUZKO0FBR0osUUFBQSxPQUFPLEVBQUUsQ0FITDtBQUlKLFFBQUEsT0FBTyxFQUFFLElBSkw7QUFLSixRQUFBLE1BQU0sRUFBRTtBQUxKLE9BRlc7QUFTakIsTUFBQSxPQUFPLEVBQUU7QUFDUCxRQUFBLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLE9BRGQ7QUFFUCxRQUFBLE9BRk8scUJBRUc7QUFDUixjQUFNLE1BQU0sR0FBRyxTQUFmO0FBQ0EsVUFBQSxJQUFJLENBQUMsR0FBTCxDQUFTLEdBQVQsQ0FBYTtBQUNYLFlBQUEsTUFBTSxFQUFOO0FBRFcsV0FBYjtBQUdBLFVBQUEsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULENBQW1CO0FBQ2pCLFlBQUEsTUFBTSxFQUFFLEtBRFM7QUFFakIsWUFBQSxNQUFNLEVBQUUsa0JBRlM7QUFHakIsWUFBQSxJQUFJLEVBQUUsY0FBUyxLQUFULEVBQWdCLEVBQWhCLEVBQW9CO0FBQ3hCLGtCQUFHLEVBQUUsQ0FBQyxRQUFILENBQVks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QUFDQSxZQUFBLElBQUksQ0FBQyxHQUFMLENBQVMsT0FBVCxHQUFtQixLQUFuQjtBQUNELFdBUkgsV0FTUyxVQVRUO0FBVUQsU0F2Rk07QUF3RlAsUUFBQSxTQXhGTyxxQkF3RkcsQ0F4RkgsRUF3Rk07QUFDWCxVQUFBLGFBQWEsd0lBQWIsQ0FDRyxJQURILENBQ1EsWUFBTTtBQUNWLGdCQUFHLE1BQU0sQ0FBQyxRQUFQLElBQW1CLE1BQU0sQ0FBQyxRQUFQLENBQWdCLGFBQXRDLEVBQXFEO0FBQ25ELGNBQUEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsYUFBaEIsR0FBZ0MsS0FBaEM7QUFDRDs7QUFDRCxZQUFBLE1BQU0sQ0FBQyxRQUFQLENBQWdCLElBQWhCLG1DQUFnRCxDQUFDLENBQUMsR0FBbEQ7QUFDRCxXQU5ILFdBT1MsVUFQVDtBQVFELFNBakdNO0FBa0dQLFFBQUEsT0FsR08scUJBa0dHO0FBQ1IsZUFBSyxTQUFMLENBQWUsSUFBSSxDQUFDLEdBQUwsQ0FBUyxNQUFULENBQWdCLElBQS9CO0FBQ0QsU0FwR007QUFxR1AsUUFBQSxJQXJHTyxnQkFxR0YsUUFyR0UsRUFxR1E7QUFDYixVQUFBLElBQUksQ0FBQyxRQUFMLEdBQWdCLFFBQWhCO0FBQ0EsZUFBSyxPQUFMO0FBQ0EsZUFBSyxTQUFMO0FBQ0QsU0F6R007QUEwR1AsUUFBQSxLQTFHTyxtQkEwR0M7QUFDTixVQUFBLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBVDtBQUNEO0FBNUdNO0FBVFEsS0FBUixDQUFYO0FBd0hBLElBQUEsSUFBSSxDQUFDLElBQUwsR0FBWSxJQUFJLENBQUMsR0FBTCxDQUFTLElBQXJCO0FBQ0EsSUFBQSxJQUFJLENBQUMsS0FBTCxHQUFhLElBQUksQ0FBQyxHQUFMLENBQVMsS0FBdEI7QUFDRDs7QUE5SEg7QUFBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIk5LQy5tb2R1bGVzLlNlbGVjdERyYWZ0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBzZWxmLmRvbSA9ICQoXCIjbW9kdWxlU2VsZWN0RHJhZnRcIik7XG4gICAgc2VsZi5hcHAgPSBuZXcgVnVlKHtcbiAgICAgIGVsOiBcIiNtb2R1bGVTZWxlY3REcmFmdEFwcFwiLFxuICAgICAgZGF0YToge1xuICAgICAgICB1aWQ6IE5LQy5jb25maWdzLnVpZCxcbiAgICAgICAgcGFnaW5nOiB7fSxcbiAgICAgICAgcGVycGFnZTogNyxcbiAgICAgICAgbG9hZGluZzogdHJ1ZSxcbiAgICAgICAgZHJhZnRzOiBbXVxuICAgICAgfSxcbiAgICAgIG1ldGhvZHM6IHtcbiAgICAgICAgZnJvbU5vdzogTktDLm1ldGhvZHMuZnJvbU5vdyxcbiAgICAgICAgaW5pdERvbSgpIHtcbiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBcIjQzLjVyZW1cIjtcbiAgICAgICAgICBzZWxmLmRvbS5jc3Moe1xuICAgICAgICAgICAgaGVpZ2h0XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc2VsZi5kb20uZHJhZ2dhYmxlKHtcbiAgICAgICAgICAgIHNjcm9sbDogZmFsc2UsXG4gICAgICAgICAgICBoYW5kbGU6IFwiLm1vZHVsZS1zZC10aXRsZVwiLFxuICAgICAgICAgICAgZHJhZzogZnVuY3Rpb24oZXZlbnQsIHVpKSB7XG4gICAgICAgICAgICAgIGlmKHVpLnBvc2l0aW9uLnRvcCA8IDApIHVpLnBvc2l0aW9uLnRvcCA9IDA7XG4gICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgaWYodWkucG9zaXRpb24udG9wID4gaGVpZ2h0IC0gMzApIHVpLnBvc2l0aW9uLnRvcCA9IGhlaWdodCAtIDMwO1xuICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHNlbGYuZG9tLndpZHRoKCk7XG4gICAgICAgICAgICAgIGlmKHVpLnBvc2l0aW9uLmxlZnQgPCAxMDAgLSB3aWR0aCkgdWkucG9zaXRpb24ubGVmdCA9IDEwMCAtIHdpZHRoO1xuICAgICAgICAgICAgICBjb25zdCB3aW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuICAgICAgICAgICAgICBpZih1aS5wb3NpdGlvbi5sZWZ0ID4gd2luV2lkdGggLSAxMDApIHVpLnBvc2l0aW9uLmxlZnQgPSB3aW5XaWR0aCAtIDEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCB3aWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuICAgICAgICAgIGlmKHdpZHRoIDwgNzAwKSB7XG4gICAgICAgICAgICAvLyDlsI/lsY/luZVcbiAgICAgICAgICAgIHNlbGYuZG9tLmNzcyh7XG4gICAgICAgICAgICAgIFwid2lkdGhcIjogd2lkdGggKiAwLjgsXG4gICAgICAgICAgICAgIFwidG9wXCI6IDAsXG4gICAgICAgICAgICAgIFwicmlnaHRcIjogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIOWuveWxj1xuICAgICAgICAgICAgc2VsZi5kb20uY3NzKFwibGVmdFwiLCAod2lkdGggLSBzZWxmLmRvbS53aWR0aCgpKSowLjUgLSAyMCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlbGYuZG9tLnNob3coKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0RHJhZnRJbmZvKGRyYWZ0KSB7XG4gICAgICAgICAgY29uc3Qge3R5cGUsIHRocmVhZCwgZm9ydW19ID0gZHJhZnQ7XG4gICAgICAgICAgbGV0IGluZm8gPSBcIlwiO1xuICAgICAgICAgIGlmKHR5cGUgPT09IFwibmV3VGhyZWFkXCIpIHtcbiAgICAgICAgICAgIGluZm8gPSBg5Y+R6KGo5paH56ugYDtcbiAgICAgICAgICB9IGVsc2UgaWYodHlwZSA9PT0gXCJuZXdQb3N0XCIpIHtcbiAgICAgICAgICAgIGluZm8gPSBg5Zyo5paH56ug44CKJHt0aHJlYWQudGl0bGV944CL5LiL5Y+R6KGo5Zue5aSNYDtcbiAgICAgICAgICB9IGVsc2UgaWYodHlwZSA9PT0gXCJtb2RpZnlQb3N0XCIpIHtcbiAgICAgICAgICAgIGluZm8gPSBg5L+u5pS55paH56ug44CKJHt0aHJlYWQudGl0bGV944CL5LiL55qE5Zue5aSNYDtcbiAgICAgICAgICB9IGVsc2UgaWYodHlwZSA9PT0gXCJtb2RpZnlUaHJlYWRcIikge1xuICAgICAgICAgICAgaW5mbyA9IGDkv67mlLnmlofnq6DjgIoke3RocmVhZC50aXRsZX3jgItgO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbmZvID0gYOS/ruaUueS4k+S4muOAiiR7Zm9ydW0udGl0bGV944CL55qE5LiT5Lia6K+05piOYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGluZm87XG4gICAgICAgIH0sXG4gICAgICAgIGluc2VydChkYXRhKSB7XG4gICAgICAgICAgdmFyIGNvbnRlbnQgPSBOS0MubWV0aG9kcy51ZWRpdG9yLnNldENvbnRlbnQoZGF0YS5jb250ZW50KTtcbiAgICAgICAgICBzZWxmLmNhbGxiYWNrKHtjb250ZW50OmNvbnRlbnR9KTtcbiAgICAgICAgICBkYXRhLmRlbGF5ID0gMztcbiAgICAgICAgICBjb25zdCBmdW5jID0gKCkgPT4ge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIGRhdGEuZGVsYXkgLS07XG4gICAgICAgICAgICAgIGlmKGRhdGEuZGVsYXkgPiAwKSB7XG4gICAgICAgICAgICAgICAgZnVuYygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZnVuYygpO1xuICAgICAgICB9LFxuICAgICAgICByZW1vdmVEcmFmdChkcmFmdCkge1xuICAgICAgICAgIHN3ZWV0UXVlc3Rpb24oXCLnoa7lrpropoHliKDpmaTojYnnqL/lkJfvvJ9cIilcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgbmtjQVBJKCcvdS8nICsgdGhpcy51aWQgKyBcIi9kcmFmdHMvXCIgKyBkcmFmdC5kaWQsIFwiREVMRVRFXCIpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICBzZWxmLmFwcC5nZXREcmFmdHMoc2VsZi5hcHAucGFnaW5nLnBhZ2UpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgIHN3ZWV0RXJyb3IoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGdldERyYWZ0cyhwYWdlID0gMCkge1xuICAgICAgICAgIG5rY0FQSShgL3UvJHt0aGlzLnVpZH0vcHJvZmlsZS9kcmFmdD9wYWdlPSR7cGFnZX0mcGVycGFnZT0ke3RoaXMucGVycGFnZX1gLCBcIkdFVFwiKVxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgIGRhdGEuZHJhZnRzLm1hcChkID0+IHtcbiAgICAgICAgICAgICAgICBkLmRlbGF5ID0gMDtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHNlbGYuYXBwLmRyYWZ0cyA9IGRhdGEuZHJhZnRzO1xuICAgICAgICAgICAgICBzZWxmLmFwcC5wYWdpbmcgPSBkYXRhLnBhZ2luZztcbiAgICAgICAgICAgICAgc2VsZi5hcHAubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcbiAgICAgICAgfSxcbiAgICAgICAgbG9hZERyYWZ0KGQpIHtcbiAgICAgICAgICBzd2VldFF1ZXN0aW9uKGDnu6fnu63liJvkvZzlsIbkvJropobnm5bnvJbovpHlmajkuK3lhajpg6jlhoXlrrnvvIznoa7lrprnu6fnu63vvJ9gKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBpZih3aW5kb3cuUG9zdEluZm8gJiYgd2luZG93LlBvc3RJbmZvLnNob3dDbG9zZUluZm8pIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuUG9zdEluZm8uc2hvd0Nsb3NlSW5mbyA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYC9lZGl0b3I/dHlwZT1yZWRpdCZpZD0ke2QuZGlkfWA7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xuICAgICAgICB9LFxuICAgICAgICByZWZyZXNoKCkge1xuICAgICAgICAgIHRoaXMuZ2V0RHJhZnRzKHNlbGYuYXBwLnBhZ2luZy5wYWdlKTtcbiAgICAgICAgfSxcbiAgICAgICAgb3BlbihjYWxsYmFjaykge1xuICAgICAgICAgIHNlbGYuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgICB0aGlzLmluaXREb20oKTtcbiAgICAgICAgICB0aGlzLmdldERyYWZ0cygpO1xuICAgICAgICB9LFxuICAgICAgICBjbG9zZSgpIHtcbiAgICAgICAgICBzZWxmLmRvbS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLm9wZW4gPSBzZWxmLmFwcC5vcGVuO1xuICAgIHNlbGYuY2xvc2UgPSBzZWxmLmFwcC5jbG9zZTtcbiAgfVxufTsiXX0=
