(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var StickerViewer = function StickerViewer() {
  _classCallCheck(this, StickerViewer);

  var self = this;
  self.dom = $("#moduleStickerViewer");
  self.dom.modal({
    show: false
  });
  self.app = new Vue({
    el: "#moduleStickerViewerApp",
    data: {
      sticker: "",
      uid: NKC.configs.uid,
      management: false,
      loading: false
    },
    mounted: function mounted() {
      this.init();
    },
    methods: {
      getUrl: NKC.methods.tools.getUrl,
      fromNow: NKC.methods.fromNow,
      collection: function collection() {
        nkcAPI("/sticker", "POST", {
          type: "collection",
          stickersId: [this.sticker._id]
        }).then(function () {
          self.app.close();
          sweetSuccess("表情已添加");
        })["catch"](sweetError);
      },
      moveSticker: function moveSticker() {
        var sticker = this.sticker;
        var body = {
          type: "move",
          stickersId: [sticker.collected._id]
        };
        nkcAPI("/sticker", "POST", body).then(function () {
          self.app.close();
          window.location.reload();
        })["catch"](sweetError);
      },
      shareSticker: function shareSticker() {
        var sticker = this.sticker;
        var body = {
          type: "share",
          stickersId: [sticker._id]
        };
        nkcAPI("/sticker", "POST", body).then(function () {
          sweetSuccess("操作成功");
        })["catch"](sweetError);
      },
      removeSticker: function removeSticker() {
        var sticker = this.sticker;
        sweetQuestion("\u786E\u5B9A\u8981\u5220\u9664\u8868\u60C5\uFF1F").then(function () {
          var body = {
            type: "delete",
            stickersId: [sticker.collected._id]
          };
          return nkcAPI("/sticker", "POST", body);
        }).then(function () {
          self.app.close();
          window.location.reload();
        })["catch"](sweetError);
      },
      init: function init() {
        // 旧 数据统一后可移除
        var dom = $("[data-sticker-rid]");

        for (var i = 0; i < dom.length; i++) {
          var d = dom.eq(i);
          if (d.attr("data-sticker-init") === "true") continue;
          d.on("click", function () {
            self.app.open($(this).attr("data-sticker-rid"), !!$(this).attr("data-sticker-management"));
          });
          d.attr("data-sticker-init", "true");
        } // 新


        var dom2 = $("span[data-tag='nkcsource'][data-type='sticker']");
        dom2.each(function () {
          var d = $(this);
          if (d.attr("data-sticker-init") === "true") return;
          d.on("click", function () {
            self.app.open($(this).attr("data-id"), !!$(this).attr("data-sticker-management"));
          });
          d.attr("data-sticker-init", "true");
        });
      },
      open: function open(rid, management) {
        self.app.management = !!management;
        self.dom.modal("show");
        this.loading = true;
        nkcAPI("/sticker/".concat(rid, "?t=json"), "GET").then(function (data) {
          self.app.sticker = data.sticker;
          self.app.loading = false;
        })["catch"](function (data) {
          sweetError(data);
          self.app.close();
        });
      },
      close: function close() {
        self.dom.modal("hide");
      }
    }
  });
  self.initPanel = self.app.init;
};

var stickerViewer = new StickerViewer();
NKC.methods.initStickerViewer = stickerViewer.app.init;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3B1YmxpY01vZHVsZXMvc3RpY2tlci9zdGlja2VyLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7SUNBTSxhLEdBQ0oseUJBQWM7QUFBQTs7QUFDWixNQUFNLElBQUksR0FBRyxJQUFiO0FBQ0EsRUFBQSxJQUFJLENBQUMsR0FBTCxHQUFXLENBQUMsQ0FBQyxzQkFBRCxDQUFaO0FBQ0EsRUFBQSxJQUFJLENBQUMsR0FBTCxDQUFTLEtBQVQsQ0FBZTtBQUNiLElBQUEsSUFBSSxFQUFFO0FBRE8sR0FBZjtBQUdBLEVBQUEsSUFBSSxDQUFDLEdBQUwsR0FBVyxJQUFJLEdBQUosQ0FBUTtBQUNqQixJQUFBLEVBQUUsRUFBRSx5QkFEYTtBQUVqQixJQUFBLElBQUksRUFBRTtBQUNKLE1BQUEsT0FBTyxFQUFFLEVBREw7QUFFSixNQUFBLEdBQUcsRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLEdBRmI7QUFHSixNQUFBLFVBQVUsRUFBRSxLQUhSO0FBSUosTUFBQSxPQUFPLEVBQUU7QUFKTCxLQUZXO0FBUWpCLElBQUEsT0FSaUIscUJBUVA7QUFDUixXQUFLLElBQUw7QUFDRCxLQVZnQjtBQVdqQixJQUFBLE9BQU8sRUFBRTtBQUNQLE1BQUEsTUFBTSxFQUFFLEdBQUcsQ0FBQyxPQUFKLENBQVksS0FBWixDQUFrQixNQURuQjtBQUVQLE1BQUEsT0FBTyxFQUFFLEdBQUcsQ0FBQyxPQUFKLENBQVksT0FGZDtBQUdQLE1BQUEsVUFITyx3QkFHTTtBQUNYLFFBQUEsTUFBTSxhQUFhLE1BQWIsRUFBcUI7QUFDekIsVUFBQSxJQUFJLEVBQUUsWUFEbUI7QUFFekIsVUFBQSxVQUFVLEVBQUUsQ0FBQyxLQUFLLE9BQUwsQ0FBYSxHQUFkO0FBRmEsU0FBckIsQ0FBTixDQUlHLElBSkgsQ0FJUSxZQUFXO0FBQ2YsVUFBQSxJQUFJLENBQUMs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QUVILElBQU0sYUFBYSxHQUFHLElBQUksYUFBSixFQUF0QjtBQUNBLEdBQUcsQ0FBQyxPQUFKLENBQVksaUJBQVosR0FBZ0MsYUFBYSxDQUFDLEdBQWQsQ0FBa0IsSUFBbEQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjbGFzcyBTdGlja2VyVmlld2VyIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5kb20gPSAkKFwiI21vZHVsZVN0aWNrZXJWaWV3ZXJcIik7XHJcbiAgICBzZWxmLmRvbS5tb2RhbCh7XHJcbiAgICAgIHNob3c6IGZhbHNlXHJcbiAgICB9KTtcclxuICAgIHNlbGYuYXBwID0gbmV3IFZ1ZSh7XHJcbiAgICAgIGVsOiBcIiNtb2R1bGVTdGlja2VyVmlld2VyQXBwXCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBzdGlja2VyOiBcIlwiLFxyXG4gICAgICAgIHVpZDogTktDLmNvbmZpZ3MudWlkLFxyXG4gICAgICAgIG1hbmFnZW1lbnQ6IGZhbHNlLFxyXG4gICAgICAgIGxvYWRpbmc6IGZhbHNlXHJcbiAgICAgIH0sXHJcbiAgICAgIG1vdW50ZWQoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIG1ldGhvZHM6IHtcclxuICAgICAgICBnZXRVcmw6IE5LQy5tZXRob2RzLnRvb2xzLmdldFVybCxcclxuICAgICAgICBmcm9tTm93OiBOS0MubWV0aG9kcy5mcm9tTm93LFxyXG4gICAgICAgIGNvbGxlY3Rpb24oKSB7XHJcbiAgICAgICAgICBua2NBUEkoYC9zdGlja2VyYCwgXCJQT1NUXCIsIHtcclxuICAgICAgICAgICAgdHlwZTogXCJjb2xsZWN0aW9uXCIsXHJcbiAgICAgICAgICAgIHN0aWNrZXJzSWQ6IFt0aGlzLnN0aWNrZXIuX2lkXVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAuY2xvc2UoKTtcclxuICAgICAgICAgICAgICBzd2VldFN1Y2Nlc3MoXCLooajmg4Xlt7Lmt7vliqBcIik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1vdmVTdGlja2VyKCkge1xyXG4gICAgICAgICAgY29uc3Qge3N0aWNrZXJ9ID0gdGhpcztcclxuICAgICAgICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwibW92ZVwiLFxyXG4gICAgICAgICAgICBzdGlja2Vyc0lkOiBbc3RpY2tlci5jb2xsZWN0ZWQuX2lkXVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIG5rY0FQSShcIi9zdGlja2VyXCIsIFwiUE9TVFwiLCBib2R5KVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAuY2xvc2UoKTtcclxuICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNoYXJlU3RpY2tlcigpIHtcclxuICAgICAgICAgIGNvbnN0IHtzdGlja2VyfSA9IHRoaXM7XHJcbiAgICAgICAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBcInNoYXJlXCIsXHJcbiAgICAgICAgICAgIHN0aWNrZXJzSWQ6IFtzdGlja2VyLl9pZF1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBua2NBUEkoXCIvc3RpY2tlclwiLCBcIlBPU1RcIiwgYm9keSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHN3ZWV0U3VjY2VzcyhcIuaTjeS9nOaIkOWKn1wiKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlU3RpY2tlcigpIHtcclxuICAgICAgICAgIGNvbnN0IHtzdGlja2VyfSA9IHRoaXM7XHJcbiAgICAgICAgICBzd2VldFF1ZXN0aW9uKGDnoa7lrpropoHliKDpmaTooajmg4XvvJ9gKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiZGVsZXRlXCIsXHJcbiAgICAgICAgICAgICAgICBzdGlja2Vyc0lkOiBbc3RpY2tlci5jb2xsZWN0ZWQuX2lkXVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG5rY0FQSShcIi9zdGlja2VyXCIsIFwiUE9TVFwiLCBib2R5KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbml0KCkge1xyXG4gICAgICAgICAgLy8g5penIOaVsOaNrue7n+S4gOWQjuWPr+enu+mZpFxyXG4gICAgICAgICAgY29uc3QgZG9tID0gJChcIltkYXRhLXN0aWNrZXItcmlkXVwiKTtcclxuXHJcbiAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZG9tLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGQgPSBkb20uZXEoaSk7XHJcbiAgICAgICAgICAgIGlmKGQuYXR0cihcImRhdGEtc3RpY2tlci1pbml0XCIpID09PSBcInRydWVcIikgY29udGludWU7XHJcbiAgICAgICAgICAgIGQub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICBzZWxmLmFwcC5vcGVuKCQodGhpcykuYXR0cihcImRhdGEtc3RpY2tlci1yaWRcIiksICEhJCh0aGlzKS5hdHRyKFwiZGF0YS1zdGlja2VyLW1hbmFnZW1lbnRcIikpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZC5hdHRyKFwiZGF0YS1zdGlja2VyLWluaXRcIiwgXCJ0cnVlXCIpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIOaWsFxyXG4gICAgICAgICAgY29uc3QgZG9tMiA9ICQoXCJzcGFuW2RhdGEtdGFnPSdua2Nzb3VyY2UnXVtkYXRhLXR5cGU9J3N0aWNrZXInXVwiKTtcclxuICAgICAgICAgIGRvbTIuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY29uc3QgZCA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIGlmKGQuYXR0cihcImRhdGEtc3RpY2tlci1pbml0XCIpID09PSBcInRydWVcIikgcmV0dXJuO1xyXG4gICAgICAgICAgICBkLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAub3BlbigkKHRoaXMpLmF0dHIoXCJkYXRhLWlkXCIpLCAhISQodGhpcykuYXR0cihcImRhdGEtc3RpY2tlci1tYW5hZ2VtZW50XCIpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGQuYXR0cihcImRhdGEtc3RpY2tlci1pbml0XCIsIFwidHJ1ZVwiKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3BlbihyaWQsIG1hbmFnZW1lbnQpIHtcclxuICAgICAgICAgIHNlbGYuYXBwLm1hbmFnZW1lbnQgPSAhIW1hbmFnZW1lbnQ7XHJcbiAgICAgICAgICBzZWxmLmRvbS5tb2RhbChcInNob3dcIik7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgbmtjQVBJKGAvc3RpY2tlci8ke3JpZH0/dD1qc29uYCwgXCJHRVRcIilcclxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgc2VsZi5hcHAuc3RpY2tlciA9IGRhdGEuc3RpY2tlcjtcclxuICAgICAgICAgICAgICBzZWxmLmFwcC5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChkYXRhID0+IHtcclxuICAgICAgICAgICAgICBzd2VldEVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgIHNlbGYuYXBwLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY2xvc2UoKSB7XHJcbiAgICAgICAgICBzZWxmLmRvbS5tb2RhbChcImhpZGVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHNlbGYuaW5pdFBhbmVsID0gc2VsZi5hcHAuaW5pdDtcclxuICB9XHJcbn1cclxuY29uc3Qgc3RpY2tlclZpZXdlciA9IG5ldyBTdGlja2VyVmlld2VyKCk7XHJcbk5LQy5tZXRob2RzLmluaXRTdGlja2VyVmlld2VyID0gc3RpY2tlclZpZXdlci5hcHAuaW5pdDtcclxuIl19
