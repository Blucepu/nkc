(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

NKC.modules.SelectSticker = function () {
  var self = this;
  self.dom = $("#moduleSelectSticker");
  self.app = new Vue({
    el: "#moduleSelectStickerApp",
    data: {
      type: "own",
      pageNumber: "",
      perpage: 20,
      emoji: [],
      share: false,
      localStickers: [],
      stickers: [],
      paging: {}
    },
    mounted: function mounted() {},
    methods: {
      getUrl: NKC.methods.tools.getUrl,
      initModule: function initModule() {
        var height = "43.5rem";
        self.dom.css({
          height: height
        });
        self.dom.draggable({
          scroll: false,
          handle: ".module-ss-title",
          drag: function drag(event, ui) {
            if (ui.position.top < 0) ui.position.top = 0;
            var height = $(window).height();
            if (ui.position.top > height - 30) ui.position.top = height - 30;
            var width = self.dom.width();
            if (ui.position.left < 100 - width) ui.position.left = 100 - width;
            var winWidth = $(window).width();
            if (ui.position.left > winWidth - 100) ui.position.left = winWidth - 100;
          }
        });
      },
      resetDomPosition: function resetDomPosition() {
        var dom = self.dom;
        var width = $(window).width();
        var height = $(window).height();

        if (width < 700) {
          // 小屏幕
          dom.css({
            "width": width * 0.8,
            "top": 0,
            "right": 0
          });
        } else {
          // 宽屏
          dom.css("left", (width - dom.width()) * 0.5);
        }
      },
      selectType: function selectType(type) {
        this.type = type;

        if (type === "upload") {// if(!this.localStickers.length) this.selectLocalFile();
        } else {
          this.getStickers();
        }
      },
      changePage: function changePage(type) {
        var paging = this.paging;
        if (paging.buttonValue.length <= 1) return;
        if (type === "last" && paging.page === 0) return;
        if (type === "next" && paging.page + 1 === paging.pageCount) return;
        var count = type === "last" ? -1 : 1;
        this.getStickers(paging.page + count);
      },
      getStickers: function getStickers() {
        var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
        var type = this.type;
        if (type !== "own") return;
        var url = "/sticker?page=".concat(page, "&c=own&reviewed=true&perpage=").concat(this.perpage);
        nkcAPI(url, "GET").then(function (data) {
          self.app.stickers = data.ownStickers;
          self.app.paging = data.paging;
          self.app.emoji = data.emoji;
        })["catch"](sweetError);
      },
      fastSelectPage: function fastSelectPage() {
        var pageNumber = this.pageNumber - 1;
        var paging = this.paging;
        if (!paging || !paging.buttonValue.length) return;
        var lastNumber = paging.buttonValue[paging.buttonValue.length - 1].num;
        if (pageNumber < 0 || lastNumber < pageNumber) return sweetInfo("输入的页数超出范围");
        this.getStickers(pageNumber);
      },
      selectSticker: function selectSticker(sticker) {
        self.callback({
          type: "sticker",
          data: sticker
        });
      },
      selectEmoji: function selectEmoji(emoji) {
        self.callback({
          type: "emoji",
          data: emoji
        });
      },
      addLocalFile: function addLocalFile(file) {
        this.fileToSticker(file).then(function (sticker) {
          self.app.localStickers.push(sticker);
          self.app.uploadLocalSticker(sticker);
        });
      },
      fileToSticker: function fileToSticker(file) {
        return new Promise(function (resolve, reject) {
          var sticker = {
            file: file
          };
          sticker.status = "unUploaded";
          sticker.progress = 0;
          NKC.methods.fileToUrl(file).then(function (base64) {
            sticker.url = base64;
            resolve(sticker);
          })["catch"](reject);
        });
      },
      selectedLocalFile: function selectedLocalFile() {
        var input = $("#moduleSelectStickerInput");
        var files = input[0].files;

        for (var i = 0; i < files.length; i++) {
          var file = files[i];
          self.app.addLocalFile(file);
        }
      },
      selectLocalFile: function selectLocalFile() {
        $("#moduleSelectStickerInput").click();
      },
      uploadLocalSticker: function uploadLocalSticker(sticker) {
        Promise.resolve().then(function () {
          sticker.status = "uploading";
          var formData = new FormData();
          formData.append("file", sticker.file);
          formData.append("type", "sticker");
          formData.append("fileName", sticker.file.name);

          if (self.app.share) {
            formData.append("share", "true");
          }

          return nkcUploadFile("/r", "POST", formData, function (e, progress) {
            sticker.progress = progress;
          });
        }).then(function () {
          sticker.status = "uploaded";
          self.app.localStickers.splice(self.app.localStickers.indexOf(sticker), 1);
          if (!self.app.localStickers.length) self.app.selectType("own");
        })["catch"](function (data) {
          screenTopWarning(data.error || data);
          sticker.error = data.error || data;
          sticker.status = "unUploaded";
        });
      },
      restartUpload: function restartUpload(s) {
        this.uploadLocalSticker(s);
      },
      open: function open(callback, options) {
        self.callback = callback;
        this.resetDomPosition();
        this.initModule();
        self.dom.show();
        this.getStickers();
      },
      close: function close() {
        self.dom.hide();
      }
    }
  });
  self.open = self.app.open;
  self.close = self.app.close;
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3B1YmxpY01vZHVsZXMvc3RpY2tlci9zZWxlY3RTdGlja2VyLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxhQUFaLEdBQTRCLFlBQVc7QUFDckMsTUFBSSxJQUFJLEdBQUcsSUFBWDtBQUNBLEVBQUEsSUFBSSxDQUFDLEdBQUwsR0FBVyxDQUFDLENBQUMsc0JBQUQsQ0FBWjtBQUNBLEVBQUEsSUFBSSxDQUFDLEdBQUwsR0FBVyxJQUFJLEdBQUosQ0FBUTtBQUNqQixJQUFBLEVBQUUsRUFBRSx5QkFEYTtBQUVqQixJQUFBLElBQUksRUFBRTtBQUNKLE1BQUEsSUFBSSxFQUFFLEtBREY7QUFFSixNQUFBLFVBQVUsRUFBRSxFQUZSO0FBR0osTUFBQSxPQUFPLEVBQUUsRUFITDtBQUlKLE1BQUEsS0FBSyxFQUFFLEVBSkg7QUFLSixNQUFBLEtBQUssRUFBRSxLQUxIO0FBTUosTUFBQSxhQUFhLEVBQUUsRUFOWDtBQU9KLE1BQUEsUUFBUSxFQUFFLEVBUE47QUFRSixNQUFBLE1BQU0sRUFBRTtBQVJKLEtBRlc7QUFZakIsSUFBQSxPQUFPLEVBQUUsbUJBQVksQ0FFcEIsQ0FkZ0I7QUFlakIsSUFBQSxPQUFPLEVBQUU7QUFDUCxNQUFBLE1BQU0sRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLEtBQVosQ0FBa0IsTUFEbkI7QUFFUCxNQUFBLFVBRk8sd0JBRU07QUFDWCxZQUFJLE1BQU0sR0FBRyxTQUFiO0FBQ0EsUUFBQSxJQUFJLENBQUMsR0FBTCxDQUFTLEdBQVQsQ0FBYTtBQUNYLFVBQUEsTUFBTSxFQUFFO0FBREcsU0FBYjtBQUdBLFFBQUEsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULENBQW1CO0FBQ2pCLFVBQUEsTUFBTSxFQUFFLEtBRFM7QUFFakIsVUFBQSxNQUFNLEVBQUUs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LEdBQUwsQ0FBUyxhQUFULENBQXVCLE1BQTNCLEVBQW1DLElBQUksQ0FBQyxHQUFMLENBQVMsVUFBVCxDQUFvQixLQUFwQjtBQUNwQyxTQWxCSCxXQW1CUyxVQUFDLElBQUQsRUFBVTtBQUNmLFVBQUEsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUwsSUFBYyxJQUFmLENBQWhCO0FBQ0EsVUFBQSxPQUFPLENBQUMsS0FBUixHQUFnQixJQUFJLENBQUMsS0FBTCxJQUFjLElBQTlCO0FBQ0EsVUFBQSxPQUFPLENBQUMsTUFBUixHQUFpQixZQUFqQjtBQUNELFNBdkJIO0FBd0JELE9BOUlNO0FBK0lQLE1BQUEsYUEvSU8seUJBK0lPLENBL0lQLEVBK0lVO0FBQ2YsYUFBSyxrQkFBTCxDQUF3QixDQUF4QjtBQUNELE9BakpNO0FBa0pQLE1BQUEsSUFsSk8sZ0JBa0pGLFFBbEpFLEVBa0pRLE9BbEpSLEVBa0ppQjtBQUN0QixRQUFBLElBQUksQ0FBQyxRQUFMLEdBQWdCLFFBQWhCO0FBQ0EsYUFBSyxnQkFBTDtBQUNBLGFBQUssVUFBTDtBQUNBLFFBQUEsSUFBSSxDQUFDLEdBQUwsQ0FBUyxJQUFUO0FBQ0EsYUFBSyxXQUFMO0FBQ0QsT0F4Sk07QUF5SlAsTUFBQSxLQXpKTyxtQkF5SkM7QUFDTixRQUFBLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBVDtBQUNEO0FBM0pNO0FBZlEsR0FBUixDQUFYO0FBNktBLEVBQUEsSUFBSSxDQUFDLElBQUwsR0FBWSxJQUFJLENBQUMsR0FBTCxDQUFTLElBQXJCO0FBQ0EsRUFBQSxJQUFJLENBQUMsS0FBTCxHQUFhLElBQUksQ0FBQyxHQUFMLENBQVMsS0FBdEI7QUFDRCxDQWxMRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIk5LQy5tb2R1bGVzLlNlbGVjdFN0aWNrZXIgPSBmdW5jdGlvbigpIHtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5kb20gPSAkKFwiI21vZHVsZVNlbGVjdFN0aWNrZXJcIik7XHJcbiAgc2VsZi5hcHAgPSBuZXcgVnVlKHtcclxuICAgIGVsOiBcIiNtb2R1bGVTZWxlY3RTdGlja2VyQXBwXCIsXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIHR5cGU6IFwib3duXCIsXHJcbiAgICAgIHBhZ2VOdW1iZXI6IFwiXCIsXHJcbiAgICAgIHBlcnBhZ2U6IDIwLFxyXG4gICAgICBlbW9qaTogW10sXHJcbiAgICAgIHNoYXJlOiBmYWxzZSxcclxuICAgICAgbG9jYWxTdGlja2VyczogW10sXHJcbiAgICAgIHN0aWNrZXJzOiBbXSxcclxuICAgICAgcGFnaW5nOiB7fVxyXG4gICAgfSxcclxuICAgIG1vdW50ZWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgIFxyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6IHtcclxuICAgICAgZ2V0VXJsOiBOS0MubWV0aG9kcy50b29scy5nZXRVcmwsXHJcbiAgICAgIGluaXRNb2R1bGUoKSB7XHJcbiAgICAgICAgdmFyIGhlaWdodCA9IFwiNDMuNXJlbVwiO1xyXG4gICAgICAgIHNlbGYuZG9tLmNzcyh7XHJcbiAgICAgICAgICBoZWlnaHQ6IGhlaWdodFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNlbGYuZG9tLmRyYWdnYWJsZSh7XHJcbiAgICAgICAgICBzY3JvbGw6IGZhbHNlLFxyXG4gICAgICAgICAgaGFuZGxlOiBcIi5tb2R1bGUtc3MtdGl0bGVcIixcclxuICAgICAgICAgIGRyYWc6IGZ1bmN0aW9uKGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgICBpZih1aS5wb3NpdGlvbi50b3AgPCAwKSB1aS5wb3NpdGlvbi50b3AgPSAwO1xyXG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xyXG4gICAgICAgICAgICBpZih1aS5wb3NpdGlvbi50b3AgPiBoZWlnaHQgLSAzMCkgdWkucG9zaXRpb24udG9wID0gaGVpZ2h0IC0gMzA7XHJcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHNlbGYuZG9tLndpZHRoKCk7XHJcbiAgICAgICAgICAgIGlmKHVpLnBvc2l0aW9uLmxlZnQgPCAxMDAgLSB3aWR0aCkgdWkucG9zaXRpb24ubGVmdCA9IDEwMCAtIHdpZHRoO1xyXG4gICAgICAgICAgICB2YXIgd2luV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgICAgICAgICAgaWYodWkucG9zaXRpb24ubGVmdCA+IHdpbldpZHRoIC0gMTAwKSB1aS5wb3NpdGlvbi5sZWZ0ID0gd2luV2lkdGggLSAxMDA7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHJlc2V0RG9tUG9zaXRpb246IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBkb20gPSBzZWxmLmRvbTtcclxuICAgICAgICB2YXIgd2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgICAgICB2YXIgaGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xyXG4gICAgICAgIGlmKHdpZHRoIDwgNzAwKSB7XHJcbiAgICAgICAgICAvLyDlsI/lsY/luZVcclxuICAgICAgICAgIGRvbS5jc3Moe1xyXG4gICAgICAgICAgICBcIndpZHRoXCI6IHdpZHRoICogMC44LFxyXG4gICAgICAgICAgICBcInRvcFwiOiAwLFxyXG4gICAgICAgICAgICBcInJpZ2h0XCI6IDBcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyDlrr3lsY9cclxuICAgICAgICAgIGRvbS5jc3MoXCJsZWZ0XCIsICh3aWR0aCAtIGRvbS53aWR0aCgpKSowLjUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgc2VsZWN0VHlwZSh0eXBlKSB7XHJcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgICAgICBpZih0eXBlID09PSBcInVwbG9hZFwiKSB7XHJcbiAgICAgICAgICAvLyBpZighdGhpcy5sb2NhbFN0aWNrZXJzLmxlbmd0aCkgdGhpcy5zZWxlY3RMb2NhbEZpbGUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5nZXRTdGlja2VycygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgY2hhbmdlUGFnZSh0eXBlKSB7XHJcbiAgICAgICAgY29uc3QgcGFnaW5nID0gdGhpcy5wYWdpbmc7XHJcbiAgICAgICAgaWYocGFnaW5nLmJ1dHRvblZhbHVlLmxlbmd0aCA8PSAxKSByZXR1cm47XHJcbiAgICAgICAgaWYodHlwZSA9PT0gXCJsYXN0XCIgJiYgcGFnaW5nLnBhZ2UgPT09IDApIHJldHVybjtcclxuICAgICAgICBpZih0eXBlID09PSBcIm5leHRcIiAmJiBwYWdpbmcucGFnZSArIDEgPT09IHBhZ2luZy5wYWdlQ291bnQpIHJldHVybjtcclxuICAgICAgICBjb25zdCBjb3VudCA9IHR5cGUgPT09IFwibGFzdFwiPyAtMTogMTtcclxuICAgICAgICB0aGlzLmdldFN0aWNrZXJzKHBhZ2luZy5wYWdlICsgY291bnQpO1xyXG4gICAgICB9LFxyXG4gICAgICBnZXRTdGlja2VycyhwYWdlID0gMCkge1xyXG4gICAgICAgIGNvbnN0IHt0eXBlfSA9IHRoaXM7XHJcbiAgICAgICAgaWYodHlwZSAhPT0gXCJvd25cIikgcmV0dXJuO1xyXG4gICAgICAgIGxldCB1cmwgPSBgL3N0aWNrZXI/cGFnZT0ke3BhZ2V9JmM9b3duJnJldmlld2VkPXRydWUmcGVycGFnZT0ke3RoaXMucGVycGFnZX1gO1xyXG4gICAgICAgIG5rY0FQSSh1cmwsIFwiR0VUXCIpXHJcbiAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgc2VsZi5hcHAuc3RpY2tlcnMgPSBkYXRhLm93blN0aWNrZXJzO1xyXG4gICAgICAgICAgICBzZWxmLmFwcC5wYWdpbmcgPSBkYXRhLnBhZ2luZztcclxuICAgICAgICAgICAgc2VsZi5hcHAuZW1vamkgPSBkYXRhLmVtb2ppO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcclxuICAgICAgfSxcclxuICAgICAgZmFzdFNlbGVjdFBhZ2UoKSB7XHJcbiAgICAgICAgY29uc3QgcGFnZU51bWJlciA9IHRoaXMucGFnZU51bWJlciAtIDE7XHJcbiAgICAgICAgY29uc3QgcGFnaW5nID0gdGhpcy5wYWdpbmc7XHJcbiAgICAgICAgaWYoIXBhZ2luZyB8fCAhcGFnaW5nLmJ1dHRvblZhbHVlLmxlbmd0aCkgcmV0dXJuO1xyXG4gICAgICAgIGNvbnN0IGxhc3ROdW1iZXIgPSBwYWdpbmcuYnV0dG9uVmFsdWVbcGFnaW5nLmJ1dHRvblZhbHVlLmxlbmd0aCAtIDFdLm51bTtcclxuICAgICAgICBpZihwYWdlTnVtYmVyIDwgMCB8fCBsYXN0TnVtYmVyIDwgcGFnZU51bWJlcikgcmV0dXJuIHN3ZWV0SW5mbyhcIui+k+WFpeeahOmhteaVsOi2heWHuuiMg+WbtFwiKTtcclxuICAgICAgICB0aGlzLmdldFN0aWNrZXJzKHBhZ2VOdW1iZXIpO1xyXG4gICAgICB9LFxyXG4gICAgICBzZWxlY3RTdGlja2VyKHN0aWNrZXIpIHtcclxuICAgICAgICBzZWxmLmNhbGxiYWNrKHtcclxuICAgICAgICAgIHR5cGU6IFwic3RpY2tlclwiLFxyXG4gICAgICAgICAgZGF0YTogc3RpY2tlclxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgICBzZWxlY3RFbW9qaShlbW9qaSkge1xyXG4gICAgICAgIHNlbGYuY2FsbGJhY2soe1xyXG4gICAgICAgICAgdHlwZTogXCJlbW9qaVwiLFxyXG4gICAgICAgICAgZGF0YTogZW1vamlcclxuICAgICAgICB9KTtcclxuICAgICAgfSxcclxuICAgICAgYWRkTG9jYWxGaWxlKGZpbGUpIHtcclxuICAgICAgICB0aGlzLmZpbGVUb1N0aWNrZXIoZmlsZSlcclxuICAgICAgICAgIC50aGVuKHN0aWNrZXIgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmFwcC5sb2NhbFN0aWNrZXJzLnB1c2goc3RpY2tlcik7XHJcbiAgICAgICAgICAgIHNlbGYuYXBwLnVwbG9hZExvY2FsU3RpY2tlcihzdGlja2VyKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgIH0sXHJcbiAgICAgIGZpbGVUb1N0aWNrZXIoZmlsZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBzdGlja2VyID0ge2ZpbGV9O1xyXG4gICAgICAgICAgc3RpY2tlci5zdGF0dXMgPSBcInVuVXBsb2FkZWRcIjtcclxuICAgICAgICAgIHN0aWNrZXIucHJvZ3Jlc3MgPSAwO1xyXG4gICAgICAgICAgTktDLm1ldGhvZHMuZmlsZVRvVXJsKGZpbGUpXHJcbiAgICAgICAgICAgIC50aGVuKGJhc2U2NCA9PiB7XHJcbiAgICAgICAgICAgICAgc3RpY2tlci51cmwgPSBiYXNlNjQ7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShzdGlja2VyKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKHJlamVjdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgIH0sXHJcbiAgICAgIHNlbGVjdGVkTG9jYWxGaWxlKCkge1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gJChcIiNtb2R1bGVTZWxlY3RTdGlja2VySW5wdXRcIik7XHJcbiAgICAgICAgY29uc3QgZmlsZXMgPSBpbnB1dFswXS5maWxlcztcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpICsrKSB7XHJcbiAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbaV07XHJcbiAgICAgICAgICBzZWxmLmFwcC5hZGRMb2NhbEZpbGUoZmlsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBzZWxlY3RMb2NhbEZpbGUoKSB7XHJcbiAgICAgICAgJChcIiNtb2R1bGVTZWxlY3RTdGlja2VySW5wdXRcIikuY2xpY2soKTtcclxuICAgICAgfSxcclxuICAgICAgdXBsb2FkTG9jYWxTdGlja2VyKHN0aWNrZXIpIHtcclxuICAgICAgICBQcm9taXNlLnJlc29sdmUoKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBzdGlja2VyLnN0YXR1cyA9IFwidXBsb2FkaW5nXCI7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgc3RpY2tlci5maWxlKTtcclxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwidHlwZVwiLCBcInN0aWNrZXJcIik7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVOYW1lXCIsIHN0aWNrZXIuZmlsZS5uYW1lKTtcclxuICAgICAgICAgICAgaWYoc2VsZi5hcHAuc2hhcmUpIHtcclxuICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJzaGFyZVwiLCBcInRydWVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG5rY1VwbG9hZEZpbGUoXCIvclwiLCBcIlBPU1RcIiwgZm9ybURhdGEsIGZ1bmN0aW9uKGUsIHByb2dyZXNzKSB7XHJcbiAgICAgICAgICAgICAgc3RpY2tlci5wcm9ncmVzcyA9IHByb2dyZXNzO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHN0aWNrZXIuc3RhdHVzID0gXCJ1cGxvYWRlZFwiO1xyXG4gICAgICAgICAgICBzZWxmLmFwcC5sb2NhbFN0aWNrZXJzLnNwbGljZShzZWxmLmFwcC5sb2NhbFN0aWNrZXJzLmluZGV4T2Yoc3RpY2tlciksIDEpO1xyXG4gICAgICAgICAgICBpZighc2VsZi5hcHAubG9jYWxTdGlja2Vycy5sZW5ndGgpIHNlbGYuYXBwLnNlbGVjdFR5cGUoXCJvd25cIik7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIHNjcmVlblRvcFdhcm5pbmcoZGF0YS5lcnJvciB8fCBkYXRhKTtcclxuICAgICAgICAgICAgc3RpY2tlci5lcnJvciA9IGRhdGEuZXJyb3IgfHwgZGF0YTtcclxuICAgICAgICAgICAgc3RpY2tlci5zdGF0dXMgPSBcInVuVXBsb2FkZWRcIjtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgICByZXN0YXJ0VXBsb2FkKHMpIHtcclxuICAgICAgICB0aGlzLnVwbG9hZExvY2FsU3RpY2tlcihzKTtcclxuICAgICAgfSxcclxuICAgICAgb3BlbihjYWxsYmFjaywgb3B0aW9ucykge1xyXG4gICAgICAgIHNlbGYuY2FsbGJhY2sgPSBjYWxsYmFjaztcclxuICAgICAgICB0aGlzLnJlc2V0RG9tUG9zaXRpb24oKTtcclxuICAgICAgICB0aGlzLmluaXRNb2R1bGUoKTtcclxuICAgICAgICBzZWxmLmRvbS5zaG93KCk7XHJcbiAgICAgICAgdGhpcy5nZXRTdGlja2VycygpO1xyXG4gICAgICB9LFxyXG4gICAgICBjbG9zZSgpIHtcclxuICAgICAgICBzZWxmLmRvbS5oaWRlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxuICBzZWxmLm9wZW4gPSBzZWxmLmFwcC5vcGVuO1xyXG4gIHNlbGYuY2xvc2UgPSBzZWxmLmFwcC5jbG9zZTtcclxufTsiXX0=
