!function r(a,c,s){function p(t,e){if(!c[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var n=c[t]={exports:{}};a[t][0].call(n.exports,function(e){return p(a[t][1][e]||e)},n,n.exports,r,a,c,s)}return c[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)p(s[e]);return p}({1:[function(e,t,i){"use strict";NKC.modules.SelectSticker=function(){var r=this;r.dom=$("#moduleSelectSticker"),r.app=new Vue({el:"#moduleSelectStickerApp",data:{type:"own",pageNumber:"",perpage:20,sharePerpage:24,emoji:[],share:!1,localStickers:[],stickers:[],paging:{}},mounted:function(){},methods:{getUrl:NKC.methods.tools.getUrl,initModule:function(){r.dom.css({height:"43.5rem"}),r.dom.draggable({scroll:!1,handle:".module-ss-title",drag:function(e,t){t.position.top<0&&(t.position.top=0);var i=$(window).height();t.position.top>i-30&&(t.position.top=i-30);var o=r.dom.width();t.position.left<100-o&&(t.position.left=100-o);var n=$(window).width();t.position.left>n-100&&(t.position.left=n-100)}})},resetDomPosition:function(){var e=r.dom,t=$(window).width();$(window).height();t<700?e.css({width:.8*t,top:0,right:0}):e.css("left",.5*(t-e.width())-40)},selectType:function(e){this.type=e,["own","share"].includes(e)&&this.getStickers()},changePage:function(e){var t,i=this.paging;i.buttonValue.length<=1||"last"===e&&0===i.page||"next"===e&&i.page+1===i.pageCount||(t="last"===e?-1:1,this.getStickers(i.page+t))},getStickers:function(e){var t,i=0<arguments.length&&void 0!==e?e:0,o=this.type;["own","share"].includes(o)&&(t="/sticker?page=".concat(i,"&c=own&reviewed=true&perpage=").concat(this.perpage),"share"===o&&(t="/stickers?page=".concat(i,"&perpage=").concat(this.sharePerpage)),nkcAPI(t,"GET").then(function(e){r.app.stickers=e.stickers,r.app.paging=e.paging,e.emoji&&(r.app.emoji=e.emoji)}).catch(sweetError))},fastSelectPage:function(){var e=this.pageNumber-1,t=this.paging;if(t&&t.buttonValue.length){var i=t.buttonValue[t.buttonValue.length-1].num;if(e<0||i<e)return sweetInfo("输入的页数超出范围");this.getStickers(e)}},selectSticker:function(e){r.callback({type:"sticker",data:e})},selectEmoji:function(e){r.callback({type:"emoji",data:e})},addLocalFile:function(e){this.fileToSticker(e).then(function(e){r.app.localStickers.push(e),r.app.uploadLocalSticker(e)})},fileToSticker:function(o){return new Promise(function(t,e){var i={file:o,status:"unUploaded",progress:0};NKC.methods.fileToUrl(o).then(function(e){i.url=e,t(i)}).catch(e)})},selectedLocalFile:function(){for(var e=$("#moduleSelectStickerInput")[0].files,t=0;t<e.length;t++){var i=e[t];r.app.addLocalFile(i)}},selectLocalFile:function(){$("#moduleSelectStickerInput").click()},uploadLocalSticker:function(i){Promise.resolve().then(function(){i.status="uploading";var e=new FormData;return e.append("file",i.file),e.append("type","sticker"),e.append("fileName",i.file.name),r.app.share&&e.append("share","true"),nkcUploadFile("/r","POST",e,function(e,t){i.progress=t})}).then(function(){i.status="uploaded",r.app.localStickers.splice(r.app.localStickers.indexOf(i),1),r.app.localStickers.length||r.app.selectType("own")}).catch(function(e){screenTopWarning(e.error||e),i.error=e.error||e,i.status="unUploaded"})},restartUpload:function(e){this.uploadLocalSticker(e)},open:function(e){r.callback=e,this.resetDomPosition(),this.initModule(),r.dom.show(),this.getStickers()},close:function(){r.dom.hide()}}}),r.open=r.app.open,r.close=r.app.close}},{}]},{},[1]);