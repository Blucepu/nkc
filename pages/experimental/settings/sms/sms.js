(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById("data");
window.app = new Vue({
  el: '#app',
  data: {
    smsSettings: data.smsSettings,
    nationCodes: nationCodes,
    modifyApp: false,
    test: {
      name: 'register',
      mobile: '',
      nationCode: '86',
      content: ""
    }
  },
  methods: {
    checkString: NKC.methods.checkData.checkString,
    saveApp: function saveApp() {
      // 保存AppId、App Key和短信签名
      var _this$smsSettings = this.smsSettings,
          appId = _this$smsSettings.appId,
          appKey = _this$smsSettings.appKey,
          smsSign = _this$smsSettings.smsSign;
      var self = this;
      Promise.resolve().then(function () {
        self.checkString(appId, {
          name: "App ID",
          minLength: 1
        });
        self.checkString(appKey, {
          name: "App Key",
          minLength: 1
        });
        self.checkString(smsSign, {
          name: "短信签名",
          minLength: 1
        });
        var body = {
          type: "modifyApp",
          smsSettings: {
            appId: appId,
            appKey: appKey,
            smsSign: smsSign
          }
        };
        return nkcAPI("/e/settings/sms", "PUT", body);
      }).then(function (data) {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    },
    getChineseName: function getChineseName(code) {
      var chineseName = '';
      this.nationCodes.forEach(function (ele) {
        if (ele.code === code) {
          chineseName = ele.chineseName;
        }
      });
      return chineseName;
    },
    isDisabled: function isDisabled(nationCode) {
      for (var i = 0; i < this.smsSettings.restrictedNumber.length; i++) {
        if (nationCode === this.smsSettings.restrictedNumber[i].code) return true;
      }

      return false;
    },
    tran: function tran(name) {
      switch (name) {
        case 'register':
          return '注册';

        case 'login':
          return '登录';

        case 'getback':
          return '找回密码';

        case 'bindMobile':
          return '绑定手机';

        case 'changeMobile':
          return '更改手机号';

        case 'reset':
          return '绑定新手机号';

        case 'withdraw':
          return '提现';

        case 'destroy':
          return '账号注销';

        case "unbindMobile":
          return "解绑手机号";
      }
    },
    testSendMessage: function testSendMessage() {
      var self = this;
      var name = self.test.name;
      var mobile = self.test.mobile;
      var nationCode = self.test.nationCode;
      var content = self.test.content;
      Promise.resolve().then(function () {
        if (!name) throw '请选择测试类型';
        if (!nationCode) throw '请选择测试手机国际区号';
        if (!mobile) throw '请输入测试手机号码';
        if (!content) throw "请输入自定义验证码";
        return sweetQuestion("确定要发送短消息？");
      }).then(function () {
        return nkcAPI('/e/settings/sms/test', 'POST', {
          name: name,
          mobile: mobile,
          nationCode: nationCode,
          content: content
        });
      }).then(function () {
        sweetSuccess('短信发送成功');
      })["catch"](sweetError);
    },
    save: function save() {
      var smsSettings = this.smsSettings;
      var self = this; // 验证限制号码字符串 去掉无用数据 并转为数组

      Promise.resolve().then(function () {
        smsSettings.appId += '';
        var appId = smsSettings.appId,
            appKey = smsSettings.appKey,
            smsSign = smsSettings.smsSign;
        self.checkString(appId, {
          name: "App ID",
          minLength: 1
        });
        self.checkString(appKey, {
          name: "App Key",
          minLength: 1
        });
        self.checkString(smsSign, {
          name: "短信签名",
          minLength: 1
        });

        for (var i = 0; i < smsSettings.templates.length; i++) {
          var template = smsSettings.templates[i];

          if (smsSettings.status) {
            if (template.id === '') throw template.name + '的模板ID不能为空';
            if (template.validityPeriod === '') throw template.name + '的有效时间不能为空';
            if (template.validityPeriod <= 0) throw template.name + '的有效时间必须大于0';
            if (template.sameIpOneDay === '') throw template.name + '的IP次数限制不能为空';
            if (template.sameIpOneDay <= 0) throw template.name + '的IP次数限制必须大于0';
            if (template.sameMobileOneDay === '') throw template.name + '的手机号码次数限制不能为空';
            if (template.sameMobileOneDay <= 0) throw template.name + '的手机号码次数限制必须大于0';
          }
        }

        var checkString = NKC.methods.checkData.checkString;
        smsSettings.restrictedNumber.forEach(function (ele) {
          ele.number = ele.number.toString();
          checkString(ele.code, {
            name: "国际区号",
            minLength: 1
          });
          checkString(ele.number, {
            name: '受限号码',
            minLength: '1'
          });
          ele.number = ele.number.trim().split(',').filter(function (n) {
            return n.trim();
          });
        });
      }).then(function () {
        return nkcAPI('/e/settings/sms', 'PUT', {
          smsSettings: smsSettings
        });
      }).then(function () {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9leHBlcmltZW50YWwvc2V0dGluZ3Mvc21zL3Ntcy5tanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLElBQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFKLENBQVksV0FBWixDQUF3QixNQUF4QixDQUFiO0FBQ0EsTUFBTSxDQUFDLEdBQVAsR0FBYSxJQUFJLEdBQUosQ0FBUTtBQUNuQixFQUFBLEVBQUUsRUFBRSxNQURlO0FBRW5CLEVBQUEsSUFBSSxFQUFFO0FBQ0osSUFBQSxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBRGQ7QUFFSixJQUFBLFdBQVcsRUFBRSxXQUZUO0FBR0osSUFBQSxTQUFTLEVBQUUsS0FIUDtBQUlKLElBQUEsSUFBSSxFQUFFO0FBQ0osTUFBQSxJQUFJLEVBQUUsVUFERjtBQUVKLE1BQUEsTUFBTSxFQUFFLEVBRko7QUFHSixNQUFBLFVBQVUsRUFBRSxJQUhSO0FBSUosTUFBQSxPQUFPLEVBQUU7QUFKTDtBQUpGLEdBRmE7QUFhbkIsRUFBQSxPQUFPLEVBQUU7QUFDUCxJQUFBLFdBQVcsRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLFNBQVosQ0FBc0IsV0FENUI7QUFFUCxJQUFBLE9BRk8scUJBRUc7QUFDUjtBQURRLDhCQUV5QixLQUFLLFdBRjlCO0FBQUEsVUFFRCxLQUZDLHFCQUVELEtBRkM7QUFBQSxVQUVNLE1BRk4scUJBRU0sTUFGTjtBQUFBLFVBRWMsT0FGZCxxQkFFYyxPQUZkO0FBR1IsVUFBTSxJQUFJLEdBQUcsSUFBYjtBQUNBLE1BQUEsT0FBTyxDQUFDLE9BQVIsR0FDRyxJQURILENBQ1EsWUFBTTtBQUNWLFFBQUEsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsS0FBakIsRUFBd0I7QUFDdEIsVUFBQSxJQUFJLEVBQUUsUUFEZ0I7QUFFdEIsVUFBQSxTQUFTLEVBQUU7QUFGVyxTQUF4QjtBQUlBLFFBQUEsSUFBSSxDQUFDLFdB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QUNBLFVBQUEsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFMLEVBQVc7QUFDcEIsWUFBQSxJQUFJLEVBQUUsTUFEYztBQUVwQixZQUFBLFNBQVMsRUFBRTtBQUZTLFdBQVgsQ0FBWDtBQUlBLFVBQUEsV0FBVyxDQUFDLEdBQUcsQ0FBQyxNQUFMLEVBQVk7QUFDckIsWUFBQSxJQUFJLEVBQUUsTUFEZTtBQUVyQixZQUFBLFNBQVMsRUFBRTtBQUZVLFdBQVosQ0FBWDtBQUlBLFVBQUEsR0FBRyxDQUFDLE1BQUosR0FBYSxHQUFHLENBQUMsTUFBSixDQUFXLElBQVgsR0FBa0IsS0FBbEIsQ0FBd0IsR0FBeEIsRUFBNkIsTUFBN0IsQ0FBb0MsVUFBVSxDQUFWLEVBQWE7QUFDNUQsbUJBQU8sQ0FBQyxDQUFDLElBQUYsRUFBUDtBQUNELFdBRlksQ0FBYjtBQUdELFNBYkQ7QUFjRCxPQTdDSCxFQThDRyxJQTlDSCxDQThDUSxZQUFZO0FBQ2hCLGVBQU8sTUFBTSxDQUFDLGlCQUFELEVBQW9CLEtBQXBCLEVBQTJCO0FBQUMsVUFBQSxXQUFXLEVBQUU7QUFBZCxTQUEzQixDQUFiO0FBQ0QsT0FoREgsRUFpREcsSUFqREgsQ0FpRFEsWUFBVztBQUNmLFFBQUEsWUFBWSxDQUFDLE1BQUQsQ0FBWjtBQUNELE9BbkRILFdBb0RTLFVBcERUO0FBcUREO0FBOUlNO0FBYlUsQ0FBUixDQUFiIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgZGF0YSA9IE5LQy5tZXRob2RzLmdldERhdGFCeUlkKFwiZGF0YVwiKTtcclxud2luZG93LmFwcCA9IG5ldyBWdWUoe1xyXG4gIGVsOiAnI2FwcCcsXHJcbiAgZGF0YToge1xyXG4gICAgc21zU2V0dGluZ3M6IGRhdGEuc21zU2V0dGluZ3MsXHJcbiAgICBuYXRpb25Db2RlczogbmF0aW9uQ29kZXMsXHJcbiAgICBtb2RpZnlBcHA6IGZhbHNlLFxyXG4gICAgdGVzdDoge1xyXG4gICAgICBuYW1lOiAncmVnaXN0ZXInLFxyXG4gICAgICBtb2JpbGU6ICcnLFxyXG4gICAgICBuYXRpb25Db2RlOiAnODYnLFxyXG4gICAgICBjb250ZW50OiBcIlwiXHJcbiAgICB9XHJcbiAgfSxcclxuICBtZXRob2RzOiB7XHJcbiAgICBjaGVja1N0cmluZzogTktDLm1ldGhvZHMuY2hlY2tEYXRhLmNoZWNrU3RyaW5nLFxyXG4gICAgc2F2ZUFwcCgpIHtcclxuICAgICAgLy8g5L+d5a2YQXBwSWTjgIFBcHAgS2V55ZKM55+t5L+h562+5ZCNXHJcbiAgICAgIGNvbnN0IHthcHBJZCwgYXBwS2V5LCBzbXNTaWdufSA9IHRoaXMuc21zU2V0dGluZ3M7XHJcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICBQcm9taXNlLnJlc29sdmUoKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIHNlbGYuY2hlY2tTdHJpbmcoYXBwSWQsIHtcclxuICAgICAgICAgICAgbmFtZTogXCJBcHAgSURcIixcclxuICAgICAgICAgICAgbWluTGVuZ3RoOiAxXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHNlbGYuY2hlY2tTdHJpbmcoYXBwS2V5LCB7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiQXBwIEtleVwiLFxyXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDFcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgc2VsZi5jaGVja1N0cmluZyhzbXNTaWduLCB7XHJcbiAgICAgICAgICAgIG5hbWU6IFwi55+t5L+h562+5ZCNXCIsXHJcbiAgICAgICAgICAgIG1pbkxlbmd0aDogMVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBcIm1vZGlmeUFwcFwiLFxyXG4gICAgICAgICAgICBzbXNTZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgIGFwcElkLFxyXG4gICAgICAgICAgICAgIGFwcEtleSxcclxuICAgICAgICAgICAgICBzbXNTaWduXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICByZXR1cm4gbmtjQVBJKFwiL2Uvc2V0dGluZ3Mvc21zXCIsIFwiUFVUXCIsIGJvZHkpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgIHN3ZWV0U3VjY2VzcyhcIuS/neWtmOaIkOWKn1wiKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcclxuICAgIH0sXHJcbiAgICBnZXRDaGluZXNlTmFtZTogZnVuY3Rpb24oY29kZSkge1xyXG4gICAgICB2YXIgY2hpbmVzZU5hbWUgPSAnJztcclxuICAgICAgdGhpcy5uYXRpb25Db2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGUpIHtcclxuICAgICAgICBpZiAoZWxlLmNvZGUgPT09IGNvZGUpIHtcclxuICAgICAgICAgIGNoaW5lc2VOYW1lID0gZWxlLmNoaW5lc2VOYW1lXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGNoaW5lc2VOYW1lXHJcbiAgICB9LFxyXG4gICAgaXNEaXNhYmxlZDogZnVuY3Rpb24obmF0aW9uQ29kZSkge1xyXG4gICAgICBmb3IgKHZhciBpPTA7ICBpIDwgdGhpcy5zbXNTZXR0aW5ncy5yZXN0cmljdGVkTnVtYmVyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKG5hdGlvbkNvZGUgPT09IHRoaXMuc21zU2V0dGluZ3MucmVzdHJpY3RlZE51bWJlcltpXS5jb2RlKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH0sXHJcbiAgICB0cmFuOiBmdW5jdGlvbihuYW1lKSB7XHJcbiAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgIGNhc2UgJ3JlZ2lzdGVyJzogcmV0dXJuICfms6jlhownO1xyXG4gICAgICAgIGNhc2UgJ2xvZ2luJzogcmV0dXJuICfnmbvlvZUnO1xyXG4gICAgICAgIGNhc2UgJ2dldGJhY2snOiByZXR1cm4gJ+aJvuWbnuWvhueggSc7XHJcbiAgICAgICAgY2FzZSAnYmluZE1vYmlsZSc6IHJldHVybiAn57uR5a6a5omL5py6JztcclxuICAgICAgICBjYXNlICdjaGFuZ2VNb2JpbGUnOiByZXR1cm4gJ+abtOaUueaJi+acuuWPtyc7XHJcbiAgICAgICAgY2FzZSAncmVzZXQnOiByZXR1cm4gJ+e7keWumuaWsOaJi+acuuWPtyc7XHJcbiAgICAgICAgY2FzZSAnd2l0aGRyYXcnOiByZXR1cm4gJ+aPkOeOsCc7XHJcbiAgICAgICAgY2FzZSAnZGVzdHJveSc6IHJldHVybiAn6LSm5Y+35rOo6ZSAJztcclxuICAgICAgICBjYXNlIFwidW5iaW5kTW9iaWxlXCI6IHJldHVybiBcIuino+e7keaJi+acuuWPt1wiXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICB0ZXN0U2VuZE1lc3NhZ2U6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgIHZhciBuYW1lID0gc2VsZi50ZXN0Lm5hbWU7XHJcbiAgICAgIHZhciBtb2JpbGUgPSBzZWxmLnRlc3QubW9iaWxlO1xyXG4gICAgICB2YXIgbmF0aW9uQ29kZSA9IHNlbGYudGVzdC5uYXRpb25Db2RlO1xyXG4gICAgICB2YXIgY29udGVudCA9IHNlbGYudGVzdC5jb250ZW50O1xyXG4gICAgICBQcm9taXNlLnJlc29sdmUoKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGlmKCFuYW1lKSB0aHJvdygn6K+36YCJ5oup5rWL6K+V57G75Z6LJyk7XHJcbiAgICAgICAgICBpZighbmF0aW9uQ29kZSkgdGhyb3coJ+ivt+mAieaLqea1i+ivleaJi+acuuWbvemZheWMuuWPtycpO1xyXG4gICAgICAgICAgaWYoIW1vYmlsZSkgdGhyb3coJ+ivt+i+k+WFpea1i+ivleaJi+acuuWPt+eggScpO1xyXG4gICAgICAgICAgaWYoIWNvbnRlbnQpIHRocm93KFwi6K+36L6T5YWl6Ieq5a6a5LmJ6aqM6K+B56CBXCIpO1xyXG4gICAgICAgICAgcmV0dXJuIHN3ZWV0UXVlc3Rpb24oXCLnoa7lrpropoHlj5HpgIHnn63mtojmga/vvJ9cIilcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIHJldHVybiBua2NBUEkoJy9lL3NldHRpbmdzL3Ntcy90ZXN0JywgJ1BPU1QnLCB7bmFtZTogbmFtZSwgbW9iaWxlOiBtb2JpbGUsIG5hdGlvbkNvZGU6IG5hdGlvbkNvZGUsIGNvbnRlbnQ6IGNvbnRlbnR9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBzd2VldFN1Y2Nlc3MoJ+efreS/oeWPkemAgeaIkOWKnycpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpXHJcbiAgICB9LFxyXG4gICAgc2F2ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciBzbXNTZXR0aW5ncyA9IHRoaXMuc21zU2V0dGluZ3M7XHJcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAvLyDpqozor4HpmZDliLblj7fnoIHlrZfnrKbkuLIg5Y675o6J5peg55So5pWw5o2uIOW5tui9rOS4uuaVsOe7hFxyXG4gICAgICBQcm9taXNlLnJlc29sdmUoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgc21zU2V0dGluZ3MuYXBwSWQgKz0gJyc7XHJcbiAgICAgICAgICBjb25zdCB7YXBwSWQsIGFwcEtleSwgc21zU2lnbn0gPSBzbXNTZXR0aW5ncztcclxuICAgICAgICAgIHNlbGYuY2hlY2tTdHJpbmcoYXBwSWQsIHtcclxuICAgICAgICAgICAgbmFtZTogXCJBcHAgSURcIixcclxuICAgICAgICAgICAgbWluTGVuZ3RoOiAxXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHNlbGYuY2hlY2tTdHJpbmcoYXBwS2V5LCB7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiQXBwIEtleVwiLFxyXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDFcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgc2VsZi5jaGVja1N0cmluZyhzbXNTaWduLCB7XHJcbiAgICAgICAgICAgIG5hbWU6IFwi55+t5L+h562+5ZCNXCIsXHJcbiAgICAgICAgICAgIG1pbkxlbmd0aDogMVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgZm9yKHZhciBpID0gMCA7IGkgPCBzbXNTZXR0aW5ncy50ZW1wbGF0ZXMubGVuZ3RoIDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IHNtc1NldHRpbmdzLnRlbXBsYXRlc1tpXTtcclxuICAgICAgICAgICAgaWYoc21zU2V0dGluZ3Muc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgaWYodGVtcGxhdGUuaWQgPT09ICcnKSB0aHJvdyh0ZW1wbGF0ZS5uYW1lICsgJ+eahOaooeadv0lE5LiN6IO95Li656m6Jyk7XHJcbiAgICAgICAgICAgICAgaWYodGVtcGxhdGUudmFsaWRpdHlQZXJpb2QgPT09ICcnKSB0aHJvdyh0ZW1wbGF0ZS5uYW1lICsgJ+eahOacieaViOaXtumXtOS4jeiDveS4uuepuicpO1xyXG4gICAgICAgICAgICAgIGlmKHRlbXBsYXRlLnZhbGlkaXR5UGVyaW9kIDw9IDApIHRocm93KHRlbXBsYXRlLm5hbWUgKyAn55qE5pyJ5pWI5pe26Ze05b+F6aG75aSn5LqOMCcpO1xyXG4gICAgICAgICAgICAgIGlmKHRlbXBsYXRlLnNhbWVJcE9uZURheSA9PT0gJycpIHRocm93KHRlbXBsYXRlLm5hbWUgKyAn55qESVDmrKHmlbDpmZDliLbkuI3og73kuLrnqbonKTtcclxuICAgICAgICAgICAgICBpZih0ZW1wbGF0ZS5zYW1lSXBPbmVEYXkgPD0gMCkgdGhyb3codGVtcGxhdGUubmFtZSArICfnmoRJUOasoeaVsOmZkOWItuW/hemhu+Wkp+S6jjAnKTtcclxuICAgICAgICAgICAgICBpZih0ZW1wbGF0ZS5zYW1lTW9iaWxlT25lRGF5ID09PSAnJykgdGhyb3codGVtcGxhdGUubmFtZSArICfnmoTmiYvmnLrlj7fnoIHmrKHmlbDpmZDliLbkuI3og73kuLrnqbonKTtcclxuICAgICAgICAgICAgICBpZih0ZW1wbGF0ZS5zYW1lTW9iaWxlT25lRGF5IDw9IDApIHRocm93KHRlbXBsYXRlLm5hbWUgKyAn55qE5omL5py65Y+356CB5qyh5pWw6ZmQ5Yi25b+F6aG75aSn5LqOMCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdmFyIGNoZWNrU3RyaW5nID0gTktDLm1ldGhvZHMuY2hlY2tEYXRhLmNoZWNrU3RyaW5nO1xyXG4gICAgICAgICAgc21zU2V0dGluZ3MucmVzdHJpY3RlZE51bWJlci5mb3JFYWNoKGZ1bmN0aW9uIChlbGUpIHtcclxuICAgICAgICAgICAgZWxlLm51bWJlciA9IGVsZS5udW1iZXIudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgY2hlY2tTdHJpbmcoZWxlLmNvZGUsIHtcclxuICAgICAgICAgICAgICBuYW1lOiBcIuWbvemZheWMuuWPt1wiLFxyXG4gICAgICAgICAgICAgIG1pbkxlbmd0aDogMSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNoZWNrU3RyaW5nKGVsZS5udW1iZXIse1xyXG4gICAgICAgICAgICAgIG5hbWU6ICflj5fpmZDlj7fnoIEnLFxyXG4gICAgICAgICAgICAgIG1pbkxlbmd0aDogJzEnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBlbGUubnVtYmVyID0gZWxlLm51bWJlci50cmltKCkuc3BsaXQoJywnKS5maWx0ZXIoZnVuY3Rpb24gKG4pIHtcclxuICAgICAgICAgICAgICByZXR1cm4gbi50cmltKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgcmV0dXJuIG5rY0FQSSgnL2Uvc2V0dGluZ3Mvc21zJywgJ1BVVCcsIHtzbXNTZXR0aW5nczogc21zU2V0dGluZ3N9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBzd2VldFN1Y2Nlc3MoXCLkv53lrZjmiJDlip9cIik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcilcclxuICAgIH1cclxuICB9XHJcbn0pO1xyXG4iXX0=
