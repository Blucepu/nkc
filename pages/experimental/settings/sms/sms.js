(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById("data");
window.app = new Vue({
  el: '#app',
  data: {
    smsSettings: data.smsSettings,
    nationCodes: nationCodes,
    modifyApp: false,
    test: {
      name: 'register',
      mobile: '',
      nationCode: '86',
      content: ""
    }
  },
  methods: {
    checkString: NKC.methods.checkData.checkString,
    saveApp: function saveApp() {
      // 保存AppId、App Key和短信签名
      var _this$smsSettings = this.smsSettings,
          appId = _this$smsSettings.appId,
          appKey = _this$smsSettings.appKey,
          smsSign = _this$smsSettings.smsSign;
      var self = this;
      Promise.resolve().then(function () {
        self.checkString(appId, {
          name: "App ID",
          minLength: 1
        });
        self.checkString(appKey, {
          name: "App Key",
          minLength: 1
        });
        self.checkString(smsSign, {
          name: "短信签名",
          minLength: 1
        });
        var body = {
          type: "modifyApp",
          smsSettings: {
            appId: appId,
            appKey: appKey,
            smsSign: smsSign
          }
        };
        return nkcAPI("/e/settings/sms", "PATCH", body);
      }).then(function (data) {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    },
    getChineseName: function getChineseName(code) {
      var chineseName = '';
      this.nationCodes.forEach(function (ele) {
        if (ele.code === code) {
          chineseName = ele.chineseName;
        }
      });
      return chineseName;
    },
    isDisabled: function isDisabled(nationCode) {
      for (var i = 0; i < this.smsSettings.restrictedNumber.length; i++) {
        if (nationCode === this.smsSettings.restrictedNumber[i].code) return true;
      }

      return false;
    },
    tran: function tran(name) {
      switch (name) {
        case 'register':
          return '注册';

        case 'login':
          return '登录';

        case 'getback':
          return '找回密码';

        case 'bindMobile':
          return '绑定手机';

        case 'changeMobile':
          return '更改手机号';

        case 'reset':
          return '绑定新手机号';

        case 'withdraw':
          return '提现';

        case 'destroy':
          return '账号注销';

        case "unbindMobile":
          return "解绑手机号";
      }
    },
    testSendMessage: function testSendMessage() {
      var self = this;
      var name = self.test.name;
      var mobile = self.test.mobile;
      var nationCode = self.test.nationCode;
      var content = self.test.content;
      Promise.resolve().then(function () {
        if (!name) throw '请选择测试类型';
        if (!nationCode) throw '请选择测试手机国际区号';
        if (!mobile) throw '请输入测试手机号码';
        if (!content) throw "请输入自定义验证码";
        return sweetQuestion("确定要发送短消息？");
      }).then(function () {
        return nkcAPI('/e/settings/sms/test', 'POST', {
          name: name,
          mobile: mobile,
          nationCode: nationCode,
          content: content
        });
      }).then(function () {
        sweetSuccess('短信发送成功');
      })["catch"](sweetError);
    },
    save: function save() {
      var smsSettings = this.smsSettings;
      var self = this; // 验证限制号码字符串 去掉无用数据 并转为数组

      Promise.resolve().then(function () {
        smsSettings.appId += '';
        var appId = smsSettings.appId,
            appKey = smsSettings.appKey,
            smsSign = smsSettings.smsSign;
        self.checkString(appId, {
          name: "App ID",
          minLength: 1
        });
        self.checkString(appKey, {
          name: "App Key",
          minLength: 1
        });
        self.checkString(smsSign, {
          name: "短信签名",
          minLength: 1
        });

        for (var i = 0; i < smsSettings.templates.length; i++) {
          var template = smsSettings.templates[i];

          if (smsSettings.status) {
            if (template.id === '') throw template.name + '的模板ID不能为空';
            if (template.validityPeriod === '') throw template.name + '的有效时间不能为空';
            if (template.validityPeriod <= 0) throw template.name + '的有效时间必须大于0';
            if (template.sameIpOneDay === '') throw template.name + '的IP次数限制不能为空';
            if (template.sameIpOneDay <= 0) throw template.name + '的IP次数限制必须大于0';
            if (template.sameMobileOneDay === '') throw template.name + '的手机号码次数限制不能为空';
            if (template.sameMobileOneDay <= 0) throw template.name + '的手机号码次数限制必须大于0';
          }
        }

        var checkString = NKC.methods.checkData.checkString;
        smsSettings.restrictedNumber.forEach(function (ele) {
          ele.number = ele.number.toString();
          checkString(ele.code, {
            name: "国际区号",
            minLength: 1
          });
          checkString(ele.number, {
            name: '受限号码',
            minLength: '1'
          });
          ele.number = ele.number.trim().split(',').filter(function (n) {
            return n.trim();
          });
        });
      }).then(function () {
        return nkcAPI('/e/settings/sms', 'PATCH', {
          smsSettings: smsSettings
        });
      }).then(function () {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL2V4cGVyaW1lbnRhbC9zZXR0aW5ncy9zbXMvc21zLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE9BQUosQ0FBWSxXQUFaLENBQXdCLE1BQXhCLENBQWI7QUFDQSxNQUFNLENBQUMsR0FBUCxHQUFhLElBQUksR0FBSixDQUFRO0FBQ25CLEVBQUEsRUFBRSxFQUFFLE1BRGU7QUFFbkIsRUFBQSxJQUFJLEVBQUU7QUFDSixJQUFBLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FEZDtBQUVKLElBQUEsV0FBVyxFQUFFLFdBRlQ7QUFHSixJQUFBLFNBQVMsRUFBRSxLQUhQO0FBSUosSUFBQSxJQUFJLEVBQUU7QUFDSixNQUFBLElBQUksRUFBRSxVQURGO0FBRUosTUFBQSxNQUFNLEVBQUUsRUFGSjtBQUdKLE1BQUEsVUFBVSxFQUFFLElBSFI7QUFJSixNQUFBLE9BQU8sRUFBRTtBQUpMO0FBSkYsR0FGYTtBQWFuQixFQUFBLE9BQU8sRUFBRTtBQUNQLElBQUEsV0FBVyxFQUFFLEdBQUcsQ0FBQyxPQUFKLENBQVksU0FBWixDQUFzQixXQUQ1QjtBQUVQLElBQUEsT0FGTyxxQkFFRztBQUNSO0FBRFEsOEJBRXlCLEtBQUssV0FGOUI7QUFBQSxVQUVELEtBRkMscUJBRUQsS0FGQztBQUFBLFVBRU0sTUFGTixxQkFFTSxNQUZOO0FBQUEsVUFFYyxPQUZkLHFCQUVjLE9BRmQ7QUFHUixVQUFNLElBQUksR0FBRyxJQUFiO0FBQ0EsTUFBQSxPQUFPLENBQUMsT0FBUixHQUNHLElBREgsQ0FDUSxZQUFNO0FBQ1YsUUFBQSxJQUFJLENBQUMsV0FBTCxDQUFpQixLQUFqQixFQUF3QjtBQUN0QixVQUFBLElBQUksRUFBRSxRQURnQjtBQUV0QixVQUFBLFNBQVMsRUFBRTtBQUZXLFNBQXhCO0FB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QUFKLENBQVcsUUFBWCxFQUFiO0FBQ0EsVUFBQSxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUwsRUFBVztBQUNwQixZQUFBLElBQUksRUFBRSxNQURjO0FBRXBCLFlBQUEsU0FBUyxFQUFFO0FBRlMsV0FBWCxDQUFYO0FBSUEsVUFBQSxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQUwsRUFBWTtBQUNyQixZQUFBLElBQUksRUFBRSxNQURlO0FBRXJCLFlBQUEsU0FBUyxFQUFFO0FBRlUsV0FBWixDQUFYO0FBSUEsVUFBQSxHQUFHLENBQUMsTUFBSixHQUFhLEdBQUcsQ0FBQyxNQUFKLENBQVcsSUFBWCxHQUFrQixLQUFsQixDQUF3QixHQUF4QixFQUE2QixNQUE3QixDQUFvQyxVQUFVLENBQVYsRUFBYTtBQUM1RCxtQkFBTyxDQUFDLENBQUMsSUFBRixFQUFQO0FBQ0QsV0FGWSxDQUFiO0FBR0QsU0FiRDtBQWNELE9BN0NILEVBOENHLElBOUNILENBOENRLFlBQVk7QUFDaEIsZUFBTyxNQUFNLENBQUMsaUJBQUQsRUFBb0IsT0FBcEIsRUFBNkI7QUFBQyxVQUFBLFdBQVcsRUFBRTtBQUFkLFNBQTdCLENBQWI7QUFDRCxPQWhESCxFQWlERyxJQWpESCxDQWlEUSxZQUFXO0FBQ2YsUUFBQSxZQUFZLENBQUMsTUFBRCxDQUFaO0FBQ0QsT0FuREgsV0FvRFMsVUFwRFQ7QUFxREQ7QUE5SU07QUFiVSxDQUFSLENBQWIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjb25zdCBkYXRhID0gTktDLm1ldGhvZHMuZ2V0RGF0YUJ5SWQoXCJkYXRhXCIpO1xyXG53aW5kb3cuYXBwID0gbmV3IFZ1ZSh7XHJcbiAgZWw6ICcjYXBwJyxcclxuICBkYXRhOiB7XHJcbiAgICBzbXNTZXR0aW5nczogZGF0YS5zbXNTZXR0aW5ncyxcclxuICAgIG5hdGlvbkNvZGVzOiBuYXRpb25Db2RlcyxcclxuICAgIG1vZGlmeUFwcDogZmFsc2UsXHJcbiAgICB0ZXN0OiB7XHJcbiAgICAgIG5hbWU6ICdyZWdpc3RlcicsXHJcbiAgICAgIG1vYmlsZTogJycsXHJcbiAgICAgIG5hdGlvbkNvZGU6ICc4NicsXHJcbiAgICAgIGNvbnRlbnQ6IFwiXCJcclxuICAgIH1cclxuICB9LFxyXG4gIG1ldGhvZHM6IHtcclxuICAgIGNoZWNrU3RyaW5nOiBOS0MubWV0aG9kcy5jaGVja0RhdGEuY2hlY2tTdHJpbmcsXHJcbiAgICBzYXZlQXBwKCkge1xyXG4gICAgICAvLyDkv53lrZhBcHBJZOOAgUFwcCBLZXnlkoznn63kv6Hnrb7lkI1cclxuICAgICAgY29uc3Qge2FwcElkLCBhcHBLZXksIHNtc1NpZ259ID0gdGhpcy5zbXNTZXR0aW5ncztcclxuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgc2VsZi5jaGVja1N0cmluZyhhcHBJZCwge1xyXG4gICAgICAgICAgICBuYW1lOiBcIkFwcCBJRFwiLFxyXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDFcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgc2VsZi5jaGVja1N0cmluZyhhcHBLZXksIHtcclxuICAgICAgICAgICAgbmFtZTogXCJBcHAgS2V5XCIsXHJcbiAgICAgICAgICAgIG1pbkxlbmd0aDogMVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBzZWxmLmNoZWNrU3RyaW5nKHNtc1NpZ24sIHtcclxuICAgICAgICAgICAgbmFtZTogXCLnn63kv6Hnrb7lkI1cIixcclxuICAgICAgICAgICAgbWluTGVuZ3RoOiAxXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwibW9kaWZ5QXBwXCIsXHJcbiAgICAgICAgICAgIHNtc1NldHRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgYXBwSWQsXHJcbiAgICAgICAgICAgICAgYXBwS2V5LFxyXG4gICAgICAgICAgICAgIHNtc1NpZ25cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHJldHVybiBua2NBUEkoXCIvZS9zZXR0aW5ncy9zbXNcIiwgXCJQQVRDSFwiLCBib2R5KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICBzd2VldFN1Y2Nlc3MoXCLkv53lrZjmiJDlip9cIik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcik7XHJcbiAgICB9LFxyXG4gICAgZ2V0Q2hpbmVzZU5hbWU6IGZ1bmN0aW9uKGNvZGUpIHtcclxuICAgICAgdmFyIGNoaW5lc2VOYW1lID0gJyc7XHJcbiAgICAgIHRoaXMubmF0aW9uQ29kZXMuZm9yRWFjaChmdW5jdGlvbiAoZWxlKSB7XHJcbiAgICAgICAgaWYgKGVsZS5jb2RlID09PSBjb2RlKSB7XHJcbiAgICAgICAgICBjaGluZXNlTmFtZSA9IGVsZS5jaGluZXNlTmFtZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBjaGluZXNlTmFtZVxyXG4gICAgfSxcclxuICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uKG5hdGlvbkNvZGUpIHtcclxuICAgICAgZm9yICh2YXIgaT0wOyAgaSA8IHRoaXMuc21zU2V0dGluZ3MucmVzdHJpY3RlZE51bWJlci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChuYXRpb25Db2RlID09PSB0aGlzLnNtc1NldHRpbmdzLnJlc3RyaWN0ZWROdW1iZXJbaV0uY29kZSkgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9LFxyXG4gICAgdHJhbjogZnVuY3Rpb24obmFtZSkge1xyXG4gICAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICBjYXNlICdyZWdpc3Rlcic6IHJldHVybiAn5rOo5YaMJztcclxuICAgICAgICBjYXNlICdsb2dpbic6IHJldHVybiAn55m75b2VJztcclxuICAgICAgICBjYXNlICdnZXRiYWNrJzogcmV0dXJuICfmib7lm57lr4bnoIEnO1xyXG4gICAgICAgIGNhc2UgJ2JpbmRNb2JpbGUnOiByZXR1cm4gJ+e7keWumuaJi+acuic7XHJcbiAgICAgICAgY2FzZSAnY2hhbmdlTW9iaWxlJzogcmV0dXJuICfmm7TmlLnmiYvmnLrlj7cnO1xyXG4gICAgICAgIGNhc2UgJ3Jlc2V0JzogcmV0dXJuICfnu5HlrprmlrDmiYvmnLrlj7cnO1xyXG4gICAgICAgIGNhc2UgJ3dpdGhkcmF3JzogcmV0dXJuICfmj5DnjrAnO1xyXG4gICAgICAgIGNhc2UgJ2Rlc3Ryb3knOiByZXR1cm4gJ+i0puWPt+azqOmUgCc7XHJcbiAgICAgICAgY2FzZSBcInVuYmluZE1vYmlsZVwiOiByZXR1cm4gXCLop6Pnu5HmiYvmnLrlj7dcIlxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgdGVzdFNlbmRNZXNzYWdlOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICB2YXIgbmFtZSA9IHNlbGYudGVzdC5uYW1lO1xyXG4gICAgICB2YXIgbW9iaWxlID0gc2VsZi50ZXN0Lm1vYmlsZTtcclxuICAgICAgdmFyIG5hdGlvbkNvZGUgPSBzZWxmLnRlc3QubmF0aW9uQ29kZTtcclxuICAgICAgdmFyIGNvbnRlbnQgPSBzZWxmLnRlc3QuY29udGVudDtcclxuICAgICAgUHJvbWlzZS5yZXNvbHZlKClcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBpZighbmFtZSkgdGhyb3coJ+ivt+mAieaLqea1i+ivleexu+WeiycpO1xyXG4gICAgICAgICAgaWYoIW5hdGlvbkNvZGUpIHRocm93KCfor7fpgInmi6nmtYvor5XmiYvmnLrlm73pmYXljLrlj7cnKTtcclxuICAgICAgICAgIGlmKCFtb2JpbGUpIHRocm93KCfor7fovpPlhaXmtYvor5XmiYvmnLrlj7fnoIEnKTtcclxuICAgICAgICAgIGlmKCFjb250ZW50KSB0aHJvdyhcIuivt+i+k+WFpeiHquWumuS5iemqjOivgeeggVwiKTtcclxuICAgICAgICAgIHJldHVybiBzd2VldFF1ZXN0aW9uKFwi56Gu5a6a6KaB5Y+R6YCB55+t5raI5oGv77yfXCIpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gbmtjQVBJKCcvZS9zZXR0aW5ncy9zbXMvdGVzdCcsICdQT1NUJywge25hbWU6IG5hbWUsIG1vYmlsZTogbW9iaWxlLCBuYXRpb25Db2RlOiBuYXRpb25Db2RlLCBjb250ZW50OiBjb250ZW50fSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgc3dlZXRTdWNjZXNzKCfnn63kv6Hlj5HpgIHmiJDlip8nKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChzd2VldEVycm9yKVxyXG4gICAgfSxcclxuICAgIHNhdmU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgc21zU2V0dGluZ3MgPSB0aGlzLnNtc1NldHRpbmdzO1xyXG4gICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgLy8g6aqM6K+B6ZmQ5Yi25Y+356CB5a2X56ym5LiyIOWOu+aOieaXoOeUqOaVsOaNriDlubbovazkuLrmlbDnu4RcclxuICAgICAgUHJvbWlzZS5yZXNvbHZlKClcclxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgIHNtc1NldHRpbmdzLmFwcElkICs9ICcnO1xyXG4gICAgICAgICAgY29uc3Qge2FwcElkLCBhcHBLZXksIHNtc1NpZ259ID0gc21zU2V0dGluZ3M7XHJcbiAgICAgICAgICBzZWxmLmNoZWNrU3RyaW5nKGFwcElkLCB7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiQXBwIElEXCIsXHJcbiAgICAgICAgICAgIG1pbkxlbmd0aDogMVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBzZWxmLmNoZWNrU3RyaW5nKGFwcEtleSwge1xyXG4gICAgICAgICAgICBuYW1lOiBcIkFwcCBLZXlcIixcclxuICAgICAgICAgICAgbWluTGVuZ3RoOiAxXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHNlbGYuY2hlY2tTdHJpbmcoc21zU2lnbiwge1xyXG4gICAgICAgICAgICBuYW1lOiBcIuefreS/oeetvuWQjVwiLFxyXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDFcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgc21zU2V0dGluZ3MudGVtcGxhdGVzLmxlbmd0aCA7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBzbXNTZXR0aW5ncy50ZW1wbGF0ZXNbaV07XHJcbiAgICAgICAgICAgIGlmKHNtc1NldHRpbmdzLnN0YXR1cykge1xyXG4gICAgICAgICAgICAgIGlmKHRlbXBsYXRlLmlkID09PSAnJykgdGhyb3codGVtcGxhdGUubmFtZSArICfnmoTmqKHmnb9JROS4jeiDveS4uuepuicpO1xyXG4gICAgICAgICAgICAgIGlmKHRlbXBsYXRlLnZhbGlkaXR5UGVyaW9kID09PSAnJykgdGhyb3codGVtcGxhdGUubmFtZSArICfnmoTmnInmlYjml7bpl7TkuI3og73kuLrnqbonKTtcclxuICAgICAgICAgICAgICBpZih0ZW1wbGF0ZS52YWxpZGl0eVBlcmlvZCA8PSAwKSB0aHJvdyh0ZW1wbGF0ZS5uYW1lICsgJ+eahOacieaViOaXtumXtOW/hemhu+Wkp+S6jjAnKTtcclxuICAgICAgICAgICAgICBpZih0ZW1wbGF0ZS5zYW1lSXBPbmVEYXkgPT09ICcnKSB0aHJvdyh0ZW1wbGF0ZS5uYW1lICsgJ+eahElQ5qyh5pWw6ZmQ5Yi25LiN6IO95Li656m6Jyk7XHJcbiAgICAgICAgICAgICAgaWYodGVtcGxhdGUuc2FtZUlwT25lRGF5IDw9IDApIHRocm93KHRlbXBsYXRlLm5hbWUgKyAn55qESVDmrKHmlbDpmZDliLblv4XpobvlpKfkuo4wJyk7XHJcbiAgICAgICAgICAgICAgaWYodGVtcGxhdGUuc2FtZU1vYmlsZU9uZURheSA9PT0gJycpIHRocm93KHRlbXBsYXRlLm5hbWUgKyAn55qE5omL5py65Y+356CB5qyh5pWw6ZmQ5Yi25LiN6IO95Li656m6Jyk7XHJcbiAgICAgICAgICAgICAgaWYodGVtcGxhdGUuc2FtZU1vYmlsZU9uZURheSA8PSAwKSB0aHJvdyh0ZW1wbGF0ZS5uYW1lICsgJ+eahOaJi+acuuWPt+eggeasoeaVsOmZkOWItuW/hemhu+Wkp+S6jjAnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHZhciBjaGVja1N0cmluZyA9IE5LQy5tZXRob2RzLmNoZWNrRGF0YS5jaGVja1N0cmluZztcclxuICAgICAgICAgIHNtc1NldHRpbmdzLnJlc3RyaWN0ZWROdW1iZXIuZm9yRWFjaChmdW5jdGlvbiAoZWxlKSB7XHJcbiAgICAgICAgICAgIGVsZS5udW1iZXIgPSBlbGUubnVtYmVyLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIGNoZWNrU3RyaW5nKGVsZS5jb2RlLCB7XHJcbiAgICAgICAgICAgICAgbmFtZTogXCLlm73pmYXljLrlj7dcIixcclxuICAgICAgICAgICAgICBtaW5MZW5ndGg6IDEsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjaGVja1N0cmluZyhlbGUubnVtYmVyLHtcclxuICAgICAgICAgICAgICBuYW1lOiAn5Y+X6ZmQ5Y+356CBJyxcclxuICAgICAgICAgICAgICBtaW5MZW5ndGg6ICcxJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZWxlLm51bWJlciA9IGVsZS5udW1iZXIudHJpbSgpLnNwbGl0KCcsJykuZmlsdGVyKGZ1bmN0aW9uIChuKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG4udHJpbSgpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIHJldHVybiBua2NBUEkoJy9lL3NldHRpbmdzL3NtcycsICdQQVRDSCcsIHtzbXNTZXR0aW5nczogc21zU2V0dGluZ3N9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBzd2VldFN1Y2Nlc3MoXCLkv53lrZjmiJDlip9cIik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcilcclxuICAgIH1cclxuICB9XHJcbn0pO1xyXG4iXX0=
