extends ../../experimental
block eTitle
  title 专业设置
  +includeCSS('/experimental/settings/forum/forum.css')
block eContent
  #data.hidden=objToStr({forumCategories: data.forumCategories, forums: data.forums, forumSettings: data.forumSettings})
  .container-fluid.max-width#app(v-cloak)
    .row
      .col-xs-12.col-md-12
        h4 刷新专业数据（文章数、回复数等）
        button.btn.btn-danger(@click='updateForums' v-if='!updating') 立即刷新
        button.btn.btn-danger(v-else disabled) 刷新中...
          .fa.fa-spinner.fa-spin
        h4 新建专业
        .form.form-inline.m-b-2
          .form-group
            input.form-control(type='text' v-model.tirm='forumName' placeholder='请输入专业名称')
          .form-group
            button.btn.btn-default(@click='addForum') 提交
        h4 回收站（用于存放被删文章的专业）
        .form.form-inline.m-b-2
          .form-group
            input.form-control(type='text' v-model.tirm='forumSettings.recycle' placeholder='请输入专业ID')
        //
          h4 专业排序
          .forums.m-b-2
            .forum(v-for='f, index in forums')
              .forum-top(:data-float-fid='f.fid')
                img.forum-avatar(:src="getUrl('forumLogo', f.logo)")
                a(:href="'/f/' + f.fid" target="_blank").forum-name {{f.displayName}}
              .forum-bottom
                button.btn.btn-default.btn-xs(@click='move(index, forums, "left")')
                  | &nbsp;
                  .fa.fa-angle-left
                  | &nbsp;
                button.btn.btn-default.btn-xs(@click='move(index, forums, "right")')
                  | &nbsp;
                  .fa.fa-angle-right
                  | &nbsp;
        h4 专业分类
        .categories.m-b-2
          div
            table.table.table-bordered
              thead
                tr
                  th 名称
                  th 简介
                  th 专业显示风格
                  th 互斥
                  th 其他
              tbody
                tr(v-for='c, index in forumCategories')
                  th
                    input.form-control(type='text' v-model.trim='c.name')
                  th
                    textarea.form-control(v-model.trim='c.description')
                  th
                    .radio
                      label.m-r-05
                        input(type='radio' value='simple' v-model='c.displayStyle')
                        span 简单
                      label.m-r-05
                        input(type='radio' value='normal' v-model='c.displayStyle')
                        span 正常
                      label
                        input(type='radio' value='detailed' v-model='c.displayStyle')
                        span 详细
                  th(style='min-width: 20rem;')
                    .checkbox
                      label.m-r-1
                        input(type='checkbox' :value='true' v-model='c.mutuallyExclusiveWithSelf')
                        span 与自己互斥
                      label
                        input(type='checkbox' :value='true' v-model='c.mutuallyExclusiveWithOthers')
                        span 与其他大类互斥
                  th
                    button.btn.btn-xs.btn-default(@click='move(index, forumCategories, "left")') 上移
                    button.btn.btn-xs.btn-default(@click='move(index, forumCategories, "right")') 下移
                    button.btn.btn-xs.btn-default(@click='remove(index, forumCategories)') 删除
          .m-t-1
            button.btn.btn-default(@click='addForumCategory') 添加分类
        mixin renderForums(forums, paddingLeft)
          -paddingLeft = paddingLeft || 0.5;
          for f in forums
            tr
              th.order-th(style=`padding-left: ${paddingLeft}rem`)
                input.order.m-r-1(value=f.order data-name='forumOrder' data-fid=f.fid)
                a.forum-displayName(href=tools.getUrl('forumHome', f.fid) target="_blank" data-float-fid=f.fid).name=f.displayName
              th
                .radio
                  label.m-r-05
                    input(type='radio' value='abstract' data-name='forumThreadList' data-fid=f.fid checked=f.threadListStyle.type === 'abstract')
                    span 摘要
                  label.m-r-05
                    input(type='radio' value='brief' data-name='forumThreadList' data-fid=f.fid checked=f.threadListStyle.type === 'brief')
                    span 简略
                  label
                    input(type='radio' value='minimalist' data-name='forumThreadList' data-fid=f.fid checked=f.threadListStyle.type === 'minimalist')
                    span 极简
              th
                .radio
                  label.m-r-05
                    input(type='radio' value='left' data-name='forumCover' data-fid=f.fid checked=f.threadListStyle.cover === 'left')
                    span 左侧
                  label.m-r-05
                    input(type='radio' value='right' data-name='forumCover' data-fid=f.fid checked=f.threadListStyle.cover === 'right')
                    span 右侧
                  label
                    input(type='radio' value='null' data-name='forumCover' data-fid=f.fid checked=f.threadListStyle.cover === 'null')
                    span 不显示
            +renderForums(f.childForums, paddingLeft + 2)
        h4 专业排序
        .forums-order.m-b-2
          table.table.table-bordered
            thead
              tr
                th 序号 名称
                th 文章列表模式
                  .radio
                    label.m-r-05
                      input(type='radio' value='abstract' data-name='allThreadList' onclick='app.selectAllThreadListStyle("abstract")')
                      span 摘要
                    label.m-r-05
                      input(type='radio' value='brief' data-name='allThreadList' onclick='app.selectAllThreadListStyle("brief")')
                      span 简略
                    label
                      input(type='radio' value='minimalist' data-name='allThreadList' onclick='app.selectAllThreadListStyle("minimalist")')
                      span 极简
                th 文章列表封面图
                  .radio
                    label.m-r-05
                      input(type='radio' value='left' data-name='allCover' onclick='app.selectAllCover("left")')
                      span 左侧
                    label.m-r-05
                      input(type='radio' value='right' data-name='allCover' onclick='app.selectAllCover("right")')
                      span 右侧
                    label
                      input(type='radio' value='null' data-name='allCover' onclick='app.selectAllCover("null")')
                      span 不显示
            tbody
              +renderForums(data.forums)
        .m-t-05
          button.btn.btn-primary(@click='save') 保存
block scripts
  include ../../../publicModules/subscribeTypes/subscribeTypes
  include ../../../publicModules/floatForumPanel/floatForumPanel
  +includeJS('/experimental/settings/forum/forum.js')
