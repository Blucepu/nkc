(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function saveAdsOrder() {
  var arr = $('input[name="threadOrder"]');
  var orders = [];
  var ads = [];

  for (var i = 0; i < arr.length; i++) {
    var tid = arr.eq(i).attr('data-tid');
    var order = arr.eq(i).val();
    order = parseInt(order);

    if (orders.length === 0) {
      orders.push(order);
      ads.push(tid);
    } else {
      var pushed = false;

      for (var j = 0; j < orders.length; j++) {
        if (orders[j] > order) {
          orders.splice(j, 0, order);
          ads.splice(j, 0, tid);
          pushed = true;
          break;
        }
      }

      if (!pushed) {
        orders.push(order);
        ads.push(tid);
      }
    }
  }

  nkcAPI('/e/settings/home/top', 'PATCH', {
    operation: 'modifyOrder',
    ads: ads
  }).then(function () {
    window.location.reload();
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
}

$('#inputFile').on('change', function () {
  var file = $('#inputFile')[0].files[0];

  if (file) {
    upLoadFile = file;
    var formData = new FormData();
    formData.append('file', upLoadFile);
    $.ajax({
      url: '/logo',
      method: 'POST',
      cache: false,
      data: formData,
      headers: {
        'FROM': 'nkcAPI'
      },
      dataType: 'json',
      contentType: false,
      processData: false
    }).done(function () {
      window.location.reload();
    }).fail(function (data) {
      screenTopWarning(JSON.parse(data.responseText).error);
    });
  }
});

function defaultLogo(id, type) {
  nkcAPI('/e/settings/home/logo', 'PATCH', {
    id: id,
    type: type,
    operation: 'saveLogo'
  }).then(function () {
    window.location.reload();
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
}

function deleteLogo(id) {
  nkcAPI('/e/settings/home/logo?id=' + id, 'DELETE', {}).then(function () {
    window.location.reload();
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
}

window.saveNotice = function saveNotice() {
  var value = $('#threadId').val();
  var arr = value.split(',');
  nkcAPI('/e/settings/home/notice', 'PATCH', {
    id: arr
  }).then(function () {
    window.location.reload();
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
};

function removeNotice(oc) {
  nkcAPI('/e/settings/home/notice?oc=' + oc, 'DELETE', {}).then(function () {
    window.location.reload();
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
}

function saveWaterMarkSettings() {
  var watermarkTransparency = $('#watermarkTransparency').val();
  var waterLimitMinWidth = $("#waterLimitMinWidth").val();
  var waterLimitMinHeight = $("#waterLimitMinHeight").val();
  nkcAPI('/e/settings/home/logo', 'PATCH', {
    watermarkTransparency: watermarkTransparency,
    waterLimitMinWidth: parseInt(waterLimitMinWidth),
    waterLimitMinHeight: parseInt(waterLimitMinHeight),
    operation: 'saveWaterMarkSettings'
  }).then(function () {
    screenTopAlert('保存成功');
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
}

function uploadHomeBigLogo(files) {
  var form = new FormData();
  files.forEach(function (file, index) {
    form.append('file' + index, file);
  });
  return nkcUploadFile("/e/settings/home/list/biglogo", "POST", form);
}

function saveHomeListSettings() {
  var inputs = $('input[name="list"]');
  var topic = inputs.eq(0).is(':checked');
  var discipline = inputs.eq(1).is(':checked');
  var visitorThreadList = $('input[name="visitor"]');
  visitorThreadList = visitorThreadList.eq(0).is(":checked") ? "latest" : "recommend";
  nkcAPI('/e/settings/home/list', 'PATCH', {
    topic: topic,
    discipline: discipline,
    visitorThreadList: visitorThreadList
  }).then(function () {
    screenTopAlert('保存成功');
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
}

var vueDom = document.getElementById("app");

if (vueDom) {
  var app = new Vue({
    el: '#app',
    data: {
      homeSettings: '',
      info: '',
      list: [],
      recommend: [],
      error: "",
      logoFiles: [],
      logoFileUploadding: false
    },
    beforeMount: function beforeMount() {
      var data = NKC.methods.getDataById("data");

      if (data.homeSettings.list.topic) {
        this.list.push("topic");
      }

      if (data.homeSettings.list.discipline) {
        this.list.push("discipline");
      }

      if (data.homeSettings.recommend.featuredThreads) {
        this.recommend.push("featuredThreads");
      }

      if (data.homeSettings.recommend.hotThreads) {
        this.recommend.push("hotThreads");
      }

      this.homeSettings = data.homeSettings;

      if (data.homeBigLogo) {
        this.logoFiles = this.logoFiles.concat(data.homeBigLogo);
      }
    },
    methods: {
      save: function save() {
        this.error = "";
        this.info = "";
        var homeSettings = this.homeSettings;
        var list = this.list;
        homeSettings.list.topic = false;
        homeSettings.list.discipline = false;
        if (homeSettings.hotThreads.postCount < 0) return this.error = "热门文章最小回复数不能小于0";
        if (homeSettings.hotThreads.postUserCount < 0) return this.error = "热门文章最小回复用户总数不能小于0";
        var recommend = this.recommend;
        homeSettings.recommend.hotThreads = false;
        homeSettings.recommend.featuredThreads = false;
        if (recommend.indexOf("hotThreads") !== -1) homeSettings.recommend.hotThreads = true;
        if (recommend.indexOf("featuredThreads") !== -1) homeSettings.recommend.featuredThreads = true;
        if (homeSettings.recommend.voteUpTotal < 0) return this.error = "推荐条件中点赞总数不能小于0";
        if (homeSettings.recommend.voteUpMax < 0) return this.error = "推荐条件中独立点赞数不能小于0";
        if (homeSettings.recommend.encourageTotal < 0) return this.error = "推荐条件中鼓励次数不能小于0";

        if (list.indexOf('topic') !== -1) {
          homeSettings.list.topic = true;
        }

        if (list.indexOf("discipline") !== -1) {
          homeSettings.list.discipline = true;
        }

        nkcAPI('/e/settings/home/list', 'PATCH', {
          topic: homeSettings.list.topic,
          discipline: homeSettings.list.discipline,
          visitorThreadList: homeSettings.visitorThreadList,
          hotThreads: homeSettings.hotThreads,
          recommend: homeSettings.recommend
        }).then(function () {
          sweetSuccess('保存成功');
        })["catch"](function (data) {
          app.error = data.error || data;
        });
      },
      pickPicture: function pickPicture() {
        $("#inputFile").click();
      },
      addFile: function addFile() {
        var self = this;
        var files = [].slice.call($("#inputFile")[0].files);
        self.logoFileUploadding = true;
        uploadHomeBigLogo(files).then(function (data) {
          self.logoFiles = self.logoFiles.concat(data.saved);
          self.logoFileUploadding = false;
        });
        $("#inputFile").val("");
      },
      deleteBigLogo: function deleteBigLogo(index) {
        var logoFiles = this.logoFiles;
        var fileItem = logoFiles[index];
        nkcAPI("/e/settings/home/list/biglogo", "POST", {
          type: "delete",
          aid: fileItem.aid
        }).then(function () {
          logoFiles.splice(index, 1);
          screenTopAlert('删除成功');
        })["catch"](function (err) {
          screenTopAlert(err.error);
        });
      }
    }
  });
}

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL2V4cGVyaW1lbnRhbC9zZXR0aW5ncy9ob21lLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsU0FBUyxZQUFULEdBQXdCO0FBQ3ZCLE1BQUksR0FBRyxHQUFHLENBQUMsQ0FBQywyQkFBRCxDQUFYO0FBQ0EsTUFBSSxNQUFNLEdBQUcsRUFBYjtBQUNBLE1BQUksR0FBRyxHQUFHLEVBQVY7O0FBQ0EsT0FBSSxJQUFJLENBQUMsR0FBRyxDQUFaLEVBQWUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUF2QixFQUErQixDQUFDLEVBQWhDLEVBQW9DO0FBQ25DLFFBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxFQUFKLENBQU8sQ0FBUCxFQUFVLElBQVYsQ0FBZSxVQUFmLENBQVY7QUFDQSxRQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsRUFBSixDQUFPLENBQVAsRUFBVSxHQUFWLEVBQVo7QUFDQSxJQUFBLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBRCxDQUFoQjs7QUFDQSxRQUFHLE1BQU0sQ0FBQyxNQUFQLEtBQWtCLENBQXJCLEVBQXdCO0FBQ3ZCLE1BQUEsTUFBTSxDQUFDLElBQVAsQ0FBWSxLQUFaO0FBQ0EsTUFBQSxHQUFHLENBQUMsSUFBSixDQUFTLEdBQVQ7QUFDQSxLQUhELE1BR087QUFDTixVQUFJLE1BQU0sR0FBRyxLQUFiOztBQUNBLFdBQUksSUFBSSxDQUFDLEdBQUcsQ0FBWixFQUFlLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBMUIsRUFBa0MsQ0FBQyxFQUFuQyxFQUF1QztBQUN0QyxZQUFHLE1BQU0sQ0FBQyxDQUFELENBQU4sR0FBWSxLQUFmLEVBQXNCO0FBQ3JCLFVBQUEsTUFBTSxDQUFDLE1BQVAsQ0FBYyxDQUFkLEVBQWlCLENBQWpCLEVBQW9CLEtBQXBCO0FBQ0EsVUFBQSxHQUFHLENBQUMsTUFBSixDQUFXLENBQVgsRUFBYyxDQUFkLEVBQWlCLEdBQWpCO0FBQ0EsVUFBQSxNQUFNLEdBQUcsSUFBVDtBQUNBO0FBQ0E7QUFDRDs7QUFDRCxVQUFHLENBQUMsTUFBSixFQUFZO0FBQ1gsUUFBQSxNQUFNLENBQUMsSUFBUCxDQUFZLEtBQVo7QUFDQSxRQUFBLEdBQUcsQ0FBQyxJQUFKLENBQVMsR0FBVDtBQUNBO0FBQ0Q7QUFDRDs7QUFDRCxFQUFBLE1BQU0sQ0FBQyxzQkFBRCxFQUF5QixPQUF6QixFQUFrQztBQUFDLElBQUEsU0FBUyxFQUFFLGFBQVo7QUFBMkIsSUFBQSxHQUFHLEVBQUU7QUFBaEMsR0FBbEMsQ0FBTixDQUNFLElBREYsQ0FDTyxZQUFXO0FBQ2hCLElBQUEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsTUFBaEI7QUFDQSxHQUhGLFdBSVEsVUFBUyxJQUFULEVBQWU7QUFDckIsSUFBQSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsS0FBTCxJQUFZLElBQWIsQ0FBaEI7QUFDQSxHQU5GO0FBT0E7O0FBSUQsQ0FBQyxDQUFDLFlBQUQsQ0FBRCxDQUFnQixFQUFoQixDQUFtQixRQUFuQixFQUE2QixZQUFXO0FBQ3ZDLE1BQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxZQUFELENBQUQsQ0FBZ0IsQ0FBaEIsRUFBbUIsS0FBbkIsQ0FBeUIsQ0FBekIsQ0FBWDs7QUFDQSxNQUFHLElBQUgsRUFBUztBQUNSLElBQUEsVUFBVSxHQUFHLElBQWI7QUFDQSxRQUFJLFFBQVEsR0FBRyxJQUFJLFFBQUosRUFBZjtBQUNBLElBQUEsUUFBUSxDQUFDLE1BQVQsQ0FBZ0IsTUFBaEIsRUFBd0IsVUFBeEI7QUFDQSxJQUFBLENBQUMsQ0FBQyxJQUFGLENBQU87QUFDTixNQUFBLEdBQUcsRUFBRSxPQURDO0FBRU4sTUFBQSxNQUFNLEVBQUUsTUFGRjtBQUdOLE1BQUEsS0FBSyxFQUFFLEtBSEQ7QUFJTixNQUFBLElBQUksRUFBRSxRQUpBO0FBS04sTUFBQSxPQUFPLEVBQUU7QUFDUixnQkFBUTtBQURBLE9BTEg7QUFRTixNQUFBLFFBQVEsRUFBRSxNQVJKO0FBU04sTUFBQSxXQUFXLEVBQUUsS0FUUDtBQVVOLE1BQUEsV0FBVyxFQUFFO0FBVlAsS0FBUCxFQVlFLElBWkYsQ0FZTyxZQUFXO0FBQ2hCLE1BQUEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsTUFBaEI7QUFDQSxLQWRGLEVBZUUsSUFmRixDQWVPLFVBQVMsSUFBVCxFQUFlO0FBQ3BCLE1BQUEsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUwsQ0FBVyxJQUFJLENBQUMsWUFBaEIsRUFBOEIsS0FBL0IsQ0FBaEI7QUFDQSxLQWpCRjtBQWtCQTtBQUNELENBekJEOztBQTJCQSxTQUFTLFdBQVQsQ0FBcUIsRUFBckIsRUFBeUIsSUFBekIsRUFBK0I7QUFDOUIsRUFBQSxNQUFNLENBQUMsdUJBQUQsRUFBMEIsT0FBMUIsRUFBbUM7QUFBQyxJQUFBLEVBQUUsRUFBRSxFQUFMO0FBQVMsSUFBQSxJQUFJLEVBQUUsSUFBZjtBQUFxQixJQUFBLFNBQVMsRUFBRTtBQUFoQyxHQUFuQyxDQUFOLENBQ0UsSUFERixDQUNPLFlBQVc7QUFDaEIsSUFBQSxNQUFNLENBQUMsUUFBUCxDQUFnQixNQUFoQjtBQUNBLEdBSEYsV0FJUSxVQUFTLElBQVQsRUFBZTtBQUNyQixJQUFBLGdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFMLElBQWEsSUFBZCxDQUFoQjtBQUNBLEdBTkY7QUFPQTs7QUFFRCxTQUFTLFVBQVQsQ0FBb0IsRUFBcEIsRUFBd0I7QUFDdkIsRUFBQSxNQUFNLENBQUMsOEJBQTZCLEVBQTlCLEVBQWtDLFFBQWxDLEVBQTRDLEVBQTVDLENBQU4sQ0FDRSxJQURGLENBQ08sWUFBVztBQUNoQixJQUFBLE1BQU0sQ0FBQyxRQUFQLENBQWdCLE1BQWhCO0FBQ0EsR0FIRixXQUlRLFVBQVMsSUFBVCxFQUFlO0FBQ3JCLElBQUEsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUwsSUFBYSxJQUFkLENBQWhCO0FBQ0EsR0FORjtBQU9BOztBQUVELE1BQU0sQ0FBQyxVQUFQLEdBQW9CLFNBQVMsVUFBVCxHQUFzQjtBQUN6QyxNQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsV0FBRCxDQUFELENBQWUsR0FBZixFQUFaO0FBQ0EsTUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFDLEtBQU4sQ0FBWSxHQUFaLENBQVY7QUFDQSxFQUFBLE1BQU0sQ0FBQyx5QkFBRCxFQUE0QixPQUE1QixFQUFxQztBQUFDLElBQUEsRUFBRSxFQUFFO0FBQUwsR0FBckMsQ0FBTixDQUNFLElBREYsQ0FDTyxZQUFXO0FBQ2hCLElBQUEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsTUFBaEI7QUFDQSxHQUhGLFdBSVEsVUFBUyxJQUFULEVBQWU7QUFDckIsSUFBQSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsS0FBTCxJQUFhLElBQWQsQ0FBaEI7QUFDQSxHQU5GO0FBT0EsQ0FWRDs7QUFZQSxTQUFTLFlBQVQsQ0FBc0IsRUFBdEIsRUFBMEI7QUFDekIsRUFBQSxNQUFNLENBQUMsZ0NBQThCLEVBQS9CLEVBQW1DLFFBQW5DLEVBQTZDLEVBQTdDLENBQU4sQ0FDRSxJQURGLENBQ08sWUFBVztBQUNoQixJQUFBLE1BQU0sQ0FBQyxRQUFQLENBQWdCLE1BQWhCO0FBQ0EsR0FIRixXQUlRLFVBQVMsSUFBVCxFQUFlO0FBQ3JCLElBQUEsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUwsSUFBYSxJQUFkLENBQWhCO0FBQ0EsR0FORjtBQU9BOztBQUVELFNBQVMscUJBQVQsR0FBaUM7QUFDaEMsTUFBSSxxQkFBcUIsR0FBRyxDQUFDLENBQUMsd0JBQUQsQ0FBRCxDQUE0QixHQUE1QixFQUE1QjtBQUNBLE1BQUksa0JBQWtCLEdBQUcsQ0FBQyxDQUFDLHFCQUFELENBQUQsQ0FBeUIsR0FBekIsRUFBekI7QUFDQyxNQUFJLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxzQkFBRCxDQUFELENBQTBCLEdBQTFCLEVBQTFCO0FBQ0QsRUFBQSxNQUFNLENBQUMsdUJBQUQsRUFBMEIsT0FBMUIsRUFBbUM7QUFDeEMsSUFBQSxxQkFBcUIsRUFBRSxxQkFEaUI7QUFFdEMsSUFBQSxrQkFBa0IsRUFBRSxRQUFRLENBQUMsa0JBQUQsQ0FGVTtBQUd0QyxJQUFBLG1CQUFtQixFQUFFLFFBQVEsQ0FBQyxtQkFBRCxDQUhTO0FBSXhDLElBQUEsU0FBUyxFQUFFO0FBSjZCLEdBQW5DLENBQU4sQ0FNRSxJQU5GLENBTU8sWUFBVztBQUNoQixJQUFBLGNBQWMsQ0FBQyxNQUFELENBQWQ7QUFDQSxHQVJGLFdBU1EsVUFBUyxJQUFULEVBQWU7QUFDckIsSUFBQSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsS0FBTCxJQUFhLElBQWQsQ0FBaEI7QUFDQSxHQVhGO0FBWUE7O0FBR0QsU0FBUyxpQkFBVCxDQUEyQixLQUEzQixFQUFrQztBQUNqQyxNQUFJLElBQUksR0FBRyxJQUFJLFFBQUosRUFBWDtBQUNBLEVBQUEsS0FBSyxDQUFDLE9BQU4sQ0FBYyxVQUFTLElBQVQsRUFBZSxLQUFmLEVBQXFCO0FBQ2xDLElBQUEsSUFBSSxDQUFDLE1BQUwsQ0FBWSxTQUFTLEtBQXJCLEVBQTRCLElBQTVCO0FBQ0EsR0FGRDtBQUdBLFNBQU8sYUFBYSxDQUFDLCtCQUFELEVBQWtDLE1BQWxDLEVBQTBDLElBQTFDLENBQXBCO0FBQ0E7O0FBRUQsU0FBUyxvQkFBVCxHQUFnQztBQUM5QixNQUFJLE1BQU0sR0FBRyxDQUFDLENBQUMsb0JBQUQsQ0FBZDtBQUNBLE1BQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxFQUFQLENBQVUsQ0FBVixFQUFhLEVBQWIsQ0FBZ0IsVUFBaEIsQ0FBWjtBQUNBLE1BQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxFQUFQLENBQVUsQ0FBVixFQUFhLEVBQWIsQ0FBZ0IsVUFBaEIsQ0FBakI7QUFDQSxNQUFJLGlCQUFpQixHQUFHLENBQUMsQ0FBQyx1QkFBRCxDQUF6QjtBQUNBLEVBQUEsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUMsRUFBbEIsQ0FBcUIsQ0FBckIsRUFBd0IsRUFBeEIsQ0FBMkIsVUFBM0IsSUFBdUMsUUFBdkMsR0FBaUQsV0FBckU7QUFDQSxFQUFBLE1BQU0sQ0FBQyx1QkFBRCxFQUEwQixPQUExQixFQUFtQztBQUN2QyxJQUFBLEtBQUssRUFBRSxLQURnQztBQUV2QyxJQUFBLFVBQVUsRUFBRSxVQUYyQjtBQUd2QyxJQUFBLGlCQUFpQixFQUFFO0FBSG9CLEdBQW5DLENBQU4sQ0FLQyxJQUxELENBS00sWUFBVztBQUNmLElBQUEsY0FBYyxDQUFDLE1BQUQsQ0FBZDtBQUNELEdBUEQsV0FRTyxVQUFTLElBQVQsRUFBZTtBQUNwQixJQUFBLGdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFMLElBQWMsSUFBZixDQUFoQjtBQUNELEdBVkQ7QUFXRDs7QUFDRCxJQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsY0FBVCxDQUF3QixLQUF4QixDQUFiOztBQUNBLElBQUcsTUFBSCxFQUFXO0FBQ1QsTUFBSSxHQUFHLEdBQUcsSUFBSSxHQUFKLENBQVE7QUFDaEIsSUFBQSxFQUFFLEVBQUUsTUFEWTtBQUVoQixJQUFBLElBQUksRUFBRTtBQUNKLE1BQUEsWUFBWSxFQUFFLEVBRFY7QUFFSixNQUFBLElBQUksRUFBRSxFQUZGO0FBR0osTUFBQSxJQUFJLEVBQUUsRUFIRjtBQUlKLE1BQUEsU0FBUyxFQUFFLEVBSlA7QUFLUCxNQUFBLEtBQUssRUFBRSxFQUxBO0FBTVAsTUFBQSxTQUFTLEVBQUUsRUFOSjtBQU9QLE1BQUEsa0JBQWtCLEVBQUU7QUFQYixLQUZVO0FBV2hCLElBQUEsV0FBVyxFQUFFLHVCQUFXO0FBQ3RCLFVBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFKLENBQVksV0FBWixDQUF3QixNQUF4QixDQUFYOztBQUNBLFVBQUcsSUFBSSxDQUFDLFlBQUwsQ0FBa0IsSUFBbEIsQ0FBdUIsS0FBMUIsRUFBaUM7QUFDL0IsYUFBSyxJQUFMLENBQVUsSUFBVixDQUFlLE9BQWY7QUFDRDs7QUFDRCxVQUFHLElBQUksQ0FBQyxZQUFMLENBQWtCLElBQWxCLENBQXVCLFVBQTFCLEVBQXNDO0FBQ3BDLGFBQUssSUFBTCxDQUFVLElBQVYsQ0FBZSxZQUFmO0FBQ0Q7O0FBQ0QsVUFBRyxJQUFJLENBQUMsWUFBTCxDQUFrQixTQUFsQixDQUE0QixlQUEvQixFQUFnRDtBQUM5QyxhQUFLLFNBQUwsQ0FBZSxJQUFmLENBQW9CLGlCQUFwQjtBQUNEOztBQUNELFVBQUcsSUFBSSxDQUFDLFlBQUwsQ0FBa0IsU0FBbEIsQ0FBNEIsVUFBL0IsRUFBMkM7QUFDekMsYUFBSyxTQUFMLENBQWUsSUFBZixDQUFvQixZQUFwQjtBQUNKOztBQUNELFdBQUssWUFBTCxHQUFvQixJQUFJLENBQUMsWUFBekI7O0FBQ0EsVUFBRyxJQUFJLENBQUMsV0FBUixFQUFxQjtBQUNwQixhQUFLLFNBQUwsR0FBaUIsS0FBSyxTQUFMLENBQWUsTUFBZixDQUFzQixJQUFJLENBQUMsV0FBM0IsQ0FBakI7QUFDQTtBQUNDLEtBN0JlO0FBOEJoQixJQUFBLE9BQU8sRUFBRTtBQUNQLE1BQUEsSUFBSSxFQUFFLGdCQUFXO0FBQ2YsYUFBSyxLQUFMLEdBQWEsRUFBYjtBQUNBLGFBQUssSUFBTCxHQUFZLEVBQVo7QUFDQSxZQUFJLFlBQVksR0FBRyxLQUFLLFlBQXhCO0FBQ0EsWUFBSSxJQUFJLEdBQUcsS0FBSyxJQUFoQjtBQUNBLFFBQUEsWUFBWSxDQUFDLElBQWIsQ0FBa0IsS0FBbEIsR0FBMEIsS0FBMUI7QUFDQSxRQUFBLFlBQVksQ0FBQyxJQUFiLENBQWtCLFVBQWxCLEdBQStCLEtBQS9CO0FBQ0EsWUFBRyxZQUFZLENBQUMsVUFBYixDQUF3QixTQUF4QixHQUFvQyxDQUF2QyxFQUEwQyxPQUFPLEtBQUssS0FBTCxHQUFhLGdCQUFwQjtBQUMxQyxZQUFHLFlBQVksQ0FBQyxVQUFiLENBQXdCLGFBQXhCLEdBQXdDLENBQTNDLEVBQThDLE9BQU8sS0FBSyxLQUFMLEdBQWEsbUJBQXBCO0FBQzlDLFlBQUksU0FBUyxHQUFHLEtBQUssU0FBckI7QUFDQSxRQUFBLFlBQVksQ0FBQyxTQUFiLENBQXVCLFVBQXZCLEdBQW9DLEtBQXBDO0FBQ0EsUUFBQSxZQUFZLENBQUMsU0FBYixDQUF1QixlQUF2QixHQUF5QyxLQUF6QztBQUVBLFlBQUcsU0FBUyxDQUFDLE9BQVYsQ0FBa0IsWUFBbEIsTUFBb0MsQ0FBQyxDQUF4QyxFQUEyQyxZQUFZLENBQUMsU0FBYixDQUF1QixVQUF2QixHQUFvQyxJQUFwQztBQUMzQyxZQUFHLFNBQVMsQ0FBQyxPQUFWLENBQWtCLGlCQUFsQixNQUF5QyxDQUFDLENBQTdDLEVBQWdELFlBQVksQ0FBQyxTQUFiLENBQXVCLGVBQXZCLEdBQXlDLElBQXpDO0FBQ2hELFlBQUcsWUFBWSxDQUFDLFNBQWIsQ0FBdUIsV0FBdkIsR0FBcUMsQ0FBeEMsRUFBMkMsT0FBTyxLQUFLLEtBQUwsR0FBYSxnQkFBcEI7QUFDM0MsWUFBRyxZQUFZLENBQUMsU0FBYixDQUF1QixTQUF2QixHQUFtQyxDQUF0QyxFQUF5QyxPQUFPLEtBQUssS0FBTCxHQUFhLGlCQUFwQjtBQUN6QyxZQUFHLFlBQVksQ0FBQyxTQUFiLENBQXVCLGNBQXZCLEdBQXdDLENBQTNDLEVBQThDLE9BQU8sS0FBSyxLQUFMLEdBQWEsZ0JBQXBCOztBQUM5QyxZQUFHLElBQUksQ0FBQyxPQUFMLENBQWEsT0FBYixNQUEwQixDQUFDLENBQTlCLEVBQWlDO0FBQy9CLFVBQUEsWUFBWSxDQUFDLElBQWIsQ0FBa0IsS0FBbEIsR0FBMEIsSUFBMUI7QUFDRDs7QUFDRCxZQUFHLElBQUksQ0FBQyxPQUFMLENBQWEsWUFBYixNQUErQixDQUFDLENBQW5DLEVBQXNDO0FBQ3BDLFVBQUEsWUFBWSxDQUFDLElBQWIsQ0FBa0IsVUFBbEIsR0FBK0IsSUFBL0I7QUFDRDs7QUFDRCxRQUFBLE1BQU0sQ0FBQyx1QkFBRCxFQUEwQixPQUExQixFQUFtQztBQUN2QyxVQUFBLEtBQUssRUFBRSxZQUFZLENBQUMsSUFBYixDQUFrQixLQURjO0FBRXZDLFVBQUEsVUFBVSxFQUFFLFlBQVksQ0FBQyxJQUFiLENBQWtCLFVBRlM7QUFHdkMsVUFBQSxpQkFBaUIsRUFBRSxZQUFZLENBQUMsaUJBSE87QUFJdkMsVUFBQSxVQUFVLEVBQUUsWUFBWSxDQUFDLFVBSmM7QUFLdkMsVUFBQSxTQUFTLEVBQUUsWUFBWSxDQUFDO0FBTGUsU0FBbkMsQ0FBTixDQU9HLElBUEgsQ0FPUSxZQUFXO0FBQ2hCLFVBQUEsWUFBWSxDQUFDLE1BQUQsQ0FBWjtBQUNBLFNBVEgsV0FVUyxVQUFTLElBQVQsRUFBZTtBQUNwQixVQUFBLEdBQUcsQ0FBQyxLQUFKLEdBQVksSUFBSSxDQUFDLEtBQUwsSUFBYyxJQUExQjtBQUNELFNBWkg7QUFhSixPQXRDUztBQXVDVixNQUFBLFdBQVcsRUFBRSx1QkFBVztBQUN2QixRQUFBLENBQUMsQ0FBQyxZQUFELENBQUQsQ0FBZ0IsS0FBaEI7QUFDQSxPQXpDUztBQTBDVixNQUFBLE9BQU8sRUFBRSxtQkFBVztBQUNuQixZQUFJLElBQUksR0FBRyxJQUFYO0FBQ0EsWUFBSSxLQUFLLEdBQUcsR0FBRyxLQUFILENBQVMsSUFBVCxDQUFjLENBQUMsQ0FBQyxZQUFELENBQUQsQ0FBZ0IsQ0FBaEIsRUFBbUIsS0FBakMsQ0FBWjtBQUNBLFFBQUEsSUFBSSxDQUFDLGtCQUFMLEdBQTBCLElBQTFCO0FBQ0EsUUFBQSxpQkFBaUIsQ0FBQyxLQUFELENBQWpCLENBQ0UsSUFERixDQUNPLFVBQVMsSUFBVCxFQUFjO0FBQ25CLFVBQUEsSUFBSSxDQUFDLFNBQUwsR0FBaUIsSUFBSSxDQUFDLFNBQUwsQ0FBZSxNQUFmLENBQXNCLElBQUksQ0FBQyxLQUEzQixDQUFqQjtBQUNBLFVBQUEsSUFBSSxDQUFDLGtCQUFMLEdBQTBCLEtBQTFCO0FBQ0EsU0FKRjtBQUtBLFFBQUEsQ0FBQyxDQUFDLFlBQUQsQ0FBRCxDQUFnQixHQUFoQixDQUFvQixFQUFwQjtBQUNBLE9BcERTO0FBcURWLE1BQUEsYUFBYSxFQUFFLHVCQUFTLEtBQVQsRUFBZ0I7QUFDOUIsWUFBSSxTQUFTLEdBQUcsS0FBSyxTQUFyQjtBQUNBLFlBQUksUUFBUSxHQUFHLFNBQVMsQ0FBQyxLQUFELENBQXhCO0FBQ0EsUUFBQSxNQUFNLENBQUMsK0JBQUQsRUFBa0MsTUFBbEMsRUFBMEM7QUFDL0MsVUFBQSxJQUFJLEVBQUUsUUFEeUM7QUFFL0MsVUFBQSxHQUFHLEVBQUUsUUFBUSxDQUFDO0FBRmlDLFNBQTFDLENBQU4sQ0FJQyxJQUpELENBSU0sWUFBVTtBQUNmLFVBQUEsU0FBUyxDQUFDLE1BQVYsQ0FBaUIsS0FBakIsRUFBd0IsQ0FBeEI7QUFDQSxVQUFBLGNBQWMsQ0FBQyxNQUFELENBQWQ7QUFDQSxTQVBELFdBUU8sVUFBQSxHQUFHLEVBQUk7QUFDYixVQUFBLGNBQWMsQ0FBQyxHQUFHLENBQUMsS0FBTCxDQUFkO0FBQ0EsU0FWRDtBQVdBO0FBbkVTO0FBOUJPLEdBQVIsQ0FBVjtBQW9HRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImZ1bmN0aW9uIHNhdmVBZHNPcmRlcigpIHtcclxuXHR2YXIgYXJyID0gJCgnaW5wdXRbbmFtZT1cInRocmVhZE9yZGVyXCJdJyk7XHJcblx0dmFyIG9yZGVycyA9IFtdO1xyXG5cdHZhciBhZHMgPSBbXTtcclxuXHRmb3IodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XHJcblx0XHR2YXIgdGlkID0gYXJyLmVxKGkpLmF0dHIoJ2RhdGEtdGlkJyk7XHJcblx0XHR2YXIgb3JkZXIgPSBhcnIuZXEoaSkudmFsKCk7XHJcblx0XHRvcmRlciA9IHBhcnNlSW50KG9yZGVyKTtcclxuXHRcdGlmKG9yZGVycy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0b3JkZXJzLnB1c2gob3JkZXIpO1xyXG5cdFx0XHRhZHMucHVzaCh0aWQpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dmFyIHB1c2hlZCA9IGZhbHNlO1xyXG5cdFx0XHRmb3IodmFyIGogPSAwOyBqIDwgb3JkZXJzLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0aWYob3JkZXJzW2pdID4gb3JkZXIpIHtcclxuXHRcdFx0XHRcdG9yZGVycy5zcGxpY2UoaiwgMCwgb3JkZXIpO1xyXG5cdFx0XHRcdFx0YWRzLnNwbGljZShqLCAwLCB0aWQpO1xyXG5cdFx0XHRcdFx0cHVzaGVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZighcHVzaGVkKSB7XHJcblx0XHRcdFx0b3JkZXJzLnB1c2gob3JkZXIpO1xyXG5cdFx0XHRcdGFkcy5wdXNoKHRpZCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0bmtjQVBJKCcvZS9zZXR0aW5ncy9ob21lL3RvcCcsICdQQVRDSCcsIHtvcGVyYXRpb246ICdtb2RpZnlPcmRlcicsIGFkczogYWRzfSlcclxuXHRcdC50aGVuKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcblx0XHR9KVxyXG5cdFx0LmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0c2NyZWVuVG9wV2FybmluZyhkYXRhLmVycm9yfHxkYXRhKTtcclxuXHRcdH0pXHJcbn1cclxuXHJcblxyXG5cclxuJCgnI2lucHV0RmlsZScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuXHR2YXIgZmlsZSA9ICQoJyNpbnB1dEZpbGUnKVswXS5maWxlc1swXTtcclxuXHRpZihmaWxlKSB7XHJcblx0XHR1cExvYWRGaWxlID0gZmlsZTtcclxuXHRcdHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG5cdFx0Zm9ybURhdGEuYXBwZW5kKCdmaWxlJywgdXBMb2FkRmlsZSk7XHJcblx0XHQkLmFqYXgoe1xyXG5cdFx0XHR1cmw6ICcvbG9nbycsXHJcblx0XHRcdG1ldGhvZDogJ1BPU1QnLFxyXG5cdFx0XHRjYWNoZTogZmFsc2UsXHJcblx0XHRcdGRhdGE6IGZvcm1EYXRhLFxyXG5cdFx0XHRoZWFkZXJzOiB7XHJcblx0XHRcdFx0J0ZST00nOiAnbmtjQVBJJ1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRkYXRhVHlwZTogJ2pzb24nLFxyXG5cdFx0XHRjb250ZW50VHlwZTogZmFsc2UsXHJcblx0XHRcdHByb2Nlc3NEYXRhOiBmYWxzZSxcclxuXHRcdH0pXHJcblx0XHRcdC5kb25lKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuXHRcdFx0fSlcclxuXHRcdFx0LmZhaWwoZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0XHRcdHNjcmVlblRvcFdhcm5pbmcoSlNPTi5wYXJzZShkYXRhLnJlc3BvbnNlVGV4dCkuZXJyb3IpO1xyXG5cdFx0XHR9KVxyXG5cdH1cclxufSk7XHJcblxyXG5mdW5jdGlvbiBkZWZhdWx0TG9nbyhpZCwgdHlwZSkge1xyXG5cdG5rY0FQSSgnL2Uvc2V0dGluZ3MvaG9tZS9sb2dvJywgJ1BBVENIJywge2lkOiBpZCwgdHlwZTogdHlwZSwgb3BlcmF0aW9uOiAnc2F2ZUxvZ28nfSlcclxuXHRcdC50aGVuKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcblx0XHR9KVxyXG5cdFx0LmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0c2NyZWVuVG9wV2FybmluZyhkYXRhLmVycm9yfHwgZGF0YSk7XHJcblx0XHR9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBkZWxldGVMb2dvKGlkKSB7XHJcblx0bmtjQVBJKCcvZS9zZXR0aW5ncy9ob21lL2xvZ28/aWQ9JysgaWQsICdERUxFVEUnLCB7fSlcclxuXHRcdC50aGVuKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcblx0XHR9KVxyXG5cdFx0LmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0c2NyZWVuVG9wV2FybmluZyhkYXRhLmVycm9yfHwgZGF0YSk7XHJcblx0XHR9KVxyXG59XHJcblxyXG53aW5kb3cuc2F2ZU5vdGljZSA9IGZ1bmN0aW9uIHNhdmVOb3RpY2UoKSB7XHJcblx0dmFyIHZhbHVlID0gJCgnI3RocmVhZElkJykudmFsKCk7XHJcblx0dmFyIGFyciA9IHZhbHVlLnNwbGl0KCcsJyk7XHJcblx0bmtjQVBJKCcvZS9zZXR0aW5ncy9ob21lL25vdGljZScsICdQQVRDSCcsIHtpZDogYXJyfSlcclxuXHRcdC50aGVuKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcblx0XHR9KVxyXG5cdFx0LmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0c2NyZWVuVG9wV2FybmluZyhkYXRhLmVycm9yfHwgZGF0YSk7XHJcblx0XHR9KVxyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVOb3RpY2Uob2MpIHtcclxuXHRua2NBUEkoJy9lL3NldHRpbmdzL2hvbWUvbm90aWNlP29jPScrb2MsICdERUxFVEUnLCB7fSlcclxuXHRcdC50aGVuKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcblx0XHR9KVxyXG5cdFx0LmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0c2NyZWVuVG9wV2FybmluZyhkYXRhLmVycm9yfHwgZGF0YSk7XHJcblx0XHR9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBzYXZlV2F0ZXJNYXJrU2V0dGluZ3MoKSB7XHJcblx0dmFyIHdhdGVybWFya1RyYW5zcGFyZW5jeSA9ICQoJyN3YXRlcm1hcmtUcmFuc3BhcmVuY3knKS52YWwoKTtcclxuXHR2YXIgd2F0ZXJMaW1pdE1pbldpZHRoID0gJChcIiN3YXRlckxpbWl0TWluV2lkdGhcIikudmFsKCk7XHJcbiAgdmFyIHdhdGVyTGltaXRNaW5IZWlnaHQgPSAkKFwiI3dhdGVyTGltaXRNaW5IZWlnaHRcIikudmFsKCk7XHJcblx0bmtjQVBJKCcvZS9zZXR0aW5ncy9ob21lL2xvZ28nLCAnUEFUQ0gnLCB7XHJcblx0XHR3YXRlcm1hcmtUcmFuc3BhcmVuY3k6IHdhdGVybWFya1RyYW5zcGFyZW5jeSxcclxuICAgIHdhdGVyTGltaXRNaW5XaWR0aDogcGFyc2VJbnQod2F0ZXJMaW1pdE1pbldpZHRoKSxcclxuICAgIHdhdGVyTGltaXRNaW5IZWlnaHQ6IHBhcnNlSW50KHdhdGVyTGltaXRNaW5IZWlnaHQpLFxyXG5cdFx0b3BlcmF0aW9uOiAnc2F2ZVdhdGVyTWFya1NldHRpbmdzJ1xyXG5cdH0pXHJcblx0XHQudGhlbihmdW5jdGlvbigpIHtcclxuXHRcdFx0c2NyZWVuVG9wQWxlcnQoJ+S/neWtmOaIkOWKnycpO1xyXG5cdFx0fSlcclxuXHRcdC5jYXRjaChmdW5jdGlvbihkYXRhKSB7XHJcblx0XHRcdHNjcmVlblRvcFdhcm5pbmcoZGF0YS5lcnJvcnx8IGRhdGEpO1xyXG5cdFx0fSlcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHVwbG9hZEhvbWVCaWdMb2dvKGZpbGVzKSB7XHJcblx0dmFyIGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcclxuXHRmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uKGZpbGUsIGluZGV4KXtcclxuXHRcdGZvcm0uYXBwZW5kKCdmaWxlJyArIGluZGV4LCBmaWxlKTtcclxuXHR9KVxyXG5cdHJldHVybiBua2NVcGxvYWRGaWxlKFwiL2Uvc2V0dGluZ3MvaG9tZS9saXN0L2JpZ2xvZ29cIiwgXCJQT1NUXCIsIGZvcm0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzYXZlSG9tZUxpc3RTZXR0aW5ncygpIHtcclxuICB2YXIgaW5wdXRzID0gJCgnaW5wdXRbbmFtZT1cImxpc3RcIl0nKTtcclxuICB2YXIgdG9waWMgPSBpbnB1dHMuZXEoMCkuaXMoJzpjaGVja2VkJyk7XHJcbiAgdmFyIGRpc2NpcGxpbmUgPSBpbnB1dHMuZXEoMSkuaXMoJzpjaGVja2VkJyk7XHJcbiAgdmFyIHZpc2l0b3JUaHJlYWRMaXN0ID0gJCgnaW5wdXRbbmFtZT1cInZpc2l0b3JcIl0nKTtcclxuICB2aXNpdG9yVGhyZWFkTGlzdCA9IHZpc2l0b3JUaHJlYWRMaXN0LmVxKDApLmlzKFwiOmNoZWNrZWRcIik/XCJsYXRlc3RcIjogXCJyZWNvbW1lbmRcIjtcclxuICBua2NBUEkoJy9lL3NldHRpbmdzL2hvbWUvbGlzdCcsICdQQVRDSCcsIHtcclxuICAgIHRvcGljOiB0b3BpYyxcclxuICAgIGRpc2NpcGxpbmU6IGRpc2NpcGxpbmUsXHJcbiAgICB2aXNpdG9yVGhyZWFkTGlzdDogdmlzaXRvclRocmVhZExpc3RcclxuICB9KVxyXG4gIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgc2NyZWVuVG9wQWxlcnQoJ+S/neWtmOaIkOWKnycpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIHNjcmVlblRvcFdhcm5pbmcoZGF0YS5lcnJvciB8fCBkYXRhKTtcclxuICB9KTtcclxufVxyXG52YXIgdnVlRG9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhcHBcIik7XHJcbmlmKHZ1ZURvbSkge1xyXG4gIHZhciBhcHAgPSBuZXcgVnVlKHtcclxuICAgIGVsOiAnI2FwcCcsXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIGhvbWVTZXR0aW5nczogJycsXHJcbiAgICAgIGluZm86ICcnLFxyXG4gICAgICBsaXN0OiBbXSxcclxuICAgICAgcmVjb21tZW5kOiBbXSxcclxuXHRcdFx0ZXJyb3I6IFwiXCIsXHJcblx0XHRcdGxvZ29GaWxlczogW10sXHJcblx0XHRcdGxvZ29GaWxlVXBsb2FkZGluZzogZmFsc2VcclxuICAgIH0sXHJcbiAgICBiZWZvcmVNb3VudDogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciBkYXRhID0gTktDLm1ldGhvZHMuZ2V0RGF0YUJ5SWQoXCJkYXRhXCIpO1xyXG4gICAgICBpZihkYXRhLmhvbWVTZXR0aW5ncy5saXN0LnRvcGljKSB7XHJcbiAgICAgICAgdGhpcy5saXN0LnB1c2goXCJ0b3BpY1wiKTtcclxuICAgICAgfVxyXG4gICAgICBpZihkYXRhLmhvbWVTZXR0aW5ncy5saXN0LmRpc2NpcGxpbmUpIHtcclxuICAgICAgICB0aGlzLmxpc3QucHVzaChcImRpc2NpcGxpbmVcIik7XHJcbiAgICAgIH1cclxuICAgICAgaWYoZGF0YS5ob21lU2V0dGluZ3MucmVjb21tZW5kLmZlYXR1cmVkVGhyZWFkcykge1xyXG4gICAgICAgIHRoaXMucmVjb21tZW5kLnB1c2goXCJmZWF0dXJlZFRocmVhZHNcIilcclxuICAgICAgfVxyXG4gICAgICBpZihkYXRhLmhvbWVTZXR0aW5ncy5yZWNvbW1lbmQuaG90VGhyZWFkcykge1xyXG4gICAgICAgIHRoaXMucmVjb21tZW5kLnB1c2goXCJob3RUaHJlYWRzXCIpXHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5ob21lU2V0dGluZ3MgPSBkYXRhLmhvbWVTZXR0aW5ncztcclxuXHRcdFx0aWYoZGF0YS5ob21lQmlnTG9nbykge1xyXG5cdFx0XHRcdHRoaXMubG9nb0ZpbGVzID0gdGhpcy5sb2dvRmlsZXMuY29uY2F0KGRhdGEuaG9tZUJpZ0xvZ28pO1xyXG5cdFx0XHR9XHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICBzYXZlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICB0aGlzLmVycm9yID0gXCJcIjtcclxuICAgICAgICB0aGlzLmluZm8gPSBcIlwiO1xyXG4gICAgICAgIHZhciBob21lU2V0dGluZ3MgPSB0aGlzLmhvbWVTZXR0aW5ncztcclxuICAgICAgICB2YXIgbGlzdCA9IHRoaXMubGlzdDtcclxuICAgICAgICBob21lU2V0dGluZ3MubGlzdC50b3BpYyA9IGZhbHNlO1xyXG4gICAgICAgIGhvbWVTZXR0aW5ncy5saXN0LmRpc2NpcGxpbmUgPSBmYWxzZTtcclxuICAgICAgICBpZihob21lU2V0dGluZ3MuaG90VGhyZWFkcy5wb3N0Q291bnQgPCAwKSByZXR1cm4gdGhpcy5lcnJvciA9IFwi54Ot6Zeo5paH56ug5pyA5bCP5Zue5aSN5pWw5LiN6IO95bCP5LqOMFwiO1xyXG4gICAgICAgIGlmKGhvbWVTZXR0aW5ncy5ob3RUaHJlYWRzLnBvc3RVc2VyQ291bnQgPCAwKSByZXR1cm4gdGhpcy5lcnJvciA9IFwi54Ot6Zeo5paH56ug5pyA5bCP5Zue5aSN55So5oi35oC75pWw5LiN6IO95bCP5LqOMFwiO1xyXG4gICAgICAgIHZhciByZWNvbW1lbmQgPSB0aGlzLnJlY29tbWVuZDtcclxuICAgICAgICBob21lU2V0dGluZ3MucmVjb21tZW5kLmhvdFRocmVhZHMgPSBmYWxzZTtcclxuICAgICAgICBob21lU2V0dGluZ3MucmVjb21tZW5kLmZlYXR1cmVkVGhyZWFkcyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZihyZWNvbW1lbmQuaW5kZXhPZihcImhvdFRocmVhZHNcIikgIT09IC0xKSBob21lU2V0dGluZ3MucmVjb21tZW5kLmhvdFRocmVhZHMgPSB0cnVlO1xyXG4gICAgICAgIGlmKHJlY29tbWVuZC5pbmRleE9mKFwiZmVhdHVyZWRUaHJlYWRzXCIpICE9PSAtMSkgaG9tZVNldHRpbmdzLnJlY29tbWVuZC5mZWF0dXJlZFRocmVhZHMgPSB0cnVlO1xyXG4gICAgICAgIGlmKGhvbWVTZXR0aW5ncy5yZWNvbW1lbmQudm90ZVVwVG90YWwgPCAwKSByZXR1cm4gdGhpcy5lcnJvciA9IFwi5o6o6I2Q5p2h5Lu25Lit54K56LWe5oC75pWw5LiN6IO95bCP5LqOMFwiO1xyXG4gICAgICAgIGlmKGhvbWVTZXR0aW5ncy5yZWNvbW1lbmQudm90ZVVwTWF4IDwgMCkgcmV0dXJuIHRoaXMuZXJyb3IgPSBcIuaOqOiNkOadoeS7tuS4reeLrOeri+eCuei1nuaVsOS4jeiDveWwj+S6jjBcIjtcclxuICAgICAgICBpZihob21lU2V0dGluZ3MucmVjb21tZW5kLmVuY291cmFnZVRvdGFsIDwgMCkgcmV0dXJuIHRoaXMuZXJyb3IgPSBcIuaOqOiNkOadoeS7tuS4rem8k+WKseasoeaVsOS4jeiDveWwj+S6jjBcIjtcclxuICAgICAgICBpZihsaXN0LmluZGV4T2YoJ3RvcGljJykgIT09IC0xKSB7XHJcbiAgICAgICAgICBob21lU2V0dGluZ3MubGlzdC50b3BpYyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGxpc3QuaW5kZXhPZihcImRpc2NpcGxpbmVcIikgIT09IC0xKSB7XHJcbiAgICAgICAgICBob21lU2V0dGluZ3MubGlzdC5kaXNjaXBsaW5lID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbmtjQVBJKCcvZS9zZXR0aW5ncy9ob21lL2xpc3QnLCAnUEFUQ0gnLCB7XHJcbiAgICAgICAgICB0b3BpYzogaG9tZVNldHRpbmdzLmxpc3QudG9waWMsXHJcbiAgICAgICAgICBkaXNjaXBsaW5lOiBob21lU2V0dGluZ3MubGlzdC5kaXNjaXBsaW5lLFxyXG4gICAgICAgICAgdmlzaXRvclRocmVhZExpc3Q6IGhvbWVTZXR0aW5ncy52aXNpdG9yVGhyZWFkTGlzdCxcclxuICAgICAgICAgIGhvdFRocmVhZHM6IGhvbWVTZXR0aW5ncy5ob3RUaHJlYWRzLFxyXG4gICAgICAgICAgcmVjb21tZW5kOiBob21lU2V0dGluZ3MucmVjb21tZW5kXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgXHRzd2VldFN1Y2Nlc3MoJ+S/neWtmOaIkOWKnycpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGFwcC5lcnJvciA9IGRhdGEuZXJyb3IgfHwgZGF0YTtcclxuICAgICAgICAgIH0pO1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRwaWNrUGljdHVyZTogZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0JChcIiNpbnB1dEZpbGVcIikuY2xpY2soKTtcclxuXHRcdFx0fSxcclxuXHRcdFx0YWRkRmlsZTogZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0XHRcdHZhciBmaWxlcyA9IFtdLnNsaWNlLmNhbGwoJChcIiNpbnB1dEZpbGVcIilbMF0uZmlsZXMpO1xyXG5cdFx0XHRcdHNlbGYubG9nb0ZpbGVVcGxvYWRkaW5nID0gdHJ1ZTtcclxuXHRcdFx0XHR1cGxvYWRIb21lQmlnTG9nbyhmaWxlcylcclxuXHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xyXG5cdFx0XHRcdFx0XHRzZWxmLmxvZ29GaWxlcyA9IHNlbGYubG9nb0ZpbGVzLmNvbmNhdChkYXRhLnNhdmVkKTtcclxuXHRcdFx0XHRcdFx0c2VsZi5sb2dvRmlsZVVwbG9hZGRpbmcgPSBmYWxzZTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0JChcIiNpbnB1dEZpbGVcIikudmFsKFwiXCIpO1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRkZWxldGVCaWdMb2dvOiBmdW5jdGlvbihpbmRleCkge1xyXG5cdFx0XHRcdGxldCBsb2dvRmlsZXMgPSB0aGlzLmxvZ29GaWxlcztcclxuXHRcdFx0XHRsZXQgZmlsZUl0ZW0gPSBsb2dvRmlsZXNbaW5kZXhdO1xyXG5cdFx0XHRcdG5rY0FQSShcIi9lL3NldHRpbmdzL2hvbWUvbGlzdC9iaWdsb2dvXCIsIFwiUE9TVFwiLCB7XHJcblx0XHRcdFx0XHR0eXBlOiBcImRlbGV0ZVwiLFxyXG5cdFx0XHRcdFx0YWlkOiBmaWxlSXRlbS5haWRcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0XHRsb2dvRmlsZXMuc3BsaWNlKGluZGV4LCAxKTtcclxuXHRcdFx0XHRcdHNjcmVlblRvcEFsZXJ0KCfliKDpmaTmiJDlip8nKTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHRcdC5jYXRjaChlcnIgPT4ge1xyXG5cdFx0XHRcdFx0c2NyZWVuVG9wQWxlcnQoZXJyLmVycm9yKTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHR9XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuIl19
