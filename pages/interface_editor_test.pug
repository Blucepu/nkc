extends bootstrap_base.pug

block title
  title 编辑器 - 科创论坛
  
  include MathJax.pug
  link(rel='stylesheet' href=`/mdui/css/mdui.css?v=${global.NKC.startTime}`)
block content
  -var mainContainer1400 = true
  #ife.container-fluid(style='max-width:1400px')
    .col-xs-12.col-md-12
      if !data.user
          .row
              .col-xs-12.f12
                  h1 尚未登录
                  :markdown
                      请先[登录](/login)。
      else
          .row
              .col-md-12
              include exam_notification.pug

          .row
              .form-group
                  input#title.form-control(type='text' placeholder='请输入标题...' value=`${data.title || ''}`)
              //- .form-group
              //-   if !data.type || data.type === 'forum' || data.draftDelType === 'forum'
              //-     div(style='margin-top: 5px;')
              //-     //- include forumlist_dropdown
              //-     //select#parents.form-control(style='display: inline-block; width: auto;')
              //-     //    option 选择一个学院
              //-     //select#children.form-control(style='display: inline-block; width: auto;')
              //-     //    option 选择一个专业
              //-     //select#threadTypes.form-control(style='display: inline-block; width: auto;')
              //-     //    option 无
              //-     //select.form-control#lang(style='display: none; width: auto;')
              //-     //    option html
              input.hidden#lang(value=data.l)
              if data.delReason 
                .form-froup(style="border:1px solid red;font-zie:16px") 退修原因: #{data.delReason}
              .form-group(style="background-color:#fff;line-height:1.5;")
                  div#quoteContent
              .form-group
                div#quoteCancel(style='display: none')
                  button#quoteCancel.ForumThreadHasImage(style='background-color: #337ab7' onclick=`cancelQuote()`) 取消引用
              .form-group
                include ueditor.pug

              include ./media/media_index.pug

              if !data.type || data.type === 'forum' || data.draftDelType === 'forum'
                include ./forum/forum_choice.pug

              .form-inline
                  .form-group
                      input#parseURL(type='checkbox' checked)
                      span &nbsp;处理URL&nbsp;
                  .form-group
                      button#post.btn.btn-primary(type='submit') 发表
                  if !['forum_declare'].includes(data.type)
                    .form-group
                    -if (!data.targetUser)
                      button#draft.btn.btn-primary(type='submit') 保存草稿
                    -else if(data.targetUser.uid === data.user.uid)
                      button#draft.btn.btn-primary(type='submit') 保存草稿
                    //- if (data.targetUser.uid && data.user.uid && data.targetUser.uid === data.user.uid)
                      button#draft.btn.btn-primary(type='submit') 保存草稿
                    .form-group
                      if data.user
                        a.btn.btn-default(href=`/u/${data.user.uid}/drafts` target='_blank') 草稿箱
              .form-group
                //- input#parseURL(type='checkbox' checked)
                //- span &nbsp;处理URL&nbsp;
              .form-group
                  div#disnoneplay(style='display:none')= data.content
                  div#draftNowId(style='display:none')= data.content
                  div#userNowId(style='display:none')= data.user.uid
                  div#draftId(style='display:none')=`${data.did || ''}`
                  div#draftDelType(style='display:none')=`${data.draftDelType || ''}`
                  div#draftDelTypeId(style='display:none')=`${data.draftDelTypeId || ''}`
  
  include debug_output.pug
block scripts


  link(href="jquery-ui-1.10.4.custom.css" rel="stylesheet")
  script(src=`/mdui/js/mdui.min.js?v=${global.NKC.startTime}`)
  script(src="/jquery-1.10.2.js")
  script(src="/jquery-ui-1.10.4.custom.js")
  script(src='/commonmark/dist/commonmark.js')
  script(src='/plain_escaper.js')
  script(src='/xbbcode-parser/xbbcode.js')
  script(src='/xss/dist/xss.js')
  
  script(src='/external_pkgs/react/react.min.js')
  script(src='/external_pkgs/react/JSXTransformer.js')
  script(src=`/interface_common.js?v=${startTime}`)
  script(src=`/nkc_render.js?v=${startTime}`)
  script(src=`/interface_editor.js?v=${startTime}`)

  if !data.type || data.type === 'forum' || data.draftDelType === 'forum'
    //- script(src='/module_dropdown.js?v=3')
    script(src=`/forum/forumlist_dropdown1.js?v=${startTime}`)



  //- script(src=`/interface_attachment_uploader.js?v=${global.NKC.startTime}`)
  //- script(type='text/jsx;harmony=true' src=`/interface_attachment_list_display_test.js?v=${global.NKC.startTime}`)
  script(src=`/media/media_index.js?v=${startTime}`)
  script(src=`/forum/forum_choice.js?v=${startTime}`)
  script.
    window.onbeforeunload = function() {
      if(document.getElementById("post").disabled === false){
        return "离开前保存草稿了吗？"
      }
    }