extend ../bootstrap_base
block title
  include ../publicModules/web_header
  +includeCSS("/home/home_all.css")
  +includeCSS("/swiper/swiper-bundle.min.css")
  if !permission("unBannedUser") || !permission("bannedUser") || !permission("clearUserInfo")
    style.
        .move-handle {
            display: none;
        }
block content
  mixin renderHTML(data, type)
    //轮播图
    if type === swiper
      .col-xs-12.col-md-6.home-covers-md
        .swiper-container.swiper-home
          .swiper-wrapper
            for thread in data.ads.movable
              a.swiper-slide(href=`/t/${thread.tid}` target="_blank" style={
                'background-image': `url(${tools.getUrl('recommendThreadCover', thread.cover)})`
              })
                .swiper-title= `${thread.title}`
          .swiper-pagination
          .swiper-button-next.swiper-button(style='background-image: none;')
            .fa.fa-angle-right
          .swiper-button-prev.swiper-button(style='background-image: none;')
            .fa.fa-angle-left
    //小图部分
    else if type === ''
      .col-xs-12.col-md-6.hidden-xs.hidden-sm
        .row.home-covers-sm
          for thread, index in data.ads.fixed
            .home-cover-sm
              a(href=`/t/${thread.tid}` target="_blank" title=thread.title
                class=index > 2 ? 'm-b-0' : ''
              )
                .home-covers-sm-img(style=`background-image:url(${tools.getUrl('recommendThreadCover', thread.cover)})`)
                .home-covers-sm-title=thread.title
    //首页顶置
    else if type === ''
      .home-forums-list.m-b-1.home-category-master-handle(data-cid = '')
        .home-title-box
          .home-title-l
            span.fa.fa-bars.move-handle.m-r-1
            span.panel-header.m-b-0.home-title 首页置顶
          if permission("unBannedUser") || permission("bannedUser") || permission("clearUserInfo")
            button.home-title-r.btn-warning.btn.btn-xs(@click='editorForum()') 编辑
          //-.home-header
            //-.fa.fa-tags
            .header-name 置顶
        .home-threads
          for thread in data.toppedThreads
            include ../publicModules/thread_panel/thread_panel
    //热销商品
    else if type === ''
      .home-forum-list.m-b-1.home-category-master-handle(data-cid = '')
        span.fa.fa-bars.move-handle.m-r-1
        span.panel-header.m-b-0.home-title 热销商品
        .home-goods
          for goods in data.goods
            .home-goods-content
              .home-goods-avatar
                div(style=`background-image: url(/r/${goods.imgMaster})`)
              .home-goods-info
                a(href=`/t/${goods.tid}` title=goods.name).home-goods-name=goods.name
                .home-goods-description=goods.abstract
                .home-goods-other
                  a.home-goods-user(href=`/u/${goods.user.uid}`)
                    img(src=tools.getUrl("userAvatar", goods.user.avatar) data-float-uid=goods.user.uid)
                    span=goods.user.username
                  .home-goods-price
                  if !goods.productSettings.priceShowToVisit && !data.user
                    .home-goods-price 登录可见
                  else
                    -let minPrice, maxPrice;
                    for p in goods.productParams
                      -const price = p.price;
                      if minPrice === undefined || minPrice > price
                        -minPrice = price;
                      if maxPrice === undefined || maxPrice < price
                        -maxPrice = price;
                    if minPrice === maxPrice
                      .home-goods-price=`￥${minPrice / 100}`
                    else
                      .home-goods-price=`￥${minPrice / 100} - ￥${maxPrice / 100}`
        .home-goods-forums 更多请访问：
          for f in data.goodsForums
            a(href=`/f/${f.fid}` data-float-fid=f.fid)
              if f.logo
                img.home-goods-forum-icon(src=tools.getUrl("forumLogo", f.logo))
              else
                .home-goods-forum-icon(style=`background-color: ${f.color}`)
              span=f.displayName
    //热门专栏
    else if type === ''
      .home-forums-list.m-b-1.home-category-master-handle(data-cid = '')
        span.fa.fa-bars.move-handle.m-r-1
        span.panel-header.m-b-0.home-title 热门专栏
        //-.home-header
          //- fa.fa-flask
          .header-name 热门专栏
          //.header-description 关注最新学科，足不出户便能游遍世界~
        .home-columns
          for column in data.columns
            a(href=`/m/${column._id}` target="_blank").home-column
              .home-column-avatar
                img(src=tools.getUrl("columnAvatar", column.avatar))
              .home-column-info
                .home-column-title= column.name
                .home-column-description= column.abbr || "无简介"
                .home-column-statics
                  span=tools.briefTime(column.tlm) + "更新 "
                  span= "共" + column.postCount + "篇文章"
        .m-t-05
          a.home-threads-more-link(href=`/m`) 查看更多
      if !state.userColumn && data.user && state.columnPermission
        .home-columns-link.m-b-1
          a(href=`/column/apply` target="_blank") 开设专栏
          .home-columns-link-info 你的账号已满足开设专栏所需要的所有条件，点击按钮即可开设个人专栏。

