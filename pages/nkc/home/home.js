(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById("data");

var modifyAd = function modifyAd(ad, type) {
  ad.type = type;
};

for (var i = 0; i < data.ads.movable.length; i++) {
  var ad = data.ads.movable[i];
  modifyAd(ad, "movable");
}

for (var _i = 0; _i < data.ads.fixed.length; _i++) {
  var _ad = data.ads.fixed[_i];
  modifyAd(_ad, "fixed");
}

var app = new Vue({
  el: "#app",
  data: {
    ads: data.ads,
    recommendForums: data.recommendForums,
    columns: data.columns,
    goods: data.goods,
    toppedThreads: data.toppedThreads
  },
  mounted: function mounted() {
    window.SelectImage = new NKC.methods.selectImage();
    window.MoveThread = new NKC.modules.MoveThread();
  },
  computed: {
    selectedRecommendForumsId: function selectedRecommendForumsId() {
      return data.recommendForums.map(function (f) {
        return f.fid;
      });
    }
  },
  methods: {
    checkString: NKC.methods.checkData.checkString,
    checkNumber: NKC.methods.checkData.checkNumber,
    getUrl: NKC.methods.tools.getUrl,
    floatUserInfo: NKC.methods.tools.floatUserInfo,
    visitUrl: NKC.methods.visitUrl,
    selectLocalFile: function selectLocalFile(ad) {
      var options = {};

      if (ad.type === "movable") {
        options.aspectRatio = 800 / 336;
      } else {
        options.aspectRatio = 400 / 253;
      }

      SelectImage.show(function (data) {
        var formData = new FormData();
        formData.append("cover", data);
        formData.append("topType", ad.type);
        formData.append("tid", ad.tid);
        nkcUploadFile("/nkc/home", "POST", formData).then(function (data) {
          ad.cover = data.coverHash;
        })["catch"](sweetError);
        SelectImage.close();
      }, options);
    },
    move: function move(ad, type) {
      var ads;

      if (ad.type === "movable") {
        ads = this.ads.movable;
      } else {
        ads = this.ads.fixed;
      }

      var index = ads.indexOf(ad);
      if (type === "left" && index === 0 || type === "right" && index + 1 === ads.length) return;
      var newIndex;

      if (type === "left") {
        newIndex = index - 1;
      } else {
        newIndex = index + 1;
      }

      var otherAd = ads[newIndex];
      ads.splice(index, 1, otherAd);
      ads.splice(newIndex, 1, ad);
    },
    saveAds: function saveAds() {
      var _this$ads = this.ads,
          movable = _this$ads.movable,
          fixed = _this$ads.fixed,
          movableOrder = _this$ads.movableOrder,
          fixedOrder = _this$ads.fixedOrder;
      var self = this;
      Promise.resolve().then(function () {
        movable.concat(fixed).map(function (ad) {
          self.checkString(ad.title, {
            name: "标题",
            minLength: 1,
            maxLength: 200
          });
          if (!ad.cover) throw "封面图不能为空";
          if (!ad.tid) throw "文章ID不能为空";
        });
        return nkcAPI("/nkc/home", "PATCH", {
          operation: "saveAds",
          movable: movable,
          fixed: fixed,
          movableOrder: movableOrder,
          fixedOrder: fixedOrder
        });
      }).then(function () {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    },
    remove: function remove(ads, index) {
      ads.splice(index, 1);
      /*sweetQuestion("确定要执行删除操作？")
        .then(() => {
          ads.splice(index, 1)
        })
        .catch(() => {})*/
    },
    addForum: function addForum() {
      var self = this;
      MoveThread.open(function (data) {
        var originForums = data.originForums;
        originForums.map(function (forum) {
          if (!self.selectedRecommendForumsId.includes(forum.fid)) {
            self.recommendForums.push(forum);
          }
        });
        MoveThread.close();
      }, {
        hideMoveType: true
      });
    },
    moveForum: function moveForum(arr, f, type) {
      var index = arr.indexOf(f);
      if (type === "left" && index === 0 || type === "right" && index + 1 === arr.length) return;
      var newIndex;

      if (type === "left") {
        newIndex = index - 1;
      } else {
        newIndex = index + 1;
      }

      var otherAd = arr[newIndex];
      arr.splice(index, 1, otherAd);
      arr.splice(newIndex, 1, f);
    },
    removeForum: function removeForum(arr, index) {
      arr.splice(index, 1);
      /*const self = this;
      sweetQuestion("确定要执行删除操作？")
        .then(() => {
          arr.splice(index, 1);
        })
        .catch(() => {})*/
    },
    saveRecommendForums: function saveRecommendForums() {
      var forumsId = this.recommendForums.map(function (forum) {
        return forum.fid;
      });
      nkcAPI("/nkc/home", "PATCH", {
        operation: "saveRecommendForums",
        forumsId: forumsId
      }).then(function () {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    },
    saveColumns: function saveColumns() {
      var columnsId = this.columns.map(function (c) {
        return c._id;
      });
      nkcAPI("/nkc/home", "PATCH", {
        operation: "saveColumns",
        columnsId: columnsId
      }).then(function () {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    },
    saveGoods: function saveGoods() {
      var goodsId = this.goods.map(function (g) {
        return g.productId;
      });
      nkcAPI("/nkc/home", "PATCH", {
        operation: "saveGoods",
        goodsId: goodsId
      }).then(function () {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    },
    saveToppedThreads: function saveToppedThreads() {
      var toppedThreadsId = this.toppedThreads.map(function (t) {
        return t.tid;
      });
      nkcAPI("/nkc/home", "PATCH", {
        operation: "saveToppedThreads",
        toppedThreadsId: toppedThreadsId
      }).then(function () {
        sweetSuccess("保存成功");
      })["catch"](sweetError);
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9ua2MvaG9tZS9ob21lLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE9BQUosQ0FBWSxXQUFaLENBQXdCLE1BQXhCLENBQWI7O0FBQ0EsSUFBTSxRQUFRLEdBQUcsU0FBWCxRQUFXLENBQUMsRUFBRCxFQUFLLElBQUwsRUFBYztBQUM3QixFQUFBLEVBQUUsQ0FBQyxJQUFILEdBQVUsSUFBVjtBQUNELENBRkQ7O0FBSUEsS0FBSSxJQUFJLENBQUMsR0FBRyxDQUFaLEVBQWUsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFMLENBQVMsT0FBVCxDQUFpQixNQUFwQyxFQUE0QyxDQUFDLEVBQTdDLEVBQWlEO0FBQy9DLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFMLENBQVMsT0FBVCxDQUFpQixDQUFqQixDQUFYO0FBQ0EsRUFBQSxRQUFRLENBQUMsRUFBRCxFQUFLLFNBQUwsQ0FBUjtBQUNEOztBQUVELEtBQUksSUFBSSxFQUFDLEdBQUcsQ0FBWixFQUFlLEVBQUMsR0FBRyxJQUFJLENBQUMsR0FBTCxDQUFTLEtBQVQsQ0FBZSxNQUFsQyxFQUEwQyxFQUFDLEVBQTNDLEVBQStDO0FBQzdDLE1BQU0sR0FBRSxHQUFHLElBQUksQ0FBQyxHQUFMLENBQVMsS0FBVCxDQUFlLEVBQWYsQ0FBWDtBQUNBLEVBQUEsUUFBUSxDQUFDLEdBQUQsRUFBSyxPQUFMLENBQVI7QUFDRDs7QUFFRCxJQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUosQ0FBUTtBQUNsQixFQUFBLEVBQUUsRUFBRSxNQURjO0FBRWxCLEVBQUEsSUFBSSxFQUFFO0FBQ0osSUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBRE47QUFFSixJQUFBLGVBQWUsRUFBRSxJQUFJLENBQUMsZUFGbEI7QUFHSixJQUFBLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FIVjtBQUlKLElBQUEsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUpSO0FBS0osSUFBQSxhQUFhLEVBQUUsSUFBSSxDQUFDO0FBTGhCLEdBRlk7QUFTbEIsRUFBQSxPQVRrQixxQkFTUjtBQUNSLElBQUEsTUFBTSxDQUFDLFdBQVAsR0FBcUIsSUFBSSxHQUFHLENBQUMsT0FBSixDQUFZLFdBQWhCLEVBQXJCO0FBQ0EsSUFBQSxNQUFNLENBQUMsVUFBUCxHQUFvQixJQUFJLEdBQUcsQ0FBQyxPQUFKLENBQVksVUFBaEIsRUFBcEI7QUFDRCxHQVppQjtBQWFsQixFQUFBLFFBQVEsRUFBRTtBQUNSLElBQUEseUJBRFEsdUNBQ29CO0FBQzFCLGFBQU8sSUFBSSxDQUFDLGVBQUwsQ0FBcUIsR0FBckIsQ0FBeUIsVUFBQSxDQUFDO0FBQUEsZUFBSSxDQUFDLENBQUMsR0FBTjtBQUFBLE9BQTFCLENBQVA7QUFDRDtBQUhPLEdBYlE7QUFrQmxCLEVBQUEsT0FBTyxFQUFFO0FBQ1AsSUFBQSxXQUFXLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxTQUFaLENBQXNCLFdBRDVCO0FBRVAsSUFBQSxXQUFXLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxTQUFaLENBQXNCLFdBRjVCO0FBR1AsSUFBQSxNQUFNLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxLQUFaLENBQWtCLE1BSG5CO0FBSVAsSUFBQSxhQUFhLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxLQUFaLENBQWtCLGFBSjFCO0FBS1AsSUFBQSxRQUFRLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUxmO0FBTVAsSUFBQSxlQU5PLDJCQU1TLEVBTlQsRUFNYTtBQUNsQixVQUFNLE9BQU8sR0FBRyxFQUFoQjs7QUFDQSxVQUFHLEVBQUUsQ0FBQyxJQUFILEtBQVksU0FBZixFQUEwQjtBQUN4QixRQUFBLE9BQU8sQ0FBQyxXQUFSLEdBQXNCLE1BQUksR0FBMUI7QUFDRCxPQUZELE1BRU87QUFDTCxRQUFBLE9BQU8sQ0FBQyxXQUFSLEdBQXNCLE1BQUksR0FBMUI7QUFDRDs7QUFDRCxNQUFBLFdBQVcsQ0FBQyxJQUFaLENBQWlCLFVBQUEsSUFBSSxFQUFJO0FBQ3ZCLFlBQU0sUUFBUSxHQUFHLElBQUksUUFBSixFQUFqQjtBQUNBLFFBQUEsUUFBUSxDQUFDLE1BQVQsQ0FBZ0IsT0FBaEIsRUFBeUIsSUFBekI7QUFDQSxRQUFBLFFBQVEsQ0FBQyxNQUFULENBQWdCLFNBQWhCLEVBQTJCLEVBQUUsQ0FBQyxJQUE5QjtBQUNBLFFBQUEsUUFBUSxDQUFDLE1BQVQsQ0FBZ0IsS0FBaEIsRUFBdUIsRUFBRSxDQUFDLEdBQTFCO0FBQ0EsUUFBQSxhQUFhLENBQUMsV0FBRCxFQUFjLE1BQWQsRUFBc0IsUUFBdEIsQ0FBYixDQUNHLElBREgsQ0FDUSxVQUFBLElBQUksRUFBSTtBQUNaLFVBQUEsRUFBRSxDQUFDLEtBQUgsR0FBVyxJQUFJLENBQUMsU0FBaEI7QUFDRCxTQUhILFdBSVMsVUFKVDtBQUtBLFFBQUEsV0FBVyxDQUFDLEtBQVo7QUFDRCxPQVhELEVBV0csT0FYSDtBQVlELEtBekJNO0FBMEJQLElBQUEsSUExQk8sZ0JBMEJGLEVBMUJFLEVBMEJFLElBMUJGLEVBMEJRO0FBQ2IsVUFBSSxHQUFKOztBQUNBLFVBQUcsRUFBRSxDQUFDLElBQUgsS0FBWSxTQUFmLEVBQTBCO0FBQ3hCLFFBQUEsR0FBRyxHQUFHLEtBQUssR0FBTCxDQUFTLE9BQWY7QUFDRCxPQUZELE1BRU87QUFDTCxRQUFBLEdBQUcsR0FBRyxLQUFLLEdBQUwsQ0FBUyxLQUFmO0FBQ0Q7O0FBQ0QsVUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE9BQUosQ0FBWSxFQUFaLENBQWQ7QUFDQSxVQUFJLElBQUksS0FBSyxNQUFULElBQW1CLEtBQUssS0FBSyxDQUE5QixJQUFxQyxJQUFJLEtBQUssT0FBVCxJQUFvQixLQUFLLEdBQUMsQ0FBTixLQUFZLEdBQUcsQ0FBQyxNQUE1RSxFQUFxRjtBQUNyRixVQUFJLFFBQUo7O0FBQ0EsVUFBRyxJQUFJLEtBQUssTUFBWixFQUFvQjtBQUNsQixRQUFBLFFBQVEsR0FBRyxLQUFLLEdBQUcsQ0FBbkI7QUFDRCxPQUZELE1BRU87QUFDTCxRQUFBLFFBQVEsR0FBRyxLQUFLLEdBQUcsQ0FBbkI7QUFDRDs7QUFDRCxVQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsUUFBRCxDQUFuQjtBQUNBLE1BQUEsR0FBRyxDQUFDLE1BQUosQ0FBVyxLQUFYLEVBQWtCLENBQWxCLEVBQXFCLE9BQXJCO0FBQ0EsTUFBQSxHQUFHLENBQUMsTUFBSixDQUFXLFFBQVgsRUFBcUIsQ0FBckIsRUFBd0IsRUFBeEI7QUFDRCxLQTVDTTtBQTZDUCxJQUFBLE9BN0NPLHFCQTZDRTtBQUFBLHNCQUM0QyxLQUFLLEdBRGpEO0FBQUEsVUFDQSxPQURBLGFBQ0EsT0FEQTtBQUFBLFVBQ1MsS0FEVCxhQUNTLEtBRFQ7QUFBQSxVQUNnQixZQURoQixhQUNnQixZQURoQjtBQUFBLFVBQzhCLFVBRDlCLGFBQzhCLFVBRDlCO0FBRVAsVUFBTSxJQUFJLEdBQUcsSUFBYjtBQUNBLE1BQUEsT0FBTyxDQUFDLE9BQVIsR0FDRyxJQURILENBQ1EsWUFBTTtBQUNWLFFBQUEsT0FBTyxDQUFDLE1BQVIsQ0FBZSxLQUFmLEVBQXNCLEdBQXRCLENBQTBCLFVBQUEsRUFBRSxFQUFJO0FBQzlCLFVBQUEsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsRUFBRSxDQUFDLEtBQXBCLEVBQTJCO0FBQ3pCLFlBQUEsSUFBSSxFQUFFLElBRG1CO0FBRXpCLFlBQUEsU0FBUyxFQUFFLENBRmM7QUFHekIsWUFBQSxTQUFTLEVBQUU7QUFIYyxXQUEzQjtBQUtBLGNBQUcsQ0FBQyxFQUFFLENBQUMsS0FBUCxFQUFjLE1BQU0sU0FBTjtBQUNkLGNBQUcsQ0FBQyxFQUFFLENBQUMsR0FBUCxFQUFZLE1BQU0sVUFBTjtBQUNiLFNBUkQ7QUFTQSxlQUFPLE1BQU0sQ0FBQyxXQUFELEVBQWMsT0FBZCxFQUF1QjtBQUNsQyxVQUFBLFNBQVMsRUFBRSxTQUR1QjtBQUVsQyxVQUFBLE9BQU8sRUFBUCxPQUZrQztBQUdsQyxVQUFBLEtBQUssRUFBTCxLQUhrQztBQUlsQyxVQUFBLFlBQVksRUFBWixZQUprQztBQUtsQyxVQUFBLFVBQVUsRUFBVjtBQUxrQyxTQUF2QixDQUFiO0FBT0QsT0FsQkgsRUFtQkcsSUFuQkgsQ0FtQlEsWUFBTTtBQUNWLFFBQUEsWUFBWSxDQUFDLE1BQUQsQ0FBWjtBQUNELE9BckJILFdBc0JTLFVBdEJUO0FBdUJELEtBdkVNO0FBd0VQLElBQUEsTUF4RU8sa0JBd0VBLEdBeEVBLEVBd0VLLEtBeEVMLEVBd0VXO0FBQ2hCLE1BQUEsR0FBRyxDQUFDLE1BQUosQ0FBVyxLQUFYLEVBQWtCLENBQWxCO0FBQ0E7Ozs7O0FBTUQsS0FoRk07QUFpRlAsSUFBQSxRQWpGTyxzQkFpRkk7QUFDVCxVQUFNLElBQUksR0FBRyxJQUFiO0FBQ0EsTUFBQSxVQUFVLENBQUMsSUFBWCxDQUFnQixVQUFBLElBQUksRUFBSTtBQUFBLFlBQ2YsWUFEZSxHQUNDLElBREQsQ0FDZixZQURlO0FBRXRCLFFBQUEsWUFBWSxDQUFDLEdBQWIsQ0FBaUIsVUFBQSxLQUFLLEVBQUk7QUFDeEIsY0FBRyxDQUFDLElBQUksQ0FBQyx5QkFBTCxDQUErQixRQUEvQixDQUF3QyxLQUFLLENBQUMsR0FBOUMsQ0FBSixFQUF3RDtBQUN0RCxZQUFBLElBQUksQ0FBQyxlQUFMLENBQXFCLElBQXJCLENBQTBCLEtBQTFCO0FBQ0Q7QUFDRixTQUpEO0FBS0EsUUFBQSxVQUFVLENBQUMsS0FBWDtBQUNELE9BUkQsRUFRRztBQUNELFFBQUEsWUFBWSxFQUFFO0FBRGIsT0FSSDtBQVdELEtBOUZNO0FBK0ZQLElBQUEsU0EvRk8scUJBK0ZHLEdBL0ZILEVBK0ZRLENBL0ZSLEVBK0ZXLElBL0ZYLEVBK0ZpQjtBQUN0QixVQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsT0FBSixDQUFZLENBQVosQ0FBZDtBQUNBLFVBQUksSUFBSSxLQUFLLE1BQVQsSUFBbUIsS0FBSyxLQUFLLENBQTlCLElBQXFDLElBQUksS0FBSyxPQUFULElBQW9CLEtBQUssR0FBQyxDQUFOLEtBQVksR0FBRyxDQUFDLE1BQTVFLEVBQXFGO0FBQ3JGLFVBQUksUUFBSjs7QUFDQSxVQUFHLElBQUksS0FBSyxNQUFaLEVBQW9CO0FBQ2xCLFFBQUEsUUFBUSxHQUFHLEtBQUssR0FBRyxDQUFuQjtBQUNELE9BRkQsTUFFTztBQUNMLFFBQUEsUUFBUSxHQUFHLEtBQUssR0FBRyxDQUFuQjtBQUNEOztBQUNELFVBQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxRQUFELENBQW5CO0FBQ0EsTUFBQSxHQUFHLENBQUMsTUFBSixDQUFXLEtBQVgsRUFBa0IsQ0FBbEIsRUFBcUIsT0FBckI7QUFDQSxNQUFBLEdBQUcsQ0FBQyxNQUFKLENBQVcsUUFBWCxFQUFxQixDQUFyQixFQUF3QixDQUF4QjtBQUNELEtBM0dNO0FBNEdQLElBQUEsV0E1R08sdUJBNEdLLEdBNUdMLEVBNEdVLEtBNUdWLEVBNEdpQjtBQUN0QixNQUFBLEdBQUcsQ0FBQyxNQUFKLENBQVcsS0FBWCxFQUFrQixDQUFsQjtBQUNBOzs7Ozs7QUFNRCxLQXBITTtBQXFIUCxJQUFBLG1CQXJITyxpQ0FxSGU7QUFDcEIsVUFBTSxRQUFRLEdBQUcsS0FBSyxlQUFMLENBQXFCLEdBQXJCLENBQXlCLFVBQUEsS0FBSztBQUFBLGVBQUksS0FBSyxDQUFDLEdBQVY7QUFBQSxPQUE5QixDQUFqQjtBQUNBLE1BQUEsTUFBTSxDQUFDLFdBQUQsRUFBYyxPQUFkLEVBQXVCO0FBQzNCLFFBQUEsU0FBUyxFQUFFLHFCQURnQjtBQUUzQixRQUFBLFFBQVEsRUFBUjtBQUYyQixPQUF2QixDQUFOLENBSUcsSUFKSCxDQUlRLFlBQVc7QUFDZixRQUFBLFlBQVksQ0FBQyxNQUFELENBQVo7QUFDRCxPQU5ILFdBT1MsVUFQVDtBQVFELEtBL0hNO0FBZ0lQLElBQUEsV0FoSU8seUJBZ0lNO0FBQ1gsVUFBTSxTQUFTLEdBQUcsS0FBSyxPQUFMLENBQWEsR0FBYixDQUFpQixVQUFBLENBQUM7QUFBQSxlQUFJLENBQUMsQ0FBQyxHQUFOO0FBQUEsT0FBbEIsQ0FBbEI7QUFDQSxNQUFBLE1BQU0sQ0FBQyxXQUFELEVBQWMsT0FBZCxFQUF1QjtBQUMzQixRQUFBLFNBQVMsRUFBRSxhQURnQjtBQUUzQixRQUFBLFNBQVMsRUFBVDtBQUYyQixPQUF2QixDQUFOLENBSUcsSUFKSCxDQUlRLFlBQU07QUFDVixRQUFBLFlBQVksQ0FBQyxNQUFELENBQVo7QUFDRCxPQU5ILFdBT1MsVUFQVDtBQVFELEtBMUlNO0FBMklQLElBQUEsU0EzSU8sdUJBMklLO0FBQ1YsVUFBTSxPQUFPLEdBQUcsS0FBSyxLQUFMLENBQVcsR0FBWCxDQUFlLFVBQUEsQ0FBQztBQUFBLGVBQUksQ0FBQyxDQUFDLFNBQU47QUFBQSxPQUFoQixDQUFoQjtBQUNBLE1BQUEsTUFBTSxDQUFDLFdBQUQsRUFBYyxPQUFkLEVBQXVCO0FBQzNCLFFBQUEsU0FBUyxFQUFFLFdBRGdCO0FBRTNCLFFBQUEsT0FBTyxFQUFQO0FBRjJCLE9BQXZCLENBQU4sQ0FJRyxJQUpILENBSVEsWUFBTTtBQUNWLFFBQUEsWUFBWSxDQUFDLE1BQUQsQ0FBWjtBQUNELE9BTkgsV0FPUyxVQVBUO0FBUUQsS0FySk07QUFzSlAsSUFBQSxpQkF0Sk8sK0JBc0phO0FBQ2xCLFVBQU0sZUFBZSxHQUFHLEtBQUssYUFBTCxDQUFtQixHQUFuQixDQUF1QixVQUFBLENBQUM7QUFBQSxlQUFJLENBQUMsQ0FBQyxHQUFOO0FBQUEsT0FBeEIsQ0FBeEI7QUFDQSxNQUFBLE1BQU0sQ0FBQyxXQUFELEVBQWMsT0FBZCxFQUF1QjtBQUMzQixRQUFBLFNBQVMsRUFBRSxtQkFEZ0I7QUFFM0IsUUFBQSxlQUFlLEVBQWY7QUFGMkIsT0FBdkIsQ0FBTixDQUlHLElBSkgsQ0FJUSxZQUFNO0FBQ1YsUUFBQSxZQUFZLENBQUMsTUFBRCxDQUFaO0FBQ0QsT0FOSCxXQU9TLFVBUFQ7QUFRRDtBQWhLTTtBQWxCUyxDQUFSLENBQVoiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjb25zdCBkYXRhID0gTktDLm1ldGhvZHMuZ2V0RGF0YUJ5SWQoXCJkYXRhXCIpO1xuY29uc3QgbW9kaWZ5QWQgPSAoYWQsIHR5cGUpID0+IHtcbiAgYWQudHlwZSA9IHR5cGU7XG59O1xuXG5mb3IobGV0IGkgPSAwOyBpIDwgZGF0YS5hZHMubW92YWJsZS5sZW5ndGg7IGkrKykge1xuICBjb25zdCBhZCA9IGRhdGEuYWRzLm1vdmFibGVbaV07XG4gIG1vZGlmeUFkKGFkLCBcIm1vdmFibGVcIik7XG59XG5cbmZvcihsZXQgaSA9IDA7IGkgPCBkYXRhLmFkcy5maXhlZC5sZW5ndGg7IGkrKykge1xuICBjb25zdCBhZCA9IGRhdGEuYWRzLmZpeGVkW2ldO1xuICBtb2RpZnlBZChhZCwgXCJmaXhlZFwiKTtcbn1cblxuY29uc3QgYXBwID0gbmV3IFZ1ZSh7XG4gIGVsOiBcIiNhcHBcIixcbiAgZGF0YToge1xuICAgIGFkczogZGF0YS5hZHMsXG4gICAgcmVjb21tZW5kRm9ydW1zOiBkYXRhLnJlY29tbWVuZEZvcnVtcyxcbiAgICBjb2x1bW5zOiBkYXRhLmNvbHVtbnMsXG4gICAgZ29vZHM6IGRhdGEuZ29vZHMsXG4gICAgdG9wcGVkVGhyZWFkczogZGF0YS50b3BwZWRUaHJlYWRzXG4gIH0sXG4gIG1vdW50ZWQoKSB7XG4gICAgd2luZG93LlNlbGVjdEltYWdlID0gbmV3IE5LQy5tZXRob2RzLnNlbGVjdEltYWdlKCk7XG4gICAgd2luZG93Lk1vdmVUaHJlYWQgPSBuZXcgTktDLm1vZHVsZXMuTW92ZVRocmVhZCgpO1xuICB9LFxuICBjb21wdXRlZDoge1xuICAgIHNlbGVjdGVkUmVjb21tZW5kRm9ydW1zSWQoKSB7XG4gICAgICByZXR1cm4gZGF0YS5yZWNvbW1lbmRGb3J1bXMubWFwKGYgPT4gZi5maWQpO1xuICAgIH1cbiAgfSxcbiAgbWV0aG9kczoge1xuICAgIGNoZWNrU3RyaW5nOiBOS0MubWV0aG9kcy5jaGVja0RhdGEuY2hlY2tTdHJpbmcsXG4gICAgY2hlY2tOdW1iZXI6IE5LQy5tZXRob2RzLmNoZWNrRGF0YS5jaGVja051bWJlcixcbiAgICBnZXRVcmw6IE5LQy5tZXRob2RzLnRvb2xzLmdldFVybCxcbiAgICBmbG9hdFVzZXJJbmZvOiBOS0MubWV0aG9kcy50b29scy5mbG9hdFVzZXJJbmZvLFxuICAgIHZpc2l0VXJsOiBOS0MubWV0aG9kcy52aXNpdFVybCxcbiAgICBzZWxlY3RMb2NhbEZpbGUoYWQpIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7fTtcbiAgICAgIGlmKGFkLnR5cGUgPT09IFwibW92YWJsZVwiKSB7XG4gICAgICAgIG9wdGlvbnMuYXNwZWN0UmF0aW8gPSA4MDAvMzM2O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3B0aW9ucy5hc3BlY3RSYXRpbyA9IDQwMC8yNTM7XG4gICAgICB9XG4gICAgICBTZWxlY3RJbWFnZS5zaG93KGRhdGEgPT4ge1xuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJjb3ZlclwiLCBkYXRhKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwidG9wVHlwZVwiLCBhZC50eXBlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwidGlkXCIsIGFkLnRpZCk7XG4gICAgICAgIG5rY1VwbG9hZEZpbGUoXCIvbmtjL2hvbWVcIiwgXCJQT1NUXCIsIGZvcm1EYXRhKVxuICAgICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgICAgYWQuY292ZXIgPSBkYXRhLmNvdmVySGFzaDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcbiAgICAgICAgU2VsZWN0SW1hZ2UuY2xvc2UoKTtcbiAgICAgIH0sIG9wdGlvbnMpO1xuICAgIH0sXG4gICAgbW92ZShhZCwgdHlwZSkge1xuICAgICAgbGV0IGFkcztcbiAgICAgIGlmKGFkLnR5cGUgPT09IFwibW92YWJsZVwiKSB7XG4gICAgICAgIGFkcyA9IHRoaXMuYWRzLm1vdmFibGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhZHMgPSB0aGlzLmFkcy5maXhlZDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGluZGV4ID0gYWRzLmluZGV4T2YoYWQpO1xuICAgICAgaWYoKHR5cGUgPT09IFwibGVmdFwiICYmIGluZGV4ID09PSAwKSB8fCAodHlwZSA9PT0gXCJyaWdodFwiICYmIGluZGV4KzEgPT09IGFkcy5sZW5ndGgpKSByZXR1cm47XG4gICAgICBsZXQgbmV3SW5kZXg7XG4gICAgICBpZih0eXBlID09PSBcImxlZnRcIikge1xuICAgICAgICBuZXdJbmRleCA9IGluZGV4IC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld0luZGV4ID0gaW5kZXggKyAxO1xuICAgICAgfVxuICAgICAgY29uc3Qgb3RoZXJBZCA9IGFkc1tuZXdJbmRleF07XG4gICAgICBhZHMuc3BsaWNlKGluZGV4LCAxLCBvdGhlckFkKTtcbiAgICAgIGFkcy5zcGxpY2UobmV3SW5kZXgsIDEsIGFkKTtcbiAgICB9LFxuICAgIHNhdmVBZHMoKXtcbiAgICAgIGNvbnN0IHttb3ZhYmxlLCBmaXhlZCwgbW92YWJsZU9yZGVyLCBmaXhlZE9yZGVyfSA9IHRoaXMuYWRzO1xuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgbW92YWJsZS5jb25jYXQoZml4ZWQpLm1hcChhZCA9PiB7XG4gICAgICAgICAgICBzZWxmLmNoZWNrU3RyaW5nKGFkLnRpdGxlLCB7XG4gICAgICAgICAgICAgIG5hbWU6IFwi5qCH6aKYXCIsXG4gICAgICAgICAgICAgIG1pbkxlbmd0aDogMSxcbiAgICAgICAgICAgICAgbWF4TGVuZ3RoOiAyMDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYoIWFkLmNvdmVyKSB0aHJvdyBcIuWwgemdouWbvuS4jeiDveS4uuepulwiO1xuICAgICAgICAgICAgaWYoIWFkLnRpZCkgdGhyb3cgXCLmlofnq6BJROS4jeiDveS4uuepulwiO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBua2NBUEkoXCIvbmtjL2hvbWVcIiwgXCJQQVRDSFwiLCB7XG4gICAgICAgICAgICBvcGVyYXRpb246IFwic2F2ZUFkc1wiLFxuICAgICAgICAgICAgbW92YWJsZSxcbiAgICAgICAgICAgIGZpeGVkLFxuICAgICAgICAgICAgbW92YWJsZU9yZGVyLFxuICAgICAgICAgICAgZml4ZWRPcmRlclxuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgc3dlZXRTdWNjZXNzKFwi5L+d5a2Y5oiQ5YqfXCIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcik7XG4gICAgfSxcbiAgICByZW1vdmUoYWRzLCBpbmRleCl7XG4gICAgICBhZHMuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgLypzd2VldFF1ZXN0aW9uKFwi56Gu5a6a6KaB5omn6KGM5Yig6Zmk5pON5L2c77yfXCIpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBhZHMuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKCkgPT4ge30pKi9cbiAgICAgIFxuICAgIH0sXG4gICAgYWRkRm9ydW0oKSB7XG4gICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgIE1vdmVUaHJlYWQub3BlbihkYXRhID0+IHtcbiAgICAgICAgY29uc3Qge29yaWdpbkZvcnVtc30gPSBkYXRhO1xuICAgICAgICBvcmlnaW5Gb3J1bXMubWFwKGZvcnVtID0+IHtcbiAgICAgICAgICBpZighc2VsZi5zZWxlY3RlZFJlY29tbWVuZEZvcnVtc0lkLmluY2x1ZGVzKGZvcnVtLmZpZCkpIHtcbiAgICAgICAgICAgIHNlbGYucmVjb21tZW5kRm9ydW1zLnB1c2goZm9ydW0pXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgTW92ZVRocmVhZC5jbG9zZSgpO1xuICAgICAgfSwge1xuICAgICAgICBoaWRlTW92ZVR5cGU6IHRydWVcbiAgICAgIH0pXG4gICAgfSxcbiAgICBtb3ZlRm9ydW0oYXJyLCBmLCB0eXBlKSB7XG4gICAgICBjb25zdCBpbmRleCA9IGFyci5pbmRleE9mKGYpO1xuICAgICAgaWYoKHR5cGUgPT09IFwibGVmdFwiICYmIGluZGV4ID09PSAwKSB8fCAodHlwZSA9PT0gXCJyaWdodFwiICYmIGluZGV4KzEgPT09IGFyci5sZW5ndGgpKSByZXR1cm47XG4gICAgICBsZXQgbmV3SW5kZXg7XG4gICAgICBpZih0eXBlID09PSBcImxlZnRcIikge1xuICAgICAgICBuZXdJbmRleCA9IGluZGV4IC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld0luZGV4ID0gaW5kZXggKyAxO1xuICAgICAgfVxuICAgICAgY29uc3Qgb3RoZXJBZCA9IGFycltuZXdJbmRleF07XG4gICAgICBhcnIuc3BsaWNlKGluZGV4LCAxLCBvdGhlckFkKTtcbiAgICAgIGFyci5zcGxpY2UobmV3SW5kZXgsIDEsIGYpO1xuICAgIH0sXG4gICAgcmVtb3ZlRm9ydW0oYXJyLCBpbmRleCkge1xuICAgICAgYXJyLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAvKmNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgc3dlZXRRdWVzdGlvbihcIuehruWumuimgeaJp+ihjOWIoOmZpOaTjeS9nO+8n1wiKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgYXJyLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoKSA9PiB7fSkqL1xuICAgIH0sXG4gICAgc2F2ZVJlY29tbWVuZEZvcnVtcygpIHtcbiAgICAgIGNvbnN0IGZvcnVtc0lkID0gdGhpcy5yZWNvbW1lbmRGb3J1bXMubWFwKGZvcnVtID0+IGZvcnVtLmZpZCk7XG4gICAgICBua2NBUEkoXCIvbmtjL2hvbWVcIiwgXCJQQVRDSFwiLCB7XG4gICAgICAgIG9wZXJhdGlvbjogXCJzYXZlUmVjb21tZW5kRm9ydW1zXCIsXG4gICAgICAgIGZvcnVtc0lkXG4gICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICBzd2VldFN1Y2Nlc3MoXCLkv53lrZjmiJDlip9cIik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcbiAgICB9LFxuICAgIHNhdmVDb2x1bW5zKCl7XG4gICAgICBjb25zdCBjb2x1bW5zSWQgPSB0aGlzLmNvbHVtbnMubWFwKGMgPT4gYy5faWQpO1xuICAgICAgbmtjQVBJKFwiL25rYy9ob21lXCIsIFwiUEFUQ0hcIiwge1xuICAgICAgICBvcGVyYXRpb246IFwic2F2ZUNvbHVtbnNcIixcbiAgICAgICAgY29sdW1uc0lkXG4gICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgc3dlZXRTdWNjZXNzKFwi5L+d5a2Y5oiQ5YqfXCIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcik7XG4gICAgfSxcbiAgICBzYXZlR29vZHMoKSB7XG4gICAgICBjb25zdCBnb29kc0lkID0gdGhpcy5nb29kcy5tYXAoZyA9PiBnLnByb2R1Y3RJZCk7XG4gICAgICBua2NBUEkoXCIvbmtjL2hvbWVcIiwgXCJQQVRDSFwiLCB7XG4gICAgICAgIG9wZXJhdGlvbjogXCJzYXZlR29vZHNcIixcbiAgICAgICAgZ29vZHNJZFxuICAgICAgfSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHN3ZWV0U3VjY2VzcyhcIuS/neWtmOaIkOWKn1wiKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xuICAgIH0sXG4gICAgc2F2ZVRvcHBlZFRocmVhZHMoKSB7XG4gICAgICBjb25zdCB0b3BwZWRUaHJlYWRzSWQgPSB0aGlzLnRvcHBlZFRocmVhZHMubWFwKHQgPT4gdC50aWQpO1xuICAgICAgbmtjQVBJKFwiL25rYy9ob21lXCIsIFwiUEFUQ0hcIiwge1xuICAgICAgICBvcGVyYXRpb246IFwic2F2ZVRvcHBlZFRocmVhZHNcIixcbiAgICAgICAgdG9wcGVkVGhyZWFkc0lkXG4gICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgc3dlZXRTdWNjZXNzKFwi5L+d5a2Y5oiQ5YqfXCIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goc3dlZXRFcnJvcilcbiAgICB9XG4gIH1cbn0pO1xuIl19
