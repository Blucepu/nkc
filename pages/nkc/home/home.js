!function a(s,i,c){function d(t,e){if(!i[t]){if(!s[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(h)return h(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var r=i[t]={exports:{}};s[t][0].call(r.exports,function(e){return d(s[t][1][e]||e)},r,r.exports,a,s,i,c)}return i[t].exports}for(var h="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(e,t,o){"use strict";for(var n=NKC.methods.getDataById("data"),r=function(e,t){e.type=t},a=0;a<n.ads.movable.length;a++){r(n.ads.movable[a],"movable")}for(var s=0;s<n.ads.fixed.length;s++){r(n.ads.fixed[s],"fixed")}new Vue({el:"#app",data:{page:{id:"other",name:"其他"},recommendThreads:n.recommendThreads,ads:n.ads,recommendForums:n.recommendForums,columns:n.columns,goods:n.goods,toppedThreads:n.toppedThreads,latestToppedThreads:n.latestToppedThreads,showShopGoods:n.showGoods?"t":"",originalThreadDisplayMode:n.originalThreadDisplayMode,showActivityEnter:n.showActivityEnter?"show":"hidden",updating:!1},mounted:function(){window.SelectImage=new NKC.methods.selectImage,window.MoveThread=new NKC.modules.MoveThread},computed:{selectedRecommendForumsId:function(){return n.recommendForums.map(function(e){return e.fid})},nav:function(){var t=this.page,e=[{id:"other",name:"其他"},{id:"movable",name:"轮播图"},{id:"fixed",name:"固定图"}];return e.map(function(e){e.active=e.id===t.id}),e},threadCount:function(){var e=this.recommendThreads[this.page.id],t=e.automaticProportion,o=e.count,n=Math.round(o*t/(t+1));return{automaticCount:n,manualCount:o-n}}},methods:{checkString:NKC.methods.checkData.checkString,checkNumber:NKC.methods.checkData.checkNumber,getUrl:NKC.methods.tools.getUrl,floatUserInfo:NKC.methods.tools.floatUserInfo,visitUrl:NKC.methods.visitUrl,removeFromArr:function(e,t){e.splice(t,1)},moveFromArr:function(e,t,o){var n,r,a,s=e.length;0===t&&"left"===o||t+1===s&&"right"===o||(n="left"===o?t-1:t+1,r=e[t],a=e[n],Vue.set(e,t,a),Vue.set(e,n,r))},getRecommendTypeName:function(e){return{movable:"轮播图",fixed:"固定图"}[e]},selectPage:function(e){this.page=e},saveRecommendThreads:function(){var e=this.page,t=this.recommendThreads[e.id];nkcAPI("/nkc/home","PUT",{operation:"saveRecommendThreads",type:e.id,options:t}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},updateThreadList:function(){var e=this.page;this.updating=!0;var t=e.id,o=this;nkcAPI("/nkc/home","PUT",{operation:"updateThreadList",type:t}).then(function(e){o.recommendThreads[t].automaticallySelectedThreads=e.automaticallySelectedThreads,Vue.set(o.saveRecommendThreads),sweetSuccess("更新成功"),o.updating=!1}).catch(function(e){o.updating=!1})},selectLocalFile:function(o){var e={};"movable"===o.type?e.aspectRatio=800/336:e.aspectRatio=400/253,SelectImage.show(function(e){var t=new FormData;t.append("cover",e),t.append("topType",o.type),t.append("tid",o.tid),nkcUploadFile("/nkc/home","POST",t).then(function(e){o.cover=e.coverHash,console.log(o.cover)}).catch(sweetError),SelectImage.close()},e)},move:function(e,t){var o,n,r="movable"===e.type?this.ads.movable:this.ads.fixed,a=r.indexOf(e);"left"===t&&0===a||"right"===t&&a+1===r.length||(n=r[o="left"===t?a-1:a+1],r.splice(a,1,n),r.splice(o,1,e))},saveAds:function(){var e=this.ads,t=e.movable,o=e.fixed,n=e.movableOrder,r=e.fixedOrder,a=this;Promise.resolve().then(function(){return t.concat(o).map(function(e){if(a.checkString(e.title,{name:"标题",minLength:1,maxLength:200}),!e.cover)throw"封面图不能为空";if(!e.tid)throw"文章ID不能为空"}),nkcAPI("/nkc/home","PUT",{operation:"saveAds",movable:t,fixed:o,movableOrder:n,fixedOrder:r})}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},remove:function(e,t){e.splice(t,1)},addForum:function(){var t=this;MoveThread.open(function(e){e.originForums.map(function(e){t.selectedRecommendForumsId.includes(e.fid)||t.recommendForums.push(e)}),MoveThread.close()},{hideMoveType:!0})},moveForum:function(e,t,o){var n,r,a=e.indexOf(t);"left"===o&&0===a||"right"===o&&a+1===e.length||(r=e[n="left"===o?a-1:a+1],e.splice(a,1,r),e.splice(n,1,t))},removeForum:function(e,t){e.splice(t,1)},saveRecommendForums:function(){var e=this.recommendForums.map(function(e){return e.fid});nkcAPI("/nkc/home","PUT",{operation:"saveRecommendForums",forumsId:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveColumns:function(){var e=this.columns.map(function(e){return e._id});nkcAPI("/nkc/home","PUT",{operation:"saveColumns",columnsId:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveGoods:function(){var e=this.goods.map(function(e){return e.productId}),t=!!this.showShopGoods;nkcAPI("/nkc/home","PUT",{operation:"saveGoods",goodsId:e,showShopGoods:t}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveToppedThreads:function(){var e=this.toppedThreads.map(function(e){return e.tid}),t=this.latestToppedThreads.map(function(e){return e.tid});nkcAPI("/nkc/home","PUT",{operation:"saveToppedThreads",toppedThreadsId:e,latestToppedThreadsId:t}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveOriginalThreadDisplayMode:function(){var e=this.originalThreadDisplayMode;nkcAPI("/nkc/home","PUT",{operation:"saveOriginalThreadDisplayMode",originalThreadDisplayMode:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveShowActivityEnter:function(){var e="show"===this.showActivityEnter;nkcAPI("/nkc/home/showActivityEnter","PUT",{showActivityEnter:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)}}})},{}]},{},[1]);