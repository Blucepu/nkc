!function i(s,a,c){function d(o,e){if(!a[o]){if(!s[o]){var t="function"==typeof require&&require;if(!e&&t)return t(o,!0);if(u)return u(o,!0);var n=new Error("Cannot find module '"+o+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[o]={exports:{}};s[o][0].call(r.exports,function(e){return d(s[o][1][e]||e)},r,r.exports,i,s,a,c)}return a[o].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(e,o,t){"use strict";for(var n=NKC.methods.getDataById("data"),r=function(e,o){e.type=o},i=0;i<n.ads.movable.length;i++){r(n.ads.movable[i],"movable")}for(var s=0;s<n.ads.fixed.length;s++){r(n.ads.fixed[s],"fixed")}new Vue({el:"#app",data:{page:{id:"other",name:"其他"},recommendThreads:n.recommendThreads,ads:n.ads,recommendForums:n.recommendForums,columns:n.columns,goods:n.goods,toppedThreads:n.toppedThreads,latestToppedThreads:n.latestToppedThreads,showShopGoods:n.showGoods?"t":"",originalThreadDisplayMode:n.originalThreadDisplayMode,showActivityEnter:n.showActivityEnter?"show":"hidden",updating:!1,columnListPosition:n.columnListPosition,columnCount:n.columnCount},mounted:function(){window.SelectImage=new NKC.methods.selectImage,window.MoveThread=new NKC.modules.MoveThread},computed:{selectedRecommendForumsId:function(){return n.recommendForums.map(function(e){return e.fid})},nav:function(){var o=this.page,e=[{id:"other",name:"其他"},{id:"movable",name:"轮播图"},{id:"fixed",name:"固定图"}];return e.map(function(e){e.active=e.id===o.id}),e},threadCount:function(){var e=this.recommendThreads[this.page.id],o=e.automaticProportion,t=e.count,n=Math.round(t*o/(o+1));return{automaticCount:n,manualCount:t-n}}},methods:{checkString:NKC.methods.checkData.checkString,checkNumber:NKC.methods.checkData.checkNumber,getUrl:NKC.methods.tools.getUrl,floatUserInfo:NKC.methods.tools.floatUserInfo,visitUrl:NKC.methods.visitUrl,removeFromArr:function(e,o){e.splice(o,1)},moveFromArr:function(e,o,t){var n,r,i,s=e.length;0===o&&"left"===t||o+1===s&&"right"===t||(n="left"===t?o-1:o+1,r=e[o],i=e[n],Vue.set(e,o,i),Vue.set(e,n,r))},getRecommendTypeName:function(e){return{movable:"轮播图",fixed:"固定图"}[e]},selectPage:function(e){this.page=e},saveRecommendThreads:function(){var e=this.page,o=this.recommendThreads[e.id];nkcAPI("/nkc/home","PUT",{operation:"saveRecommendThreads",type:e.id,options:o}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},updateThreadList:function(){var e=this.page;this.updating=!0;var o=e.id,t=this;nkcAPI("/nkc/home","PUT",{operation:"updateThreadList",type:o}).then(function(e){t.recommendThreads[o].automaticallySelectedThreads=e.automaticallySelectedThreads,Vue.set(t.saveRecommendThreads),sweetSuccess("更新成功"),t.updating=!1}).catch(function(e){t.updating=!1})},selectLocalFile:function(t){var e={};"movable"===t.type?e.aspectRatio=800/336:e.aspectRatio=400/253,SelectImage.show(function(e){var o=new FormData;o.append("cover",e),o.append("topType",t.type),o.append("tid",t.tid),nkcUploadFile("/nkc/home","POST",o).then(function(e){t.cover=e.coverHash,console.log(t.cover)}).catch(sweetError),SelectImage.close()},e)},move:function(e,o){var t,n,r="movable"===e.type?this.ads.movable:this.ads.fixed,i=r.indexOf(e);"left"===o&&0===i||"right"===o&&i+1===r.length||(n=r[t="left"===o?i-1:i+1],r.splice(i,1,n),r.splice(t,1,e))},saveAds:function(){var e=this.ads,o=e.movable,t=e.fixed,n=e.movableOrder,r=e.fixedOrder,i=this;Promise.resolve().then(function(){return o.concat(t).map(function(e){if(i.checkString(e.title,{name:"标题",minLength:1,maxLength:200}),!e.cover)throw"封面图不能为空";if(!e.tid)throw"文章ID不能为空"}),nkcAPI("/nkc/home","PUT",{operation:"saveAds",movable:o,fixed:t,movableOrder:n,fixedOrder:r})}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},remove:function(e,o){e.splice(o,1)},addForum:function(){var o=this;MoveThread.open(function(e){e.originForums.map(function(e){o.selectedRecommendForumsId.includes(e.fid)||o.recommendForums.push(e)}),MoveThread.close()},{hideMoveType:!0})},moveForum:function(e,o,t){var n,r,i=e.indexOf(o);"left"===t&&0===i||"right"===t&&i+1===e.length||(r=e[n="left"===t?i-1:i+1],e.splice(i,1,r),e.splice(n,1,o))},removeForum:function(e,o){e.splice(o,1)},saveRecommendForums:function(){var e=this.recommendForums.map(function(e){return e.fid});nkcAPI("/nkc/home","PUT",{operation:"saveRecommendForums",forumsId:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveColumns:function(){var e=this.columns.map(function(e){return e._id});nkcAPI("/nkc/home","PUT",{operation:"saveColumns",columnsId:e,columnListPosition:this.columnListPosition,columnCount:this.columnCount}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveGoods:function(){var e=this.goods.map(function(e){return e.productId}),o=!!this.showShopGoods;nkcAPI("/nkc/home","PUT",{operation:"saveGoods",goodsId:e,showShopGoods:o}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveToppedThreads:function(){var e=this.toppedThreads.map(function(e){return e.tid}),o=this.latestToppedThreads.map(function(e){return e.tid});nkcAPI("/nkc/home","PUT",{operation:"saveToppedThreads",toppedThreadsId:e,latestToppedThreadsId:o}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveOriginalThreadDisplayMode:function(){var e=this.originalThreadDisplayMode;nkcAPI("/nkc/home","PUT",{operation:"saveOriginalThreadDisplayMode",originalThreadDisplayMode:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveShowActivityEnter:function(){var e="show"===this.showActivityEnter;nkcAPI("/nkc/home/showActivityEnter","PUT",{showActivityEnter:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)}}})},{}]},{},[1]);