!function n(r,s,i){function c(o,e){if(!s[o]){if(!r[o]){var t="function"==typeof require&&require;if(!e&&t)return t(o,!0);if(a)return a(o,!0);throw(t=new Error("Cannot find module '"+o+"'")).code="MODULE_NOT_FOUND",t}t=s[o]={exports:{}},r[o][0].call(t.exports,function(e){return c(r[o][1][e]||e)},t,t.exports,n,r,s,i)}return s[o].exports}for(var a="function"==typeof require&&require,e=0;e<i.length;e++)c(i[e]);return c}({1:[function(e,o,t){"use strict";for(var n=NKC.methods.getDataById("data"),r=function(e,o){e.type=o},s=0;s<n.ads.movable.length;s++)r(n.ads.movable[s],"movable");for(var i=0;i<n.ads.fixed.length;i++)r(n.ads.fixed[i],"fixed");new Vue({el:"#app",data:{page:{id:"other",name:"其他"},recommendThreads:n.recommendThreads,ads:n.ads,recommendForums:n.recommendForums,columns:n.columns,poolColumns:n.poolColumns,toppedColumns:n.toppedColumns,goods:n.goods,toppedThreads:n.toppedThreads,latestToppedThreads:n.latestToppedThreads,showShopGoods:n.showGoods?"t":"",originalThreadDisplayMode:n.originalThreadDisplayMode,showActivityEnter:n.showActivityEnter?"show":"hidden",updating:!1,columnUpdating:!1,columnListPosition:n.columnListPosition,columnCount:n.columnCount,columnListSort:n.columnListSort,columnPool:n.columnPool},mounted:function(){window.SelectImage=new NKC.methods.selectImage,window.MoveThread=new NKC.modules.MoveThread},computed:{selectedRecommendForumsId:function(){return n.recommendForums.map(function(e){return e.fid})},nav:function(){var o=this.page,e=[{id:"other",name:"其他"},{id:"movable",name:"轮播图"},{id:"fixed",name:"固定图"},{id:"hotColumn",name:"热门专栏"},{id:"toppedColumn",name:"置顶专栏"}];return e.map(function(e){e.active=e.id===o.id}),e},threadCount:function(){var e=this.recommendThreads[this.page.id],o=e.automaticProportion,e=e.count,o=Math.round(e*o/(o+1));return{automaticCount:o,manualCount:e-o}}},methods:{checkString:NKC.methods.checkData.checkString,checkNumber:NKC.methods.checkData.checkNumber,getUrl:NKC.methods.tools.getUrl,floatUserInfo:NKC.methods.tools.floatUserInfo,visitUrl:NKC.methods.visitUrl,fromNow:NKC.methods.tools.fromNow,removeFromArr:function(e,o){e.splice(o,1)},moveFromArr:function(e,o,t){var n,r=e.length;0===o&&"left"===t||o+1===r&&"right"===t||(n=e[o],t=e[r="left"===t?o-1:o+1],Vue.set(e,o,t),Vue.set(e,r,n))},getRecommendTypeName:function(e){return{movable:"轮播图",fixed:"固定图"}[e]},selectPage:function(e){this.page=e},saveRecommendThreads:function(){var e=this.page,o=this.recommendThreads[e.id];nkcAPI("/nkc/home","PUT",{operation:"saveRecommendThreads",type:e.id,options:o}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},updateThreadList:function(){var e=this.page;this.updating=!0;var o=e.id,t=this;nkcAPI("/nkc/home","PUT",{operation:"updateThreadList",type:o}).then(function(e){t.recommendThreads[o].automaticallySelectedThreads=e.automaticallySelectedThreads,Vue.set(t.saveRecommendThreads),sweetSuccess("更新成功"),t.updating=!1}).catch(function(e){sweetError(e),t.updating=!1})},updateHomeHotColumns:function(){var o=this,t=this;this.columnUpdating=!0,nkcAPI("/nkc/home","PUT",{operation:"updateHomeHotColumns"}).then(function(e){t.poolColumns=e.poolColumns,o.columnUpdating=!1}).catch(function(e){sweetError(e),o.columnUpdating=!1})},selectLocalFile:function(t){var e={};"movable"===t.type?e.aspectRatio=800/336:e.aspectRatio=400/253,SelectImage.show(function(e){var o=new FormData;o.append("cover",e),o.append("topType",t.type),o.append("tid",t.tid),nkcUploadFile("/nkc/home","POST",o).then(function(e){t.cover=e.coverHash,console.log(t.cover)}).catch(sweetError),SelectImage.close()},e)},move:function(e,o){var t,n="movable"===e.type?this.ads.movable:this.ads.fixed,r=n.indexOf(e);"left"===o&&0===r||"right"===o&&r+1===n.length||(o=n[t="left"===o?r-1:r+1],n.splice(r,1,o),n.splice(t,1,e))},saveAds:function(){var e=this.ads,o=e.movable,t=e.fixed,n=e.movableOrder,r=e.fixedOrder,s=this;Promise.resolve().then(function(){return o.concat(t).map(function(e){if(s.checkString(e.title,{name:"标题",minLength:1,maxLength:200}),!e.cover)throw"封面图不能为空";if(!e.tid)throw"文章ID不能为空"}),nkcAPI("/nkc/home","PUT",{operation:"saveAds",movable:o,fixed:t,movableOrder:n,fixedOrder:r})}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},remove:function(e,o){e.splice(o,1)},addForum:function(){var o=this;MoveThread.open(function(e){e.originForums.map(function(e){o.selectedRecommendForumsId.includes(e.fid)||o.recommendForums.push(e)}),MoveThread.close()},{hideMoveType:!0})},moveForum:function(e,o,t){var n,r=e.indexOf(o);"left"===t&&0===r||"right"===t&&r+1===e.length||(t=e[n="left"===t?r-1:r+1],e.splice(r,1,t),e.splice(n,1,o))},removeForum:function(e,o){e.splice(o,1)},saveRecommendForums:function(){var e=this.recommendForums.map(function(e){return e.fid});nkcAPI("/nkc/home","PUT",{operation:"saveRecommendForums",forumsId:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveColumns:function(){var e=this.columns.map(function(e){return e._id}),o=this.poolColumns.map(function(e){return e._id});nkcAPI("/nkc/home","PUT",{operation:"saveColumns",columnsId:e,columnListPosition:this.columnListPosition,columnCount:this.columnCount,columnPool:this.columnPool,columnListSort:this.columnListSort,poolColumnsId:o}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveToppedColumns:function(){var e=this.toppedColumns.map(function(e){return e._id});nkcAPI("/nkc/home","PUT",{operation:"saveToppedColumns",columnsId:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveGoods:function(){var e=this.goods.map(function(e){return e.productId}),o=!!this.showShopGoods;nkcAPI("/nkc/home","PUT",{operation:"saveGoods",goodsId:e,showShopGoods:o}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveToppedThreads:function(){var e=this.toppedThreads.map(function(e){return e.tid}),o=this.latestToppedThreads.map(function(e){return e.tid});nkcAPI("/nkc/home","PUT",{operation:"saveToppedThreads",toppedThreadsId:e,latestToppedThreadsId:o}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveOriginalThreadDisplayMode:function(){var e=this.originalThreadDisplayMode;nkcAPI("/nkc/home","PUT",{operation:"saveOriginalThreadDisplayMode",originalThreadDisplayMode:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)},saveShowActivityEnter:function(){var e="show"===this.showActivityEnter;nkcAPI("/nkc/home/showActivityEnter","PUT",{showActivityEnter:e}).then(function(){sweetSuccess("保存成功")}).catch(sweetError)}}})},{}]},{},[1]);