(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById('data');
var math = NKC.modules.math;
var defaultKCB = [10, 20, 50, 100, 500, 1000, 5000];
var app = new Vue({
  el: '#app',
  data: {
    defaultKCB: defaultKCB.filter(function (d) {
      return d >= data.rechargeSettings.min / 100 && d <= data.rechargeSettings.max / 100;
    }),
    money: 10,
    error: '',
    payment: '',
    input: '',
    mainScore: data.mainScore,
    rechargeSettings: data.rechargeSettings
  },
  computed: {
    payments: function payments() {
      var arr = [];
      var _this$rechargeSetting = this.rechargeSettings,
          weChat = _this$rechargeSetting.weChat,
          aliPay = _this$rechargeSetting.aliPay;
      if (aliPay.enabled) arr.push({
        type: 'aliPay',
        name: '支付宝'
      });
      if (weChat.enabled) arr.push({
        type: 'weChat',
        name: '微信支付'
      });
      return arr;
    },
    payInfo: function payInfo() {
      var payment = this.payment,
          rechargeSettings = this.rechargeSettings;
      if (!payment) return;
      var pay = rechargeSettings[payment];

      if (pay.enabled && pay.fee > 0) {
        var fee = math.chain(math.bignumber(pay.fee)).multiply(100).done().toNumber();
        return "\u670D\u52A1\u5546\uFF08\u975E\u672C\u7AD9\uFF09\u5C06\u6536\u53D6 ".concat(fee, "% \u7684\u624B\u7EED\u8D39");
      }
    },
    fee: function fee() {
      var totalPrice = this.totalPrice,
          finalPrice = this.finalPrice;

      if (totalPrice) {
        return Number((totalPrice - finalPrice).toFixed(2));
      }
    },
    finalPrice: function finalPrice() {
      var money = this.money,
          input = this.input;
      var m = input;

      if (money !== '') {
        m = money;
      }

      if (m) {
        m = m.toFixed(2);
        return Number(m);
      }
    },
    totalPrice: function totalPrice() {
      var payment = this.payment,
          rechargeSettings = this.rechargeSettings;
      var pay = rechargeSettings[payment];

      if (pay) {
        if (this.finalPrice) {
          var fee = this.finalPrice / (1 - pay.fee);
          fee = fee.toFixed(2);
          return Number(fee);
        }
      }
    }
  },
  mounted: function mounted() {
    if (this.payments.length) {
      this.selectPayment(this.payments[0].type);
    }
  },
  methods: {
    select: function select(m) {
      this.money = m;
    },
    selectPayment: function selectPayment(t) {
      this.payment = t;
    },
    pay: function pay() {
      var totalPrice = this.totalPrice,
          payment = this.payment,
          finalPrice = this.finalPrice;
      var newWindow;
      var redirect = false;
      var isPhone = NKC.methods.isPhone();
      var url = "/account/finance/recharge?type=get_url&money=".concat(totalPrice, "&score=").concat(finalPrice, "&payment=").concat(payment);
      Promise.resolve().then(function () {
        if (!['aliPay', 'weChat'].includes(payment)) throw '请选择支付方式';

        if (totalPrice > 0) {} else {
          throw '充值金额必须大于0';
        }

        if (NKC.configs.platform !== 'reactNative') {
          if (isPhone) {
            url += '&redirect=true';
            screenTopAlert('正在前往支付宝...');
            redirect = true;
            return window.location.href = url;
          } else {
            newWindow = window.open();
          }
        }

        return nkcAPI(url, 'GET');
      }).then(function (data) {
        if (redirect) return;

        if (NKC.configs.platform === 'reactNative') {
          NKC.methods.visitUrl(data.url, true);
        } else {
          newWindow.location = data.url;
        }

        sweetInfo('请在浏览器新打开的窗口完成支付！若没有新窗口打开，请检查新窗口是否已被浏览器拦截。');
      })["catch"](function (err) {
        sweetError(err);

        if (newWindow) {
          newWindow.document.body.innerHTML = err.error || err;
        }
      });
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL2FjY291bnQvZmluYW5jZS9yZWNoYXJnZS5tanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLElBQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFKLENBQVksV0FBWixDQUF3QixNQUF4QixDQUFiO0FBQ0EsSUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE9BQUosQ0FBWSxJQUF6QjtBQUNBLElBQUksVUFBVSxHQUFHLENBQUMsRUFBRCxFQUFLLEVBQUwsRUFBUyxFQUFULEVBQWEsR0FBYixFQUFrQixHQUFsQixFQUF1QixJQUF2QixFQUE2QixJQUE3QixDQUFqQjtBQUNBLElBQUksR0FBRyxHQUFHLElBQUksR0FBSixDQUFRO0FBQ2hCLEVBQUEsRUFBRSxFQUFFLE1BRFk7QUFFaEIsRUFBQSxJQUFJLEVBQUU7QUFDSixJQUFBLFVBQVUsRUFBRSxVQUFVLENBQUMsTUFBWCxDQUFrQixVQUFBLENBQUMsRUFBSTtBQUNqQyxhQUNFLENBQUMsSUFBSSxJQUFJLENBQUMsZ0JBQUwsQ0FBc0IsR0FBdEIsR0FBNEIsR0FBakMsSUFBd0MsQ0FBQyxJQUFJLElBQUksQ0FBQyxnQkFBTCxDQUFzQixHQUF0QixHQUE0QixHQUQzRTtBQUdELEtBSlcsQ0FEUjtBQU1KLElBQUEsS0FBSyxFQUFFLEVBTkg7QUFPSixJQUFBLEtBQUssRUFBRSxFQVBIO0FBUUosSUFBQSxPQUFPLEVBQUUsRUFSTDtBQVNKLElBQUEsS0FBSyxFQUFFLEVBVEg7QUFVSixJQUFBLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FWWjtBQVdKLElBQUEsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDO0FBWG5CLEdBRlU7QUFlaEIsRUFBQSxRQUFRLEVBQUU7QUFDUixJQUFBLFFBRFEsc0JBQ0c7QUFDVCxVQUFNLEdBQUcsR0FBRyxFQUFaO0FBRFMsa0NBRWdCLEtBQUssZ0JBRnJC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O0FBQ1osWUFBRyxRQUFILEVBQWE7O0FBQ2IsWUFBRyxHQUFHLENBQUMsT0FBSixDQUFZLFFBQVosS0FBeUIsYUFBNUIsRUFBMkM7QUFDekMsVUFBQSxHQUFHLENBQUMsT0FBSixDQUFZLFFBQVosQ0FBcUIsSUFBSSxDQUFDLEdBQTFCLEVBQStCLElBQS9CO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsVUFBQSxTQUFTLENBQUMsUUFBVixHQUFxQixJQUFJLENBQUMsR0FBMUI7QUFDRDs7QUFDRCxRQUFBLFNBQVMsQ0FBQywyQ0FBRCxDQUFUO0FBQ0QsT0EzQkgsV0E0QlMsVUFBQSxHQUFHLEVBQUk7QUFDWixRQUFBLFVBQVUsQ0FBQyxHQUFELENBQVY7O0FBQ0EsWUFBRyxTQUFILEVBQWM7QUFDWixVQUFBLFNBQVMsQ0FBQyxRQUFWLENBQW1CLElBQW5CLENBQXdCLFNBQXhCLEdBQW9DLEdBQUcsQ0FBQyxLQUFKLElBQWEsR0FBakQ7QUFDRDtBQUNGLE9BakNIO0FBa0NEO0FBL0NNO0FBeEVPLENBQVIsQ0FBViIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGRhdGEgPSBOS0MubWV0aG9kcy5nZXREYXRhQnlJZCgnZGF0YScpO1xyXG5jb25zdCBtYXRoID0gTktDLm1vZHVsZXMubWF0aDtcclxubGV0IGRlZmF1bHRLQ0IgPSBbMTAsIDIwLCA1MCwgMTAwLCA1MDAsIDEwMDAsIDUwMDBdO1xyXG52YXIgYXBwID0gbmV3IFZ1ZSh7XHJcbiAgZWw6ICcjYXBwJyxcclxuICBkYXRhOiB7XHJcbiAgICBkZWZhdWx0S0NCOiBkZWZhdWx0S0NCLmZpbHRlcihkID0+IHtcclxuICAgICAgcmV0dXJuIChcclxuICAgICAgICBkID49IGRhdGEucmVjaGFyZ2VTZXR0aW5ncy5taW4gLyAxMDAgJiYgZCA8PSBkYXRhLnJlY2hhcmdlU2V0dGluZ3MubWF4IC8gMTAwXHJcbiAgICAgICk7XHJcbiAgICB9KSxcclxuICAgIG1vbmV5OiAxMCxcclxuICAgIGVycm9yOiAnJyxcclxuICAgIHBheW1lbnQ6ICcnLFxyXG4gICAgaW5wdXQ6ICcnLFxyXG4gICAgbWFpblNjb3JlOiBkYXRhLm1haW5TY29yZSxcclxuICAgIHJlY2hhcmdlU2V0dGluZ3M6IGRhdGEucmVjaGFyZ2VTZXR0aW5ncyxcclxuICB9LFxyXG4gIGNvbXB1dGVkOiB7XHJcbiAgICBwYXltZW50cygpIHtcclxuICAgICAgY29uc3QgYXJyID0gW107XHJcbiAgICAgIGNvbnN0IHt3ZUNoYXQsIGFsaVBheX0gPSB0aGlzLnJlY2hhcmdlU2V0dGluZ3M7XHJcbiAgICAgIGlmKGFsaVBheS5lbmFibGVkKSBhcnIucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ2FsaVBheScsXHJcbiAgICAgICAgbmFtZTogJ+aUr+S7mOWunSdcclxuICAgICAgfSk7XHJcbiAgICAgIGlmKHdlQ2hhdC5lbmFibGVkKSBhcnIucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ3dlQ2hhdCcsXHJcbiAgICAgICAgbmFtZTogJ+W+ruS/oeaUr+S7mCdcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBhcnI7XHJcbiAgICB9LFxyXG4gICAgcGF5SW5mbygpIHtcclxuICAgICAgY29uc3Qge3BheW1lbnQsIHJlY2hhcmdlU2V0dGluZ3N9ID0gdGhpcztcclxuICAgICAgaWYoIXBheW1lbnQpIHJldHVybjtcclxuICAgICAgY29uc3QgcGF5ID0gcmVjaGFyZ2VTZXR0aW5nc1twYXltZW50XTtcclxuICAgICAgaWYocGF5LmVuYWJsZWQgJiYgcGF5LmZlZSA+IDApIHtcclxuICAgICAgICBjb25zdCBmZWUgPSBtYXRoLmNoYWluKG1hdGguYmlnbnVtYmVyKHBheS5mZWUpKS5tdWx0aXBseSgxMDApLmRvbmUoKS50b051bWJlcigpO1xyXG4gICAgICAgIHJldHVybiBg5pyN5Yqh5ZWG77yI6Z2e5pys56uZ77yJ5bCG5pS25Y+WICR7ZmVlfSUg55qE5omL57ut6LS5YFxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgZmVlKCkge1xyXG4gICAgICBjb25zdCB7dG90YWxQcmljZSwgZmluYWxQcmljZX0gPSB0aGlzO1xyXG4gICAgICBpZih0b3RhbFByaWNlKSB7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcigodG90YWxQcmljZSAtIGZpbmFsUHJpY2UpLnRvRml4ZWQoMikpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgZmluYWxQcmljZSgpIHtcclxuICAgICAgY29uc3Qge21vbmV5LCBpbnB1dH0gPSB0aGlzO1xyXG4gICAgICBsZXQgbSA9IGlucHV0O1xyXG4gICAgICBpZihtb25leSAhPT0gJycpIHtcclxuICAgICAgICBtID0gbW9uZXk7XHJcbiAgICAgIH1cclxuICAgICAgaWYobSkge1xyXG4gICAgICAgIG0gPSBtLnRvRml4ZWQoMik7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcihtKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHRvdGFsUHJpY2UoKSB7XHJcbiAgICAgIGNvbnN0IHtwYXltZW50LCByZWNoYXJnZVNldHRpbmdzfSA9IHRoaXM7XHJcbiAgICAgIGNvbnN0IHBheSA9IHJlY2hhcmdlU2V0dGluZ3NbcGF5bWVudF07XHJcbiAgICAgIGlmKHBheSkge1xyXG4gICAgICAgIGlmKHRoaXMuZmluYWxQcmljZSkge1xyXG4gICAgICAgICAgbGV0IGZlZSA9IHRoaXMuZmluYWxQcmljZSAvICgxIC0gcGF5LmZlZSk7XHJcbiAgICAgICAgICBmZWUgPSBmZWUudG9GaXhlZCgyKTtcclxuICAgICAgICAgIHJldHVybiBOdW1iZXIoZmVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9LFxyXG4gIG1vdW50ZWQoKSB7XHJcbiAgICBpZih0aGlzLnBheW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLnNlbGVjdFBheW1lbnQodGhpcy5wYXltZW50c1swXS50eXBlKTtcclxuICAgIH1cclxuICB9LFxyXG4gIG1ldGhvZHM6IHtcclxuICAgIHNlbGVjdDogZnVuY3Rpb24obSkge1xyXG4gICAgICB0aGlzLm1vbmV5ID0gbTtcclxuICAgIH0sXHJcbiAgICBzZWxlY3RQYXltZW50OiBmdW5jdGlvbih0KSB7XHJcbiAgICAgIHRoaXMucGF5bWVudCA9IHQ7XHJcbiAgICB9LFxyXG4gICAgcGF5OiBmdW5jdGlvbigpIHtcclxuICAgICAgY29uc3Qge3RvdGFsUHJpY2UsIHBheW1lbnQsIGZpbmFsUHJpY2V9ID0gdGhpcztcclxuICAgICAgbGV0IG5ld1dpbmRvdztcclxuICAgICAgbGV0IHJlZGlyZWN0ID0gZmFsc2U7XHJcbiAgICAgIGNvbnN0IGlzUGhvbmUgPSBOS0MubWV0aG9kcy5pc1Bob25lKCk7XHJcbiAgICAgIGxldCB1cmwgPSBgL2FjY291bnQvZmluYW5jZS9yZWNoYXJnZT90eXBlPWdldF91cmwmbW9uZXk9JHt0b3RhbFByaWNlfSZzY29yZT0ke2ZpbmFsUHJpY2V9JnBheW1lbnQ9JHtwYXltZW50fWA7XHJcbiAgICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgaWYoIVsnYWxpUGF5JywgJ3dlQ2hhdCddLmluY2x1ZGVzKHBheW1lbnQpKSB0aHJvdyAn6K+36YCJ5oup5pSv5LuY5pa55byPJztcclxuICAgICAgICAgIGlmKHRvdGFsUHJpY2UgPiAwKSB7fVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93ICflhYXlgLzph5Hpop3lv4XpobvlpKfkuo4wJztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmKE5LQy5jb25maWdzLnBsYXRmb3JtICE9PSAncmVhY3ROYXRpdmUnKSB7XHJcbiAgICAgICAgICAgIGlmKGlzUGhvbmUpIHtcclxuICAgICAgICAgICAgICB1cmwgKz0gJyZyZWRpcmVjdD10cnVlJztcclxuICAgICAgICAgICAgICBzY3JlZW5Ub3BBbGVydCgn5q2j5Zyo5YmN5b6A5pSv5LuY5a6dLi4uJylcclxuICAgICAgICAgICAgICByZWRpcmVjdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIG5ld1dpbmRvdyA9IHdpbmRvdy5vcGVuKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBua2NBUEkodXJsLCAnR0VUJyk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgIGlmKHJlZGlyZWN0KSByZXR1cm47XHJcbiAgICAgICAgICBpZihOS0MuY29uZmlncy5wbGF0Zm9ybSA9PT0gJ3JlYWN0TmF0aXZlJykge1xyXG4gICAgICAgICAgICBOS0MubWV0aG9kcy52aXNpdFVybChkYXRhLnVybCwgdHJ1ZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZXdXaW5kb3cubG9jYXRpb24gPSBkYXRhLnVybDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHN3ZWV0SW5mbygn6K+35Zyo5rWP6KeI5Zmo5paw5omT5byA55qE56qX5Y+j5a6M5oiQ5pSv5LuY77yB6Iul5rKh5pyJ5paw56qX5Y+j5omT5byA77yM6K+35qOA5p+l5paw56qX5Y+j5piv5ZCm5bey6KKr5rWP6KeI5Zmo5oum5oiq44CCJyk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgIHN3ZWV0RXJyb3IoZXJyKVxyXG4gICAgICAgICAgaWYobmV3V2luZG93KSB7XHJcbiAgICAgICAgICAgIG5ld1dpbmRvdy5kb2N1bWVudC5ib2R5LmlubmVySFRNTCA9IGVyci5lcnJvciB8fCBlcnI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG59KTtcclxuIl19
