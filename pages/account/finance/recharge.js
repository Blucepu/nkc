(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById('data');
var math = NKC.modules.math;
var defaultKCB = [10, 20, 50, 100, 500, 1000, 5000];
var app = new Vue({
  el: '#app',
  data: {
    defaultKCB: defaultKCB.filter(function (d) {
      return d >= data.rechargeSettings.min / 100 && d <= data.rechargeSettings.max / 100;
    }),
    money: 10,
    error: '',
    payment: '',
    input: '',
    mainScore: data.mainScore,
    rechargeSettings: data.rechargeSettings
  },
  computed: {
    payments: function payments() {
      var arr = [];
      var _this$rechargeSetting = this.rechargeSettings,
          weChat = _this$rechargeSetting.weChat,
          aliPay = _this$rechargeSetting.aliPay;
      if (aliPay.enabled) arr.push({
        type: 'aliPay',
        name: '支付宝'
      });
      if (weChat.enabled) arr.push({
        type: 'weChat',
        name: '微信支付'
      });
      return arr;
    },
    payInfo: function payInfo() {
      var payment = this.payment,
          rechargeSettings = this.rechargeSettings;
      if (!payment) return;
      var pay = rechargeSettings[payment];

      if (pay.enabled && pay.fee > 0) {
        var fee = math.chain(math.bignumber(pay.fee)).multiply(100).done().toNumber();
        return "\u670D\u52A1\u5546\uFF08\u975E\u672C\u7AD9\uFF09\u5C06\u6536\u53D6 ".concat(fee, "% \u7684\u624B\u7EED\u8D39");
      }
    },
    fee: function fee() {
      var totalPrice = this.totalPrice,
          finalPrice = this.finalPrice;

      if (totalPrice) {
        return Number((totalPrice - finalPrice).toFixed(2));
      }
    },
    finalPrice: function finalPrice() {
      var money = this.money,
          input = this.input;
      var m = input;

      if (money !== '') {
        m = money;
      }

      if (m) {
        m = m.toFixed(2);
        return Number(m);
      }
    },
    totalPrice: function totalPrice() {
      var payment = this.payment,
          rechargeSettings = this.rechargeSettings;
      var pay = rechargeSettings[payment];

      if (pay) {
        if (this.finalPrice) {
          var fee = this.finalPrice / (1 - pay.fee);
          fee = fee.toFixed(2);
          return Number(fee);
        }
      }
    }
  },
  mounted: function mounted() {
    if (this.payments.length) {
      this.selectPayment(this.payments[0].type);
    }
  },
  methods: {
    select: function select(m) {
      this.money = m;
    },
    selectPayment: function selectPayment(t) {
      this.payment = t;
    },
    pay: function pay() {
      var totalPrice = this.totalPrice,
          payment = this.payment,
          finalPrice = this.finalPrice;
      var newWindow;
      var redirect = false;
      var isPhone = NKC.methods.isPhone();
      var url = "/account/finance/recharge?type=get_url&money=".concat(totalPrice, "&score=").concat(finalPrice, "&payment=").concat(payment);
      Promise.resolve().then(function () {
        if (!['aliPay', 'weChat'].includes(payment)) throw '请选择支付方式';

        if (totalPrice > 0) {} else {
          throw '充值金额必须大于0';
        }

        if (NKC.configs.platform !== 'reactNative') {
          if (isPhone) {
            url += '&redirect=true';
            screenTopAlert('正在前往支付宝...');
            redirect = true;
            return window.location.href = url;
          } else {
            newWindow = window.open();
          }
        }

        return nkcAPI(url, 'GET');
      }).then(function (data) {
        if (redirect) return;

        if (NKC.configs.platform === 'reactNative') {
          NKC.methods.visitUrl(data.url, true);
        } else {
          newWindow.location = data.url;
        }

        sweetInfo('请在浏览器新打开的窗口完成支付！若没有新窗口打开，请检查新窗口是否已被浏览器拦截。');
      })["catch"](function (err) {
        sweetError(err);

        if (newWindow) {
          newWindow.document.body.innerHTML = err.error || err;
        }
      });
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9hY2NvdW50L2ZpbmFuY2UvcmVjaGFyZ2UubWpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFNLElBQUksR0FBRyxHQUFHLENBQUMsT0FBSixDQUFZLFdBQVosQ0FBd0IsTUFBeEIsQ0FBYjtBQUNBLElBQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFKLENBQVksSUFBekI7QUFDQSxJQUFJLFVBQVUsR0FBRyxDQUFDLEVBQUQsRUFBSyxFQUFMLEVBQVMsRUFBVCxFQUFhLEdBQWIsRUFBa0IsR0FBbEIsRUFBdUIsSUFBdkIsRUFBNkIsSUFBN0IsQ0FBakI7QUFDQSxJQUFJLEdBQUcsR0FBRyxJQUFJLEdBQUosQ0FBUTtBQUNoQixFQUFBLEVBQUUsRUFBRSxNQURZO0FBRWhCLEVBQUEsSUFBSSxFQUFFO0FBQ0osSUFBQSxVQUFVLEVBQUUsVUFBVSxDQUFDLE1BQVgsQ0FBa0IsVUFBQSxDQUFDLEVBQUk7QUFDakMsYUFDRSxDQUFDLElBQUksSUFBSSxDQUFDLGdCQUFMLENBQXNCLEdBQXRCLEdBQTRCLEdBQWpDLElBQXdDLENBQUMsSUFBSSxJQUFJLENBQUMsZ0JBQUwsQ0FBc0IsR0FBdEIsR0FBNEIsR0FEM0U7QUFHRCxLQUpXLENBRFI7QUFNSixJQUFBLEtBQUssRUFBRSxFQU5IO0FBT0osSUFBQSxLQUFLLEVBQUUsRUFQSDtBQVFKLElBQUEsT0FBTyxFQUFFLEVBUkw7QUFTSixJQUFBLEtBQUssRUFBRSxFQVRIO0FBVUosSUFBQSxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBVlo7QUFXSixJQUFBLGdCQUFnQixFQUFFLElBQUksQ0FBQztBQVhuQixHQUZVO0FBZWhCLEVBQUEsUUFBUSxFQUFFO0FBQ1IsSUFBQSxRQURRLHNCQUNHO0FBQ1QsVUFBTSxHQUFHLEdBQUcsRUFBWjtBQURTLGtDQUVnQixLQUFLLGdCQUZyQjtBQUFBLFVBRUYsTUFGRSx5QkFF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OztBQUNiLFlBQUcsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLEtBQXlCLGFBQTVCLEVBQTJDO0FBQ3pDLFVBQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLENBQXFCLElBQUksQ0FBQyxHQUExQixFQUErQixJQUEvQjtBQUNELFNBRkQsTUFFTztBQUNMLFVBQUEsU0FBUyxDQUFDLFFBQVYsR0FBcUIsSUFBSSxDQUFDLEdBQTFCO0FBQ0Q7O0FBQ0QsUUFBQSxTQUFTLENBQUMsMkNBQUQsQ0FBVDtBQUNELE9BM0JILFdBNEJTLFVBQUEsR0FBRyxFQUFJO0FBQ1osUUFBQSxVQUFVLENBQUMsR0FBRCxDQUFWOztBQUNBLFlBQUcsU0FBSCxFQUFjO0FBQ1osVUFBQSxTQUFTLENBQUMsUUFBVixDQUFtQixJQUFuQixDQUF3QixTQUF4QixHQUFvQyxHQUFHLENBQUMsS0FBSixJQUFhLEdBQWpEO0FBQ0Q7QUFDRixPQWpDSDtBQWtDRDtBQS9DTTtBQXhFTyxDQUFSLENBQVYiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjb25zdCBkYXRhID0gTktDLm1ldGhvZHMuZ2V0RGF0YUJ5SWQoJ2RhdGEnKTtcclxuY29uc3QgbWF0aCA9IE5LQy5tb2R1bGVzLm1hdGg7XHJcbmxldCBkZWZhdWx0S0NCID0gWzEwLCAyMCwgNTAsIDEwMCwgNTAwLCAxMDAwLCA1MDAwXTtcclxudmFyIGFwcCA9IG5ldyBWdWUoe1xyXG4gIGVsOiAnI2FwcCcsXHJcbiAgZGF0YToge1xyXG4gICAgZGVmYXVsdEtDQjogZGVmYXVsdEtDQi5maWx0ZXIoZCA9PiB7XHJcbiAgICAgIHJldHVybiAoXHJcbiAgICAgICAgZCA+PSBkYXRhLnJlY2hhcmdlU2V0dGluZ3MubWluIC8gMTAwICYmIGQgPD0gZGF0YS5yZWNoYXJnZVNldHRpbmdzLm1heCAvIDEwMFxyXG4gICAgICApO1xyXG4gICAgfSksXHJcbiAgICBtb25leTogMTAsXHJcbiAgICBlcnJvcjogJycsXHJcbiAgICBwYXltZW50OiAnJyxcclxuICAgIGlucHV0OiAnJyxcclxuICAgIG1haW5TY29yZTogZGF0YS5tYWluU2NvcmUsXHJcbiAgICByZWNoYXJnZVNldHRpbmdzOiBkYXRhLnJlY2hhcmdlU2V0dGluZ3MsXHJcbiAgfSxcclxuICBjb21wdXRlZDoge1xyXG4gICAgcGF5bWVudHMoKSB7XHJcbiAgICAgIGNvbnN0IGFyciA9IFtdO1xyXG4gICAgICBjb25zdCB7d2VDaGF0LCBhbGlQYXl9ID0gdGhpcy5yZWNoYXJnZVNldHRpbmdzO1xyXG4gICAgICBpZihhbGlQYXkuZW5hYmxlZCkgYXJyLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICdhbGlQYXknLFxyXG4gICAgICAgIG5hbWU6ICfmlK/ku5jlrp0nXHJcbiAgICAgIH0pO1xyXG4gICAgICBpZih3ZUNoYXQuZW5hYmxlZCkgYXJyLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICd3ZUNoYXQnLFxyXG4gICAgICAgIG5hbWU6ICflvq7kv6HmlK/ku5gnXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gYXJyO1xyXG4gICAgfSxcclxuICAgIHBheUluZm8oKSB7XHJcbiAgICAgIGNvbnN0IHtwYXltZW50LCByZWNoYXJnZVNldHRpbmdzfSA9IHRoaXM7XHJcbiAgICAgIGlmKCFwYXltZW50KSByZXR1cm47XHJcbiAgICAgIGNvbnN0IHBheSA9IHJlY2hhcmdlU2V0dGluZ3NbcGF5bWVudF07XHJcbiAgICAgIGlmKHBheS5lbmFibGVkICYmIHBheS5mZWUgPiAwKSB7XHJcbiAgICAgICAgY29uc3QgZmVlID0gbWF0aC5jaGFpbihtYXRoLmJpZ251bWJlcihwYXkuZmVlKSkubXVsdGlwbHkoMTAwKS5kb25lKCkudG9OdW1iZXIoKTtcclxuICAgICAgICByZXR1cm4gYOacjeWKoeWVhu+8iOmdnuacrOerme+8ieWwhuaUtuWPliAke2ZlZX0lIOeahOaJi+e7rei0uWBcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGZlZSgpIHtcclxuICAgICAgY29uc3Qge3RvdGFsUHJpY2UsIGZpbmFsUHJpY2V9ID0gdGhpcztcclxuICAgICAgaWYodG90YWxQcmljZSkge1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIoKHRvdGFsUHJpY2UgLSBmaW5hbFByaWNlKS50b0ZpeGVkKDIpKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGZpbmFsUHJpY2UoKSB7XHJcbiAgICAgIGNvbnN0IHttb25leSwgaW5wdXR9ID0gdGhpcztcclxuICAgICAgbGV0IG0gPSBpbnB1dDtcclxuICAgICAgaWYobW9uZXkgIT09ICcnKSB7XHJcbiAgICAgICAgbSA9IG1vbmV5O1xyXG4gICAgICB9XHJcbiAgICAgIGlmKG0pIHtcclxuICAgICAgICBtID0gbS50b0ZpeGVkKDIpO1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIobSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICB0b3RhbFByaWNlKCkge1xyXG4gICAgICBjb25zdCB7cGF5bWVudCwgcmVjaGFyZ2VTZXR0aW5nc30gPSB0aGlzO1xyXG4gICAgICBjb25zdCBwYXkgPSByZWNoYXJnZVNldHRpbmdzW3BheW1lbnRdO1xyXG4gICAgICBpZihwYXkpIHtcclxuICAgICAgICBpZih0aGlzLmZpbmFsUHJpY2UpIHtcclxuICAgICAgICAgIGxldCBmZWUgPSB0aGlzLmZpbmFsUHJpY2UgLyAoMSAtIHBheS5mZWUpO1xyXG4gICAgICAgICAgZmVlID0gZmVlLnRvRml4ZWQoMik7XHJcbiAgICAgICAgICByZXR1cm4gTnVtYmVyKGZlZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSxcclxuICBtb3VudGVkKCkge1xyXG4gICAgaWYodGhpcy5wYXltZW50cy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5zZWxlY3RQYXltZW50KHRoaXMucGF5bWVudHNbMF0udHlwZSk7XHJcbiAgICB9XHJcbiAgfSxcclxuICBtZXRob2RzOiB7XHJcbiAgICBzZWxlY3Q6IGZ1bmN0aW9uKG0pIHtcclxuICAgICAgdGhpcy5tb25leSA9IG07XHJcbiAgICB9LFxyXG4gICAgc2VsZWN0UGF5bWVudDogZnVuY3Rpb24odCkge1xyXG4gICAgICB0aGlzLnBheW1lbnQgPSB0O1xyXG4gICAgfSxcclxuICAgIHBheTogZnVuY3Rpb24oKSB7XHJcbiAgICAgIGNvbnN0IHt0b3RhbFByaWNlLCBwYXltZW50LCBmaW5hbFByaWNlfSA9IHRoaXM7XHJcbiAgICAgIGxldCBuZXdXaW5kb3c7XHJcbiAgICAgIGxldCByZWRpcmVjdCA9IGZhbHNlO1xyXG4gICAgICBjb25zdCBpc1Bob25lID0gTktDLm1ldGhvZHMuaXNQaG9uZSgpO1xyXG4gICAgICBsZXQgdXJsID0gYC9hY2NvdW50L2ZpbmFuY2UvcmVjaGFyZ2U/dHlwZT1nZXRfdXJsJm1vbmV5PSR7dG90YWxQcmljZX0mc2NvcmU9JHtmaW5hbFByaWNlfSZwYXltZW50PSR7cGF5bWVudH1gO1xyXG4gICAgICBQcm9taXNlLnJlc29sdmUoKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGlmKCFbJ2FsaVBheScsICd3ZUNoYXQnXS5pbmNsdWRlcyhwYXltZW50KSkgdGhyb3cgJ+ivt+mAieaLqeaUr+S7mOaWueW8jyc7XHJcbiAgICAgICAgICBpZih0b3RhbFByaWNlID4gMCkge31cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyAn5YWF5YC86YeR6aKd5b+F6aG75aSn5LqOMCc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZihOS0MuY29uZmlncy5wbGF0Zm9ybSAhPT0gJ3JlYWN0TmF0aXZlJykge1xyXG4gICAgICAgICAgICBpZihpc1Bob25lKSB7XHJcbiAgICAgICAgICAgICAgdXJsICs9ICcmcmVkaXJlY3Q9dHJ1ZSc7XHJcbiAgICAgICAgICAgICAgc2NyZWVuVG9wQWxlcnQoJ+ato+WcqOWJjeW+gOaUr+S7mOWunS4uLicpXHJcbiAgICAgICAgICAgICAgcmVkaXJlY3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVybDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBuZXdXaW5kb3cgPSB3aW5kb3cub3BlbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gbmtjQVBJKHVybCwgJ0dFVCcpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICBpZihyZWRpcmVjdCkgcmV0dXJuO1xyXG4gICAgICAgICAgaWYoTktDLmNvbmZpZ3MucGxhdGZvcm0gPT09ICdyZWFjdE5hdGl2ZScpIHtcclxuICAgICAgICAgICAgTktDLm1ldGhvZHMudmlzaXRVcmwoZGF0YS51cmwsIHRydWUpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbmV3V2luZG93LmxvY2F0aW9uID0gZGF0YS51cmw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzd2VldEluZm8oJ+ivt+WcqOa1j+iniOWZqOaWsOaJk+W8gOeahOeql+WPo+WujOaIkOaUr+S7mO+8geiLpeayoeacieaWsOeql+WPo+aJk+W8gO+8jOivt+ajgOafpeaWsOeql+WPo+aYr+WQpuW3suiiq+a1j+iniOWZqOaLpuaIquOAgicpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICBzd2VldEVycm9yKGVycilcclxuICAgICAgICAgIGlmKG5ld1dpbmRvdykge1xyXG4gICAgICAgICAgICBuZXdXaW5kb3cuZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBlcnIuZXJyb3IgfHwgZXJyO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufSk7XHJcbiJdfQ==
