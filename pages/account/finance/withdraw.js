(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById('data');
var app = new Vue({
  el: "#app",
  data: {
    user: "",
    code: "",
    password: "",
    succeed: false,
    submitted: false,
    timeLimit: 0,
    payment: '',
    info: "",
    succeedMoney: 0,
    error: "",
    withdrawSettings: data.withdrawSettings,
    countToday: data.countToday,
    mainScore: data.mainScore,
    userMainScore: data.userMainScore,
    alipayAccounts: data.alipayAccounts,
    bankAccounts: data.bankAccounts,
    money: "",
    selectedAccount: "",
    to: "alipay" // alipay, bank

  },
  computed: {
    realMoney: function realMoney() {
      return (this.money * (1 - this.withdrawSettings.withdrawFee)).toFixed(2);
    },
    timeBegin: function timeBegin() {
      var timeBegin = this.getHMS(this.withdrawSettings.startingTime, "string");
      return timeBegin.hour + ":" + timeBegin.min + ":" + timeBegin.sec;
    },
    timeEnd: function timeEnd() {
      var timeEnd = this.getHMS(this.withdrawSettings.endTime, "string");
      return timeEnd.hour + ":" + timeEnd.min + ":" + timeEnd.sec;
    },
    outTime: function outTime() {
      var now = new Date();
      var sec = now.getHours() * 60 * 60 * 1000 + now.getMinutes() * 60 * 1000 + now.getSeconds() * 1000;

      if (sec < this.withdrawSettings.withdrawTimeBegin || sec > this.withdrawSettings.withdrawTimeEnd) {
        return true;
      }
    },
    count: function count() {
      return this.withdrawSettings.withdrawCount - this.countToday;
    },
    payments: function payments() {
      var arr = [];
      var _this$withdrawSetting = this.withdrawSettings,
          weChat = _this$withdrawSetting.weChat,
          aliPay = _this$withdrawSetting.aliPay;
      if (aliPay.enabled) arr.push({
        type: 'aliPay',
        name: '支付宝'
      });
      if (weChat.enabled) arr.push({
        type: 'weChat',
        name: '微信支付'
      });
      return arr;
    },
    payInfo: function payInfo() {
      var payment = this.payment,
          withdrawSettings = this.withdrawSettings;
      if (!payment) return;
      var pay = withdrawSettings[payment];

      if (pay.enabled && pay.fee > 0) {
        var fee = Number((pay.fee * 100).toFixed(4));
        return "\u670D\u52A1\u5546\uFF08\u975E\u672C\u7AD9\uFF09\u5C06\u6536\u53D6 ".concat(fee, "% \u7684\u624B\u7EED\u8D39");
      }
    },
    fee: function fee() {
      var totalPrice = this.totalPrice,
          money = this.money;
      return Number((money - totalPrice).toFixed(2));
    },
    totalPrice: function totalPrice() {
      var withdrawSettings = this.withdrawSettings,
          money = this.money,
          payment = this.payment;
      var fee = withdrawSettings[payment].fee;

      if (fee) {
        money = money * (1 - fee);
      } else {
        money;
      }

      return Number(money.toFixed(2));
    }
  },
  mounted: function mounted() {
    for (var i = 0; i < this.alipayAccounts.length; i++) {
      var alipay = this.alipayAccounts[i];

      if (alipay["default"]) {
        this.selectedAccount = alipay;
        break;
      }
    }

    if (this.payments.length) {
      this.selectPayment(this.payments[0].type);
    }
  },
  methods: {
    selectAccount: function selectAccount(account) {
      this.selectedAccount = account;
    },
    selectPayment: function selectPayment(t) {
      this.payment = t;
    },
    getHMS: function getHMS(t, type) {
      var hour = Math.floor(t / 3600000);
      var min = Math.floor(t / 60000) % 60;
      var sec = Math.floor(t / 1000) % 60;

      if (type === "string") {
        if (hour < 10) hour = "0" + hour;
        if (min < 10) min = "0" + min;
        if (sec < 10) sec = "0" + sec;
      }

      return {
        hour: hour,
        min: min,
        sec: sec
      };
    },
    countdown: function countdown() {
      if (app.timeLimit <= 0) return;
      app.timeLimit--;
      setTimeout(function () {
        app.countdown();
      }, 1000);
    },
    sendMessage: function sendMessage() {
      nkcAPI("/sendMessage/withdraw", "POST", {}).then(function () {
        app.timeLimit = 120;
        app.countdown();
        screenTopAlert("短信验证码发送成功");
      })["catch"](function (err) {
        sweetError(err);
      });
    },
    submit: function submit() {
      this.error = "";
      this.info = "";
      var self = this;
      var money = this.money,
          password = this.password,
          totalPrice = this.totalPrice,
          code = this.code,
          payment = this.payment,
          selectedAccount = this.selectedAccount;
      Promise.resolve().then(function () {
        if (money > 0) {} else {
          throw '提现金额不正确';
        }

        if (!['aliPay', 'weChat'].includes(payment)) throw '请选择付款方式';
        if (!code) throw '请输入短信验证码';
        if (!password) throw '请输入登录密码';
        self.submitted = true;
        return nkcAPI("/account/finance/withdraw", 'POST', {
          money: totalPrice,
          score: money,
          password: password,
          code: code,
          account: selectedAccount,
          to: payment
        });
      }).then(function () {
        self.submitted = false;
        self.password = '';
        self.money = '';
        return sweetSuccess('提现成功');
      })["catch"](function (err) {
        sweetError(err);
        self.submitted = false;
      });
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL2FjY291bnQvZmluYW5jZS93aXRoZHJhdy5tanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLElBQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFKLENBQVksV0FBWixDQUF3QixNQUF4QixDQUFiO0FBQ0EsSUFBSSxHQUFHLEdBQUcsSUFBSSxHQUFKLENBQVE7QUFDaEIsRUFBQSxFQUFFLEVBQUUsTUFEWTtBQUVoQixFQUFBLElBQUksRUFBRTtBQUNKLElBQUEsSUFBSSxFQUFFLEVBREY7QUFFSixJQUFBLElBQUksRUFBRSxFQUZGO0FBR0osSUFBQSxRQUFRLEVBQUUsRUFITjtBQUtKLElBQUEsT0FBTyxFQUFFLEtBTEw7QUFNSixJQUFBLFNBQVMsRUFBRSxLQU5QO0FBT0osSUFBQSxTQUFTLEVBQUUsQ0FQUDtBQVNKLElBQUEsT0FBTyxFQUFFLEVBVEw7QUFXSixJQUFBLElBQUksRUFBRSxFQVhGO0FBYUosSUFBQSxZQUFZLEVBQUUsQ0FiVjtBQWVKLElBQUEsS0FBSyxFQUFFLEVBZkg7QUFpQkosSUFBQSxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsZ0JBakJuQjtBQWtCSixJQUFBLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFsQmI7QUFtQkosSUFBQSxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBbkJaO0FBb0JKLElBQUEsYUFBYSxFQUFFLElBQUksQ0FBQyxhQXBCaEI7QUFzQkosSUFBQSxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBdEJqQjtBQXVCSixJQUFBLFlBQVksRUFBRSxJQUFJLENBQUMsWUF2QmY7QUF3QkosSUFBQSxLQUFLLEVBQUUsRUF4Qkg7QUF5QkosSUFBQSxlQUFlLEVBQUUsRUF6QmI7QUEwQkosSUFBQSxFQUFFLEVBQUUsUUExQkEsQ0EwQlM7O0FBMUJULEdBRlU7QUE4QmhCLEVBQUEsUUFBUSxFQUFFO0FBQ1Is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RDtBQUlqRCxVQUFBLElBQUksRUFBSixJQUppRDtBQUtqRCxVQUFBLE9BQU8sRUFBRSxlQUx3QztBQU1qRCxVQUFBLEVBQUUsRUFBRTtBQU42QyxTQUF0QyxDQUFiO0FBU0QsT0FuQkgsRUFvQkcsSUFwQkgsQ0FvQlEsWUFBTTtBQUNWLFFBQUEsSUFBSSxDQUFDLFNBQUwsR0FBaUIsS0FBakI7QUFDQSxRQUFBLElBQUksQ0FBQyxRQUFMLEdBQWdCLEVBQWhCO0FBQ0EsUUFBQSxJQUFJLENBQUMsS0FBTCxHQUFhLEVBQWI7QUFDQSxlQUFPLFlBQVksQ0FBQyxNQUFELENBQW5CO0FBQ0QsT0F6QkgsV0EwQlMsVUFBQSxHQUFHLEVBQUk7QUFDWixRQUFBLFVBQVUsQ0FBQyxHQUFELENBQVY7QUFDQSxRQUFBLElBQUksQ0FBQyxTQUFMLEdBQWlCLEtBQWpCO0FBQ0QsT0E3Qkg7QUE4QkQ7QUEzRU07QUFyR08sQ0FBUixDQUFWIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgZGF0YSA9IE5LQy5tZXRob2RzLmdldERhdGFCeUlkKCdkYXRhJyk7XHJcbnZhciBhcHAgPSBuZXcgVnVlKHtcclxuICBlbDogXCIjYXBwXCIsXHJcbiAgZGF0YToge1xyXG4gICAgdXNlcjogXCJcIixcclxuICAgIGNvZGU6IFwiXCIsXHJcbiAgICBwYXNzd29yZDogXCJcIixcclxuXHJcbiAgICBzdWNjZWVkOiBmYWxzZSxcclxuICAgIHN1Ym1pdHRlZDogZmFsc2UsXHJcbiAgICB0aW1lTGltaXQ6IDAsXHJcblxyXG4gICAgcGF5bWVudDogJycsXHJcblxyXG4gICAgaW5mbzogXCJcIixcclxuXHJcbiAgICBzdWNjZWVkTW9uZXk6IDAsXHJcblxyXG4gICAgZXJyb3I6IFwiXCIsXHJcblxyXG4gICAgd2l0aGRyYXdTZXR0aW5nczogZGF0YS53aXRoZHJhd1NldHRpbmdzLFxyXG4gICAgY291bnRUb2RheTogZGF0YS5jb3VudFRvZGF5LFxyXG4gICAgbWFpblNjb3JlOiBkYXRhLm1haW5TY29yZSxcclxuICAgIHVzZXJNYWluU2NvcmU6IGRhdGEudXNlck1haW5TY29yZSxcclxuXHJcbiAgICBhbGlwYXlBY2NvdW50czogZGF0YS5hbGlwYXlBY2NvdW50cyxcclxuICAgIGJhbmtBY2NvdW50czogZGF0YS5iYW5rQWNjb3VudHMsXHJcbiAgICBtb25leTogXCJcIixcclxuICAgIHNlbGVjdGVkQWNjb3VudDogXCJcIixcclxuICAgIHRvOiBcImFsaXBheVwiIC8vIGFsaXBheSwgYmFua1xyXG4gIH0sXHJcbiAgY29tcHV0ZWQ6IHtcclxuICAgIHJlYWxNb25leTogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiAodGhpcy5tb25leSooMS10aGlzLndpdGhkcmF3U2V0dGluZ3Mud2l0aGRyYXdGZWUpKS50b0ZpeGVkKDIpXHJcbiAgICB9LFxyXG4gICAgdGltZUJlZ2luOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIHRpbWVCZWdpbiA9IHRoaXMuZ2V0SE1TKHRoaXMud2l0aGRyYXdTZXR0aW5ncy5zdGFydGluZ1RpbWUsIFwic3RyaW5nXCIpO1xyXG4gICAgICByZXR1cm4gdGltZUJlZ2luLmhvdXIgKyBcIjpcIiArIHRpbWVCZWdpbi5taW4gKyBcIjpcIiArIHRpbWVCZWdpbi5zZWNcclxuICAgIH0sXHJcbiAgICB0aW1lRW5kOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIHRpbWVFbmQgPSB0aGlzLmdldEhNUyh0aGlzLndpdGhkcmF3U2V0dGluZ3MuZW5kVGltZSwgXCJzdHJpbmdcIik7XHJcbiAgICAgIHJldHVybiB0aW1lRW5kLmhvdXIgKyBcIjpcIiArIHRpbWVFbmQubWluICsgXCI6XCIgKyB0aW1lRW5kLnNlY1xyXG4gICAgfSxcclxuICAgIG91dFRpbWU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTtcclxuICAgICAgdmFyIHNlYyA9IG5vdy5nZXRIb3VycygpKjYwKjYwKjEwMDAgKyBub3cuZ2V0TWludXRlcygpKjYwKjEwMDAgKyBub3cuZ2V0U2Vjb25kcygpKjEwMDA7XHJcbiAgICAgIGlmKHNlYyA8IHRoaXMud2l0aGRyYXdTZXR0aW5ncy53aXRoZHJhd1RpbWVCZWdpbiB8fCBzZWMgPiB0aGlzLndpdGhkcmF3U2V0dGluZ3Mud2l0aGRyYXdUaW1lRW5kKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjb3VudDogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLndpdGhkcmF3U2V0dGluZ3Mud2l0aGRyYXdDb3VudCAtIHRoaXMuY291bnRUb2RheVxyXG4gICAgfSxcclxuICAgIHBheW1lbnRzKCkge1xyXG4gICAgICBjb25zdCBhcnIgPSBbXTtcclxuICAgICAgY29uc3Qge3dlQ2hhdCwgYWxpUGF5fSA9IHRoaXMud2l0aGRyYXdTZXR0aW5ncztcclxuICAgICAgaWYoYWxpUGF5LmVuYWJsZWQpIGFyci5wdXNoKHtcclxuICAgICAgICB0eXBlOiAnYWxpUGF5JyxcclxuICAgICAgICBuYW1lOiAn5pSv5LuY5a6dJ1xyXG4gICAgICB9KTtcclxuICAgICAgaWYod2VDaGF0LmVuYWJsZWQpIGFyci5wdXNoKHtcclxuICAgICAgICB0eXBlOiAnd2VDaGF0JyxcclxuICAgICAgICBuYW1lOiAn5b6u5L+h5pSv5LuYJ1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGFycjtcclxuICAgIH0sXHJcbiAgICBwYXlJbmZvKCkge1xyXG4gICAgICBjb25zdCB7cGF5bWVudCwgd2l0aGRyYXdTZXR0aW5nc30gPSB0aGlzO1xyXG4gICAgICBpZighcGF5bWVudCkgcmV0dXJuO1xyXG4gICAgICBjb25zdCBwYXkgPSB3aXRoZHJhd1NldHRpbmdzW3BheW1lbnRdO1xyXG4gICAgICBpZihwYXkuZW5hYmxlZCAmJiBwYXkuZmVlID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGZlZSA9IE51bWJlcigocGF5LmZlZSAqIDEwMCkudG9GaXhlZCg0KSk7XHJcbiAgICAgICAgcmV0dXJuIGDmnI3liqHllYbvvIjpnZ7mnKznq5nvvInlsIbmlLblj5YgJHtmZWV9JSDnmoTmiYvnu63otLlgXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBmZWUoKSB7XHJcbiAgICAgIGNvbnN0IHt0b3RhbFByaWNlLCBtb25leX0gPSB0aGlzO1xyXG4gICAgICByZXR1cm4gTnVtYmVyKChtb25leSAtIHRvdGFsUHJpY2UpLnRvRml4ZWQoMikpO1xyXG4gICAgfSxcclxuICAgIHRvdGFsUHJpY2UoKSB7XHJcbiAgICAgIGxldCB7d2l0aGRyYXdTZXR0aW5ncywgbW9uZXksIHBheW1lbnR9ID0gdGhpcztcclxuICAgICAgY29uc3QgZmVlID0gd2l0aGRyYXdTZXR0aW5nc1twYXltZW50XS5mZWU7XHJcbiAgICAgIGlmKGZlZSkge1xyXG4gICAgICAgIG1vbmV5ID0gbW9uZXkgKiAoMSAtIGZlZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbW9uZXk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIE51bWJlcihtb25leS50b0ZpeGVkKDIpKTtcclxuICAgIH1cclxuICB9LFxyXG4gIG1vdW50ZWQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuYWxpcGF5QWNjb3VudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdmFyIGFsaXBheSA9IHRoaXMuYWxpcGF5QWNjb3VudHNbaV07XHJcbiAgICAgIGlmKGFsaXBheS5kZWZhdWx0KSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZEFjY291bnQgPSBhbGlwYXk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHRoaXMucGF5bWVudHMubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0UGF5bWVudCh0aGlzLnBheW1lbnRzWzBdLnR5cGUpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgbWV0aG9kczoge1xyXG4gICAgc2VsZWN0QWNjb3VudDogZnVuY3Rpb24oYWNjb3VudCkge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkQWNjb3VudCA9IGFjY291bnQ7XHJcbiAgICB9LFxyXG4gICAgc2VsZWN0UGF5bWVudDogZnVuY3Rpb24odCkge1xyXG4gICAgICB0aGlzLnBheW1lbnQgPSB0O1xyXG4gICAgfSxcclxuICAgIGdldEhNUzogZnVuY3Rpb24odCwgdHlwZSkge1xyXG4gICAgICB2YXIgaG91ciA9IE1hdGguZmxvb3IodC8zNjAwMDAwKTtcclxuICAgICAgdmFyIG1pbiA9IE1hdGguZmxvb3IodC82MDAwMCkgJSA2MDtcclxuICAgICAgdmFyIHNlYyA9IE1hdGguZmxvb3IodC8xMDAwKSAlIDYwO1xyXG4gICAgICBpZih0eXBlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgaWYoaG91ciA8IDEwKSBob3VyID0gXCIwXCIgKyBob3VyO1xyXG4gICAgICAgIGlmKG1pbiA8IDEwKSBtaW4gPSBcIjBcIiArIG1pbjtcclxuICAgICAgICBpZihzZWMgPCAxMCkgc2VjID0gXCIwXCIgKyBzZWM7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBob3VyOiBob3VyLFxyXG4gICAgICAgIG1pbjogbWluLFxyXG4gICAgICAgIHNlYzogc2VjXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjb3VudGRvd246IGZ1bmN0aW9uKCkge1xyXG4gICAgICBpZihhcHAudGltZUxpbWl0IDw9IDApIHJldHVybjtcclxuICAgICAgYXBwLnRpbWVMaW1pdCAtLTtcclxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICBhcHAuY291bnRkb3duKCk7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgfSxcclxuICAgIHNlbmRNZXNzYWdlOiBmdW5jdGlvbigpIHtcclxuICAgICAgbmtjQVBJKFwiL3NlbmRNZXNzYWdlL3dpdGhkcmF3XCIsIFwiUE9TVFwiLCB7fSlcclxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgIGFwcC50aW1lTGltaXQgPSAxMjA7XHJcbiAgICAgICAgICBhcHAuY291bnRkb3duKCk7XHJcbiAgICAgICAgICBzY3JlZW5Ub3BBbGVydChcIuefreS/oemqjOivgeeggeWPkemAgeaIkOWKn1wiKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIHN3ZWV0RXJyb3IoZXJyKTtcclxuICAgICAgICB9KVxyXG4gICAgfSxcclxuICAgIHN1Ym1pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHRoaXMuZXJyb3IgPSBcIlwiO1xyXG4gICAgICB0aGlzLmluZm8gPSBcIlwiO1xyXG4gICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgY29uc3Qge21vbmV5LCBwYXNzd29yZCx0b3RhbFByaWNlLCBjb2RlLCBwYXltZW50LCBzZWxlY3RlZEFjY291bnR9ID0gdGhpcztcclxuICAgICAgUHJvbWlzZS5yZXNvbHZlKClcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBpZihtb25leSA+IDApIHt9XHJcbiAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICB0aHJvdyAn5o+Q546w6YeR6aKd5LiN5q2j56GuJztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmKCFbJ2FsaVBheScsICd3ZUNoYXQnXS5pbmNsdWRlcyhwYXltZW50KSkgdGhyb3cgJ+ivt+mAieaLqeS7mOasvuaWueW8jyc7XHJcbiAgICAgICAgICBpZighY29kZSkgdGhyb3cgJ+ivt+i+k+WFpeefreS/oemqjOivgeeggSc7XHJcbiAgICAgICAgICBpZighcGFzc3dvcmQpIHRocm93ICfor7fovpPlhaXnmbvlvZXlr4bnoIEnO1xyXG4gICAgICAgICAgc2VsZi5zdWJtaXR0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgcmV0dXJuIG5rY0FQSShgL2FjY291bnQvZmluYW5jZS93aXRoZHJhd2AsICdQT1NUJywge1xyXG4gICAgICAgICAgICBtb25leTogdG90YWxQcmljZSxcclxuICAgICAgICAgICAgc2NvcmU6IG1vbmV5LFxyXG4gICAgICAgICAgICBwYXNzd29yZCxcclxuICAgICAgICAgICAgY29kZSxcclxuICAgICAgICAgICAgYWNjb3VudDogc2VsZWN0ZWRBY2NvdW50LFxyXG4gICAgICAgICAgICB0bzogcGF5bWVudFxyXG4gICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBzZWxmLnN1Ym1pdHRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgc2VsZi5wYXNzd29yZCA9ICcnO1xyXG4gICAgICAgICAgc2VsZi5tb25leSA9ICcnO1xyXG4gICAgICAgICAgcmV0dXJuIHN3ZWV0U3VjY2Vzcygn5o+Q546w5oiQ5YqfJyk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgIHN3ZWV0RXJyb3IoZXJyKTtcclxuICAgICAgICAgIHNlbGYuc3VibWl0dGVkID0gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG59KTtcclxuIl19
