(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById('data');
var app = new Vue({
  el: "#app",
  data: {
    user: "",
    code: "",
    password: "",
    succeed: false,
    submitted: false,
    timeLimit: 0,
    payment: '',
    info: "",
    succeedMoney: 0,
    error: "",
    withdrawSettings: data.withdrawSettings,
    countToday: data.countToday,
    mainScore: data.mainScore,
    userMainScore: data.userMainScore,
    alipayAccounts: data.alipayAccounts,
    bankAccounts: data.bankAccounts,
    money: "",
    selectedAccount: "",
    to: "alipay" // alipay, bank

  },
  computed: {
    realMoney: function realMoney() {
      return (this.money * (1 - this.withdrawSettings.withdrawFee)).toFixed(2);
    },
    timeBegin: function timeBegin() {
      var timeBegin = this.getHMS(this.withdrawSettings.startingTime, "string");
      return timeBegin.hour + ":" + timeBegin.min + ":" + timeBegin.sec;
    },
    timeEnd: function timeEnd() {
      var timeEnd = this.getHMS(this.withdrawSettings.endTime, "string");
      return timeEnd.hour + ":" + timeEnd.min + ":" + timeEnd.sec;
    },
    outTime: function outTime() {
      var now = new Date();
      var sec = now.getHours() * 60 * 60 * 1000 + now.getMinutes() * 60 * 1000 + now.getSeconds() * 1000;

      if (sec < this.withdrawSettings.withdrawTimeBegin || sec > this.withdrawSettings.withdrawTimeEnd) {
        return true;
      }
    },
    count: function count() {
      return this.withdrawSettings.withdrawCount - this.countToday;
    },
    payments: function payments() {
      var arr = [];
      var _this$withdrawSetting = this.withdrawSettings,
          weChat = _this$withdrawSetting.weChat,
          aliPay = _this$withdrawSetting.aliPay;
      if (aliPay.enabled) arr.push({
        type: 'aliPay',
        name: '支付宝'
      });
      if (weChat.enabled) arr.push({
        type: 'weChat',
        name: '微信支付'
      });
      return arr;
    },
    payInfo: function payInfo() {
      var payment = this.payment,
          withdrawSettings = this.withdrawSettings;
      if (!payment) return;
      var pay = withdrawSettings[payment];

      if (pay.enabled && pay.fee > 0) {
        var fee = Number((pay.fee * 100).toFixed(4));
        return "\u670D\u52A1\u5546\uFF08\u975E\u672C\u7AD9\uFF09\u5C06\u6536\u53D6 ".concat(fee, "% \u7684\u624B\u7EED\u8D39");
      }
    },
    fee: function fee() {
      var totalPrice = this.totalPrice,
          money = this.money;
      return Number((money - totalPrice).toFixed(2));
    },
    totalPrice: function totalPrice() {
      var withdrawSettings = this.withdrawSettings,
          money = this.money,
          payment = this.payment;
      var fee = withdrawSettings[payment].fee;

      if (fee) {
        money = money * (1 - fee);
      } else {
        money;
      }

      return Number(money.toFixed(2));
    }
  },
  mounted: function mounted() {
    for (var i = 0; i < this.alipayAccounts.length; i++) {
      var alipay = this.alipayAccounts[i];

      if (alipay["default"]) {
        this.selectedAccount = alipay;
        break;
      }
    }

    if (this.payments.length) {
      this.selectPayment(this.payments[0].type);
    }
  },
  methods: {
    selectAccount: function selectAccount(account) {
      this.selectedAccount = account;
    },
    selectPayment: function selectPayment(t) {
      this.payment = t;
    },
    getHMS: function getHMS(t, type) {
      var hour = Math.floor(t / 3600000);
      var min = Math.floor(t / 60000) % 60;
      var sec = Math.floor(t / 1000) % 60;

      if (type === "string") {
        if (hour < 10) hour = "0" + hour;
        if (min < 10) min = "0" + min;
        if (sec < 10) sec = "0" + sec;
      }

      return {
        hour: hour,
        min: min,
        sec: sec
      };
    },
    countdown: function countdown() {
      if (app.timeLimit <= 0) return;
      app.timeLimit--;
      setTimeout(function () {
        app.countdown();
      }, 1000);
    },
    sendMessage: function sendMessage() {
      nkcAPI("/sendMessage/withdraw", "POST", {}).then(function () {
        app.timeLimit = 120;
        app.countdown();
        screenTopAlert("短信验证码发送成功");
      })["catch"](function (err) {
        sweetError(err);
      });
    },
    submit: function submit() {
      this.error = "";
      this.info = "";
      var self = this;
      var money = this.money,
          password = this.password,
          totalPrice = this.totalPrice,
          code = this.code,
          payment = this.payment,
          selectedAccount = this.selectedAccount;
      Promise.resolve().then(function () {
        if (money > 0) {} else {
          throw '提现金额不正确';
        }

        if (!['aliPay', 'weChat'].includes(payment)) throw '请选择付款方式';
        if (!code) throw '请输入短信验证码';
        if (!password) throw '请输入登录密码';
        self.submitted = true;
        return nkcAPI("/account/finance/withdraw", 'POST', {
          money: totalPrice,
          score: money,
          password: password,
          code: code,
          account: selectedAccount,
          to: payment
        });
      }).then(function () {
        self.submitted = false;
        self.password = '';
        self.money = '';
        return sweetSuccess('提现成功');
      })["catch"](function (err) {
        sweetError(err);
        self.submitted = false;
      });
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9hY2NvdW50L2ZpbmFuY2Uvd2l0aGRyYXcubWpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFNLElBQUksR0FBRyxHQUFHLENBQUMsT0FBSixDQUFZLFdBQVosQ0FBd0IsTUFBeEIsQ0FBYjtBQUNBLElBQUksR0FBRyxHQUFHLElBQUksR0FBSixDQUFRO0FBQ2hCLEVBQUEsRUFBRSxFQUFFLE1BRFk7QUFFaEIsRUFBQSxJQUFJLEVBQUU7QUFDSixJQUFBLElBQUksRUFBRSxFQURGO0FBRUosSUFBQSxJQUFJLEVBQUUsRUFGRjtBQUdKLElBQUEsUUFBUSxFQUFFLEVBSE47QUFLSixJQUFBLE9BQU8sRUFBRSxLQUxMO0FBTUosSUFBQSxTQUFTLEVBQUUsS0FOUDtBQU9KLElBQUEsU0FBUyxFQUFFLENBUFA7QUFTSixJQUFBLE9BQU8sRUFBRSxFQVRMO0FBV0osSUFBQSxJQUFJLEVBQUUsRUFYRjtBQWFKLElBQUEsWUFBWSxFQUFFLENBYlY7QUFlSixJQUFBLEtBQUssRUFBRSxFQWZIO0FBaUJKLElBQUEsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGdCQWpCbkI7QUFrQkosSUFBQSxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBbEJiO0FBbUJKLElBQUEsU0FBUyxFQUFFLElBQUksQ0FBQyxTQW5CWjtBQW9CSixJQUFBLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFwQmhCO0FBc0JKLElBQUEsY0FBYyxFQUFFLElBQUksQ0FBQyxjQXRCakI7QUF1QkosSUFBQSxZQUFZLEVBQUUsSUFBSSxDQUFDLFlBdkJmO0FBd0JKLElBQUEsS0FBSyxFQUFFLEVBeEJIO0FBeUJKLElBQUEsZUFBZSxFQUFFLEVBekJiO0FBMEJKLElBQUEsRUFBRSxFQUFFLFFBMUJBLENBMEJTOztBQTFCVCxHQUZVO0FBOEJoQixFQUFBLFFBQVEsRUFBRTtBQUNSLElBQUEsU0FBUyxFQUFFLHFCQUFX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QUosSUFKaUQ7QUFLakQsVUFBQSxPQUFPLEVBQUUsZUFMd0M7QUFNakQsVUFBQSxFQUFFLEVBQUU7QUFONkMsU0FBdEMsQ0FBYjtBQVNELE9BbkJILEVBb0JHLElBcEJILENBb0JRLFlBQU07QUFDVixRQUFBLElBQUksQ0FBQyxTQUFMLEdBQWlCLEtBQWpCO0FBQ0EsUUFBQSxJQUFJLENBQUMsUUFBTCxHQUFnQixFQUFoQjtBQUNBLFFBQUEsSUFBSSxDQUFDLEtBQUwsR0FBYSxFQUFiO0FBQ0EsZUFBTyxZQUFZLENBQUMsTUFBRCxDQUFuQjtBQUNELE9BekJILFdBMEJTLFVBQUEsR0FBRyxFQUFJO0FBQ1osUUFBQSxVQUFVLENBQUMsR0FBRCxDQUFWO0FBQ0EsUUFBQSxJQUFJLENBQUMsU0FBTCxHQUFpQixLQUFqQjtBQUNELE9BN0JIO0FBOEJEO0FBM0VNO0FBckdPLENBQVIsQ0FBViIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGRhdGEgPSBOS0MubWV0aG9kcy5nZXREYXRhQnlJZCgnZGF0YScpO1xyXG52YXIgYXBwID0gbmV3IFZ1ZSh7XHJcbiAgZWw6IFwiI2FwcFwiLFxyXG4gIGRhdGE6IHtcclxuICAgIHVzZXI6IFwiXCIsXHJcbiAgICBjb2RlOiBcIlwiLFxyXG4gICAgcGFzc3dvcmQ6IFwiXCIsXHJcblxyXG4gICAgc3VjY2VlZDogZmFsc2UsXHJcbiAgICBzdWJtaXR0ZWQ6IGZhbHNlLFxyXG4gICAgdGltZUxpbWl0OiAwLFxyXG5cclxuICAgIHBheW1lbnQ6ICcnLFxyXG5cclxuICAgIGluZm86IFwiXCIsXHJcblxyXG4gICAgc3VjY2VlZE1vbmV5OiAwLFxyXG5cclxuICAgIGVycm9yOiBcIlwiLFxyXG5cclxuICAgIHdpdGhkcmF3U2V0dGluZ3M6IGRhdGEud2l0aGRyYXdTZXR0aW5ncyxcclxuICAgIGNvdW50VG9kYXk6IGRhdGEuY291bnRUb2RheSxcclxuICAgIG1haW5TY29yZTogZGF0YS5tYWluU2NvcmUsXHJcbiAgICB1c2VyTWFpblNjb3JlOiBkYXRhLnVzZXJNYWluU2NvcmUsXHJcblxyXG4gICAgYWxpcGF5QWNjb3VudHM6IGRhdGEuYWxpcGF5QWNjb3VudHMsXHJcbiAgICBiYW5rQWNjb3VudHM6IGRhdGEuYmFua0FjY291bnRzLFxyXG4gICAgbW9uZXk6IFwiXCIsXHJcbiAgICBzZWxlY3RlZEFjY291bnQ6IFwiXCIsXHJcbiAgICB0bzogXCJhbGlwYXlcIiAvLyBhbGlwYXksIGJhbmtcclxuICB9LFxyXG4gIGNvbXB1dGVkOiB7XHJcbiAgICByZWFsTW9uZXk6IGZ1bmN0aW9uKCkge1xyXG4gICAgICByZXR1cm4gKHRoaXMubW9uZXkqKDEtdGhpcy53aXRoZHJhd1NldHRpbmdzLndpdGhkcmF3RmVlKSkudG9GaXhlZCgyKVxyXG4gICAgfSxcclxuICAgIHRpbWVCZWdpbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciB0aW1lQmVnaW4gPSB0aGlzLmdldEhNUyh0aGlzLndpdGhkcmF3U2V0dGluZ3Muc3RhcnRpbmdUaW1lLCBcInN0cmluZ1wiKTtcclxuICAgICAgcmV0dXJuIHRpbWVCZWdpbi5ob3VyICsgXCI6XCIgKyB0aW1lQmVnaW4ubWluICsgXCI6XCIgKyB0aW1lQmVnaW4uc2VjXHJcbiAgICB9LFxyXG4gICAgdGltZUVuZDogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciB0aW1lRW5kID0gdGhpcy5nZXRITVModGhpcy53aXRoZHJhd1NldHRpbmdzLmVuZFRpbWUsIFwic3RyaW5nXCIpO1xyXG4gICAgICByZXR1cm4gdGltZUVuZC5ob3VyICsgXCI6XCIgKyB0aW1lRW5kLm1pbiArIFwiOlwiICsgdGltZUVuZC5zZWNcclxuICAgIH0sXHJcbiAgICBvdXRUaW1lOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIHZhciBzZWMgPSBub3cuZ2V0SG91cnMoKSo2MCo2MCoxMDAwICsgbm93LmdldE1pbnV0ZXMoKSo2MCoxMDAwICsgbm93LmdldFNlY29uZHMoKSoxMDAwO1xyXG4gICAgICBpZihzZWMgPCB0aGlzLndpdGhkcmF3U2V0dGluZ3Mud2l0aGRyYXdUaW1lQmVnaW4gfHwgc2VjID4gdGhpcy53aXRoZHJhd1NldHRpbmdzLndpdGhkcmF3VGltZUVuZCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgY291bnQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy53aXRoZHJhd1NldHRpbmdzLndpdGhkcmF3Q291bnQgLSB0aGlzLmNvdW50VG9kYXlcclxuICAgIH0sXHJcbiAgICBwYXltZW50cygpIHtcclxuICAgICAgY29uc3QgYXJyID0gW107XHJcbiAgICAgIGNvbnN0IHt3ZUNoYXQsIGFsaVBheX0gPSB0aGlzLndpdGhkcmF3U2V0dGluZ3M7XHJcbiAgICAgIGlmKGFsaVBheS5lbmFibGVkKSBhcnIucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ2FsaVBheScsXHJcbiAgICAgICAgbmFtZTogJ+aUr+S7mOWunSdcclxuICAgICAgfSk7XHJcbiAgICAgIGlmKHdlQ2hhdC5lbmFibGVkKSBhcnIucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ3dlQ2hhdCcsXHJcbiAgICAgICAgbmFtZTogJ+W+ruS/oeaUr+S7mCdcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBhcnI7XHJcbiAgICB9LFxyXG4gICAgcGF5SW5mbygpIHtcclxuICAgICAgY29uc3Qge3BheW1lbnQsIHdpdGhkcmF3U2V0dGluZ3N9ID0gdGhpcztcclxuICAgICAgaWYoIXBheW1lbnQpIHJldHVybjtcclxuICAgICAgY29uc3QgcGF5ID0gd2l0aGRyYXdTZXR0aW5nc1twYXltZW50XTtcclxuICAgICAgaWYocGF5LmVuYWJsZWQgJiYgcGF5LmZlZSA+IDApIHtcclxuICAgICAgICBjb25zdCBmZWUgPSBOdW1iZXIoKHBheS5mZWUgKiAxMDApLnRvRml4ZWQoNCkpO1xyXG4gICAgICAgIHJldHVybiBg5pyN5Yqh5ZWG77yI6Z2e5pys56uZ77yJ5bCG5pS25Y+WICR7ZmVlfSUg55qE5omL57ut6LS5YFxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgZmVlKCkge1xyXG4gICAgICBjb25zdCB7dG90YWxQcmljZSwgbW9uZXl9ID0gdGhpcztcclxuICAgICAgcmV0dXJuIE51bWJlcigobW9uZXkgLSB0b3RhbFByaWNlKS50b0ZpeGVkKDIpKTtcclxuICAgIH0sXHJcbiAgICB0b3RhbFByaWNlKCkge1xyXG4gICAgICBsZXQge3dpdGhkcmF3U2V0dGluZ3MsIG1vbmV5LCBwYXltZW50fSA9IHRoaXM7XHJcbiAgICAgIGNvbnN0IGZlZSA9IHdpdGhkcmF3U2V0dGluZ3NbcGF5bWVudF0uZmVlO1xyXG4gICAgICBpZihmZWUpIHtcclxuICAgICAgICBtb25leSA9IG1vbmV5ICogKDEgLSBmZWUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1vbmV5O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBOdW1iZXIobW9uZXkudG9GaXhlZCgyKSk7XHJcbiAgICB9XHJcbiAgfSxcclxuICBtb3VudGVkOiBmdW5jdGlvbigpIHtcclxuICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmFsaXBheUFjY291bnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIHZhciBhbGlwYXkgPSB0aGlzLmFsaXBheUFjY291bnRzW2ldO1xyXG4gICAgICBpZihhbGlwYXkuZGVmYXVsdCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRBY2NvdW50ID0gYWxpcGF5O1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLnBheW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLnNlbGVjdFBheW1lbnQodGhpcy5wYXltZW50c1swXS50eXBlKTtcclxuICAgIH1cclxuICB9LFxyXG4gIG1ldGhvZHM6IHtcclxuICAgIHNlbGVjdEFjY291bnQ6IGZ1bmN0aW9uKGFjY291bnQpIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZEFjY291bnQgPSBhY2NvdW50O1xyXG4gICAgfSxcclxuICAgIHNlbGVjdFBheW1lbnQ6IGZ1bmN0aW9uKHQpIHtcclxuICAgICAgdGhpcy5wYXltZW50ID0gdDtcclxuICAgIH0sXHJcbiAgICBnZXRITVM6IGZ1bmN0aW9uKHQsIHR5cGUpIHtcclxuICAgICAgdmFyIGhvdXIgPSBNYXRoLmZsb29yKHQvMzYwMDAwMCk7XHJcbiAgICAgIHZhciBtaW4gPSBNYXRoLmZsb29yKHQvNjAwMDApICUgNjA7XHJcbiAgICAgIHZhciBzZWMgPSBNYXRoLmZsb29yKHQvMTAwMCkgJSA2MDtcclxuICAgICAgaWYodHlwZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgIGlmKGhvdXIgPCAxMCkgaG91ciA9IFwiMFwiICsgaG91cjtcclxuICAgICAgICBpZihtaW4gPCAxMCkgbWluID0gXCIwXCIgKyBtaW47XHJcbiAgICAgICAgaWYoc2VjIDwgMTApIHNlYyA9IFwiMFwiICsgc2VjO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaG91cjogaG91cixcclxuICAgICAgICBtaW46IG1pbixcclxuICAgICAgICBzZWM6IHNlY1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgY291bnRkb3duOiBmdW5jdGlvbigpIHtcclxuICAgICAgaWYoYXBwLnRpbWVMaW1pdCA8PSAwKSByZXR1cm47XHJcbiAgICAgIGFwcC50aW1lTGltaXQgLS07XHJcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgYXBwLmNvdW50ZG93bigpO1xyXG4gICAgICB9LCAxMDAwKTtcclxuICAgIH0sXHJcbiAgICBzZW5kTWVzc2FnZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgIG5rY0FQSShcIi9zZW5kTWVzc2FnZS93aXRoZHJhd1wiLCBcIlBPU1RcIiwge30pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBhcHAudGltZUxpbWl0ID0gMTIwO1xyXG4gICAgICAgICAgYXBwLmNvdW50ZG93bigpO1xyXG4gICAgICAgICAgc2NyZWVuVG9wQWxlcnQoXCLnn63kv6Hpqozor4HnoIHlj5HpgIHmiJDlip9cIik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICBzd2VldEVycm9yKGVycik7XHJcbiAgICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBzdWJtaXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB0aGlzLmVycm9yID0gXCJcIjtcclxuICAgICAgdGhpcy5pbmZvID0gXCJcIjtcclxuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgIGNvbnN0IHttb25leSwgcGFzc3dvcmQsdG90YWxQcmljZSwgY29kZSwgcGF5bWVudCwgc2VsZWN0ZWRBY2NvdW50fSA9IHRoaXM7XHJcbiAgICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgaWYobW9uZXkgPiAwKSB7fVxyXG4gICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhyb3cgJ+aPkOeOsOmHkemineS4jeato+ehric7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZighWydhbGlQYXknLCAnd2VDaGF0J10uaW5jbHVkZXMocGF5bWVudCkpIHRocm93ICfor7fpgInmi6nku5jmrL7mlrnlvI8nO1xyXG4gICAgICAgICAgaWYoIWNvZGUpIHRocm93ICfor7fovpPlhaXnn63kv6Hpqozor4HnoIEnO1xyXG4gICAgICAgICAgaWYoIXBhc3N3b3JkKSB0aHJvdyAn6K+36L6T5YWl55m75b2V5a+G56CBJztcclxuICAgICAgICAgIHNlbGYuc3VibWl0dGVkID0gdHJ1ZTtcclxuICAgICAgICAgIHJldHVybiBua2NBUEkoYC9hY2NvdW50L2ZpbmFuY2Uvd2l0aGRyYXdgLCAnUE9TVCcsIHtcclxuICAgICAgICAgICAgbW9uZXk6IHRvdGFsUHJpY2UsXHJcbiAgICAgICAgICAgIHNjb3JlOiBtb25leSxcclxuICAgICAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgICAgICAgIGNvZGUsXHJcbiAgICAgICAgICAgIGFjY291bnQ6IHNlbGVjdGVkQWNjb3VudCxcclxuICAgICAgICAgICAgdG86IHBheW1lbnRcclxuICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgc2VsZi5zdWJtaXR0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgIHNlbGYucGFzc3dvcmQgPSAnJztcclxuICAgICAgICAgIHNlbGYubW9uZXkgPSAnJztcclxuICAgICAgICAgIHJldHVybiBzd2VldFN1Y2Nlc3MoJ+aPkOeOsOaIkOWKnycpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICBzd2VldEVycm9yKGVycik7XHJcbiAgICAgICAgICBzZWxmLnN1Ym1pdHRlZCA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufSk7XHJcbiJdfQ==
