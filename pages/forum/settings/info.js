(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function toEditor(fid) {
  window.location.href = '/editor?type=forum_declare&id=' + fid;
}

function submit(fid, fn) {
  var obj = {
    displayName: $('#displayName').val(),
    abbr: $('#abbr').val(),
    color: $('#color').val(),
    description: $('#description').val(),
    brief: $('#brief').val(),
    basicThreadsId: $('#basicThreadsId').val(),
    noticeThreadsId: $('#noticeThreadsId').val(),
    valuableThreadsId: $('#valuableThreadsId').val()
  };
  nkcAPI('/f/' + fid + '/settings/info', 'PATCH', obj).then(function () {
    if (fn) {
      fn(fid);
    } else {
      screenTopAlert('保存成功');
    }
  })["catch"](function (data) {
    screenTopWarning(data.error || data);
  });
}

var data = NKC.methods.getDataById('data');
var forum = data.forum;
forum._noticeThreadsId = (forum.noticeThreadsId || []).join(", ");
forum._basicThreadsId = (forum.basicThreadsId || []).join(", ");
forum._valuableThreadsId = (forum.valuableThreadsId || []).join(", ");
var selectImage = new NKC.methods.selectImage();
var app = new Vue({
  el: '#app',
  data: {
    logoData: '',
    logoFile: '',
    bannerData: '',
    bannerFile: '',
    forum: forum
  },
  mounted: function mounted() {
    var self = this;
    setTimeout(function () {
      NKC.methods.initSelectColor(function (color) {
        self.forum.color = color;
      });
    }, 100);
  },
  methods: {
    getUrl: NKC.methods.tools.getUrl,
    str2arr: function str2arr(str) {
      var arr = str.split(',');
      var _arr = [];
      arr.map(function (a) {
        a = a.trim();
        if (a) _arr.push(a);
      });
      return _arr;
    },
    selectLogo: function selectLogo() {
      var self = this;
      selectImage.show(function (d) {
        var file = NKC.methods.blobToFile(d);
        NKC.methods.fileToUrl(file).then(function (d) {
          self.logoData = d;
          self.logoFile = file;
          selectImage.close();
        });
      }, {
        aspectRatio: 1
      });
    },
    selectBanner: function selectBanner() {
      var self = this;
      selectImage.show(function (d) {
        var file = NKC.methods.blobToFile(d);
        NKC.methods.fileToUrl(file).then(function (d) {
          self.bannerData = d;
          self.bannerFile = file;
          selectImage.close();
        });
      }, {
        aspectRatio: 4
      });
    },
    toEditor: function toEditor() {
      NKC.methods.visitUrl('/editor?type=forum_declare&id=' + this.forum.fid, true);
    },
    save: function save() {
      var self = this;
      var forum = self.forum;
      Promise.resolve().then(function () {
        forum.noticeThreadsId = self.str2arr(forum._noticeThreadsId);
        forum.basicThreadsId = self.str2arr(forum._basicThreadsId);
        forum.valuableThreadsId = self.str2arr(forum._valuableThreadsId);
        var formData = new FormData();
        formData.append('forum', JSON.stringify(forum));

        if (self.logoFile) {
          formData.append('logo', self.logoFile);
        }

        if (self.bannerFile) {
          formData.append('banner', self.bannerFile);
        }

        return nkcUploadFile("/f/".concat(self.forum.fid, "/settings/info"), 'PATCH', formData);
      }).then(function (data) {
        if (data.logo) {
          self.logoData = '';
          self.logoFile = '';
          self.forum.logo = data.logo;
        }

        if (data.banner) {
          self.bannerData = '';
          self.bannerFile = '';
          self.forum.banner = data.banner;
        }

        sweetSuccess('保存成功');
      })["catch"](sweetError);
    }
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9mb3J1bS9zZXR0aW5ncy9pbmZvLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsU0FBUyxRQUFULENBQWtCLEdBQWxCLEVBQXVCO0FBQ3RCLEVBQUEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsSUFBaEIsR0FBdUIsbUNBQWlDLEdBQXhEO0FBQ0E7O0FBR0QsU0FBUyxNQUFULENBQWdCLEdBQWhCLEVBQXFCLEVBQXJCLEVBQXlCO0FBQ3hCLE1BQUksR0FBRyxHQUFHO0FBQ1QsSUFBQSxXQUFXLEVBQUUsQ0FBQyxDQUFDLGNBQUQsQ0FBRCxDQUFrQixHQUFsQixFQURKO0FBRVQsSUFBQSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQUQsQ0FBRCxDQUFXLEdBQVgsRUFGRztBQUdULElBQUEsS0FBSyxFQUFFLENBQUMsQ0FBQyxRQUFELENBQUQsQ0FBWSxHQUFaLEVBSEU7QUFJVCxJQUFBLFdBQVcsRUFBRSxDQUFDLENBQUMsY0FBRCxDQUFELENBQWtCLEdBQWxCLEVBSko7QUFLVCxJQUFBLEtBQUssRUFBRSxDQUFDLENBQUMsUUFBRCxDQUFELENBQVksR0FBWixFQUxFO0FBTVQsSUFBQSxjQUFjLEVBQUUsQ0FBQyxDQUFDLGlCQUFELENBQUQsQ0FBcUIsR0FBckIsRUFOUDtBQU9ULElBQUEsZUFBZSxFQUFFLENBQUMsQ0FBQyxrQkFBRCxDQUFELENBQXNCLEdBQXRCLEVBUFI7QUFRVCxJQUFBLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxvQkFBRCxDQUFELENBQXdCLEdBQXhCO0FBUlYsR0FBVjtBQVVBLEVBQUEsTUFBTSxDQUFDLFFBQU0sR0FBTixHQUFVLGdCQUFYLEVBQTZCLE9BQTdCLEVBQXNDLEdBQXRDLENBQU4sQ0FDRSxJQURGLENBQ08sWUFBVztBQUNoQixRQUFHLEVBQUgsRUFBTztBQUNOLE1BQUEsRUFBRSxDQUFDLEdBQUQsQ0FBRjtBQUNBLEtBRkQs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QyxTQUFMLENBQWUsS0FBZixDQUF6Qjs7QUFDQSxZQUFHLElBQUksQ0FBQyxRQUFSLEVBQWtCO0FBQ2pCLFVBQUEsUUFBUSxDQUFDLE1BQVQsQ0FBZ0IsTUFBaEIsRUFBd0IsSUFBSSxDQUFDLFFBQTdCO0FBQ0E7O0FBQ0QsWUFBRyxJQUFJLENBQUMsVUFBUixFQUFvQjtBQUNuQixVQUFBLFFBQVEsQ0FBQyxNQUFULENBQWdCLFFBQWhCLEVBQTBCLElBQUksQ0FBQyxVQUEvQjtBQUNBOztBQUNELGVBQU8sYUFBYSxjQUFPLElBQUksQ0FBQyxLQUFMLENBQVcsR0FBbEIscUJBQXVDLE9BQXZDLEVBQWdELFFBQWhELENBQXBCO0FBQ0EsT0FkRixFQWVFLElBZkYsQ0FlTyxVQUFDLElBQUQsRUFBVTtBQUNmLFlBQUcsSUFBSSxDQUFDLElBQVIsRUFBYztBQUNiLFVBQUEsSUFBSSxDQUFDLFFBQUwsR0FBZ0IsRUFBaEI7QUFDQSxVQUFBLElBQUksQ0FBQyxRQUFMLEdBQWdCLEVBQWhCO0FBQ0EsVUFBQSxJQUFJLENBQUMsS0FBTCxDQUFXLElBQVgsR0FBa0IsSUFBSSxDQUFDLElBQXZCO0FBQ0E7O0FBQ0QsWUFBRyxJQUFJLENBQUMsTUFBUixFQUFnQjtBQUNmLFVBQUEsSUFBSSxDQUFDLFVBQUwsR0FBa0IsRUFBbEI7QUFDQSxVQUFBLElBQUksQ0FBQyxVQUFMLEdBQWtCLEVBQWxCO0FBQ0EsVUFBQSxJQUFJLENBQUMsS0FBTCxDQUFXLE1BQVgsR0FBb0IsSUFBSSxDQUFDLE1BQXpCO0FBQ0E7O0FBQ0QsUUFBQSxZQUFZLENBQUMsTUFBRCxDQUFaO0FBQ0EsT0EzQkYsV0E0QlEsVUE1QlI7QUE2QkE7QUExRU87QUFsQlUsQ0FBUixDQUFaIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiZnVuY3Rpb24gdG9FZGl0b3IoZmlkKSB7XG5cdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9lZGl0b3I/dHlwZT1mb3J1bV9kZWNsYXJlJmlkPScrZmlkO1xufVxuXG5cbmZ1bmN0aW9uIHN1Ym1pdChmaWQsIGZuKSB7XG5cdHZhciBvYmogPSB7XG5cdFx0ZGlzcGxheU5hbWU6ICQoJyNkaXNwbGF5TmFtZScpLnZhbCgpLFxuXHRcdGFiYnI6ICQoJyNhYmJyJykudmFsKCksXG5cdFx0Y29sb3I6ICQoJyNjb2xvcicpLnZhbCgpLFxuXHRcdGRlc2NyaXB0aW9uOiAkKCcjZGVzY3JpcHRpb24nKS52YWwoKSxcblx0XHRicmllZjogJCgnI2JyaWVmJykudmFsKCksXG5cdFx0YmFzaWNUaHJlYWRzSWQ6ICQoJyNiYXNpY1RocmVhZHNJZCcpLnZhbCgpLFxuXHRcdG5vdGljZVRocmVhZHNJZDogJCgnI25vdGljZVRocmVhZHNJZCcpLnZhbCgpLFxuXHRcdHZhbHVhYmxlVGhyZWFkc0lkOiAkKCcjdmFsdWFibGVUaHJlYWRzSWQnKS52YWwoKSxcblx0fTtcblx0bmtjQVBJKCcvZi8nK2ZpZCsnL3NldHRpbmdzL2luZm8nLCAnUEFUQ0gnLCBvYmopXG5cdFx0LnRoZW4oZnVuY3Rpb24oKSB7XG5cdFx0XHRpZihmbikge1xuXHRcdFx0XHRmbihmaWQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2NyZWVuVG9wQWxlcnQoJ+S/neWtmOaIkOWKnycpO1xuXHRcdFx0fVxuXHRcdH0pXG5cdFx0LmNhdGNoKGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdHNjcmVlblRvcFdhcm5pbmcoZGF0YS5lcnJvciB8fCBkYXRhKTtcblx0XHR9KVxufVxuXG5jb25zdCBkYXRhID0gTktDLm1ldGhvZHMuZ2V0RGF0YUJ5SWQoJ2RhdGEnKTtcbmNvbnN0IGZvcnVtID0gZGF0YS5mb3J1bTtcbmZvcnVtLl9ub3RpY2VUaHJlYWRzSWQgPSAoZm9ydW0ubm90aWNlVGhyZWFkc0lkIHx8IFtdKS5qb2luKFwiLCBcIik7XG5mb3J1bS5fYmFzaWNUaHJlYWRzSWQgPSAoZm9ydW0uYmFzaWNUaHJlYWRzSWQgfHwgW10pLmpvaW4oXCIsIFwiKTtcbmZvcnVtLl92YWx1YWJsZVRocmVhZHNJZCA9IChmb3J1bS52YWx1YWJsZVRocmVhZHNJZCB8fCBbXSkuam9pbihcIiwgXCIpO1xuY29uc3Qgc2VsZWN0SW1hZ2UgPSBuZXcgTktDLm1ldGhvZHMuc2VsZWN0SW1hZ2UoKVxuY29uc3QgYXBwID0gbmV3IFZ1ZSh7XG5cdGVsOiAnI2FwcCcsXG5cdGRhdGE6IHtcblx0XHRsb2dvRGF0YTogJycsXG5cdFx0bG9nb0ZpbGU6ICcnLFxuXHRcdGJhbm5lckRhdGE6ICcnLFxuXHRcdGJhbm5lckZpbGU6ICcnLFxuXHRcdGZvcnVtXG5cdH0sXG5cdG1vdW50ZWQoKSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHROS0MubWV0aG9kcy5pbml0U2VsZWN0Q29sb3IoY29sb3IgPT4ge1xuXHRcdFx0XHRzZWxmLmZvcnVtLmNvbG9yID0gY29sb3I7XG5cdFx0XHR9KTtcblx0XHR9LCAxMDApXG5cblx0fSxcblx0bWV0aG9kczoge1xuXHRcdGdldFVybDogTktDLm1ldGhvZHMudG9vbHMuZ2V0VXJsLFxuXHRcdHN0cjJhcnIoc3RyKSB7XG5cdFx0XHRjb25zdCBhcnIgPSBzdHIuc3BsaXQoJywnKTtcblx0XHRcdGNvbnN0IF9hcnIgPSBbXTtcblx0XHRcdGFyci5tYXAoYSA9PiB7XG5cdFx0XHRcdGEgPSBhLnRyaW0oKTtcblx0XHRcdFx0aWYoYSkgX2Fyci5wdXNoKGEpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gX2Fycjtcblx0XHR9LFxuXHRcdHNlbGVjdExvZ28oKSB7XG5cdFx0XHRjb25zdCBzZWxmID0gdGhpcztcblx0XHRcdHNlbGVjdEltYWdlLnNob3coZCA9PiB7XG5cdFx0XHRcdGNvbnN0IGZpbGUgPSBOS0MubWV0aG9kcy5ibG9iVG9GaWxlKGQpO1xuXHRcdFx0XHROS0MubWV0aG9kcy5maWxlVG9VcmwoZmlsZSlcblx0XHRcdFx0XHQudGhlbihkID0+IHtcblx0XHRcdFx0XHRcdHNlbGYubG9nb0RhdGEgPSBkO1xuXHRcdFx0XHRcdFx0c2VsZi5sb2dvRmlsZSA9IGZpbGU7XG5cdFx0XHRcdFx0XHRzZWxlY3RJbWFnZS5jbG9zZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHR9LCB7XG5cdFx0XHRcdGFzcGVjdFJhdGlvOiAxXG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdHNlbGVjdEJhbm5lcigpIHtcblx0XHRcdGNvbnN0IHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZWN0SW1hZ2Uuc2hvdyhkID0+IHtcblx0XHRcdFx0Y29uc3QgZmlsZSA9IE5LQy5tZXRob2RzLmJsb2JUb0ZpbGUoZCk7XG5cdFx0XHRcdE5LQy5tZXRob2RzLmZpbGVUb1VybChmaWxlKVxuXHRcdFx0XHRcdC50aGVuKGQgPT4ge1xuXHRcdFx0XHRcdFx0c2VsZi5iYW5uZXJEYXRhID0gZDtcblx0XHRcdFx0XHRcdHNlbGYuYmFubmVyRmlsZSA9IGZpbGU7XG5cdFx0XHRcdFx0XHRzZWxlY3RJbWFnZS5jbG9zZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHR9LCB7XG5cdFx0XHRcdGFzcGVjdFJhdGlvOiA0XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdHRvRWRpdG9yKCkge1xuXHRcdFx0TktDLm1ldGhvZHMudmlzaXRVcmwoJy9lZGl0b3I/dHlwZT1mb3J1bV9kZWNsYXJlJmlkPScrdGhpcy5mb3J1bS5maWQsIHRydWUpO1xuXHRcdH0sXG5cdFx0c2F2ZSgpIHtcblx0XHRcdGNvbnN0IHNlbGYgPSB0aGlzO1xuXHRcdFx0Y29uc3Qge2ZvcnVtfSA9IHNlbGY7XG5cdFx0XHRQcm9taXNlLnJlc29sdmUoKVxuXHRcdFx0XHQudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0Zm9ydW0ubm90aWNlVGhyZWFkc0lkID0gc2VsZi5zdHIyYXJyKGZvcnVtLl9ub3RpY2VUaHJlYWRzSWQpO1xuXHRcdFx0XHRcdGZvcnVtLmJhc2ljVGhyZWFkc0lkID0gc2VsZi5zdHIyYXJyKGZvcnVtLl9iYXNpY1RocmVhZHNJZCk7XG5cdFx0XHRcdFx0Zm9ydW0udmFsdWFibGVUaHJlYWRzSWQgPSBzZWxmLnN0cjJhcnIoZm9ydW0uX3ZhbHVhYmxlVGhyZWFkc0lkKTtcblx0XHRcdFx0XHRjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXHRcdFx0XHRcdGZvcm1EYXRhLmFwcGVuZCgnZm9ydW0nLCBKU09OLnN0cmluZ2lmeShmb3J1bSkpO1xuXHRcdFx0XHRcdGlmKHNlbGYubG9nb0ZpbGUpIHtcblx0XHRcdFx0XHRcdGZvcm1EYXRhLmFwcGVuZCgnbG9nbycsIHNlbGYubG9nb0ZpbGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZihzZWxmLmJhbm5lckZpbGUpIHtcblx0XHRcdFx0XHRcdGZvcm1EYXRhLmFwcGVuZCgnYmFubmVyJywgc2VsZi5iYW5uZXJGaWxlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIG5rY1VwbG9hZEZpbGUoYC9mLyR7c2VsZi5mb3J1bS5maWR9L3NldHRpbmdzL2luZm9gLCAnUEFUQ0gnLCBmb3JtRGF0YSk7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKChkYXRhKSA9PiB7XG5cdFx0XHRcdFx0aWYoZGF0YS5sb2dvKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmxvZ29EYXRhID0gJyc7XG5cdFx0XHRcdFx0XHRzZWxmLmxvZ29GaWxlID0gJyc7XG5cdFx0XHRcdFx0XHRzZWxmLmZvcnVtLmxvZ28gPSBkYXRhLmxvZ287XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmKGRhdGEuYmFubmVyKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmJhbm5lckRhdGEgPSAnJztcblx0XHRcdFx0XHRcdHNlbGYuYmFubmVyRmlsZSA9ICcnO1xuXHRcdFx0XHRcdFx0c2VsZi5mb3J1bS5iYW5uZXIgPSBkYXRhLmJhbm5lcjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0c3dlZXRTdWNjZXNzKCfkv53lrZjmiJDlip8nKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0LmNhdGNoKHN3ZWV0RXJyb3IpO1xuXHRcdH1cblx0fVxufSk7XG4iXX0=
