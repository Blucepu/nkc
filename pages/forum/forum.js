(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var SubscribeTypes;
var forumInfo = NKC.methods.getDataById('forumInfo');
var fid = forumInfo.fid,
    page = forumInfo.page,
    digest = forumInfo.digest,
    sort = forumInfo.sort;
$(function () {
  if (!window.SubscribeTypes) {
    SubscribeTypes = new NKC.modules.SubscribeTypes();
  }

  var dom = $("#navbar_custom_dom");
  var leftDom = $("#leftDom");
  dom.html(leftDom.html());

  if (NKC.configs.lid) {
    window.Library = new NKC.modules.Library({
      lid: NKC.configs.lid,
      folderId: NKC.configs.folderId,
      tLid: NKC.configs.tLid,
      closed: NKC.configs.closed,
      uploadResourcesId: NKC.configs.uploadResourcesId ? NKC.configs.uploadResourcesId.split("-") : []
    });
  }

  var threadUrlSwitch = $('#threadUrlSwitch');

  if (threadUrlSwitch.length) {
    var threadUrlSwitchStatus = getThreadUrlSwitchStatus();
    modifyThreadUrl(threadUrlSwitchStatus);
    threadUrlSwitch.on("click", function () {
      var s = $(this).prop('checked');
      modifyThreadUrl(s);
    });
  }

  if (NKC.configs.uid) {
    connectForumRoom();
  }
});
var threadUrlSwitchKey = 'forum_thread_a_target';

function modifyThreadUrl(status) {
  var target = status ? '_blank' : '_self';
  $('.thread-panel-url').attr('target', target);
  $('#threadUrlSwitch').prop('checked', !!status);
  setThreadUrlSwitchStatus(status);
}
/*
* @return {Boolean}
* */


function getThreadUrlSwitchStatus() {
  return localStorage.getItem(threadUrlSwitchKey) === 'true';
}

function setThreadUrlSwitchStatus(status) {
  localStorage.setItem(threadUrlSwitchKey, status);
}

window.openEditSite = function () {
  var url = window.location.origin + "/editor?type=forum&id=" + fid;

  if (NKC.configs.platform === 'reactNative') {
    NKC.methods.rn.emit("openEditorPage", {
      url: url
    });
  } else if (NKC.configs.platform === 'apiCloud') {
    api.openWin({
      name: url,
      url: 'widget://html/common/editorInfo.html',
      pageParam: {
        realUrl: url,
        shareType: "common"
      }
    });
  } else {
    NKC.methods.visitUrl(url, true);
  }
};
/*
* 连入房间
* */


function joinRoom() {
  socket.emit('joinRoom', {
    type: 'forum',
    data: {
      forumId: fid
    }
  });
}
/*
* 连接上专业房间
* */


function connectForumRoom() {
  socket.on('connect', function () {
    joinRoom();
  });
  socket.on('forumMessage', function (data) {
    var html = data.html,
        tid = data.tid,
        contentType = data.contentType;
    var threadList = $('div.normal-thread-list');
    var targetThread = threadList.find('div[data-tid="' + tid + '"]');
    var targetThreadCounter = threadList.find('div[data-tid="' + tid + '"] span.thread-panel-counter');
    var newPostCount = 0; // 获取当前未读数

    if (targetThreadCounter.length) {
      newPostCount = Number(targetThreadCounter.attr('data-count'));
    }

    if (page === 0 && // 处于专业首页
    digest === data.digest && (contentType === 'thread' || sort === 'tlm') // 发表文章或发表回复且按回复排序
    ) {
        // 处于专业首页 更新时先移除旧元素再在列表头部插入新元素
        targetThread.remove();
        targetThread = $(html);
        threadList.prepend(targetThread);
      } else {
      if (!targetThread) return;
      targetThreadCounter.remove();
    }

    newPostCount++;
    var counter = $("<span class='thread-panel-counter' data-count='" + newPostCount + "' title='" + newPostCount + "条更新'>" + newPostCount + "</span>");
    targetThread.prepend(counter);
    floatUserPanel.initPanel();
    floatForumPanel.initPanel();
  });

  if (socket.connected) {
    joinRoom();
  }
}

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9mb3J1bS9mb3J1bS5tanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLElBQUksY0FBSjtBQUNBLElBQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQyxPQUFKLENBQVksV0FBWixDQUF3QixXQUF4QixDQUFsQjtJQUNPLEcsR0FBMkIsUyxDQUEzQixHO0lBQUssSSxHQUFzQixTLENBQXRCLEk7SUFBTSxNLEdBQWdCLFMsQ0FBaEIsTTtJQUFRLEksR0FBUSxTLENBQVIsSTtBQUUxQixDQUFDLENBQUMsWUFBVztBQUNYLE1BQUcsQ0FBQyxNQUFNLENBQUMsY0FBWCxFQUEyQjtBQUN6QixJQUFBLGNBQWMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFKLENBQVksY0FBaEIsRUFBakI7QUFDRDs7QUFDRCxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsb0JBQUQsQ0FBYjtBQUNBLE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBQyxVQUFELENBQWpCO0FBQ0EsRUFBQSxHQUFHLENBQUMsSUFBSixDQUFTLE9BQU8sQ0FBQyxJQUFSLEVBQVQ7O0FBQ0EsTUFBRyxHQUFHLENBQUMsT0FBSixDQUFZLEdBQWYsRUFBb0I7QUFDbEIsSUFBQSxNQUFNLENBQUMsT0FBUCxHQUFpQixJQUFJLEdBQUcsQ0FBQyxPQUFKLENBQVksT0FBaEIsQ0FBd0I7QUFDdkMsTUFBQSxHQUFHLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxHQURzQjtBQUV2QyxNQUFBLFFBQVEsRUFBRSxHQUFHLENBQUMsT0FBSixDQUFZLFFBRmlCO0FBR3ZDLE1BQUEsSUFBSSxFQUFFLEdBQUcsQ0FBQyxPQUFKLENBQVksSUFIcUI7QUFJdkMsTUFBQSxNQUFNLEVBQUUsR0FBRyxDQUFDLE9BQUosQ0FBWSxNQUptQjtBQUt2QyxNQUFBLGlCQUFpQixFQUFFLEdBQUcsQ0FBQyxPQUFKLENBQVksaUJBQVosR0FBOEIsR0FBRyxD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Z0csWUFBaEcsR0FBNkcsU0FBOUcsQ0FBakI7QUFDQSxJQUFBLFlBQVksQ0FBQyxPQUFiLENBQXFCLE9BQXJCO0FBRUEsSUFBQSxjQUFjLENBQUMsU0FBZjtBQUNBLElBQUEsZUFBZSxDQUFDLFNBQWhCO0FBQ0QsR0EvQkQ7O0FBZ0NBLE1BQUcsTUFBTSxDQUFDLFNBQVYsRUFBcUI7QUFDbkIsSUFBQSxRQUFRO0FBQ1Q7QUFDRiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImxldCBTdWJzY3JpYmVUeXBlcztcclxuY29uc3QgZm9ydW1JbmZvID0gTktDLm1ldGhvZHMuZ2V0RGF0YUJ5SWQoJ2ZvcnVtSW5mbycpO1xyXG5jb25zdCB7ZmlkLCBwYWdlLCBkaWdlc3QsIHNvcnR9ID0gZm9ydW1JbmZvO1xyXG5cclxuJChmdW5jdGlvbigpIHtcclxuICBpZighd2luZG93LlN1YnNjcmliZVR5cGVzKSB7XHJcbiAgICBTdWJzY3JpYmVUeXBlcyA9IG5ldyBOS0MubW9kdWxlcy5TdWJzY3JpYmVUeXBlcygpO1xyXG4gIH1cclxuICBjb25zdCBkb20gPSAkKFwiI25hdmJhcl9jdXN0b21fZG9tXCIpO1xyXG4gIGNvbnN0IGxlZnREb20gPSAkKFwiI2xlZnREb21cIik7XHJcbiAgZG9tLmh0bWwobGVmdERvbS5odG1sKCkpO1xyXG4gIGlmKE5LQy5jb25maWdzLmxpZCkge1xyXG4gICAgd2luZG93LkxpYnJhcnkgPSBuZXcgTktDLm1vZHVsZXMuTGlicmFyeSh7XHJcbiAgICAgIGxpZDogTktDLmNvbmZpZ3MubGlkLFxyXG4gICAgICBmb2xkZXJJZDogTktDLmNvbmZpZ3MuZm9sZGVySWQsXHJcbiAgICAgIHRMaWQ6IE5LQy5jb25maWdzLnRMaWQsXHJcbiAgICAgIGNsb3NlZDogTktDLmNvbmZpZ3MuY2xvc2VkLFxyXG4gICAgICB1cGxvYWRSZXNvdXJjZXNJZDogTktDLmNvbmZpZ3MudXBsb2FkUmVzb3VyY2VzSWQ/TktDLmNvbmZpZ3MudXBsb2FkUmVzb3VyY2VzSWQuc3BsaXQoXCItXCIpOltdXHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29uc3QgdGhyZWFkVXJsU3dpdGNoID0gJCgnI3RocmVhZFVybFN3aXRjaCcpO1xyXG4gIGlmKHRocmVhZFVybFN3aXRjaC5sZW5ndGgpIHtcclxuICAgIGNvbnN0IHRocmVhZFVybFN3aXRjaFN0YXR1cyA9IGdldFRocmVhZFVybFN3aXRjaFN0YXR1cygpO1xyXG4gICAgbW9kaWZ5VGhyZWFkVXJsKHRocmVhZFVybFN3aXRjaFN0YXR1cyk7XHJcbiAgICB0aHJlYWRVcmxTd2l0Y2gub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgY29uc3QgcyA9ICQodGhpcykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICAgICBtb2RpZnlUaHJlYWRVcmwocyk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgaWYoTktDLmNvbmZpZ3MudWlkKSB7XHJcbiAgICBjb25uZWN0Rm9ydW1Sb29tKCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbmNvbnN0IHRocmVhZFVybFN3aXRjaEtleSA9ICdmb3J1bV90aHJlYWRfYV90YXJnZXQnO1xyXG5cclxuZnVuY3Rpb24gbW9kaWZ5VGhyZWFkVXJsKHN0YXR1cykge1xyXG4gIHZhciB0YXJnZXQgPSBzdGF0dXM/ICdfYmxhbmsnOiAnX3NlbGYnO1xyXG4gICQoJy50aHJlYWQtcGFuZWwtdXJsJykuYXR0cigndGFyZ2V0JywgdGFyZ2V0KTtcclxuICAkKCcjdGhyZWFkVXJsU3dpdGNoJykucHJvcCgnY2hlY2tlZCcsICEhc3RhdHVzKTtcclxuICBzZXRUaHJlYWRVcmxTd2l0Y2hTdGF0dXMoc3RhdHVzKTtcclxufVxyXG4vKlxyXG4qIEByZXR1cm4ge0Jvb2xlYW59XHJcbiogKi9cclxuZnVuY3Rpb24gZ2V0VGhyZWFkVXJsU3dpdGNoU3RhdHVzKCkge1xyXG4gIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aHJlYWRVcmxTd2l0Y2hLZXkpID09PSAndHJ1ZSc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFRocmVhZFVybFN3aXRjaFN0YXR1cyhzdGF0dXMpIHtcclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aHJlYWRVcmxTd2l0Y2hLZXksIHN0YXR1cyk7XHJcbn1cclxuXHJcbndpbmRvdy5vcGVuRWRpdFNpdGUgPSBmdW5jdGlvbigpIHtcclxuICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgXCIvZWRpdG9yP3R5cGU9Zm9ydW0maWQ9XCIgKyBmaWQ7XHJcblxyXG4gIGlmKE5LQy5jb25maWdzLnBsYXRmb3JtID09PSAncmVhY3ROYXRpdmUnKSB7XHJcbiAgICBOS0MubWV0aG9kcy5ybi5lbWl0KFwib3BlbkVkaXRvclBhZ2VcIiwge1xyXG4gICAgICB1cmw6IHVybFxyXG4gICAgfSlcclxuICB9IGVsc2UgaWYoTktDLmNvbmZpZ3MucGxhdGZvcm0gPT09ICdhcGlDbG91ZCcpIHtcclxuICAgIGFwaS5vcGVuV2luKHtcclxuICAgICAgbmFtZTogdXJsLFxyXG4gICAgICB1cmw6ICd3aWRnZXQ6Ly9odG1sL2NvbW1vbi9lZGl0b3JJbmZvLmh0bWwnLFxyXG4gICAgICBwYWdlUGFyYW06IHtcclxuICAgICAgICByZWFsVXJsOiB1cmwsXHJcbiAgICAgICAgc2hhcmVUeXBlOiBcImNvbW1vblwiXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfSBlbHNlIHtcclxuICAgIE5LQy5tZXRob2RzLnZpc2l0VXJsKHVybCwgdHJ1ZSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKlxyXG4qIOi/nuWFpeaIv+mXtFxyXG4qICovXHJcbmZ1bmN0aW9uIGpvaW5Sb29tKCkge1xyXG4gIHNvY2tldC5lbWl0KCdqb2luUm9vbScsIHtcclxuICAgIHR5cGU6ICdmb3J1bScsXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIGZvcnVtSWQ6IGZpZFxyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKlxyXG4qIOi/nuaOpeS4iuS4k+S4muaIv+mXtFxyXG4qICovXHJcbmZ1bmN0aW9uIGNvbm5lY3RGb3J1bVJvb20oKSB7XHJcbiAgc29ja2V0Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24oKSB7XHJcbiAgICBqb2luUm9vbSgpO1xyXG4gIH0pO1xyXG4gIHNvY2tldC5vbignZm9ydW1NZXNzYWdlJywgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgY29uc3Qge2h0bWwsIHRpZCwgY29udGVudFR5cGV9ID0gZGF0YTtcclxuICAgIGNvbnN0IHRocmVhZExpc3QgPSAkKCdkaXYubm9ybWFsLXRocmVhZC1saXN0Jyk7XHJcbiAgICBsZXQgdGFyZ2V0VGhyZWFkID0gdGhyZWFkTGlzdC5maW5kKCdkaXZbZGF0YS10aWQ9XCInK3RpZCsnXCJdJyk7XHJcbiAgICBjb25zdCB0YXJnZXRUaHJlYWRDb3VudGVyID0gdGhyZWFkTGlzdC5maW5kKCdkaXZbZGF0YS10aWQ9XCInK3RpZCsnXCJdIHNwYW4udGhyZWFkLXBhbmVsLWNvdW50ZXInKTtcclxuICAgIGxldCBuZXdQb3N0Q291bnQgPSAwO1xyXG4gICAgLy8g6I635Y+W5b2T5YmN5pyq6K+75pWwXHJcbiAgICBpZih0YXJnZXRUaHJlYWRDb3VudGVyLmxlbmd0aCkge1xyXG4gICAgICBuZXdQb3N0Q291bnQgPSBOdW1iZXIodGFyZ2V0VGhyZWFkQ291bnRlci5hdHRyKCdkYXRhLWNvdW50JykpO1xyXG4gICAgfVxyXG4gICAgaWYoXHJcbiAgICAgIHBhZ2UgPT09IDAgJiYgLy8g5aSE5LqO5LiT5Lia6aaW6aG1XHJcbiAgICAgIGRpZ2VzdCA9PT0gZGF0YS5kaWdlc3QgJiZcclxuICAgICAgKGNvbnRlbnRUeXBlID09PSAndGhyZWFkJyB8fCBzb3J0ID09PSAndGxtJykgLy8g5Y+R6KGo5paH56ug5oiW5Y+R6KGo5Zue5aSN5LiU5oyJ5Zue5aSN5o6S5bqPXHJcbiAgICApIHtcclxuICAgICAgLy8g5aSE5LqO5LiT5Lia6aaW6aG1IOabtOaWsOaXtuWFiOenu+mZpOaXp+WFg+e0oOWGjeWcqOWIl+ihqOWktOmDqOaPkuWFpeaWsOWFg+e0oFxyXG4gICAgICB0YXJnZXRUaHJlYWQucmVtb3ZlKCk7XHJcbiAgICAgIHRhcmdldFRocmVhZCA9ICQoaHRtbCk7XHJcbiAgICAgIHRocmVhZExpc3QucHJlcGVuZCh0YXJnZXRUaHJlYWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYoIXRhcmdldFRocmVhZCkgcmV0dXJuO1xyXG4gICAgICB0YXJnZXRUaHJlYWRDb3VudGVyLnJlbW92ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5ld1Bvc3RDb3VudCArKztcclxuXHJcbiAgICBjb25zdCBjb3VudGVyID0gJChcIjxzcGFuIGNsYXNzPSd0aHJlYWQtcGFuZWwtY291bnRlcicgZGF0YS1jb3VudD0nXCIrbmV3UG9zdENvdW50K1wiJyB0aXRsZT0nXCIrbmV3UG9zdENvdW50K1wi5p2h5pu05pawJz5cIituZXdQb3N0Q291bnQrXCI8L3NwYW4+XCIpO1xyXG4gICAgdGFyZ2V0VGhyZWFkLnByZXBlbmQoY291bnRlcik7XHJcblxyXG4gICAgZmxvYXRVc2VyUGFuZWwuaW5pdFBhbmVsKCk7XHJcbiAgICBmbG9hdEZvcnVtUGFuZWwuaW5pdFBhbmVsKCk7XHJcbiAgfSk7XHJcbiAgaWYoc29ja2V0LmNvbm5lY3RlZCkge1xyXG4gICAgam9pblJvb20oKTtcclxuICB9XHJcbn1cclxuIl19
