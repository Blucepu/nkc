(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var CommonModal = new NKC.modules.CommonModal();

window.modifyParam = function (productId, paramId) {
  var param = getParam(productId, paramId);
  CommonModal.open(function (data) {
    var paramData = {
      name: data[0].value,
      originPrice: data[1].value,
      stocksSurplus: data[2].value,
      price: data[3].value,
      useDiscount: data[4].value,
      isEnable: data[5].value,
      paramId: paramId,
      productId: productId
    };
    nkcAPI("/shop/manage/".concat(NKC.configs.uid, "/goodslist/editParam"), "PATCH", {
      paramData: paramData
    }).then(function () {
      sweetSuccess("修改成功");
      CommonModal.close();
      setParam(productId, paramId, paramData);
    })["catch"](sweetError);
  }, {
    title: "修改规格",
    data: [{
      dom: "input",
      type: "text",
      label: "名称",
      value: param.name
    }, {
      dom: "input",
      type: "number",
      label: "价格（元，精确到0.01）",
      value: param.originPrice
    }, {
      dom: "input",
      type: "number",
      label: "库存",
      value: param.stocksSurplus
    }, {
      dom: "input",
      type: "number",
      label: "优惠价（元，精确到0.01）",
      value: param.price
    }, {
      dom: "radio",
      label: "是否使用优惠价",
      value: param.useDiscount,
      radios: [{
        value: true,
        name: "是"
      }, {
        value: false,
        name: "否"
      }]
    }, {
      dom: "radio",
      label: "是否屏蔽",
      value: param.isEnable,
      radios: [{
        value: false,
        name: "是"
      }, {
        value: true,
        name: "否"
      }]
    }]
  });
}; // 重新计算一个商品的总库存和总销量


window.computeStocks = function (productId) {}; // 字符串数字提取


window.getNumber = function (str) {
  var fractionDigits = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  str = str + "";
  str = str.replace("￥", "");
  str = parseFloat(str);
  str = str.toFixed(fractionDigits);
  return parseFloat(str);
}; // 获取规格相关的dom


window.getParamDom = function (productId, paramId) {
  var dom = $(".param[data-product-id='".concat(productId, "'][data-param-id='").concat(paramId, "']"));
  var originPrice = dom.find(".origin-price");
  var price = dom.find(".price");
  var name = dom.find(".name");
  var stocksSurplus = dom.find(".stocks-surplus");
  return {
    dom: dom,
    name: name,
    originPrice: originPrice,
    price: price,
    stocksSurplus: stocksSurplus
  };
}; // 获取规格信息


window.getParam = function (productId, paramId) {
  var _getParamDom = getParamDom(productId, paramId),
      dom = _getParamDom.dom,
      originPrice = _getParamDom.originPrice,
      price = _getParamDom.price,
      name = _getParamDom.name,
      stocksSurplus = _getParamDom.stocksSurplus;

  originPrice = getNumber(originPrice.text(), 2);
  var useDiscount = false;

  if (price.text() === "无") {
    price = "";
  } else {
    price = getNumber(price.text(), 2);
    useDiscount = true;
  }

  stocksSurplus = getNumber(stocksSurplus.text());
  var isEnable = true;
  if (dom.hasClass("disabled")) isEnable = false;
  name = name.text();
  return {
    name: name,
    isEnable: isEnable,
    useDiscount: useDiscount,
    originPrice: originPrice,
    price: price,
    stocksSurplus: stocksSurplus
  };
};

window.setParam = function (productId, paramId, param) {
  var paramDom = getParamDom(productId, paramId);
  var name = param.name,
      originPrice = param.originPrice,
      price = param.price,
      useDiscount = param.useDiscount,
      stocksSurplus = param.stocksSurplus,
      isEnable = param.isEnable;
  var _NKC$methods$checkDat = NKC.methods.checkData,
      checkString = _NKC$methods$checkDat.checkString,
      checkNumber = _NKC$methods$checkDat.checkNumber;
  Promise.resolve().then(function () {
    checkString(name, {
      name: "名称",
      minLength: 1,
      maxLength: 100
    });
    checkNumber(stocksSurplus, {
      name: "库存",
      min: 0
    }), checkNumber(originPrice, {
      name: "价格",
      min: 0.01,
      fractionDigits: 2
    });

    if (useDiscount) {
      if (price >= originPrice) throw "规格优惠价必须小于原价";
      checkNumber(price, {
        name: "优惠价",
        min: 0.01,
        fractionDigits: 2
      });
    }

    if (isEnable) {
      paramDom.dom.removeClass("disabled");
    } else {
      paramDom.dom.addClass("disabled");
    }

    paramDom.name.text(name);
    paramDom.originPrice.text("\uFFE5".concat(originPrice.toFixed(2)));
    paramDom.stocksSurplus.text(stocksSurplus);

    if (useDiscount) {
      paramDom.price.text("\uFFE5".concat(price.toFixed(2))).addClass("number");
    } else {
      paramDom.price.text("\u65E0").removeClass("number");
    }

    var productDom = $(".product[data-product-id='".concat(productId, "'] .stocks-surplus"));
    var stocksDoms = $(".param[data-product-id='".concat(productId, "'] .stocks-surplus"));
    var count = 0;

    for (var i = 0; i < stocksDoms.length; i++) {
      var s = stocksDoms.eq(i);
      count += getNumber(s.text());
    }

    productDom.text(count);
  })["catch"](sweetError);
};
/*
* 立即上架
* */


window.shelfNow = function (productId) {
  sweetQuestion("确认要上架该商品？").then(function () {
    return nkcAPI("/shop/manage/".concat(NKC.configs.uid, "/goodslist/shelfRightNow"), "PATCH", {
      productId: productId
    });
  }).then(function () {
    sweetSuccess("商品已上架");
  })["catch"](sweetError);
};
/**
 * 商品停售
 */


window.stopSale = function (productId) {
  sweetQuestion("确认要停售该商品？").then(function () {
    return nkcAPI("/shop/manage/".concat(NKC.configs.uid, "/goodslist/productStopSale"), "PATCH", {
      productId: productId
    });
  }).then(function () {
    sweetSuccess("商品已停售");
  })["catch"](sweetError);
};
/**
 * 商品复售
 */


window.goonSale = function (productId) {
  sweetQuestion("确认要复售该商品？").then(function () {
    return nkcAPI("/shop/manage/".concat(NKC.configs.uid, "/goodslist/productGoonSale"), "PATCH", {
      productId: productId
    });
  }).then(function () {
    sweetSuccess("商品已复售");
  })["catch"](sweetError);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3Nob3AvbWFuYWdlL2dvb2RzL2dvb2RzLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBTSxXQUFXLEdBQUcsSUFBSSxHQUFHLENBQUMsT0FBSixDQUFZLFdBQWhCLEVBQXBCOztBQUNBLE1BQU0sQ0FBQyxXQUFQLEdBQXFCLFVBQVUsU0FBVixFQUFxQixPQUFyQixFQUE4QjtBQUNqRCxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsU0FBRCxFQUFZLE9BQVosQ0FBdEI7QUFDQSxFQUFBLFdBQVcsQ0FBQyxJQUFaLENBQWlCLFVBQUEsSUFBSSxFQUFJO0FBQ3ZCLFFBQU0sU0FBUyxHQUFHO0FBQ2hCLE1BQUEsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUSxLQURFO0FBRWhCLE1BQUEsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUSxLQUZMO0FBR2hCLE1BQUEsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUSxLQUhQO0FBSWhCLE1BQUEsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUSxLQUpDO0FBS2hCLE1BQUEsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUSxLQUxMO0FBTWhCLE1BQUEsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUSxLQU5GO0FBT2hCLE1BQUEsT0FBTyxFQUFQLE9BUGdCO0FBUWhCLE1BQUEsU0FBUyxFQUFUO0FBUmdCLEtBQWxCO0FBWUEsSUFBQSxNQUFNLHdCQUFpQixHQUFHLENBQUMsT0FBSixDQUFZLEdBQTdCLDJCQUF3RCxPQUF4RCxFQUFpRTtBQUFDLE1BQUEsU0FBUyxFQUFUO0FBQUQsS0FBakUsQ0FBTixDQUNHLElBREgsQ0FDUSxZQUFNO0FBQ1YsTUFBQSxZQUFZLENBQUMsTUFBRCxDQUFa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QVdBOzs7OztBQUdBLE1BQU0sQ0FBQyxRQUFQLEdBQWtCLFVBQVMsU0FBVCxFQUFvQjtBQUNwQyxFQUFBLGFBQWEsQ0FBQyxXQUFELENBQWIsQ0FDRyxJQURILENBQ1EsWUFBTTtBQUNWLFdBQU8sTUFBTSx3QkFBaUIsR0FBRyxDQUFDLE9BQUosQ0FBWSxHQUE3QixpQ0FBOEQsT0FBOUQsRUFBdUU7QUFBQyxNQUFBLFNBQVMsRUFBVDtBQUFELEtBQXZFLENBQWI7QUFDRCxHQUhILEVBSUcsSUFKSCxDQUlRLFlBQU07QUFDVixJQUFBLFlBQVksQ0FBQyxPQUFELENBQVo7QUFDRCxHQU5ILFdBT1MsVUFQVDtBQVFELENBVEQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjb25zdCBDb21tb25Nb2RhbCA9IG5ldyBOS0MubW9kdWxlcy5Db21tb25Nb2RhbCgpO1xud2luZG93Lm1vZGlmeVBhcmFtID0gZnVuY3Rpb24gKHByb2R1Y3RJZCwgcGFyYW1JZCkge1xuICBjb25zdCBwYXJhbSA9IGdldFBhcmFtKHByb2R1Y3RJZCwgcGFyYW1JZCk7XG4gIENvbW1vbk1vZGFsLm9wZW4oZGF0YSA9PiB7XG4gICAgY29uc3QgcGFyYW1EYXRhID0ge1xuICAgICAgbmFtZTogZGF0YVswXS52YWx1ZSxcbiAgICAgIG9yaWdpblByaWNlOiBkYXRhWzFdLnZhbHVlLFxuICAgICAgc3RvY2tzU3VycGx1czogZGF0YVsyXS52YWx1ZSxcbiAgICAgIHByaWNlOiBkYXRhWzNdLnZhbHVlLFxuICAgICAgdXNlRGlzY291bnQ6IGRhdGFbNF0udmFsdWUsXG4gICAgICBpc0VuYWJsZTogZGF0YVs1XS52YWx1ZSxcbiAgICAgIHBhcmFtSWQsXG4gICAgICBwcm9kdWN0SWRcbiAgICB9O1xuXG5cbiAgICBua2NBUEkoYC9zaG9wL21hbmFnZS8ke05LQy5jb25maWdzLnVpZH0vZ29vZHNsaXN0L2VkaXRQYXJhbWAsIFwiUEFUQ0hcIiwge3BhcmFtRGF0YX0pXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHN3ZWV0U3VjY2VzcyhcIuS/ruaUueaIkOWKn1wiKTtcbiAgICAgICAgQ29tbW9uTW9kYWwuY2xvc2UoKTtcbiAgICAgICAgc2V0UGFyYW0ocHJvZHVjdElkLCBwYXJhbUlkLCBwYXJhbURhdGEpOyAgICBcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goc3dlZXRFcnJvcilcbiAgICBcbiAgfSwge1xuICAgIHRpdGxlOiBcIuS/ruaUueinhOagvFwiLFxuICAgIGRhdGE6IFtcbiAgICAgIHtcbiAgICAgICAgZG9tOiBcImlucHV0XCIsXG4gICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICBsYWJlbDogXCLlkI3np7BcIixcbiAgICAgICAgdmFsdWU6IHBhcmFtLm5hbWVcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGRvbTogXCJpbnB1dFwiLFxuICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxuICAgICAgICBsYWJlbDogXCLku7fmoLzvvIjlhYPvvIznsr7noa7liLAwLjAx77yJXCIsXG4gICAgICAgIHZhbHVlOiBwYXJhbS5vcmlnaW5QcmljZVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZG9tOiBcImlucHV0XCIsXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXG4gICAgICAgIGxhYmVsOiBcIuW6k+WtmFwiLFxuICAgICAgICB2YWx1ZTogcGFyYW0uc3RvY2tzU3VycGx1c1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZG9tOiBcImlucHV0XCIsXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXG4gICAgICAgIGxhYmVsOiBcIuS8mOaDoOS7t++8iOWFg++8jOeyvuehruWIsDAuMDHvvIlcIixcbiAgICAgICAgdmFsdWU6IHBhcmFtLnByaWNlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBkb206IFwicmFkaW9cIixcbiAgICAgICAgbGFiZWw6IFwi5piv5ZCm5L2/55So5LyY5oOg5Lu3XCIsXG4gICAgICAgIHZhbHVlOiBwYXJhbS51c2VEaXNjb3VudCxcbiAgICAgICAgcmFkaW9zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IHRydWUsXG4gICAgICAgICAgICBuYW1lOiBcIuaYr1wiXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBuYW1lOiBcIuWQplwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBkb206IFwicmFkaW9cIixcbiAgICAgICAgbGFiZWw6IFwi5piv5ZCm5bGP6JS9XCIsXG4gICAgICAgIHZhbHVlOiBwYXJhbS5pc0VuYWJsZSxcbiAgICAgICAgcmFkaW9zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgbmFtZTogXCLmmK9cIlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IHRydWUsXG4gICAgICAgICAgICBuYW1lOiBcIuWQplwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9XG4gICAgXVxuICB9KTtcbn1cblxuLy8g6YeN5paw6K6h566X5LiA5Liq5ZWG5ZOB55qE5oC75bqT5a2Y5ZKM5oC76ZSA6YePXG53aW5kb3cuY29tcHV0ZVN0b2NrcyA9IGZ1bmN0aW9uKHByb2R1Y3RJZCkge1xuXG59XG5cbi8vIOWtl+espuS4suaVsOWtl+aPkOWPllxud2luZG93LmdldE51bWJlciA9IGZ1bmN0aW9uKHN0ciwgZnJhY3Rpb25EaWdpdHMgPSAwKSB7XG4gIHN0ciA9IHN0ciArIFwiXCI7XG4gIHN0ciA9IHN0ci5yZXBsYWNlKFwi77+lXCIsIFwiXCIpO1xuICBzdHIgPSBwYXJzZUZsb2F0KHN0cik7XG4gIHN0ciA9IHN0ci50b0ZpeGVkKGZyYWN0aW9uRGlnaXRzKTtcbiAgcmV0dXJuIHBhcnNlRmxvYXQoc3RyKTtcbn1cblxuLy8g6I635Y+W6KeE5qC855u45YWz55qEZG9tXG53aW5kb3cuZ2V0UGFyYW1Eb20gPSBmdW5jdGlvbihwcm9kdWN0SWQsIHBhcmFtSWQpIHtcbiAgY29uc3QgZG9tID0gJChgLnBhcmFtW2RhdGEtcHJvZHVjdC1pZD0nJHtwcm9kdWN0SWR9J11bZGF0YS1wYXJhbS1pZD0nJHtwYXJhbUlkfSddYCk7XG4gIGxldCBvcmlnaW5QcmljZSA9IGRvbS5maW5kKFwiLm9yaWdpbi1wcmljZVwiKTtcbiAgbGV0IHByaWNlID0gZG9tLmZpbmQoXCIucHJpY2VcIik7XG4gIGxldCBuYW1lID0gZG9tLmZpbmQoXCIubmFtZVwiKTtcbiAgbGV0IHN0b2Nrc1N1cnBsdXMgPSBkb20uZmluZChcIi5zdG9ja3Mtc3VycGx1c1wiKTtcbiAgcmV0dXJuIHtcbiAgICBkb20sXG4gICAgbmFtZSxcbiAgICBvcmlnaW5QcmljZSxcbiAgICBwcmljZSxcbiAgICBzdG9ja3NTdXJwbHVzXG4gIH1cbn1cblxuLy8g6I635Y+W6KeE5qC85L+h5oGvXG53aW5kb3cuZ2V0UGFyYW0gPSBmdW5jdGlvbihwcm9kdWN0SWQsIHBhcmFtSWQpIHtcbiAgbGV0IHtcbiAgICBkb20sXG4gICAgb3JpZ2luUHJpY2UsXG4gICAgcHJpY2UsXG4gICAgbmFtZSxcbiAgICBzdG9ja3NTdXJwbHVzXG4gIH0gPSBnZXRQYXJhbURvbShwcm9kdWN0SWQsIHBhcmFtSWQpO1xuICBvcmlnaW5QcmljZSA9IGdldE51bWJlcihvcmlnaW5QcmljZS50ZXh0KCksIDIpO1xuICBsZXQgdXNlRGlzY291bnQgPSBmYWxzZTtcbiAgaWYocHJpY2UudGV4dCgpID09PSBcIuaXoFwiKSB7XG4gICAgcHJpY2UgPSBcIlwiO1xuICB9IGVsc2Uge1xuICAgIHByaWNlID0gZ2V0TnVtYmVyKHByaWNlLnRleHQoKSwgMik7XG4gICAgdXNlRGlzY291bnQgPSB0cnVlO1xuICB9XG4gIHN0b2Nrc1N1cnBsdXMgPSBnZXROdW1iZXIoc3RvY2tzU3VycGx1cy50ZXh0KCkpO1xuICBsZXQgaXNFbmFibGUgPSB0cnVlO1xuICBpZihkb20uaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSkgaXNFbmFibGUgPSBmYWxzZTtcbiAgbmFtZSA9IG5hbWUudGV4dCgpO1xuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgaXNFbmFibGUsXG4gICAgdXNlRGlzY291bnQsXG4gICAgb3JpZ2luUHJpY2UsXG4gICAgcHJpY2UsXG4gICAgc3RvY2tzU3VycGx1c1xuICB9XG59XG5cbndpbmRvdy5zZXRQYXJhbSA9IGZ1bmN0aW9uKHByb2R1Y3RJZCwgcGFyYW1JZCwgcGFyYW0pIHtcbiAgY29uc3QgcGFyYW1Eb20gPSBnZXRQYXJhbURvbShwcm9kdWN0SWQsIHBhcmFtSWQpO1xuICBjb25zdCB7XG4gICAgbmFtZSwgXG4gICAgb3JpZ2luUHJpY2UsXG4gICAgcHJpY2UsXG4gICAgdXNlRGlzY291bnQsXG4gICAgc3RvY2tzU3VycGx1cyxcbiAgICBpc0VuYWJsZVxuICB9ID0gcGFyYW07XG5cbiAgY29uc3Qge2NoZWNrU3RyaW5nLCBjaGVja051bWJlcn0gPSBOS0MubWV0aG9kcy5jaGVja0RhdGE7XG5cbiAgUHJvbWlzZS5yZXNvbHZlKClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjaGVja1N0cmluZyhuYW1lLCB7XG4gICAgICAgIG5hbWU6IFwi5ZCN56ewXCIsXG4gICAgICAgIG1pbkxlbmd0aDogMSxcbiAgICAgICAgbWF4TGVuZ3RoOiAxMDBcbiAgICAgIH0pO1xuICAgICAgY2hlY2tOdW1iZXIoc3RvY2tzU3VycGx1cywge1xuICAgICAgICBuYW1lOiBcIuW6k+WtmFwiLFxuICAgICAgICBtaW46IDBcbiAgICAgIH0pLFxuICAgICAgY2hlY2tOdW1iZXIob3JpZ2luUHJpY2UsIHtcbiAgICAgICAgbmFtZTogXCLku7fmoLxcIixcbiAgICAgICAgbWluOiAwLjAxLFxuICAgICAgICBmcmFjdGlvbkRpZ2l0czogMlxuICAgICAgfSk7XG4gICAgICBpZih1c2VEaXNjb3VudCkge1xuICAgICAgICBpZihwcmljZSA+PSBvcmlnaW5QcmljZSkgdGhyb3cgXCLop4TmoLzkvJjmg6Dku7flv4XpobvlsI/kuo7ljp/ku7dcIjtcbiAgICAgICAgY2hlY2tOdW1iZXIocHJpY2UsIHtcbiAgICAgICAgICBuYW1lOiBcIuS8mOaDoOS7t1wiLFxuICAgICAgICAgIG1pbjogMC4wMSxcbiAgICAgICAgICBmcmFjdGlvbkRpZ2l0czogMlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmKGlzRW5hYmxlKSB7XG4gICAgICAgIHBhcmFtRG9tLmRvbS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFyYW1Eb20uZG9tLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICB9XG4gICAgICBwYXJhbURvbS5uYW1lLnRleHQobmFtZSk7XG4gICAgICBwYXJhbURvbS5vcmlnaW5QcmljZS50ZXh0KGDvv6Uke29yaWdpblByaWNlLnRvRml4ZWQoMil9YCk7XG4gICAgICBwYXJhbURvbS5zdG9ja3NTdXJwbHVzLnRleHQoc3RvY2tzU3VycGx1cyk7XG4gICAgICBpZih1c2VEaXNjb3VudCkge1xuICAgICAgICBwYXJhbURvbS5wcmljZS50ZXh0KGDvv6Uke3ByaWNlLnRvRml4ZWQoMil9YCkuYWRkQ2xhc3MoXCJudW1iZXJcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXJhbURvbS5wcmljZS50ZXh0KGDml6BgKS5yZW1vdmVDbGFzcyhcIm51bWJlclwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHByb2R1Y3REb20gPSAkKGAucHJvZHVjdFtkYXRhLXByb2R1Y3QtaWQ9JyR7cHJvZHVjdElkfSddIC5zdG9ja3Mtc3VycGx1c2ApO1xuICAgICAgY29uc3Qgc3RvY2tzRG9tcyA9ICQoYC5wYXJhbVtkYXRhLXByb2R1Y3QtaWQ9JyR7cHJvZHVjdElkfSddIC5zdG9ja3Mtc3VycGx1c2ApO1xuICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgIGZvcihsZXQgaSA9IDAgOyBpIDwgc3RvY2tzRG9tcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBzID0gc3RvY2tzRG9tcy5lcShpKTtcbiAgICAgICAgY291bnQgKz0gZ2V0TnVtYmVyKHMudGV4dCgpKTtcbiAgICAgIH1cbiAgICAgIHByb2R1Y3REb20udGV4dChjb3VudCk7XG4gICAgfSlcbiAgICAuY2F0Y2goc3dlZXRFcnJvcik7XG59XG5cbi8qXG4qIOeri+WNs+S4iuaetlxuKiAqL1xud2luZG93LnNoZWxmTm93ID0gZnVuY3Rpb24ocHJvZHVjdElkKSB7XG4gIHN3ZWV0UXVlc3Rpb24oXCLnoa7orqTopoHkuIrmnrbor6XllYblk4HvvJ9cIilcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICByZXR1cm4gbmtjQVBJKGAvc2hvcC9tYW5hZ2UvJHtOS0MuY29uZmlncy51aWR9L2dvb2RzbGlzdC9zaGVsZlJpZ2h0Tm93YCwgXCJQQVRDSFwiLCB7cHJvZHVjdElkfSk7XG4gICAgfSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBzd2VldFN1Y2Nlc3MoXCLllYblk4Hlt7LkuIrmnrZcIik7XG4gICAgfSlcbiAgICAuY2F0Y2goc3dlZXRFcnJvcik7XG59XG4vKipcbiAqIOWVhuWTgeWBnOWUrlxuICovXG53aW5kb3cuc3RvcFNhbGUgPSBmdW5jdGlvbihwcm9kdWN0SWQpIHtcbiAgc3dlZXRRdWVzdGlvbihcIuehruiupOimgeWBnOWUruivpeWVhuWTge+8n1wiKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHJldHVybiBua2NBUEkoYC9zaG9wL21hbmFnZS8ke05LQy5jb25maWdzLnVpZH0vZ29vZHNsaXN0L3Byb2R1Y3RTdG9wU2FsZWAsIFwiUEFUQ0hcIiwge3Byb2R1Y3RJZH0pO1xuICAgIH0pXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc3dlZXRTdWNjZXNzKFwi5ZWG5ZOB5bey5YGc5ZSuXCIpO1xuICAgIH0pXG4gICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xufVxuXG4vKipcbiAqIOWVhuWTgeWkjeWUrlxuICovXG53aW5kb3cuZ29vblNhbGUgPSBmdW5jdGlvbihwcm9kdWN0SWQpIHtcbiAgc3dlZXRRdWVzdGlvbihcIuehruiupOimgeWkjeWUruivpeWVhuWTge+8n1wiKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHJldHVybiBua2NBUEkoYC9zaG9wL21hbmFnZS8ke05LQy5jb25maWdzLnVpZH0vZ29vZHNsaXN0L3Byb2R1Y3RHb29uU2FsZWAsIFwiUEFUQ0hcIiwge3Byb2R1Y3RJZH0pO1xuICAgIH0pXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc3dlZXRTdWNjZXNzKFwi5ZWG5ZOB5bey5aSN5ZSuXCIpO1xuICAgIH0pXG4gICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xufSJdfQ==
