(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var CommonModal = new NKC.modules.CommonModal();
var Ship = new NKC.modules.ShopShip();
var ModifyPrice = new NKC.modules.ShopModifyPrice();
var Transfer = new NKC.modules.Transfer();

window.transfer = function (tUid) {
  Transfer.open(function () {}, tUid);
}; // 修改卖家备注


window.modifySellMessage = function (uid, orderId) {
  var dom = $("tr[data-order-id='".concat(orderId, "'] .data-sell-message"));
  CommonModal.open(function (data) {
    var value = data[0].value;
    nkcAPI('/shop/manage/' + uid + '/order/editSellMessage', "PATCH", {
      sellMessage: value,
      orderId: orderId
    }).then(function () {
      dom.text(value);
      CommonModal.close();
      sweetSuccess("保存成功");
    })["catch"](sweetWarning);
  }, {
    title: "修改备注",
    data: [{
      value: dom.text(),
      dom: "textarea"
    }]
  });
}; // 获取金额 转换成数字且去掉￥


window.getNumber = function (str) {
  var fractionDigits = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  str = str + "";
  str = str.replace("￥", "");
  str = parseFloat(str);
  str = str.toFixed(fractionDigits);
  return parseFloat(str);
}; // 重新计算订单总价


window.computeOrderPrice = function (orderId) {
  var orderDom = $("tr[data-order-id='".concat(orderId, "']"));
  var paramPriceDom = orderDom.find(".data-param-price");
  var countDom = orderDom.find(".data-param-count");
  var freightDom = orderDom.find(".data-params-freight");
  var prices = [];
  var counts = [];

  for (var i = 0; i < paramPriceDom.length; i++) {
    var dom = paramPriceDom.eq(i);
    prices.push(getNumber(dom.text(), 2));
  }

  for (var _i = 0; _i < countDom.length; _i++) {
    var _dom = countDom.eq(_i);

    counts.push(getNumber(_dom.text(), 0));
  }

  if (prices.length !== counts.length) return sweetError("订单页面错误，请刷新页面");
  var totalPrice = 0;

  for (var _i2 = 0; _i2 < prices.length; _i2++) {
    totalPrice += prices[_i2] * counts[_i2];
  }

  var freight = getNumber(freightDom.text(), 2);
  orderDom.find(".data-params-price").text("\uFFE5".concat(totalPrice.toFixed(2)));
  orderDom.find(".data-order-price").text("\uFFE5".concat((totalPrice + freight).toFixed(2)));
  return {
    paramsPrice: totalPrice,
    freightPrice: freight,
    orderPrice: totalPrice + freight
  };
}; // 修改商品单价


window.modifyParamPrice = function (sellUid, orderId, costId) {
  var priceDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-price"));
  var countDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-count"));
  var freightDom = $("tr[data-order-id='".concat(orderId, "'] .data-params-freight"));
  var freightPrice = getNumber(freightDom.text(), 2);
  var price = getNumber(priceDom.text(), 2);
  var count = getNumber(countDom.text(), 0);
  return ModifyPrice.open(function (data) {
    var newPrice = data;
    var checkNumber = NKC.methods.checkData.checkNumber;
    Promise.resolve().then(function () {
      checkNumber(newPrice, {
        name: "商品单价",
        min: 0.01,
        fractionDigits: 2
      });
      return nkcAPI("/shop/manage/".concat(sellUid, "/order/editCostRecord"), "PATCH", {
        type: "modifyParam",
        costId: costId,
        orderId: orderId,
        freightPrice: freightPrice * 100,
        costObj: {
          singlePrice: newPrice * 100,
          count: count
        }
      });
    }).then(function () {
      priceDom.text("\uFFE5".concat(newPrice.toFixed(2)));
      computeOrderPrice(orderId);
      CommonModal.close();
    })["catch"](sweetError);
  }, price);
}; // 修改商品数量


window.modifyParamCount = function (sellUid, orderId, costId) {
  var countDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-count"));
  var priceDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-price"));
  var freightDom = $("tr[data-order-id='".concat(orderId, "'] .data-params-freight"));
  var freightPrice = getNumber(freightDom.text(), 2);
  var price = getNumber(priceDom.text(), 2);
  var count = getNumber(countDom.text(), 0);
  CommonModal.open(function (data) {
    var newCount = getNumber(data[0].value, 2);
    Promise.resolve().then(function () {
      NKC.methods.checkData.checkNumber(newCount, {
        name: "商品数量",
        min: 1
      });
      return nkcAPI("/shop/manage/".concat(sellUid, "/order/editCostRecord"), "PATCH", {
        type: "modifyParam",
        costId: costId,
        orderId: orderId,
        freightPrice: freightPrice * 100,
        costObj: {
          singlePrice: price * 100,
          count: newCount
        }
      });
    }).then(function () {
      countDom.text("".concat(newCount));
      computeOrderPrice(orderId);
      CommonModal.close();
    })["catch"](sweetError);
  }, {
    title: "修改数量",
    data: [{
      dom: "input",
      value: count
    }]
  });
}; // 修改运费


window.modifyFreight = function (sellUid, orderId) {
  var freightDom = $("tr[data-order-id='".concat(orderId, "'] .data-params-freight"));
  var freightPrice = getNumber(freightDom.text(), 2);
  return ModifyPrice.open(function (data) {
    var newFreightPrice = data;
    Promise.resolve().then(function () {
      NKC.methods.checkData.checkNumber(newFreightPrice, {
        name: "运费",
        min: 0,
        fractionDigits: 2
      });
      return nkcAPI("/shop/manage/".concat(sellUid, "/order/editCostRecord"), "PATCH", {
        type: "modifyFreight",
        orderId: orderId,
        freightPrice: newFreightPrice * 100
      });
    }).then(function () {
      freightDom.text("\uFFE5".concat(newFreightPrice.toFixed(2)));
      computeOrderPrice(orderId);
      CommonModal.close();
    })["catch"](sweetError);
  }, freightPrice);
}; // 发货/修改物流信息


window.ship = function (orderId) {
  Ship.open(function () {}, {
    orderId: orderId
  });
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwYWdlcy9zaG9wL21hbmFnZS9vcmRlci9vcmRlci5tanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLElBQU0sV0FBVyxHQUFHLElBQUksR0FBRyxDQUFDLE9BQUosQ0FBWSxXQUFoQixFQUFwQjtBQUNBLElBQU0sSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFoQixFQUFiO0FBQ0EsSUFBTSxXQUFXLEdBQUcsSUFBSSxHQUFHLENBQUMsT0FBSixDQUFZLGVBQWhCLEVBQXBCO0FBQ0EsSUFBTSxRQUFRLEdBQUcsSUFBSSxHQUFHLENBQUMsT0FBSixDQUFZLFFBQWhCLEVBQWpCOztBQUNBLE1BQU0sQ0FBQyxRQUFQLEdBQWtCLFVBQVMsSUFBVCxFQUFlO0FBQy9CLEVBQUEsUUFBUSxDQUFDLElBQVQsQ0FBYyxZQUFXLENBRXhCLENBRkQsRUFFRyxJQUZIO0FBR0QsQ0FKRCxDLENBS0E7OztBQUNBLE1BQU0sQ0FBQyxpQkFBUCxHQUEyQixVQUFTLEdBQVQsRUFBYyxPQUFkLEVBQXVCO0FBQ2hELE1BQU0sR0FBRyxHQUFHLENBQUMsNkJBQXNCLE9BQXRCLDJCQUFiO0FBQ0EsRUFBQSxXQUFXLENBQUMsSUFBWixDQUFpQixVQUFDLElBQUQsRUFBVTtBQUN6QixRQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBRCxDQUFKLENBQVEsS0FBdEI7QUFDQSxJQUFBLE1BQU0sQ0FBQyxrQkFBZ0IsR0FBaEIsR0FBb0Isd0JBQXJCLEVBQStDLE9BQS9DLEVBQXdEO0FBQUMsTUFBQSxXQUFXLEVBQUUsS0FBZDtBQUFxQixNQUFBLE9BQU8sRUFBRTtBQUE5QixLQUF4RCxDQUFOLENBQ0csSUFESCxDQUNRLFlBQVc7QUFDZixNQUFBLEdBQUcsQ0FBQyxJQUFKLENBQVMsS0FBVDtBQUNBLE1BQUEsV0FBVyxDQUFDLEtBQVo7QUFDQSxNQUFBLFlBQVksQ0FBQyxN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QUFHLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBWCxFQUFELEVBQW9CLENBQXBCLENBQTlCO0FBQ0EsU0FBTyxXQUFXLENBQUMsSUFBWixDQUFpQixVQUFBLElBQUksRUFBSTtBQUM5QixRQUFNLGVBQWUsR0FBRyxJQUF4QjtBQUNBLElBQUEsT0FBTyxDQUFDLE9BQVIsR0FDRyxJQURILENBQ1EsWUFBTTtBQUNWLE1BQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxTQUFaLENBQXNCLFdBQXRCLENBQWtDLGVBQWxDLEVBQW1EO0FBQ2pELFFBQUEsSUFBSSxFQUFFLElBRDJDO0FBRWpELFFBQUEsR0FBRyxFQUFFLENBRjRDO0FBR2pELFFBQUEsY0FBYyxFQUFFO0FBSGlDLE9BQW5EO0FBS0EsYUFBTyxNQUFNLHdCQUFpQixPQUFqQiw0QkFBaUQsT0FBakQsRUFBMEQ7QUFDckUsUUFBQSxJQUFJLEVBQUUsZUFEK0Q7QUFFckUsUUFBQSxPQUFPLEVBQVAsT0FGcUU7QUFHckUsUUFBQSxZQUFZLEVBQUUsZUFBZSxHQUFHO0FBSHFDLE9BQTFELENBQWI7QUFLRCxLQVpILEVBYUcsSUFiSCxDQWFRLFlBQU07QUFDVixNQUFBLFVBQVUsQ0FBQyxJQUFYLGlCQUFvQixlQUFlLENBQUMsT0FBaEIsQ0FBd0IsQ0FBeEIsQ0FBcEI7QUFDQSxNQUFBLGlCQUFpQixDQUFDLE9BQUQsQ0FBakI7QUFDQSxNQUFBLFdBQVcsQ0FBQyxLQUFaO0FBQ0QsS0FqQkgsV0FrQlMsVUFsQlQ7QUFtQkQsR0FyQk0sRUFxQkosWUFyQkksQ0FBUDtBQXNCRCxDQXpCRCxDLENBMEJBOzs7QUFDQSxNQUFNLENBQUMsSUFBUCxHQUFjLFVBQVMsT0FBVCxFQUFrQjtBQUM5QixFQUFBLElBQUksQ0FBQyxJQUFMLENBQVUsWUFBTSxDQUVmLENBRkQsRUFFRztBQUNELElBQUEsT0FBTyxFQUFQO0FBREMsR0FGSDtBQUtELENBTkQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjb25zdCBDb21tb25Nb2RhbCA9IG5ldyBOS0MubW9kdWxlcy5Db21tb25Nb2RhbCgpO1xyXG5jb25zdCBTaGlwID0gbmV3IE5LQy5tb2R1bGVzLlNob3BTaGlwKCk7XHJcbmNvbnN0IE1vZGlmeVByaWNlID0gbmV3IE5LQy5tb2R1bGVzLlNob3BNb2RpZnlQcmljZSgpO1xyXG5jb25zdCBUcmFuc2ZlciA9IG5ldyBOS0MubW9kdWxlcy5UcmFuc2ZlcigpO1xyXG53aW5kb3cudHJhbnNmZXIgPSBmdW5jdGlvbih0VWlkKSB7XHJcbiAgVHJhbnNmZXIub3BlbihmdW5jdGlvbigpIHtcclxuXHJcbiAgfSwgdFVpZCk7XHJcbn1cclxuLy8g5L+u5pS55Y2W5a625aSH5rOoXHJcbndpbmRvdy5tb2RpZnlTZWxsTWVzc2FnZSA9IGZ1bmN0aW9uKHVpZCwgb3JkZXJJZCkge1xyXG4gIGNvbnN0IGRvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXSAuZGF0YS1zZWxsLW1lc3NhZ2VgKTtcclxuICBDb21tb25Nb2RhbC5vcGVuKChkYXRhKSA9PiB7XHJcbiAgICBjb25zdCB2YWx1ZSA9IGRhdGFbMF0udmFsdWU7XHJcbiAgICBua2NBUEkoJy9zaG9wL21hbmFnZS8nK3VpZCsnL29yZGVyL2VkaXRTZWxsTWVzc2FnZScsIFwiUEFUQ0hcIiwge3NlbGxNZXNzYWdlOiB2YWx1ZSwgb3JkZXJJZDogb3JkZXJJZH0pXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRvbS50ZXh0KHZhbHVlKTtcclxuICAgICAgICBDb21tb25Nb2RhbC5jbG9zZSgpO1xyXG4gICAgICAgIHN3ZWV0U3VjY2VzcyhcIuS/neWtmOaIkOWKn1wiKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKHN3ZWV0V2FybmluZylcclxuICB9LCB7XHJcbiAgICB0aXRsZTogXCLkv67mlLnlpIfms6hcIixcclxuICAgIGRhdGE6IFtcclxuICAgICAge1xyXG4gICAgICAgIHZhbHVlOiBkb20udGV4dCgpLFxyXG4gICAgICAgIGRvbTogXCJ0ZXh0YXJlYVwiXHJcbiAgICAgIH1cclxuICAgIF1cclxuICB9KVxyXG59XHJcbi8vIOiOt+WPlumHkeminSDovazmjaLmiJDmlbDlrZfkuJTljrvmjonvv6Vcclxud2luZG93LmdldE51bWJlciA9IGZ1bmN0aW9uKHN0ciwgZnJhY3Rpb25EaWdpdHMgPSAwKSB7XHJcbiAgc3RyID0gc3RyICsgXCJcIjtcclxuICBzdHIgPSBzdHIucmVwbGFjZShcIu+/pVwiLCBcIlwiKTtcclxuICBzdHIgPSBwYXJzZUZsb2F0KHN0cik7XHJcbiAgc3RyID0gc3RyLnRvRml4ZWQoZnJhY3Rpb25EaWdpdHMpO1xyXG4gIHJldHVybiBwYXJzZUZsb2F0KHN0cik7XHJcbn1cclxuLy8g6YeN5paw6K6h566X6K6i5Y2V5oC75Lu3XHJcbndpbmRvdy5jb21wdXRlT3JkZXJQcmljZSA9IGZ1bmN0aW9uKG9yZGVySWQpIHtcclxuICBjb25zdCBvcmRlckRvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXWApO1xyXG4gIGNvbnN0IHBhcmFtUHJpY2VEb20gPSBvcmRlckRvbS5maW5kKFwiLmRhdGEtcGFyYW0tcHJpY2VcIik7XHJcbiAgY29uc3QgY291bnREb20gPSBvcmRlckRvbS5maW5kKFwiLmRhdGEtcGFyYW0tY291bnRcIik7XHJcbiAgY29uc3QgZnJlaWdodERvbSA9IG9yZGVyRG9tLmZpbmQoXCIuZGF0YS1wYXJhbXMtZnJlaWdodFwiKTtcclxuICBjb25zdCBwcmljZXMgPSBbXTtcclxuICBjb25zdCBjb3VudHMgPSBbXTtcclxuICBmb3IobGV0IGkgPSAwOyBpIDwgcGFyYW1QcmljZURvbS5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3QgZG9tID0gcGFyYW1QcmljZURvbS5lcShpKTtcclxuICAgIHByaWNlcy5wdXNoKGdldE51bWJlcihkb20udGV4dCgpLCAyKSk7XHJcbiAgfVxyXG4gIGZvcihsZXQgaSA9IDA7IGkgPCBjb3VudERvbS5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3QgZG9tID0gY291bnREb20uZXEoaSk7XHJcbiAgICBjb3VudHMucHVzaChnZXROdW1iZXIoZG9tLnRleHQoKSwgMCkpO1xyXG4gIH1cclxuICBpZihwcmljZXMubGVuZ3RoICE9PSBjb3VudHMubGVuZ3RoKSByZXR1cm4gc3dlZXRFcnJvcihcIuiuouWNlemhtemdoumUmeivr++8jOivt+WIt+aWsOmhtemdolwiKTtcclxuICBsZXQgdG90YWxQcmljZSA9IDA7XHJcbiAgZm9yKGxldCBpID0gMDsgaSA8IHByaWNlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgdG90YWxQcmljZSArPSBwcmljZXNbaV0gKiBjb3VudHNbaV07XHJcbiAgfVxyXG4gIGNvbnN0IGZyZWlnaHQgPSBnZXROdW1iZXIoZnJlaWdodERvbS50ZXh0KCksIDIpO1xyXG4gIG9yZGVyRG9tLmZpbmQoYC5kYXRhLXBhcmFtcy1wcmljZWApLnRleHQoYO+/pSR7dG90YWxQcmljZS50b0ZpeGVkKDIpfWApO1xyXG4gIG9yZGVyRG9tLmZpbmQoYC5kYXRhLW9yZGVyLXByaWNlYCkudGV4dChg77+lJHsodG90YWxQcmljZSArIGZyZWlnaHQpLnRvRml4ZWQoMil9YCk7XHJcbiAgcmV0dXJuIHtcclxuICAgIHBhcmFtc1ByaWNlOiB0b3RhbFByaWNlLFxyXG4gICAgZnJlaWdodFByaWNlOiBmcmVpZ2h0LFxyXG4gICAgb3JkZXJQcmljZTogdG90YWxQcmljZSArIGZyZWlnaHRcclxuICB9XHJcbn1cclxuXHJcblxyXG4vLyDkv67mlLnllYblk4HljZXku7dcclxud2luZG93Lm1vZGlmeVBhcmFtUHJpY2UgPSBmdW5jdGlvbihzZWxsVWlkLCBvcmRlcklkLCBjb3N0SWQpIHtcclxuICBjb25zdCBwcmljZURvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXVtkYXRhLW9yZGVyLXBhcmFtLWlkPScke2Nvc3RJZH0nXSAuZGF0YS1wYXJhbS1wcmljZWApO1xyXG4gIGNvbnN0IGNvdW50RG9tID0gJChgdHJbZGF0YS1vcmRlci1pZD0nJHtvcmRlcklkfSddW2RhdGEtb3JkZXItcGFyYW0taWQ9JyR7Y29zdElkfSddIC5kYXRhLXBhcmFtLWNvdW50YCk7XHJcbiAgY29uc3QgZnJlaWdodERvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXSAuZGF0YS1wYXJhbXMtZnJlaWdodGApO1xyXG4gIGNvbnN0IGZyZWlnaHRQcmljZSA9IGdldE51bWJlcihmcmVpZ2h0RG9tLnRleHQoKSwgMik7XHJcbiAgY29uc3QgcHJpY2UgPSBnZXROdW1iZXIocHJpY2VEb20udGV4dCgpLCAyKTtcclxuICBjb25zdCBjb3VudCA9IGdldE51bWJlcihjb3VudERvbS50ZXh0KCksIDApO1xyXG4gIHJldHVybiBNb2RpZnlQcmljZS5vcGVuKGRhdGEgPT4ge1xyXG4gICAgY29uc3QgbmV3UHJpY2UgPSBkYXRhO1xyXG4gICAgY29uc3QgY2hlY2tOdW1iZXIgPSBOS0MubWV0aG9kcy5jaGVja0RhdGEuY2hlY2tOdW1iZXI7XHJcbiAgICBQcm9taXNlLnJlc29sdmUoKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgY2hlY2tOdW1iZXIobmV3UHJpY2UsIHtcclxuICAgICAgICAgIG5hbWU6IFwi5ZWG5ZOB5Y2V5Lu3XCIsXHJcbiAgICAgICAgICBtaW46IDAuMDEsXHJcbiAgICAgICAgICBmcmFjdGlvbkRpZ2l0czogMlxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBua2NBUEkoYC9zaG9wL21hbmFnZS8ke3NlbGxVaWR9L29yZGVyL2VkaXRDb3N0UmVjb3JkYCwgXCJQQVRDSFwiLCB7XHJcbiAgICAgICAgICB0eXBlOiBcIm1vZGlmeVBhcmFtXCIsXHJcbiAgICAgICAgICBjb3N0SWQsXHJcbiAgICAgICAgICBvcmRlcklkLFxyXG4gICAgICAgICAgZnJlaWdodFByaWNlOiBmcmVpZ2h0UHJpY2UgKiAxMDAsXHJcbiAgICAgICAgICBjb3N0T2JqOiB7XHJcbiAgICAgICAgICAgIHNpbmdsZVByaWNlOiBuZXdQcmljZSAqIDEwMCxcclxuICAgICAgICAgICAgY291bnRcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgcHJpY2VEb20udGV4dChg77+lJHtuZXdQcmljZS50b0ZpeGVkKDIpfWApO1xyXG4gICAgICAgIGNvbXB1dGVPcmRlclByaWNlKG9yZGVySWQpO1xyXG4gICAgICAgIENvbW1vbk1vZGFsLmNsb3NlKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChzd2VldEVycm9yKTtcclxuICB9LCBwcmljZSlcclxufVxyXG5cclxuLy8g5L+u5pS55ZWG5ZOB5pWw6YePXHJcbndpbmRvdy5tb2RpZnlQYXJhbUNvdW50ID0gZnVuY3Rpb24oc2VsbFVpZCwgb3JkZXJJZCwgY29zdElkKSB7XHJcbiAgY29uc3QgY291bnREb20gPSAkKGB0cltkYXRhLW9yZGVyLWlkPScke29yZGVySWR9J11bZGF0YS1vcmRlci1wYXJhbS1pZD0nJHtjb3N0SWR9J10gLmRhdGEtcGFyYW0tY291bnRgKTtcclxuICBjb25zdCBwcmljZURvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXVtkYXRhLW9yZGVyLXBhcmFtLWlkPScke2Nvc3RJZH0nXSAuZGF0YS1wYXJhbS1wcmljZWApO1xyXG4gIGNvbnN0IGZyZWlnaHREb20gPSAkKGB0cltkYXRhLW9yZGVyLWlkPScke29yZGVySWR9J10gLmRhdGEtcGFyYW1zLWZyZWlnaHRgKTtcclxuICBjb25zdCBmcmVpZ2h0UHJpY2UgPSBnZXROdW1iZXIoZnJlaWdodERvbS50ZXh0KCksIDIpO1xyXG4gIGNvbnN0IHByaWNlID0gZ2V0TnVtYmVyKHByaWNlRG9tLnRleHQoKSwgMik7XHJcbiAgY29uc3QgY291bnQgPSBnZXROdW1iZXIoY291bnREb20udGV4dCgpLCAwKTtcclxuICBDb21tb25Nb2RhbC5vcGVuKChkYXRhKSA9PiB7XHJcbiAgICBjb25zdCBuZXdDb3VudCA9IGdldE51bWJlcihkYXRhWzBdLnZhbHVlLCAyKTtcclxuICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBOS0MubWV0aG9kcy5jaGVja0RhdGEuY2hlY2tOdW1iZXIobmV3Q291bnQsIHtcclxuICAgICAgICAgIG5hbWU6IFwi5ZWG5ZOB5pWw6YePXCIsXHJcbiAgICAgICAgICBtaW46IDFcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gbmtjQVBJKGAvc2hvcC9tYW5hZ2UvJHtzZWxsVWlkfS9vcmRlci9lZGl0Q29zdFJlY29yZGAsIFwiUEFUQ0hcIiwge1xyXG4gICAgICAgICAgdHlwZTogXCJtb2RpZnlQYXJhbVwiLFxyXG4gICAgICAgICAgY29zdElkLFxyXG4gICAgICAgICAgb3JkZXJJZCxcclxuICAgICAgICAgIGZyZWlnaHRQcmljZTogZnJlaWdodFByaWNlICogMTAwLFxyXG4gICAgICAgICAgY29zdE9iajoge1xyXG4gICAgICAgICAgICBzaW5nbGVQcmljZTogcHJpY2UgKiAxMDAsXHJcbiAgICAgICAgICAgIGNvdW50OiBuZXdDb3VudFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICBcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNvdW50RG9tLnRleHQoYCR7bmV3Q291bnR9YCk7XHJcbiAgICAgICAgY29tcHV0ZU9yZGVyUHJpY2Uob3JkZXJJZCk7XHJcbiAgICAgICAgQ29tbW9uTW9kYWwuY2xvc2UoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xyXG4gIH0sIHtcclxuICAgIHRpdGxlOiBcIuS/ruaUueaVsOmHj1wiLFxyXG4gICAgZGF0YTogW1xyXG4gICAgICB7XHJcbiAgICAgICAgZG9tOiBcImlucHV0XCIsXHJcbiAgICAgICAgdmFsdWU6IGNvdW50XHJcbiAgICAgIH1cclxuICAgIF1cclxuICB9KTtcclxufVxyXG5cclxuLy8g5L+u5pS56L+Q6LS5XHJcbndpbmRvdy5tb2RpZnlGcmVpZ2h0ID0gZnVuY3Rpb24oc2VsbFVpZCwgb3JkZXJJZCkge1xyXG4gIGNvbnN0IGZyZWlnaHREb20gPSAkKGB0cltkYXRhLW9yZGVyLWlkPScke29yZGVySWR9J10gLmRhdGEtcGFyYW1zLWZyZWlnaHRgKTtcclxuICBjb25zdCBmcmVpZ2h0UHJpY2UgPSBnZXROdW1iZXIoZnJlaWdodERvbS50ZXh0KCksIDIpO1xyXG4gIHJldHVybiBNb2RpZnlQcmljZS5vcGVuKGRhdGEgPT4ge1xyXG4gICAgY29uc3QgbmV3RnJlaWdodFByaWNlID0gZGF0YTtcclxuICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBOS0MubWV0aG9kcy5jaGVja0RhdGEuY2hlY2tOdW1iZXIobmV3RnJlaWdodFByaWNlLCB7XHJcbiAgICAgICAgICBuYW1lOiBcIui/kOi0uVwiLFxyXG4gICAgICAgICAgbWluOiAwLFxyXG4gICAgICAgICAgZnJhY3Rpb25EaWdpdHM6IDJcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gbmtjQVBJKGAvc2hvcC9tYW5hZ2UvJHtzZWxsVWlkfS9vcmRlci9lZGl0Q29zdFJlY29yZGAsIFwiUEFUQ0hcIiwge1xyXG4gICAgICAgICAgdHlwZTogXCJtb2RpZnlGcmVpZ2h0XCIsXHJcbiAgICAgICAgICBvcmRlcklkLFxyXG4gICAgICAgICAgZnJlaWdodFByaWNlOiBuZXdGcmVpZ2h0UHJpY2UgKiAxMDAsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBmcmVpZ2h0RG9tLnRleHQoYO+/pSR7bmV3RnJlaWdodFByaWNlLnRvRml4ZWQoMil9YCk7XHJcbiAgICAgICAgY29tcHV0ZU9yZGVyUHJpY2Uob3JkZXJJZCk7XHJcbiAgICAgICAgQ29tbW9uTW9kYWwuY2xvc2UoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xyXG4gIH0sIGZyZWlnaHRQcmljZSk7XHJcbn1cclxuLy8g5Y+R6LSnL+S/ruaUueeJqea1geS/oeaBr1xyXG53aW5kb3cuc2hpcCA9IGZ1bmN0aW9uKG9yZGVySWQpIHtcclxuICBTaGlwLm9wZW4oKCkgPT4ge1xyXG4gIFxyXG4gIH0sIHtcclxuICAgIG9yZGVySWRcclxuICB9KVxyXG59Il19
