(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var CommonModal = new NKC.modules.CommonModal();
var Ship = new NKC.modules.ShopShip();
var ModifyPrice = new NKC.modules.ShopModifyPrice();
var Transfer = new NKC.modules.Transfer();

window.transfer = function (tUid) {
  Transfer.open(function () {}, tUid);
}; // 修改卖家备注


window.modifySellMessage = function (uid, orderId) {
  var dom = $("tr[data-order-id='".concat(orderId, "'] .data-sell-message"));
  CommonModal.open(function (data) {
    var value = data[0].value;
    nkcAPI('/shop/manage/' + uid + '/order/editSellMessage', "PATCH", {
      sellMessage: value,
      orderId: orderId
    }).then(function () {
      dom.text(value);
      CommonModal.close();
      sweetSuccess("保存成功");
    })["catch"](sweetWarning);
  }, {
    title: "修改备注",
    data: [{
      value: dom.text(),
      dom: "textarea"
    }]
  });
}; // 获取金额 转换成数字且去掉￥


window.getNumber = function (str) {
  var fractionDigits = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  str = str + "";
  str = str.replace("￥", "");
  str = parseFloat(str);
  str = str.toFixed(fractionDigits);
  return parseFloat(str);
}; // 重新计算订单总价


window.computeOrderPrice = function (orderId) {
  var orderDom = $("tr[data-order-id='".concat(orderId, "']"));
  var paramPriceDom = orderDom.find(".data-param-price");
  var countDom = orderDom.find(".data-param-count");
  var freightDom = orderDom.find(".data-params-freight");
  var prices = [];
  var counts = [];

  for (var i = 0; i < paramPriceDom.length; i++) {
    var dom = paramPriceDom.eq(i);
    prices.push(getNumber(dom.text(), 2));
  }

  for (var _i = 0; _i < countDom.length; _i++) {
    var _dom = countDom.eq(_i);

    counts.push(getNumber(_dom.text(), 0));
  }

  if (prices.length !== counts.length) return sweetError("订单页面错误，请刷新页面");
  var totalPrice = 0;

  for (var _i2 = 0; _i2 < prices.length; _i2++) {
    totalPrice += prices[_i2] * counts[_i2];
  }

  var freight = getNumber(freightDom.text(), 2);
  orderDom.find(".data-params-price").text("\uFFE5".concat(totalPrice.toFixed(2)));
  orderDom.find(".data-order-price").text("\uFFE5".concat((totalPrice + freight).toFixed(2)));
  return {
    paramsPrice: totalPrice,
    freightPrice: freight,
    orderPrice: totalPrice + freight
  };
}; // 修改商品单价


window.modifyParamPrice = function (sellUid, orderId, costId) {
  var priceDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-price"));
  var countDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-count"));
  var freightDom = $("tr[data-order-id='".concat(orderId, "'] .data-params-freight"));
  var freightPrice = getNumber(freightDom.text(), 2);
  var price = getNumber(priceDom.text(), 2);
  var count = getNumber(countDom.text(), 0);
  return ModifyPrice.open(function (data) {
    var newPrice = data;
    var checkNumber = NKC.methods.checkData.checkNumber;
    Promise.resolve().then(function () {
      checkNumber(newPrice, {
        name: "商品单价",
        min: 0.01,
        fractionDigits: 2
      });
      return nkcAPI("/shop/manage/".concat(sellUid, "/order/editCostRecord"), "PATCH", {
        type: "modifyParam",
        costId: costId,
        orderId: orderId,
        freightPrice: freightPrice * 100,
        costObj: {
          singlePrice: newPrice * 100,
          count: count
        }
      });
    }).then(function () {
      priceDom.text("\uFFE5".concat(newPrice.toFixed(2)));
      computeOrderPrice(orderId);
      CommonModal.close();
    })["catch"](sweetError);
  }, price);
}; // 修改商品数量


window.modifyParamCount = function (sellUid, orderId, costId) {
  var countDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-count"));
  var priceDom = $("tr[data-order-id='".concat(orderId, "'][data-order-param-id='").concat(costId, "'] .data-param-price"));
  var freightDom = $("tr[data-order-id='".concat(orderId, "'] .data-params-freight"));
  var freightPrice = getNumber(freightDom.text(), 2);
  var price = getNumber(priceDom.text(), 2);
  var count = getNumber(countDom.text(), 0);
  CommonModal.open(function (data) {
    var newCount = getNumber(data[0].value, 2);
    Promise.resolve().then(function () {
      NKC.methods.checkData.checkNumber(newCount, {
        name: "商品数量",
        min: 1
      });
      return nkcAPI("/shop/manage/".concat(sellUid, "/order/editCostRecord"), "PATCH", {
        type: "modifyParam",
        costId: costId,
        orderId: orderId,
        freightPrice: freightPrice * 100,
        costObj: {
          singlePrice: price * 100,
          count: newCount
        }
      });
    }).then(function () {
      countDom.text("".concat(newCount));
      computeOrderPrice(orderId);
      CommonModal.close();
    })["catch"](sweetError);
  }, {
    title: "修改数量",
    data: [{
      dom: "input",
      value: count
    }]
  });
}; // 修改运费


window.modifyFreight = function (sellUid, orderId) {
  var freightDom = $("tr[data-order-id='".concat(orderId, "'] .data-params-freight"));
  var freightPrice = getNumber(freightDom.text(), 2);
  return ModifyPrice.open(function (data) {
    var newFreightPrice = data;
    Promise.resolve().then(function () {
      NKC.methods.checkData.checkNumber(newFreightPrice, {
        name: "运费",
        min: 0,
        fractionDigits: 2
      });
      return nkcAPI("/shop/manage/".concat(sellUid, "/order/editCostRecord"), "PATCH", {
        type: "modifyFreight",
        orderId: orderId,
        freightPrice: newFreightPrice * 100
      });
    }).then(function () {
      freightDom.text("\uFFE5".concat(newFreightPrice.toFixed(2)));
      computeOrderPrice(orderId);
      CommonModal.close();
    })["catch"](sweetError);
  }, freightPrice);
}; // 发货/修改物流信息


window.ship = function (orderId) {
  Ship.open(function () {}, {
    orderId: orderId
  });
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL3Nob3AvbWFuYWdlL29yZGVyL29yZGVyLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBTSxXQUFXLEdBQUcsSUFBSSxHQUFHLENBQUMsT0FBSixDQUFZLFdBQWhCLEVBQXBCO0FBQ0EsSUFBTSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsT0FBSixDQUFZLFFBQWhCLEVBQWI7QUFDQSxJQUFNLFdBQVcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFKLENBQVksZUFBaEIsRUFBcEI7QUFDQSxJQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFBaEIsRUFBakI7O0FBQ0EsTUFBTSxDQUFDLFFBQVAsR0FBa0IsVUFBUyxJQUFULEVBQWU7QUFDL0IsRUFBQSxRQUFRLENBQUMsSUFBVCxDQUFjLFlBQVcsQ0FFeEIsQ0FGRCxFQUVHLElBRkg7QUFHRCxDQUpELEMsQ0FLQTs7O0FBQ0EsTUFBTSxDQUFDLGlCQUFQLEdBQTJCLFVBQVMsR0FBVCxFQUFjLE9BQWQsRUFBdUI7QUFDaEQsTUFBTSxHQUFHLEdBQUcsQ0FBQyw2QkFBc0IsT0FBdEIsMkJBQWI7QUFDQSxFQUFBLFdBQVcsQ0FBQyxJQUFaLENBQWlCLFVBQUMsSUFBRCxFQUFVO0FBQ3pCLFFBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUSxLQUF0QjtBQUNBLElBQUEsTUFBTSxDQUFDLGtCQUFnQixHQUFoQixHQUFvQix3QkFBckIsRUFBK0MsT0FBL0MsRUFBd0Q7QUFBQyxNQUFBLFdBQVcsRUFBRSxLQUFkO0FBQXFCLE1BQUEsT0FBTyxFQUFFO0FBQTlCLEtBQXhELENBQU4sQ0FDRyxJQURILENBQ1EsWUFBVztBQUNmLE1BQUEsR0FBRyxDQUFDLElBQUosQ0FBUyxLQUFUO0FBQ0EsTUFBQSxXQUFXLENBQUMsS0FBWjtB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bnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IENvbW1vbk1vZGFsID0gbmV3IE5LQy5tb2R1bGVzLkNvbW1vbk1vZGFsKCk7XG5jb25zdCBTaGlwID0gbmV3IE5LQy5tb2R1bGVzLlNob3BTaGlwKCk7XG5jb25zdCBNb2RpZnlQcmljZSA9IG5ldyBOS0MubW9kdWxlcy5TaG9wTW9kaWZ5UHJpY2UoKTtcbmNvbnN0IFRyYW5zZmVyID0gbmV3IE5LQy5tb2R1bGVzLlRyYW5zZmVyKCk7XG53aW5kb3cudHJhbnNmZXIgPSBmdW5jdGlvbih0VWlkKSB7XG4gIFRyYW5zZmVyLm9wZW4oZnVuY3Rpb24oKSB7XG5cbiAgfSwgdFVpZCk7XG59XG4vLyDkv67mlLnljZblrrblpIfms6hcbndpbmRvdy5tb2RpZnlTZWxsTWVzc2FnZSA9IGZ1bmN0aW9uKHVpZCwgb3JkZXJJZCkge1xuICBjb25zdCBkb20gPSAkKGB0cltkYXRhLW9yZGVyLWlkPScke29yZGVySWR9J10gLmRhdGEtc2VsbC1tZXNzYWdlYCk7XG4gIENvbW1vbk1vZGFsLm9wZW4oKGRhdGEpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IGRhdGFbMF0udmFsdWU7XG4gICAgbmtjQVBJKCcvc2hvcC9tYW5hZ2UvJyt1aWQrJy9vcmRlci9lZGl0U2VsbE1lc3NhZ2UnLCBcIlBBVENIXCIsIHtzZWxsTWVzc2FnZTogdmFsdWUsIG9yZGVySWQ6IG9yZGVySWR9KVxuICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGRvbS50ZXh0KHZhbHVlKTtcbiAgICAgICAgQ29tbW9uTW9kYWwuY2xvc2UoKTtcbiAgICAgICAgc3dlZXRTdWNjZXNzKFwi5L+d5a2Y5oiQ5YqfXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChzd2VldFdhcm5pbmcpXG4gIH0sIHtcbiAgICB0aXRsZTogXCLkv67mlLnlpIfms6hcIixcbiAgICBkYXRhOiBbXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBkb20udGV4dCgpLFxuICAgICAgICBkb206IFwidGV4dGFyZWFcIlxuICAgICAgfVxuICAgIF1cbiAgfSlcbn1cbi8vIOiOt+WPlumHkeminSDovazmjaLmiJDmlbDlrZfkuJTljrvmjonvv6VcbndpbmRvdy5nZXROdW1iZXIgPSBmdW5jdGlvbihzdHIsIGZyYWN0aW9uRGlnaXRzID0gMCkge1xuICBzdHIgPSBzdHIgKyBcIlwiO1xuICBzdHIgPSBzdHIucmVwbGFjZShcIu+/pVwiLCBcIlwiKTtcbiAgc3RyID0gcGFyc2VGbG9hdChzdHIpO1xuICBzdHIgPSBzdHIudG9GaXhlZChmcmFjdGlvbkRpZ2l0cyk7XG4gIHJldHVybiBwYXJzZUZsb2F0KHN0cik7XG59XG4vLyDph43mlrDorqHnrpforqLljZXmgLvku7dcbndpbmRvdy5jb21wdXRlT3JkZXJQcmljZSA9IGZ1bmN0aW9uKG9yZGVySWQpIHtcbiAgY29uc3Qgb3JkZXJEb20gPSAkKGB0cltkYXRhLW9yZGVyLWlkPScke29yZGVySWR9J11gKTtcbiAgY29uc3QgcGFyYW1QcmljZURvbSA9IG9yZGVyRG9tLmZpbmQoXCIuZGF0YS1wYXJhbS1wcmljZVwiKTtcbiAgY29uc3QgY291bnREb20gPSBvcmRlckRvbS5maW5kKFwiLmRhdGEtcGFyYW0tY291bnRcIik7XG4gIGNvbnN0IGZyZWlnaHREb20gPSBvcmRlckRvbS5maW5kKFwiLmRhdGEtcGFyYW1zLWZyZWlnaHRcIik7XG4gIGNvbnN0IHByaWNlcyA9IFtdO1xuICBjb25zdCBjb3VudHMgPSBbXTtcbiAgZm9yKGxldCBpID0gMDsgaSA8IHBhcmFtUHJpY2VEb20ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBkb20gPSBwYXJhbVByaWNlRG9tLmVxKGkpO1xuICAgIHByaWNlcy5wdXNoKGdldE51bWJlcihkb20udGV4dCgpLCAyKSk7XG4gIH1cbiAgZm9yKGxldCBpID0gMDsgaSA8IGNvdW50RG9tLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgZG9tID0gY291bnREb20uZXEoaSk7XG4gICAgY291bnRzLnB1c2goZ2V0TnVtYmVyKGRvbS50ZXh0KCksIDApKTtcbiAgfVxuICBpZihwcmljZXMubGVuZ3RoICE9PSBjb3VudHMubGVuZ3RoKSByZXR1cm4gc3dlZXRFcnJvcihcIuiuouWNlemhtemdoumUmeivr++8jOivt+WIt+aWsOmhtemdolwiKTtcbiAgbGV0IHRvdGFsUHJpY2UgPSAwO1xuICBmb3IobGV0IGkgPSAwOyBpIDwgcHJpY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgdG90YWxQcmljZSArPSBwcmljZXNbaV0gKiBjb3VudHNbaV07XG4gIH1cbiAgY29uc3QgZnJlaWdodCA9IGdldE51bWJlcihmcmVpZ2h0RG9tLnRleHQoKSwgMik7XG4gIG9yZGVyRG9tLmZpbmQoYC5kYXRhLXBhcmFtcy1wcmljZWApLnRleHQoYO+/pSR7dG90YWxQcmljZS50b0ZpeGVkKDIpfWApO1xuICBvcmRlckRvbS5maW5kKGAuZGF0YS1vcmRlci1wcmljZWApLnRleHQoYO+/pSR7KHRvdGFsUHJpY2UgKyBmcmVpZ2h0KS50b0ZpeGVkKDIpfWApO1xuICByZXR1cm4ge1xuICAgIHBhcmFtc1ByaWNlOiB0b3RhbFByaWNlLFxuICAgIGZyZWlnaHRQcmljZTogZnJlaWdodCxcbiAgICBvcmRlclByaWNlOiB0b3RhbFByaWNlICsgZnJlaWdodFxuICB9XG59XG5cblxuLy8g5L+u5pS55ZWG5ZOB5Y2V5Lu3XG53aW5kb3cubW9kaWZ5UGFyYW1QcmljZSA9IGZ1bmN0aW9uKHNlbGxVaWQsIG9yZGVySWQsIGNvc3RJZCkge1xuICBjb25zdCBwcmljZURvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXVtkYXRhLW9yZGVyLXBhcmFtLWlkPScke2Nvc3RJZH0nXSAuZGF0YS1wYXJhbS1wcmljZWApO1xuICBjb25zdCBjb3VudERvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXVtkYXRhLW9yZGVyLXBhcmFtLWlkPScke2Nvc3RJZH0nXSAuZGF0YS1wYXJhbS1jb3VudGApO1xuICBjb25zdCBmcmVpZ2h0RG9tID0gJChgdHJbZGF0YS1vcmRlci1pZD0nJHtvcmRlcklkfSddIC5kYXRhLXBhcmFtcy1mcmVpZ2h0YCk7XG4gIGNvbnN0IGZyZWlnaHRQcmljZSA9IGdldE51bWJlcihmcmVpZ2h0RG9tLnRleHQoKSwgMik7XG4gIGNvbnN0IHByaWNlID0gZ2V0TnVtYmVyKHByaWNlRG9tLnRleHQoKSwgMik7XG4gIGNvbnN0IGNvdW50ID0gZ2V0TnVtYmVyKGNvdW50RG9tLnRleHQoKSwgMCk7XG4gIHJldHVybiBNb2RpZnlQcmljZS5vcGVuKGRhdGEgPT4ge1xuICAgIGNvbnN0IG5ld1ByaWNlID0gZGF0YTtcbiAgICBjb25zdCBjaGVja051bWJlciA9IE5LQy5tZXRob2RzLmNoZWNrRGF0YS5jaGVja051bWJlcjtcbiAgICBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjaGVja051bWJlcihuZXdQcmljZSwge1xuICAgICAgICAgIG5hbWU6IFwi5ZWG5ZOB5Y2V5Lu3XCIsXG4gICAgICAgICAgbWluOiAwLjAxLFxuICAgICAgICAgIGZyYWN0aW9uRGlnaXRzOiAyXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmtjQVBJKGAvc2hvcC9tYW5hZ2UvJHtzZWxsVWlkfS9vcmRlci9lZGl0Q29zdFJlY29yZGAsIFwiUEFUQ0hcIiwge1xuICAgICAgICAgIHR5cGU6IFwibW9kaWZ5UGFyYW1cIixcbiAgICAgICAgICBjb3N0SWQsXG4gICAgICAgICAgb3JkZXJJZCxcbiAgICAgICAgICBmcmVpZ2h0UHJpY2U6IGZyZWlnaHRQcmljZSAqIDEwMCxcbiAgICAgICAgICBjb3N0T2JqOiB7XG4gICAgICAgICAgICBzaW5nbGVQcmljZTogbmV3UHJpY2UgKiAxMDAsXG4gICAgICAgICAgICBjb3VudFxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHByaWNlRG9tLnRleHQoYO+/pSR7bmV3UHJpY2UudG9GaXhlZCgyKX1gKTtcbiAgICAgICAgY29tcHV0ZU9yZGVyUHJpY2Uob3JkZXJJZCk7XG4gICAgICAgIENvbW1vbk1vZGFsLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xuICB9LCBwcmljZSlcbn1cblxuLy8g5L+u5pS55ZWG5ZOB5pWw6YePXG53aW5kb3cubW9kaWZ5UGFyYW1Db3VudCA9IGZ1bmN0aW9uKHNlbGxVaWQsIG9yZGVySWQsIGNvc3RJZCkge1xuICBjb25zdCBjb3VudERvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXVtkYXRhLW9yZGVyLXBhcmFtLWlkPScke2Nvc3RJZH0nXSAuZGF0YS1wYXJhbS1jb3VudGApO1xuICBjb25zdCBwcmljZURvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXVtkYXRhLW9yZGVyLXBhcmFtLWlkPScke2Nvc3RJZH0nXSAuZGF0YS1wYXJhbS1wcmljZWApO1xuICBjb25zdCBmcmVpZ2h0RG9tID0gJChgdHJbZGF0YS1vcmRlci1pZD0nJHtvcmRlcklkfSddIC5kYXRhLXBhcmFtcy1mcmVpZ2h0YCk7XG4gIGNvbnN0IGZyZWlnaHRQcmljZSA9IGdldE51bWJlcihmcmVpZ2h0RG9tLnRleHQoKSwgMik7XG4gIGNvbnN0IHByaWNlID0gZ2V0TnVtYmVyKHByaWNlRG9tLnRleHQoKSwgMik7XG4gIGNvbnN0IGNvdW50ID0gZ2V0TnVtYmVyKGNvdW50RG9tLnRleHQoKSwgMCk7XG4gIENvbW1vbk1vZGFsLm9wZW4oKGRhdGEpID0+IHtcbiAgICBjb25zdCBuZXdDb3VudCA9IGdldE51bWJlcihkYXRhWzBdLnZhbHVlLCAyKTtcbiAgICBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBOS0MubWV0aG9kcy5jaGVja0RhdGEuY2hlY2tOdW1iZXIobmV3Q291bnQsIHtcbiAgICAgICAgICBuYW1lOiBcIuWVhuWTgeaVsOmHj1wiLFxuICAgICAgICAgIG1pbjogMVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5rY0FQSShgL3Nob3AvbWFuYWdlLyR7c2VsbFVpZH0vb3JkZXIvZWRpdENvc3RSZWNvcmRgLCBcIlBBVENIXCIsIHtcbiAgICAgICAgICB0eXBlOiBcIm1vZGlmeVBhcmFtXCIsXG4gICAgICAgICAgY29zdElkLFxuICAgICAgICAgIG9yZGVySWQsXG4gICAgICAgICAgZnJlaWdodFByaWNlOiBmcmVpZ2h0UHJpY2UgKiAxMDAsXG4gICAgICAgICAgY29zdE9iajoge1xuICAgICAgICAgICAgc2luZ2xlUHJpY2U6IHByaWNlICogMTAwLFxuICAgICAgICAgICAgY291bnQ6IG5ld0NvdW50XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICBcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY291bnREb20udGV4dChgJHtuZXdDb3VudH1gKTtcbiAgICAgICAgY29tcHV0ZU9yZGVyUHJpY2Uob3JkZXJJZCk7XG4gICAgICAgIENvbW1vbk1vZGFsLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xuICB9LCB7XG4gICAgdGl0bGU6IFwi5L+u5pS55pWw6YePXCIsXG4gICAgZGF0YTogW1xuICAgICAge1xuICAgICAgICBkb206IFwiaW5wdXRcIixcbiAgICAgICAgdmFsdWU6IGNvdW50XG4gICAgICB9XG4gICAgXVxuICB9KTtcbn1cblxuLy8g5L+u5pS56L+Q6LS5XG53aW5kb3cubW9kaWZ5RnJlaWdodCA9IGZ1bmN0aW9uKHNlbGxVaWQsIG9yZGVySWQpIHtcbiAgY29uc3QgZnJlaWdodERvbSA9ICQoYHRyW2RhdGEtb3JkZXItaWQ9JyR7b3JkZXJJZH0nXSAuZGF0YS1wYXJhbXMtZnJlaWdodGApO1xuICBjb25zdCBmcmVpZ2h0UHJpY2UgPSBnZXROdW1iZXIoZnJlaWdodERvbS50ZXh0KCksIDIpO1xuICByZXR1cm4gTW9kaWZ5UHJpY2Uub3BlbihkYXRhID0+IHtcbiAgICBjb25zdCBuZXdGcmVpZ2h0UHJpY2UgPSBkYXRhO1xuICAgIFByb21pc2UucmVzb2x2ZSgpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIE5LQy5tZXRob2RzLmNoZWNrRGF0YS5jaGVja051bWJlcihuZXdGcmVpZ2h0UHJpY2UsIHtcbiAgICAgICAgICBuYW1lOiBcIui/kOi0uVwiLFxuICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICBmcmFjdGlvbkRpZ2l0czogMlxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5rY0FQSShgL3Nob3AvbWFuYWdlLyR7c2VsbFVpZH0vb3JkZXIvZWRpdENvc3RSZWNvcmRgLCBcIlBBVENIXCIsIHtcbiAgICAgICAgICB0eXBlOiBcIm1vZGlmeUZyZWlnaHRcIixcbiAgICAgICAgICBvcmRlcklkLFxuICAgICAgICAgIGZyZWlnaHRQcmljZTogbmV3RnJlaWdodFByaWNlICogMTAwLFxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGZyZWlnaHREb20udGV4dChg77+lJHtuZXdGcmVpZ2h0UHJpY2UudG9GaXhlZCgyKX1gKTtcbiAgICAgICAgY29tcHV0ZU9yZGVyUHJpY2Uob3JkZXJJZCk7XG4gICAgICAgIENvbW1vbk1vZGFsLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKHN3ZWV0RXJyb3IpO1xuICB9LCBmcmVpZ2h0UHJpY2UpO1xufVxuLy8g5Y+R6LSnL+S/ruaUueeJqea1geS/oeaBr1xud2luZG93LnNoaXAgPSBmdW5jdGlvbihvcmRlcklkKSB7XG4gIFNoaXAub3BlbigoKSA9PiB7XG4gIFxuICB9LCB7XG4gICAgb3JkZXJJZFxuICB9KVxufSJdfQ==
