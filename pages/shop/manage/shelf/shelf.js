!function o(s,a,u){function c(t,e){if(!a[t]){if(!s[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(m)return m(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[t]={exports:{}};s[t][0].call(r.exports,function(e){return c(s[t][1][e]||e)},r,r.exports,o,s,a,u)}return a[t].exports}for(var m="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,i){"use strict";var n=NKC.methods.getDataById("data"),r=n.grades,o=n.dealInfo,u=n.product,s={},a={status:!1,count:2};o.templates.map(function(e){e.firstPrice=parseFloat(e.firstPrice),e.addPrice=parseFloat(e.addPrice)}),u&&(u.vipDisGroup.map(function(e){return s[e.vipLevel]=e}),-1==u.purchaseLimitCount?a.status=!1:(a.status=!0,a.count=u.purchaseLimitCount),u.imgIntroductions.length=5,u.productParams.map(function(e){e.price=e.price/100,e.originPrice=e.originPrice/100}),u.freightTemplates.map(function(e){e.firstPrice=e.firstPrice/100,e.addPrice=e.addPrice/100}));var c=r.map(function(e){var t=s[e._id];return{vipLevel:e._id,grade:e,vipNum:t?t.vipNum:100}});window.app=new Vue({el:"#app",data:{type:u?"modify":"create",submitting:!1,showCloseInfo:!0,shopForums:n.shopForumTypes,selectedShopForumId:"",mainForums:[],title:"",abstract:"",content:"",keywords:[],imgIntroductions:u?u.imgIntroductions:["","","","",""],paramForum:!1,selectedParams:u?u.productParams:[],params:[],vipDisGroup:c,vipDiscount:!!u&&!!u.vipDiscount,stockCostMethod:u?u.stockCostMethod:"orderReduceStock",purchaseLimit:a,uploadCert:!!u&&!!u.uploadCert,uploadCertDescription:u?u.uploadCertDescription:"",productSettings:u?u.productSettings:{priceShowToVisit:!0,priceShowAfterStop:!0},isFreePost:!u||!!u.isFreePost,defaultTemplates:o.templates,freightTemplates:u?u.freightTemplates:[],shelfType:"immediately",shelfTime:""},watch:{shelfType:function(){this.initTime()}},mounted:function(){u||(window.CommonModal=new NKC.modules.CommonModal,window.SelectForums=new NKC.modules.ForumSelector,window.editor=UE.getEditor("container",NKC.configs.ueditor.shopConfigs),this.initTime(),this.addParam())},computed:{selectedShopForum:function(){if(this.selectedShopForum)return this.selectedShopForum.fid},imgMaster:function(){return this.imgIntroductions[0]},paramAttributes:function(){var e=this.params,t=[];return e.map(function(e){(e=(e=(e=(e=e.value.replace(/，/g,",")).split(",")).map(function(e){return(e+"").trim()})).filter(function(e){return!!e})).length&&t.push(e)}),t=(t=NKC.methods.doExchange(t)).map(function(e){return Array.isArray(e)&&(e=e.join(", ")),e})},freightTemplateNames:function(){return this.freightTemplates.map(function(e){return e.name})}},methods:{save:function(){var r=this,e=NKC.methods.checkData,s=e.checkNumber,a=e.checkString,o={};Promise.resolve().then(function(){if(r.submitting=!0,"create"===r.type){if(r.content=editor.getContent(),!r.selectedShopForumId)throw"请选择商品分类";o.mainForumsId=[r.selectedShopForumId].concat(r.mainForums.map(function(e){return e.fid})),a(r.title,{name:"商品标题",minLength:6,maxLength:200}),o.productName=r.title,a(r.abstract,{name:"商品简介",minLength:6,maxLength:1e3}),o.productDescription=r.abstract,r.keywords.map(function(e){a(e,{name:"关键词",minLength:1,maxLength:20})}),o.attention=r.keywords,a(r.content,{name:"图文描述",minLength:1,maxLength:1e5}),o.productDetails=r.content}var e=r.imgIntroductions.filter(function(e){return!!e});if(!e.length)throw"请至少选择一张商品图";o.imgIntroductions=e;var t,i,n=[];if(!(n=r.selectedParams).length)throw"请至少添加一个商品规格";if(n.map(function(e){var t=e.name,i=e.originPrice,n=e.price,r=e.useDiscount,o=e.stocksTotal;if(a(t,{name:"规格名称",minLength:1,maxLength:100}),s(o,{name:"规格库存",min:0}),s(i,{name:"规格价格",min:.01,fractionDigits:2}),r&&(s(n,{name:"规格优惠价",min:.01,fractionDigits:2}),i<=n))throw"规格优惠价必须小于原价"}),o.productParams=n,o.vipDisGroup=[],r.vipDiscount&&(r.vipDisGroup.map(function(e){var t=e.vipNum;s(t,{name:"折扣率",min:1,max:100})}),o.vipDisGroup=r.vipDisGroup),o.vipDiscount=r.vipDiscount,!r.isFreePost){if(!r.freightTemplates.length)throw"请至少添加一条运费信息";r.freightTemplates.map(function(e){var t=e.name,i=e.firstPrice,n=e.addPrice;a(t,{name:"物流名称",minLength:1,maxLength:100}),s(i,{name:"物流首件价格",min:0,fractionDigits:2}),s(n,{name:"物流每增加一件的价格",min:0,fractionDigits:2})}),o.freightTemplates=r.freightTemplates}return o.isFreePost=!!r.isFreePost,o.productSettings=r.productSettings,o.stockCostMethod=r.stockCostMethod,r.purchaseLimit.status?(s(r.purchaseLimit.count,{name:"限购数量",min:1}),o.purchaseLimitCount=r.purchaseLimit.count):o.purchaseLimitCount=-1,r.uploadCert&&(a(r.uploadCertDescription,{name:"凭证说明",minLength:1,maxLength:1e3}),o.uploadCertDescription=r.uploadCertDescription),o.uploadCert=r.uploadCert,"create"===r.type?"immediately"===r.shelfType?o.productStatus="insale":"save"===r.shelfType?o.productStatus="notonshelf":(o.productStatus="notonshelf",t=$("#shelfTime"),i=new Date(t.val()).getTime(),o.shelfTime=i):o.productId=u.productId,nkcAPI("/shop/manage/shelf","POST",{post:o})}).then(function(e){sweetSuccess("提交成功"),r.submitting=!1,r.showCloseInfo=!1,NKC.methods.visitUrl("/shop/manage/goods")}).catch(function(e){r.submitting=!1,sweetError(e)})},disabledSelectParam:function(e){if(e._id){if(e.isEnable){var t=0;if(this.selectedParams.map(function(e){e.isEnable&&t++}),t<=1)return sweetError("不允许屏蔽所有规格")}e.isEnable=!e.isEnable}},initTime:function(){$(".time").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii",autoclose:!0,todayHighlight:1,startView:2,minView:0,forceParse:0})},selectPictures:function(t){var i=this;window.SelectResource||(window.SelectResource=new NKC.modules.SelectResource),SelectResource.open(function(e){return["png","jpg","jpeg"].includes(e.resources[0].ext)?void Vue.set(i.imgIntroductions,t,e.resourcesId[0]):sweetInfo("仅支持png、jpg和jpeg格式的图片")},{allowedExt:["picture"],countLimit:1})},changeArrIndex:function(e,t,i){var n,r=e[t],o=e.length;if("left"===i){if(0===t)return;n=t-1}else{if(t+1===o)return;n=t+1}var s=e[n];Vue.set(e,t,s),Vue.set(e,n,r)},removePicture:function(e){var t=this;sweetQuestion("确定要删除当前商品图片？").then(function(){Vue.set(t.imgIntroductions,e,"")}).catch(function(e){})},reloadTemplate:function(){var t=this;nkcAPI("/shop/manage/settings","GET").then(function(e){t.defaultTemplates=e.dealInfo.templates,sweetSuccess("刷新成功")}).catch(sweetError)},addTemplate:function(){this.freightTemplates.push({name:"",firstPrice:"",addPrice:""})},removeFromArr:function(e,t){e.splice(t,1)},selectTemplate:function(e){this.freightTemplateNames.includes(e.name)||this.freightTemplates.push(Object.assign({},e))},removeKeyword:function(e){this.keywords.splice(e,1)},selectForum:function(){var t=this,e=t.shopForums.map(function(e){return e.fid});window.SelectForums.open(function(e){t.mainForums=[e.forum]},{selectedForumsId:t.selectedShopForumId?[t.selectedShopForumId]:[],disabledForumsId:e})},addKeywords:function(){var n=this;CommonModal.open(function(e){var t=e[0].value;t=(t=t.replace(/，/g,",")).split(",");var i=[];t.map(function(e){(e=(e=e||"").trim())&&!i.includes(e)&&i.push(e)}),n.keywords=i,CommonModal.close()},{title:"添加关键词",data:[{dom:"textarea",label:"多个关键词以逗号分隔",value:this.keywords.join(", ")}]})},removeParamAttribute:function(e){this.params.splice(e,1)},resetParamForum:function(){this.params=[{value:""},{value:""}]},removeSelectParam:function(e){this.selectedParams.splice(e,1)},addParam:function(e){e=e&&e.name?e:this.newParam(),this.selectedParams.push(e)},newParam:function(e){return e?e="":this.selectedParams.length||(e="默认"),{name:e,originPrice:"",price:"",isEnable:!0,useDiscount:!1,stocksTotal:""}},addParams:function(){this.resetParamForum(),this.paramForum=!0},addParamAttribute:function(){this.params.push({value:""})},saveParamAttribute:function(){var e=this.paramAttributes,t=this;if(!e.length)return sweetError("请至少填写一个属性值");e.map(function(e){t.addParam(t.newParam(e))}),this.paramForum=!1}}}),window.onbeforeunload=function(){if(app.showCloseInfo)return"关闭页面后，已填写的内容将会丢失。确定要关闭当前页面？"}},{}]},{},[1]);