!function n(r,o,s){function a(t,e){if(!o[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(u)return u(t,!0);throw(i=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",i}i=o[t]={exports:{}},r[t][0].call(i.exports,function(e){return a(r[t][1][e]||e)},i,i.exports,n,r,o,s)}return o[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,i){"use strict";var n=NKC.methods.getDataById("data"),r=n.grades,o=n.dealInfo,a=n.product,s={},u={status:!1,count:2};o.templates.map(function(e){e.firstPrice=parseFloat(e.firstPrice),e.addPrice=parseFloat(e.addPrice)}),a&&(a.vipDisGroup.map(function(e){return s[e.vipLevel]=e}),-1==a.purchaseLimitCount?u.status=!1:(u.status=!0,u.count=a.purchaseLimitCount),a.imgIntroductions.length=5,a.productParams.map(function(e){e.price=e.price/100,e.originPrice=e.originPrice/100}),a.freightTemplates.map(function(e){e.firstPrice=e.firstPrice/100,e.addPrice=e.addPrice/100}));r=r.map(function(e){var t=s[e._id];return{vipLevel:e._id,grade:e,vipNum:t?t.vipNum:100}});window.app=new Vue({el:"#app",data:{type:a?"modify":"create",submitting:!1,showCloseInfo:!0,shopForums:n.shopForumTypes,selectedShopForumId:"",mainForums:[],title:"",abstract:"",content:"",keywords:[],imgIntroductions:a?a.imgIntroductions:["","","","",""],paramForum:!1,selectedParams:a?a.productParams:[],params:[],vipDisGroup:r,vipDiscount:!!a&&!!a.vipDiscount,stockCostMethod:a?a.stockCostMethod:"orderReduceStock",purchaseLimit:u,uploadCert:!!a&&!!a.uploadCert,uploadCertDescription:a?a.uploadCertDescription:"",productSettings:a?a.productSettings:{priceShowToVisit:!0,priceShowAfterStop:!0},isFreePost:!a||!!a.isFreePost,defaultTemplates:o.templates,freightTemplates:a?a.freightTemplates:[],shelfType:"immediately",shelfTime:""},watch:{shelfType:function(){this.initTime()}},mounted:function(){a||(window.CommonModal=new NKC.modules.CommonModal,window.SelectForums=new NKC.modules.ForumSelector,window.editor=UE.getEditor("container",NKC.configs.ueditor.shopConfigs),this.initTime(),this.addParam())},computed:{selectedShopForum:function(){if(this.selectedShopForum)return this.selectedShopForum.fid},imgMaster:function(){return this.imgIntroductions[0]},paramAttributes:function(){var e=this.params,t=[];return e.map(function(e){(e=(e=(e=(e=e.value.replace(/，/g,",")).split(",")).map(function(e){return(e+"").trim()})).filter(function(e){return!!e})).length&&t.push(e)}),t=(t=NKC.methods.doExchange(t)).map(function(e){return e=Array.isArray(e)?e.join(", "):e})},freightTemplateNames:function(){return this.freightTemplates.map(function(e){return e.name})}},methods:{save:function(){var t=this,e=NKC.methods.checkData,o=e.checkNumber,s=e.checkString,i={};Promise.resolve().then(function(){if(t.submitting=!0,"create"===t.type){if(t.content=editor.getContent(),!t.selectedShopForumId)throw"请选择商品分类";i.mainForumsId=[t.selectedShopForumId].concat(t.mainForums.map(function(e){return e.fid})),s(t.title,{name:"商品标题",minLength:6,maxLength:200}),i.productName=t.title,s(t.abstract,{name:"商品简介",minLength:6,maxLength:1e3}),i.productDescription=t.abstract,t.keywords.map(function(e){s(e,{name:"关键词",minLength:1,maxLength:20})}),i.attention=t.keywords,s(t.content,{name:"图文描述",minLength:1,maxLength:1e5}),i.productDetails=t.content}var e=t.imgIntroductions.filter(function(e){return!!e});if(!e.length)throw"请至少选择一张商品图";i.imgIntroductions=e;e=[];if(!(e=t.selectedParams).length)throw"请至少添加一个商品规格";if(e.map(function(e){var t=e.name,i=e.originPrice,n=e.price,r=e.useDiscount,e=e.stocksTotal;if(s(t,{name:"规格名称",minLength:1,maxLength:100}),o(e,{name:"规格库存",min:0}),o(i,{name:"规格价格",min:.01,fractionDigits:2}),r&&(o(n,{name:"规格优惠价",min:.01,fractionDigits:2}),i<=n))throw"规格优惠价必须小于原价"}),i.productParams=e,i.vipDisGroup=[],t.vipDiscount&&(t.vipDisGroup.map(function(e){e=e.vipNum;o(e,{name:"折扣率",min:1,max:100})}),i.vipDisGroup=t.vipDisGroup),i.vipDiscount=t.vipDiscount,!t.isFreePost){if(!t.freightTemplates.length)throw"请至少添加一条运费信息";t.freightTemplates.map(function(e){var t=e.name,i=e.firstPrice,e=e.addPrice;s(t,{name:"物流名称",minLength:1,maxLength:100}),o(i,{name:"物流首件价格",min:0,fractionDigits:2}),o(e,{name:"物流每增加一件的价格",min:0,fractionDigits:2})}),i.freightTemplates=t.freightTemplates}return i.isFreePost=!!t.isFreePost,i.productSettings=t.productSettings,i.stockCostMethod=t.stockCostMethod,t.purchaseLimit.status?(o(t.purchaseLimit.count,{name:"限购数量",min:1}),i.purchaseLimitCount=t.purchaseLimit.count):i.purchaseLimitCount=-1,t.uploadCert&&(s(t.uploadCertDescription,{name:"凭证说明",minLength:1,maxLength:1e3}),i.uploadCertDescription=t.uploadCertDescription),i.uploadCert=t.uploadCert,"create"===t.type?"immediately"===t.shelfType?i.productStatus="insale":"save"===t.shelfType?i.productStatus="notonshelf":(i.productStatus="notonshelf",e=$("#shelfTime"),e=new Date(e.val()).getTime(),i.shelfTime=e):i.productId=a.productId,nkcAPI("/shop/manage/shelf","POST",{post:i})}).then(function(e){sweetSuccess("提交成功"),t.submitting=!1,t.showCloseInfo=!1,NKC.methods.visitUrl("/shop/manage/goods")}).catch(function(e){t.submitting=!1,sweetError(e)})},disabledSelectParam:function(e){if(e._id){if(e.isEnable){var t=0;if(this.selectedParams.map(function(e){e.isEnable&&t++}),t<=1)return sweetError("不允许屏蔽所有规格")}e.isEnable=!e.isEnable}},initTime:function(){$(".time").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii",autoclose:!0,todayHighlight:1,startView:2,minView:0,forceParse:0})},selectPictures:function(t){var i=this;window.SelectResource||(window.SelectResource=new NKC.modules.SelectResource),SelectResource.open(function(e){return["png","jpg","jpeg"].includes(e.resources[0].ext)?void Vue.set(i.imgIntroductions,t,e.resourcesId[0]):sweetInfo("仅支持png、jpg和jpeg格式的图片")},{allowedExt:["picture"],countLimit:1})},changeArrIndex:function(e,t,i){var n,r=e[t],o=e.length;if("left"===i){if(0===t)return;n=t-1}else{if(t+1===o)return;n=t+1}o=e[n];Vue.set(e,t,o),Vue.set(e,n,r)},removePicture:function(e){var t=this;sweetQuestion("确定要删除当前商品图片？").then(function(){Vue.set(t.imgIntroductions,e,"")}).catch(function(e){})},reloadTemplate:function(){var t=this;nkcAPI("/shop/manage/settings","GET").then(function(e){t.defaultTemplates=e.dealInfo.templates,sweetSuccess("刷新成功")}).catch(sweetError)},addTemplate:function(){this.freightTemplates.push({name:"",firstPrice:"",addPrice:""})},removeFromArr:function(e,t){e.splice(t,1)},selectTemplate:function(e){this.freightTemplateNames.includes(e.name)||this.freightTemplates.push(Object.assign({},e))},removeKeyword:function(e){this.keywords.splice(e,1)},selectForum:function(){var t=this,e=t.shopForums.map(function(e){return e.fid});window.SelectForums.open(function(e){t.mainForums=[e.forum]},{selectedForumsId:t.selectedShopForumId?[t.selectedShopForumId]:[],disabledForumsId:e})},addKeywords:function(){var i=this;CommonModal.open(function(e){e=e[0].value;e=(e=e.replace(/，/g,",")).split(",");var t=[];e.map(function(e){(e=(e=e||"").trim())&&!t.includes(e)&&t.push(e)}),i.keywords=t,CommonModal.close()},{title:"添加关键词",data:[{dom:"textarea",label:"多个关键词以逗号分隔",value:this.keywords.join(", ")}]})},removeParamAttribute:function(e){this.params.splice(e,1)},resetParamForum:function(){this.params=[{value:""},{value:""}]},removeSelectParam:function(e){this.selectedParams.splice(e,1)},addParam:function(e){e=e&&e.name?e:this.newParam(),this.selectedParams.push(e)},newParam:function(e){return e?e="":this.selectedParams.length||(e="默认"),{name:e,originPrice:"",price:"",isEnable:!0,useDiscount:!1,stocksTotal:""}},addParams:function(){this.resetParamForum(),this.paramForum=!0},addParamAttribute:function(){this.params.push({value:""})},saveParamAttribute:function(){var e=this.paramAttributes,t=this;if(!e.length)return sweetError("请至少填写一个属性值");e.map(function(e){t.addParam(t.newParam(e))}),this.paramForum=!1}}}),window.onbeforeunload=function(){if(app.showCloseInfo)return"关闭页面后，已填写的内容将会丢失。确定要关闭当前页面？"}},{}]},{},[1]);