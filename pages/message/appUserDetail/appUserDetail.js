(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById("data");

if (data.friend) {
  data.friend.info._phone = data.friend.info.phone.map(function (p) {
    return {
      number: p
    };
  });

  if (!data.friend.info._phone.length) {
    data.friend.info._phone = [{
      number: ''
    }];
  }
}

window.app = new Vue({
  el: '#app',
  data: {
    friend: data.friend,
    fc: data.friendCategories,
    targetUser: data.targetUser,
    targetUserName: data.targetUserName,
    inBlacklist: data.inBlacklist,
    friendImageUrl: '',
    showNote: false
  },
  methods: {
    // 访问用户首页
    visitUserHome: function visitUserHome() {
      NKC.methods.visitUrl("/u/".concat(this.targetUser.uid), true);
    },
    _removeFriend: function _removeFriend() {
      var tUid = this.targetUser.uid;
      return nkcAPI('/friend/' + tUid, 'DELETE', {});
    },
    // 添加、删除好友
    addFriend: function addFriend(isFriend) {
      var _removeFriend = this._removeFriend;

      if (isFriend) {
        // 删除好友
        sweetQuestion('确定要删除该好友？').then(function () {
          return _removeFriend();
        }).then(function () {
          NKC.methods.appToast('删除成功');
          NKC.methods.appReloadPage();
        })["catch"](NKC.methods.appToast);
      } else {
        // 添加好友
        NKC.methods.visitUrl("/message/addFriend?uid=".concat(this.targetUser.uid), true);
      }
    },
    // 添加、移除黑名单
    moveToBlacklist: function moveToBlacklist() {
      var tUid = this.targetUser.uid;
      var inBlacklist = this.inBlacklist;
      var friend = this.friend;
      var _removeFriend = this._removeFriend;
      Promise.resolve().then(function () {
        if (!inBlacklist) {
          return sweetQuestion("确认要将该用户加入黑名单？");
        }
      }).then(function () {
        if (!inBlacklist && friend) {
          return _removeFriend();
        }
      }).then(function () {
        if (!inBlacklist) {
          return nkcAPI("/message/blackList", 'POST', {
            tUid: tUid,
            type: 'add'
          });
        } else {
          return nkcAPI('/message/blackList', 'POST', {
            tUid: tUid,
            type: 'remove'
          });
        }
      }).then(function () {
        NKC.methods.appToast('操作成功');
        NKC.methods.appReloadPage();
      })["catch"](NKC.methods.appToast);
    },
    // 打开聊天页面
    sendToUser: function sendToUser() {
      var uid = this.targetUser.uid;
      var targetUserName = this.targetUserName;
      NKC.methods.rn.emit('toChat', {
        uid: uid,
        type: 'UTU',
        username: targetUserName
      });
    },
    // 选择地区
    selectLocation: function selectLocation() {
      var self = this;
      NKC.methods.appSelectLocation().then(function (data) {
        self.friend.info.location = data.location.join('  ');
      });
    },
    // 添加联系电话
    addPhone: function addPhone() {
      this.friend.info.phone.push('');
    },
    // 删除联系电话
    removePhone: function removePhone(index) {
      this.friend.info._phone.splice(index, 1);
    },
    // 获取好友图片链接
    setFriendImageUrl: function setFriendImageUrl() {
      this.friendImageUrl = "/friend/".concat(this.targetUser.uid, "/image?t=").concat(Date.now());
    },
    // 选择图片
    selectFriendImage: function selectFriendImage() {
      this.$refs.input.value = null;
      this.$refs.input.click();
    },
    // 删除图片
    removeFriendImage: function removeFriendImage() {
      this.friend.info.image = false;
    },
    // 选择完图片后
    selectedFriendImage: function selectedFriendImage() {
      var self = this;
      var files = this.$refs.input.files;
      if (!files.length) return;
      var file = files[0];
      var formData = new FormData();
      formData.append('file', file);
      NKC.methods.appToast('上传中，请稍候');
      nkcUploadFile("/friend/".concat(self.targetUser.uid, "/image"), 'POST', formData).then(function () {
        NKC.methods.appToast('上传成功');
        self.setFriendImageUrl();
        self.friend.info.image = true;
      })["catch"](NKC.methods.appToast);
    },
    // 显示，隐藏备注信息
    switchNote: function switchNote() {
      this.showNote = !this.showNote;
    },
    // 保存好友信息
    saveFriendInfo: function saveFriendInfo() {
      var friend = this.friend,
          targetUser = this.targetUser;
      friend.info.phone = friend.info._phone.map(function (p) {
        return p.number;
      });
      nkcAPI("/message/settings/".concat(targetUser.uid), 'PATCH', {
        info: friend.info,
        cid: friend.cid
      }).then(function () {
        NKC.methods.appToast('保存成功');
      })["catch"](NKC.methods.appToast);
    }
  },
  mounted: function mounted() {
    this.setFriendImageUrl();
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL21lc3NhZ2UvYXBwVXNlckRldGFpbC9hcHBVc2VyRGV0YWlsLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE9BQUosQ0FBWSxXQUFaLENBQXdCLE1BQXhCLENBQWI7O0FBQ0EsSUFBRyxJQUFJLENBQUMsTUFBUixFQUFnQjtBQUNkLEVBQUEsSUFBSSxDQUFDLE1BQUwsQ0FBWSxJQUFaLENBQWlCLE1BQWpCLEdBQTBCLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixLQUFqQixDQUF1QixHQUF2QixDQUEyQixVQUFBLENBQUMsRUFBSTtBQUN4RCxXQUFPO0FBQ0wsTUFBQSxNQUFNLEVBQUU7QUFESCxLQUFQO0FBR0QsR0FKeUIsQ0FBMUI7O0FBS0EsTUFBRyxDQUFDLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixNQUFqQixDQUF3QixNQUE1QixFQUFvQztBQUNsQyxJQUFBLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixNQUFqQixHQUEwQixDQUFDO0FBQUMsTUFBQSxNQUFNLEVBQUU7QUFBVCxLQUFELENBQTFCO0FBQ0Q7QUFDRjs7QUFDRCxNQUFNLENBQUMsR0FBUCxHQUFhLElBQUksR0FBSixDQUFRO0FBQ25CLEVBQUEsRUFBRSxFQUFFLE1BRGU7QUFFbkIsRUFBQSxJQUFJLEVBQUU7QUFDSixJQUFBLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFEVDtBQUVKLElBQUEsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFGTDtBQUdKLElBQUEsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUhiO0FBSUosSUFBQSxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBSmpCO0FBS0osSUFBQSxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBTGQ7QUFNSixJQUFBLGNBQWMsRUFBRSxFQU5aO0FBT0osSUFBQSxRQUFRLEVBQUU7QUFQTixHQUZhO0FBV25CLEVBQUEsT0FBTyxFQUFFO0FBQ1A7QUFDQSxJQUFBLGFBRk8sMkJBRVM7QUFDZCxNQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFBWixjQUEyQixLQUFLLFVBQUwsQ0FBZ0IsR0FBM0MsR0FBa0QsSUFBbEQ7QUFDRCxLQUpNO0FBS1AsSUFBQSxhQUxPLDJCQUtTO0FBQ2QsVUFBTSxJQUFJLEdBQUcsS0FBSyxVQUFMLENBQWdCLEdBQTdCO0FBQ0EsYUFBTyxNQUFNLENBQUMsYUFBYSxJQUFkLEVBQW9CLFFBQXBCLEVBQThCLEVBQTlCLENBQWI7QUFDRCxLQVJNO0FBU1A7QUFDQSxJQUFBLFNBVk8scUJBVUcsUUFWSCxFQVVhO0FBQ2xCLFVBQU0sYUFBYSxHQUFHLEtBQUssYUFBM0I7O0FBQ0EsVUFBRyxRQUFILEVBQWE7QUFDWDtBQUNBLFFBQUEsYUFBYSxDQUFDLFdBQUQsQ0FBYixDQUNHLElBREgsQ0FDUSxZQUFNO0FBQ1YsaUJBQU8sYUFBYSxFQUFwQjtBQUNELFNBSEgsRUFJRyxJQUpILENBSVEsWUFBTTtBQUNWLFVBQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLENBQXFCLE1BQXJCO0FBQ0EsVUFBQSxHQUFHLENBQUMsT0FBSixDQUFZLGFBQVo7QUFDRCxTQVBILFdBUVMsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQVJyQjtBQVNELE9BWEQsTUFXTztBQUNMO0FBQ0EsUUFBQSxHQUFHLENBQUMsT0FBSixDQUFZLFFBQVosa0NBQStDLEtBQUssVUFBTCxDQUFnQixHQUEvRCxHQUFzRSxJQUF0RTtBQUNEO0FBQ0YsS0EzQk07QUE0QlA7QUFDQSxJQUFBLGVBN0JPLDZCQTZCVztBQUNoQixVQUFNLElBQUksR0FBRyxLQUFLLFVBQUwsQ0FBZ0IsR0FBN0I7QUFDQSxVQUFNLFdBQVcsR0FBRyxLQUFLLFdBQXpCO0FBQ0EsVUFBTSxNQUFNLEdBQUcsS0FBSyxNQUFwQjtBQUNBLFVBQU0sYUFBYSxHQUFHLEtBQUssYUFBM0I7QUFDQSxNQUFBLE9BQU8sQ0FBQyxPQUFSLEdBQ0csSUFESCxDQUNRLFlBQU07QUFDVixZQUFHLENBQUMsV0FBSixFQUFpQjtBQUNmLGlCQUFPLGFBQWEsQ0FBQyxlQUFELENBQXBCO0FBQ0Q7QUFDRixPQUxILEVBTUcsSUFOSCxDQU1RLFlBQU07QUFDVixZQUFHLENBQUMsV0FBRCxJQUFnQixNQUFuQixFQUEyQjtBQUN6QixpQkFBTyxhQUFhLEVBQXBCO0FBQ0Q7QUFDRixPQVZILEVBV0csSUFYSCxDQVdRLFlBQU07QUFDVixZQUFHLENBQUMsV0FBSixFQUFpQjtBQUNmLGlCQUFPLE1BQU0sQ0FBQyxvQkFBRCxFQUF1QixNQUF2QixFQUErQjtBQUMxQyxZQUFBLElBQUksRUFBSixJQUQwQztBQUUxQyxZQUFBLElBQUksRUFBRTtBQUZvQyxXQUEvQixDQUFiO0FBSUQsU0FMRCxNQUtPO0FBQ0wsaUJBQU8sTUFBTSxDQUFDLG9CQUFELEVBQXVCLE1BQXZCLEVBQStCO0FBQzFDLFlBQUEsSUFBSSxFQUFKLElBRDBDO0FBRTFDLFlBQUEsSUFBSSxFQUFFO0FBRm9DLFdBQS9CLENBQWI7QUFJRDtBQUNGLE9BdkJILEVBd0JHLElBeEJILENBd0JRLFlBQU07QUFDVixRQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFBWixDQUFxQixNQUFyQjtBQUNBLFFBQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxhQUFaO0FBQ0QsT0EzQkgsV0E0QlMsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQTVCckI7QUE2QkQsS0EvRE07QUFnRVA7QUFDQSxJQUFBLFVBakVPLHdCQWlFTTtBQUNYLFVBQU0sR0FBRyxHQUFHLEtBQUssVUFBTCxDQUFnQixHQUE1QjtBQUNBLFVBQU0sY0FBYyxHQUFHLEtBQUssY0FBNUI7QUFDQSxNQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksRUFBWixDQUFlLElBQWYsQ0FBb0IsUUFBcEIsRUFBOEI7QUFDNUIsUUFBQSxHQUFHLEVBQUUsR0FEdUI7QUFFNUIsUUFBQSxJQUFJLEVBQUUsS0FGc0I7QUFHNUIsUUFBQSxRQUFRLEVBQUU7QUFIa0IsT0FBOUI7QUFLRCxLQXpFTTtBQTBFUDtBQUNBLElBQUEsY0EzRU8sNEJBMkVVO0FBQ2YsVUFBTSxJQUFJLEdBQUcsSUFBYjtBQUNBLE1BQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxpQkFBWixHQUNHLElBREgsQ0FDUSxVQUFBLElBQUksRUFBSTtBQUNaLFFBQUEsSUFBSSxDQUFDLE1BQUwsQ0FBWSxJQUFaLENBQWlCLFFBQWpCLEdBQTRCLElBQUksQ0FBQyxRQUFMLENBQWMsSUFBZCxDQUFtQixJQUFuQixDQUE1QjtBQUNELE9BSEg7QUFJRCxLQWpGTTtBQWtGUDtBQUNBLElBQUEsUUFuRk8sc0JBbUZJO0FBQ1QsV0FBSyxNQUFMLENBQVksSUFBWixDQUFpQixLQUFqQixDQUF1QixJQUF2QixDQUE0QixFQUE1QjtBQUNELEtBckZNO0FBc0ZQO0FBQ0EsSUFBQSxXQXZGTyx1QkF1RkssS0F2RkwsRUF1Rlk7QUFDakIsV0FBSyxNQUFMLENBQVksSUFBWixDQUFpQixNQUFqQixDQUF3QixNQUF4QixDQUErQixLQUEvQixFQUFzQyxDQUF0QztBQUNELEtBekZNO0FBMEZQO0FBQ0EsSUFBQSxpQkEzRk8sK0JBMkZhO0FBQ2xCLFdBQUssY0FBTCxxQkFBaUMsS0FBSyxVQUFMLENBQWdCLEdBQWpELHNCQUFnRSxJQUFJLENBQUMsR0FBTCxFQUFoRTtBQUNELEtBN0ZNO0FBOEZQO0FBQ0EsSUFBQSxpQkEvRk8sK0JBK0ZhO0FBQ2xCLFdBQUssS0FBTCxDQUFXLEtBQVgsQ0FBaUIsS0FBakIsR0FBeUIsSUFBekI7QUFDQSxXQUFLLEtBQUwsQ0FBVyxLQUFYLENBQWlCLEtBQWpCO0FBQ0QsS0FsR007QUFtR1A7QUFDQSxJQUFBLGlCQXBHTywrQkFvR2E7QUFDbEIsV0FBSyxNQUFMLENBQVksSUFBWixDQUFpQixLQUFqQixHQUF5QixLQUF6QjtBQUNELEtBdEdNO0FBdUdQO0FBQ0EsSUFBQSxtQkF4R08saUNBd0dlO0FBQ3BCLFVBQU0sSUFBSSxHQUFHLElBQWI7QUFEb0IsVUFFYixLQUZhLEdBRUosS0FBSyxLQUFMLENBQVcsS0FGUCxDQUViLEtBRmE7QUFHcEIsVUFBRyxDQUFDLEtBQUssQ0FBQyxNQUFWLEVBQWtCO0FBQ2xCLFVBQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFELENBQWxCO0FBQ0EsVUFBTSxRQUFRLEdBQUcsSUFBSSxRQUFKLEVBQWpCO0FBQ0EsTUFBQSxRQUFRLENBQUMsTUFBVCxDQUFnQixNQUFoQixFQUF3QixJQUF4QjtBQUNBLE1BQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLENBQXFCLFNBQXJCO0FBQ0EsTUFBQSxhQUFhLG1CQUFZLElBQUksQ0FBQyxVQUFMLENBQWdCLEdBQTVCLGFBQXlDLE1BQXpDLEVBQWlELFFBQWpELENBQWIsQ0FDRyxJQURILENBQ1EsWUFBTTtBQUNWLFFBQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLENBQXFCLE1BQXJCO0FBQ0EsUUFBQSxJQUFJLENBQUMsaUJBQUw7QUFDQSxRQUFBLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixLQUFqQixHQUF5QixJQUF6QjtBQUNELE9BTEgsV0FNUyxHQUFHLENBQUMsT0FBSixDQUFZLFFBTnJCO0FBT0QsS0F2SE07QUF3SFA7QUFDQSxJQUFBLFVBekhPLHdCQXlITTtBQUNYLFdBQUssUUFBTCxHQUFnQixDQUFDLEtBQUssUUFBdEI7QUFDRCxLQTNITTtBQTRIUDtBQUNBLElBQUEsY0E3SE8sNEJBNkhVO0FBQUEsVUFDUixNQURRLEdBQ2MsSUFEZCxDQUNSLE1BRFE7QUFBQSxVQUNBLFVBREEsR0FDYyxJQURkLENBQ0EsVUFEQTtBQUVmLE1BQUEsTUFBTSxDQUFDLElBQVAsQ0FBWSxLQUFaLEdBQW9CLE1BQU0sQ0FBQyxJQUFQLENBQVksTUFBWixDQUFtQixHQUFuQixDQUF1QixVQUFBLENBQUM7QUFBQSxlQUFJLENBQUMsQ0FBQyxNQUFOO0FBQUEsT0FBeEIsQ0FBcEI7QUFDQSxNQUFBLE1BQU0sNkJBQXNCLFVBQVUsQ0FBQyxHQUFqQyxHQUF3QyxPQUF4QyxFQUFpRDtBQUNyRCxRQUFBLElBQUksRUFBRSxNQUFNLENBQUMsSUFEd0M7QUFFckQsUUFBQSxHQUFHLEVBQUUsTUFBTSxDQUFDO0FBRnlDLE9BQWpELENBQU4sQ0FJRyxJQUpILENBSVEsWUFBTTtBQUNWLFFBQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLENBQXFCLE1BQXJCO0FBQ0QsT0FOSCxXQU9TLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFQckI7QUFRRDtBQXhJTSxHQVhVO0FBcUpuQixFQUFBLE9BckptQixxQkFxSlQ7QUFDUixTQUFLLGlCQUFMO0FBQ0Q7QUF2SmtCLENBQVIsQ0FBYiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGRhdGEgPSBOS0MubWV0aG9kcy5nZXREYXRhQnlJZChcImRhdGFcIik7XHJcbmlmKGRhdGEuZnJpZW5kKSB7XHJcbiAgZGF0YS5mcmllbmQuaW5mby5fcGhvbmUgPSBkYXRhLmZyaWVuZC5pbmZvLnBob25lLm1hcChwID0+IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG51bWJlcjogcFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gIGlmKCFkYXRhLmZyaWVuZC5pbmZvLl9waG9uZS5sZW5ndGgpIHtcclxuICAgIGRhdGEuZnJpZW5kLmluZm8uX3Bob25lID0gW3tudW1iZXI6ICcnfV1cclxuICB9XHJcbn1cclxud2luZG93LmFwcCA9IG5ldyBWdWUoe1xyXG4gIGVsOiAnI2FwcCcsXHJcbiAgZGF0YToge1xyXG4gICAgZnJpZW5kOiBkYXRhLmZyaWVuZCxcclxuICAgIGZjOiBkYXRhLmZyaWVuZENhdGVnb3JpZXMsXHJcbiAgICB0YXJnZXRVc2VyOiBkYXRhLnRhcmdldFVzZXIsXHJcbiAgICB0YXJnZXRVc2VyTmFtZTogZGF0YS50YXJnZXRVc2VyTmFtZSxcclxuICAgIGluQmxhY2tsaXN0OiBkYXRhLmluQmxhY2tsaXN0LFxyXG4gICAgZnJpZW5kSW1hZ2VVcmw6ICcnLFxyXG4gICAgc2hvd05vdGU6IGZhbHNlLFxyXG4gIH0sXHJcbiAgbWV0aG9kczoge1xyXG4gICAgLy8g6K6/6Zeu55So5oi36aaW6aG1XHJcbiAgICB2aXNpdFVzZXJIb21lKCkge1xyXG4gICAgICBOS0MubWV0aG9kcy52aXNpdFVybChgL3UvJHt0aGlzLnRhcmdldFVzZXIudWlkfWAsIHRydWUpXHJcbiAgICB9LFxyXG4gICAgX3JlbW92ZUZyaWVuZCgpIHtcclxuICAgICAgY29uc3QgdFVpZCA9IHRoaXMudGFyZ2V0VXNlci51aWQ7XHJcbiAgICAgIHJldHVybiBua2NBUEkoJy9mcmllbmQvJyArIHRVaWQsICdERUxFVEUnLCB7fSk7XHJcbiAgICB9LFxyXG4gICAgLy8g5re75Yqg44CB5Yig6Zmk5aW95Y+LXHJcbiAgICBhZGRGcmllbmQoaXNGcmllbmQpIHtcclxuICAgICAgY29uc3QgX3JlbW92ZUZyaWVuZCA9IHRoaXMuX3JlbW92ZUZyaWVuZDtcclxuICAgICAgaWYoaXNGcmllbmQpIHtcclxuICAgICAgICAvLyDliKDpmaTlpb3lj4tcclxuICAgICAgICBzd2VldFF1ZXN0aW9uKCfnoa7lrpropoHliKDpmaTor6Xlpb3lj4vvvJ8nKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gX3JlbW92ZUZyaWVuZCgpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgTktDLm1ldGhvZHMuYXBwVG9hc3QoJ+WIoOmZpOaIkOWKnycpO1xyXG4gICAgICAgICAgICBOS0MubWV0aG9kcy5hcHBSZWxvYWRQYWdlKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKE5LQy5tZXRob2RzLmFwcFRvYXN0KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOa3u+WKoOWlveWPi1xyXG4gICAgICAgIE5LQy5tZXRob2RzLnZpc2l0VXJsKGAvbWVzc2FnZS9hZGRGcmllbmQ/dWlkPSR7dGhpcy50YXJnZXRVc2VyLnVpZH1gLCB0cnVlKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIC8vIOa3u+WKoOOAgeenu+mZpOm7keWQjeWNlVxyXG4gICAgbW92ZVRvQmxhY2tsaXN0KCkge1xyXG4gICAgICBjb25zdCB0VWlkID0gdGhpcy50YXJnZXRVc2VyLnVpZDtcclxuICAgICAgY29uc3QgaW5CbGFja2xpc3QgPSB0aGlzLmluQmxhY2tsaXN0O1xyXG4gICAgICBjb25zdCBmcmllbmQgPSB0aGlzLmZyaWVuZDtcclxuICAgICAgY29uc3QgX3JlbW92ZUZyaWVuZCA9IHRoaXMuX3JlbW92ZUZyaWVuZDtcclxuICAgICAgUHJvbWlzZS5yZXNvbHZlKClcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBpZighaW5CbGFja2xpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN3ZWV0UXVlc3Rpb24oXCLnoa7orqTopoHlsIbor6XnlKjmiLfliqDlhaXpu5HlkI3ljZXvvJ9cIilcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGlmKCFpbkJsYWNrbGlzdCAmJiBmcmllbmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9yZW1vdmVGcmllbmQoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGlmKCFpbkJsYWNrbGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmtjQVBJKFwiL21lc3NhZ2UvYmxhY2tMaXN0XCIsICdQT1NUJywge1xyXG4gICAgICAgICAgICAgIHRVaWQsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ2FkZCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBua2NBUEkoJy9tZXNzYWdlL2JsYWNrTGlzdCcsICdQT1NUJywge1xyXG4gICAgICAgICAgICAgIHRVaWQsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ3JlbW92ZSdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIE5LQy5tZXRob2RzLmFwcFRvYXN0KCfmk43kvZzmiJDlip8nKTtcclxuICAgICAgICAgIE5LQy5tZXRob2RzLmFwcFJlbG9hZFBhZ2UoKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChOS0MubWV0aG9kcy5hcHBUb2FzdClcclxuICAgIH0sXHJcbiAgICAvLyDmiZPlvIDogYrlpKnpobXpnaJcclxuICAgIHNlbmRUb1VzZXIoKSB7XHJcbiAgICAgIGNvbnN0IHVpZCA9IHRoaXMudGFyZ2V0VXNlci51aWQ7XHJcbiAgICAgIGNvbnN0IHRhcmdldFVzZXJOYW1lID0gdGhpcy50YXJnZXRVc2VyTmFtZTtcclxuICAgICAgTktDLm1ldGhvZHMucm4uZW1pdCgndG9DaGF0Jywge1xyXG4gICAgICAgIHVpZDogdWlkLFxyXG4gICAgICAgIHR5cGU6ICdVVFUnLFxyXG4gICAgICAgIHVzZXJuYW1lOiB0YXJnZXRVc2VyTmFtZVxyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICAvLyDpgInmi6nlnLDljLpcclxuICAgIHNlbGVjdExvY2F0aW9uKCkge1xyXG4gICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgTktDLm1ldGhvZHMuYXBwU2VsZWN0TG9jYXRpb24oKVxyXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgc2VsZi5mcmllbmQuaW5mby5sb2NhdGlvbiA9IGRhdGEubG9jYXRpb24uam9pbignICAnKTtcclxuICAgICAgICB9KVxyXG4gICAgfSxcclxuICAgIC8vIOa3u+WKoOiBlOezu+eUteivnVxyXG4gICAgYWRkUGhvbmUoKSB7XHJcbiAgICAgIHRoaXMuZnJpZW5kLmluZm8ucGhvbmUucHVzaCgnJyk7XHJcbiAgICB9LFxyXG4gICAgLy8g5Yig6Zmk6IGU57O755S16K+dXHJcbiAgICByZW1vdmVQaG9uZShpbmRleCkge1xyXG4gICAgICB0aGlzLmZyaWVuZC5pbmZvLl9waG9uZS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgfSxcclxuICAgIC8vIOiOt+WPluWlveWPi+WbvueJh+mTvuaOpVxyXG4gICAgc2V0RnJpZW5kSW1hZ2VVcmwoKSB7XHJcbiAgICAgIHRoaXMuZnJpZW5kSW1hZ2VVcmwgPSBgL2ZyaWVuZC8ke3RoaXMudGFyZ2V0VXNlci51aWR9L2ltYWdlP3Q9JHtEYXRlLm5vdygpfWA7XHJcbiAgICB9LFxyXG4gICAgLy8g6YCJ5oup5Zu+54mHXHJcbiAgICBzZWxlY3RGcmllbmRJbWFnZSgpIHtcclxuICAgICAgdGhpcy4kcmVmcy5pbnB1dC52YWx1ZSA9IG51bGw7XHJcbiAgICAgIHRoaXMuJHJlZnMuaW5wdXQuY2xpY2soKTtcclxuICAgIH0sXHJcbiAgICAvLyDliKDpmaTlm77niYdcclxuICAgIHJlbW92ZUZyaWVuZEltYWdlKCkge1xyXG4gICAgICB0aGlzLmZyaWVuZC5pbmZvLmltYWdlID0gZmFsc2U7XHJcbiAgICB9LFxyXG4gICAgLy8g6YCJ5oup5a6M5Zu+54mH5ZCOXHJcbiAgICBzZWxlY3RlZEZyaWVuZEltYWdlKCkge1xyXG4gICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgY29uc3Qge2ZpbGVzfSA9IHRoaXMuJHJlZnMuaW5wdXQ7XHJcbiAgICAgIGlmKCFmaWxlcy5sZW5ndGgpIHJldHVybjtcclxuICAgICAgY29uc3QgZmlsZSA9IGZpbGVzWzBdO1xyXG4gICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTtcclxuICAgICAgTktDLm1ldGhvZHMuYXBwVG9hc3QoJ+S4iuS8oOS4re+8jOivt+eojeWAmScpO1xyXG4gICAgICBua2NVcGxvYWRGaWxlKGAvZnJpZW5kLyR7c2VsZi50YXJnZXRVc2VyLnVpZH0vaW1hZ2VgLCAnUE9TVCcsIGZvcm1EYXRhKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIE5LQy5tZXRob2RzLmFwcFRvYXN0KCfkuIrkvKDmiJDlip8nKTtcclxuICAgICAgICAgIHNlbGYuc2V0RnJpZW5kSW1hZ2VVcmwoKTtcclxuICAgICAgICAgIHNlbGYuZnJpZW5kLmluZm8uaW1hZ2UgPSB0cnVlO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKE5LQy5tZXRob2RzLmFwcFRvYXN0KTtcclxuICAgIH0sXHJcbiAgICAvLyDmmL7npLrvvIzpmpDol4/lpIfms6jkv6Hmga9cclxuICAgIHN3aXRjaE5vdGUoKSB7XHJcbiAgICAgIHRoaXMuc2hvd05vdGUgPSAhdGhpcy5zaG93Tm90ZTtcclxuICAgIH0sXHJcbiAgICAvLyDkv53lrZjlpb3lj4vkv6Hmga9cclxuICAgIHNhdmVGcmllbmRJbmZvKCkge1xyXG4gICAgICBjb25zdCB7ZnJpZW5kLCB0YXJnZXRVc2VyfSA9IHRoaXM7XHJcbiAgICAgIGZyaWVuZC5pbmZvLnBob25lID0gZnJpZW5kLmluZm8uX3Bob25lLm1hcChwID0+IHAubnVtYmVyKTtcclxuICAgICAgbmtjQVBJKGAvbWVzc2FnZS9zZXR0aW5ncy8ke3RhcmdldFVzZXIudWlkfWAsICdQQVRDSCcsIHtcclxuICAgICAgICBpbmZvOiBmcmllbmQuaW5mbyxcclxuICAgICAgICBjaWQ6IGZyaWVuZC5jaWQsXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgTktDLm1ldGhvZHMuYXBwVG9hc3QoJ+S/neWtmOaIkOWKnycpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKE5LQy5tZXRob2RzLmFwcFRvYXN0KVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgbW91bnRlZCgpIHtcclxuICAgIHRoaXMuc2V0RnJpZW5kSW1hZ2VVcmwoKTtcclxuICB9XHJcbn0pXHJcbiJdfQ==
