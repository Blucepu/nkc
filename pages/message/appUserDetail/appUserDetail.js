(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var data = NKC.methods.getDataById("data");

if (data.friend) {
  data.friend.info._phone = data.friend.info.phone.map(function (p) {
    return {
      number: p
    };
  });

  if (!data.friend.info._phone.length) {
    data.friend.info._phone = [{
      number: ''
    }];
  }
}

window.app = new Vue({
  el: '#app',
  data: {
    friend: data.friend,
    fc: data.friendCategories,
    targetUser: data.targetUser,
    targetUserName: data.targetUserName,
    inBlacklist: data.inBlacklist,
    friendImageUrl: '',
    showNote: false
  },
  methods: {
    // 访问用户首页
    visitUserHome: function visitUserHome() {
      NKC.methods.visitUrl("/u/".concat(this.targetUser.uid), true);
    },
    _removeFriend: function _removeFriend() {
      var tUid = this.targetUser.uid;
      return nkcAPI('/friend/' + tUid, 'DELETE', {});
    },
    // 添加、删除好友
    addFriend: function addFriend(isFriend) {
      var _removeFriend = this._removeFriend;

      if (isFriend) {
        // 删除好友
        sweetQuestion('确定要删除该好友？').then(function () {
          return _removeFriend();
        }).then(function () {
          NKC.methods.appToast('删除成功');
          NKC.methods.appReloadPage();
        })["catch"](NKC.methods.appToast);
      } else {
        // 添加好友
        NKC.methods.visitUrl("/message/addFriend?uid=".concat(this.targetUser.uid), true);
      }
    },
    // 添加、移除黑名单
    moveToBlacklist: function moveToBlacklist() {
      var tUid = this.targetUser.uid;
      var inBlacklist = this.inBlacklist;
      var friend = this.friend;
      var _removeFriend = this._removeFriend;
      Promise.resolve().then(function () {
        if (!inBlacklist && friend) {// return _removeFriend();
        }
      }).then(function () {
        if (!inBlacklist) {
          return NKC.methods.addUserToBlacklist(tUid, 'message');
        } else {
          return NKC.methods.removeUserFromBlacklist(tUid);
        }
      }).then(function (data) {
        if (!data) return; // NKC.methods.appToast('操作成功');

        NKC.methods.appReloadPage();
      })["catch"](NKC.methods.appToast);
    },
    // 打开聊天页面
    sendToUser: function sendToUser() {
      var uid = this.targetUser.uid;
      var targetUserName = this.targetUserName;
      NKC.methods.rn.emit('toChat', {
        uid: uid,
        type: 'UTU',
        username: targetUserName
      });
    },
    // 选择地区
    selectLocation: function selectLocation() {
      var self = this;
      NKC.methods.appSelectLocation().then(function (data) {
        self.friend.info.location = data.location.join('  ');
      });
    },
    // 添加联系电话
    addPhone: function addPhone() {
      this.friend.info.phone.push('');
    },
    // 删除联系电话
    removePhone: function removePhone(index) {
      this.friend.info._phone.splice(index, 1);
    },
    // 获取好友图片链接
    setFriendImageUrl: function setFriendImageUrl() {
      this.friendImageUrl = "/friend/".concat(this.targetUser.uid, "/image?t=").concat(Date.now());
    },
    // 选择图片
    selectFriendImage: function selectFriendImage() {
      this.$refs.input.value = null;
      this.$refs.input.click();
    },
    // 删除图片
    removeFriendImage: function removeFriendImage() {
      this.friend.info.image = false;
    },
    // 选择完图片后
    selectedFriendImage: function selectedFriendImage() {
      var self = this;
      var files = this.$refs.input.files;
      if (!files.length) return;
      var file = files[0];
      var formData = new FormData();
      formData.append('file', file);
      NKC.methods.appToast('上传中，请稍候');
      nkcUploadFile("/friend/".concat(self.targetUser.uid, "/image"), 'POST', formData).then(function () {
        NKC.methods.appToast('上传成功');
        self.setFriendImageUrl();
        self.friend.info.image = true;
      })["catch"](NKC.methods.appToast);
    },
    // 显示，隐藏备注信息
    switchNote: function switchNote() {
      this.showNote = !this.showNote;
    },
    // 保存好友信息
    saveFriendInfo: function saveFriendInfo() {
      var friend = this.friend,
          targetUser = this.targetUser;
      friend.info.phone = friend.info._phone.map(function (p) {
        return p.number;
      });
      nkcAPI("/message/settings/".concat(targetUser.uid), 'PUT', {
        info: friend.info,
        cid: friend.cid
      }).then(function () {
        NKC.methods.appToast('保存成功');
      })["catch"](NKC.methods.appToast);
    }
  },
  mounted: function mounted() {
    this.setFriendImageUrl();
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInBhZ2VzL21lc3NhZ2UvYXBwVXNlckRldGFpbC9hcHBVc2VyRGV0YWlsLm1qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE9BQUosQ0FBWSxXQUFaLENBQXdCLE1BQXhCLENBQWI7O0FBQ0EsSUFBRyxJQUFJLENBQUMsTUFBUixFQUFnQjtBQUNkLEVBQUEsSUFBSSxDQUFDLE1BQUwsQ0FBWSxJQUFaLENBQWlCLE1BQWpCLEdBQTBCLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixLQUFqQixDQUF1QixHQUF2QixDQUEyQixVQUFBLENBQUMsRUFBSTtBQUN4RCxXQUFPO0FBQ0wsTUFBQSxNQUFNLEVBQUU7QUFESCxLQUFQO0FBR0QsR0FKeUIsQ0FBMUI7O0FBS0EsTUFBRyxDQUFDLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixNQUFqQixDQUF3QixNQUE1QixFQUFvQztBQUNsQyxJQUFBLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixNQUFqQixHQUEwQixDQUFDO0FBQUMsTUFBQSxNQUFNLEVBQUU7QUFBVCxLQUFELENBQTFCO0FBQ0Q7QUFDRjs7QUFDRCxNQUFNLENBQUMsR0FBUCxHQUFhLElBQUksR0FBSixDQUFRO0FBQ25CLEVBQUEsRUFBRSxFQUFFLE1BRGU7QUFFbkIsRUFBQSxJQUFJLEVBQUU7QUFDSixJQUFBLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFEVDtBQUVKLElBQUEsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFGTDtBQUdKLElBQUEsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUhiO0FBSUosSUFBQSxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBSmpCO0FBS0osSUFBQSxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBTGQ7QUFNSixJQUFBLGNBQWMsRUFBRSxFQU5aO0FBT0osSUFBQSxRQUFRLEVBQUU7QUFQTixHQUZhO0FBV25CLEVBQUEsT0FBTyxFQUFFO0FBQ1A7QUFDQSxJQUFBLGFBRk8sMkJBRVM7QUFDZCxNQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFBWixjQUEyQixLQUFLLFVBQUwsQ0FBZ0IsR0FBM0MsR0FBa0QsSUFBbEQ7QUFDRCxLQUpNO0FBS1AsSUFBQSxhQUxPLDJCQUtTO0FBQ2QsVUFBTSxJQUFJLEdBQUcsS0FBSyxVQUFMLENBQWdCLEdBQTdCO0FBQ0EsYUFBTyxNQUFNLENBQUMsYUFBYSxJQUFkLEVBQW9CLFFBQXBCLEVBQThCLEVBQTlCLENBQWI7QUFDRCxLQVJNO0FBU1A7QUFDQSxJQUFBLFNBVk8scUJBVUcsUUFWSCxFQVVhO0FBQ2xCLFVBQU0sYUFBYSxHQUFHLEtBQUssYUFBM0I7O0FBQ0EsVUFBRyxRQUFILEVBQWE7QUFDWDtBQUNBLFFBQUEsYUFBYSxDQUFDLFdBQUQsQ0FBYixDQUNHLElBREgsQ0FDUSxZQUFNO0FBQ1YsaUJBQU8sYUFBYSxFQUFwQjtBQUNELFNBSEgsRUFJRyxJQUpILENBSVEsWUFBTTtBQUNWLFVBQUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLENBQXFCLE1BQXJCO0FBQ0EsVUFBQSxHQUFHLENBQUMsT0FBSixDQUFZLGFBQVo7QUFDRCxTQVBILFdBUVMsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQVJyQjtBQVNELE9BWEQsTUFXTztBQUNMO0FBQ0EsUUFBQSxHQUFHLENBQUMsT0FBSixDQUFZLFFBQVosa0NBQStDLEtBQUssVUFBTCxDQUFnQixHQUEvRCxHQUFzRSxJQUF0RTtBQUNEO0FBQ0YsS0EzQk07QUE0QlA7QUFDQSxJQUFBLGVBN0JPLDZCQTZCVztBQUNoQixVQUFNLElBQUksR0FBRyxLQUFLLFVBQUwsQ0FBZ0IsR0FBN0I7QUFDQSxVQUFNLFdBQVcsR0FBRyxLQUFLLFdBQXpCO0FBQ0EsVUFBTSxNQUFNLEdBQUcsS0FBSyxNQUFwQjtBQUNBLFVBQU0sYUFBYSxHQUFHLEtBQUssYUFBM0I7QUFDQSxNQUFBLE9BQU8sQ0FBQyxPQUFSLEdBQ0csSUFESCxDQUNRLFlBQU07QUFDVixZQUFHLENBQUMsV0FBRCxJQUFnQixNQUFuQixFQUEyQixDQUN6QjtBQUNEO0FBQ0YsT0FMSCxFQU1HLElBTkgsQ0FNUSxZQUFNO0FBQ1YsWUFBRyxDQUFDLFdBQUosRUFBaUI7QUFDZixpQkFBTyxHQUFHLENBQUMsT0FBSixDQUFZLGtCQUFaLENBQStCLElBQS9CLEVBQXFDLFNBQXJDLENBQVA7QUFDRCxTQUZELE1BRU87QUFDTCxpQkFBTyxHQUFHLENBQUMsT0FBSixDQUFZLHVCQUFaLENBQW9DLElBQXBDLENBQVA7QUFDRDtBQUNGLE9BWkgsRUFhRyxJQWJILENBYVEsVUFBQyxJQUFELEVBQVU7QUFDZCxZQUFHLENBQUMsSUFBSixFQUFVLE9BREksQ0FFZDs7QUFDQSxRQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksYUFBWjtBQUNELE9BakJILFdBa0JTLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFsQnJCO0FBbUJELEtBckRNO0FBc0RQO0FBQ0EsSUFBQSxVQXZETyx3QkF1RE07QUFDWCxVQUFNLEdBQUcsR0FBRyxLQUFLLFVBQUwsQ0FBZ0IsR0FBNUI7QUFDQSxVQUFNLGNBQWMsR0FBRyxLQUFLLGNBQTVCO0FBQ0EsTUFBQSxHQUFHLENBQUMsT0FBSixDQUFZLEVBQVosQ0FBZSxJQUFmLENBQW9CLFFBQXBCLEVBQThCO0FBQzVCLFFBQUEsR0FBRyxFQUFFLEdBRHVCO0FBRTVCLFFBQUEsSUFBSSxFQUFFLEtBRnNCO0FBRzVCLFFBQUEsUUFBUSxFQUFFO0FBSGtCLE9BQTlCO0FBS0QsS0EvRE07QUFnRVA7QUFDQSxJQUFBLGNBakVPLDRCQWlFVTtBQUNmLFVBQU0sSUFBSSxHQUFHLElBQWI7QUFDQSxNQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksaUJBQVosR0FDRyxJQURILENBQ1EsVUFBQSxJQUFJLEVBQUk7QUFDWixRQUFBLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUFpQixRQUFqQixHQUE0QixJQUFJLENBQUMsUUFBTCxDQUFjLElBQWQsQ0FBbUIsSUFBbkIsQ0FBNUI7QUFDRCxPQUhIO0FBSUQsS0F2RU07QUF3RVA7QUFDQSxJQUFBLFFBekVPLHNCQXlFSTtBQUNULFdBQUssTUFBTCxDQUFZLElBQVosQ0FBaUIsS0FBakIsQ0FBdUIsSUFBdkIsQ0FBNEIsRUFBNUI7QUFDRCxLQTNFTTtBQTRFUDtBQUNBLElBQUEsV0E3RU8sdUJBNkVLLEtBN0VMLEVBNkVZO0FBQ2pCLFdBQUssTUFBTCxDQUFZLElBQVosQ0FBaUIsTUFBakIsQ0FBd0IsTUFBeEIsQ0FBK0IsS0FBL0IsRUFBc0MsQ0FBdEM7QUFDRCxLQS9FTTtBQWdGUDtBQUNBLElBQUEsaUJBakZPLCtCQWlGYTtBQUNsQixXQUFLLGNBQUwscUJBQWlDLEtBQUssVUFBTCxDQUFnQixHQUFqRCxzQkFBZ0UsSUFBSSxDQUFDLEdBQUwsRUFBaEU7QUFDRCxLQW5GTTtBQW9GUDtBQUNBLElBQUEsaUJBckZPLCtCQXFGYTtBQUNsQixXQUFLLEtBQUwsQ0FBVyxLQUFYLENBQWlCLEtBQWpCLEdBQXlCLElBQXpCO0FBQ0EsV0FBSyxLQUFMLENBQVcsS0FBWCxDQUFpQixLQUFqQjtBQUNELEtBeEZNO0FBeUZQO0FBQ0EsSUFBQSxpQkExRk8sK0JBMEZhO0FBQ2xCLFdBQUssTUFBTCxDQUFZLElBQVosQ0FBaUIsS0FBakIsR0FBeUIsS0FBekI7QUFDRCxLQTVGTTtBQTZGUDtBQUNBLElBQUEsbUJBOUZPLGlDQThGZTtBQUNwQixVQUFNLElBQUksR0FBRyxJQUFiO0FBRG9CLFVBRWIsS0FGYSxHQUVKLEtBQUssS0FBTCxDQUFXLEtBRlAsQ0FFYixLQUZhO0FBR3BCLFVBQUcsQ0FBQyxLQUFLLENBQUMsTUFBVixFQUFrQjtBQUNsQixVQUFNLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBRCxDQUFsQjtBQUNBLFVBQU0sUUFBUSxHQUFHLElBQUksUUFBSixFQUFqQjtBQUNBLE1BQUEsUUFBUSxDQUFDLE1BQVQsQ0FBZ0IsTUFBaEIsRUFBd0IsSUFBeEI7QUFDQSxNQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFBWixDQUFxQixTQUFyQjtBQUNBLE1BQUEsYUFBYSxtQkFBWSxJQUFJLENBQUMsVUFBTCxDQUFnQixHQUE1QixhQUF5QyxNQUF6QyxFQUFpRCxRQUFqRCxDQUFiLENBQ0csSUFESCxDQUNRLFlBQU07QUFDVixRQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFBWixDQUFxQixNQUFyQjtBQUNBLFFBQUEsSUFBSSxDQUFDLGlCQUFMO0FBQ0EsUUFBQSxJQUFJLENBQUMsTUFBTCxDQUFZLElBQVosQ0FBaUIsS0FBakIsR0FBeUIsSUFBekI7QUFDRCxPQUxILFdBTVMsR0FBRyxDQUFDLE9BQUosQ0FBWSxRQU5yQjtBQU9ELEtBN0dNO0FBOEdQO0FBQ0EsSUFBQSxVQS9HTyx3QkErR007QUFDWCxXQUFLLFFBQUwsR0FBZ0IsQ0FBQyxLQUFLLFFBQXRCO0FBQ0QsS0FqSE07QUFrSFA7QUFDQSxJQUFBLGNBbkhPLDRCQW1IVTtBQUFBLFVBQ1IsTUFEUSxHQUNjLElBRGQsQ0FDUixNQURRO0FBQUEsVUFDQSxVQURBLEdBQ2MsSUFEZCxDQUNBLFVBREE7QUFFZixNQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVksS0FBWixHQUFvQixNQUFNLENBQUMsSUFBUCxDQUFZLE1BQVosQ0FBbUIsR0FBbkIsQ0FBdUIsVUFBQSxDQUFDO0FBQUEsZUFBSSxDQUFDLENBQUMsTUFBTjtBQUFBLE9BQXhCLENBQXBCO0FBQ0EsTUFBQSxNQUFNLDZCQUFzQixVQUFVLENBQUMsR0FBakMsR0FBd0MsS0FBeEMsRUFBK0M7QUFDbkQsUUFBQSxJQUFJLEVBQUUsTUFBTSxDQUFDLElBRHNDO0FBRW5ELFFBQUEsR0FBRyxFQUFFLE1BQU0sQ0FBQztBQUZ1QyxPQUEvQyxDQUFOLENBSUcsSUFKSCxDQUlRLFlBQU07QUFDVixRQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksUUFBWixDQUFxQixNQUFyQjtBQUNELE9BTkgsV0FPUyxHQUFHLENBQUMsT0FBSixDQUFZLFFBUHJCO0FBUUQ7QUE5SE0sR0FYVTtBQTJJbkIsRUFBQSxPQTNJbUIscUJBMklUO0FBQ1IsU0FBSyxpQkFBTDtBQUNEO0FBN0lrQixDQUFSLENBQWIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjb25zdCBkYXRhID0gTktDLm1ldGhvZHMuZ2V0RGF0YUJ5SWQoXCJkYXRhXCIpO1xyXG5pZihkYXRhLmZyaWVuZCkge1xyXG4gIGRhdGEuZnJpZW5kLmluZm8uX3Bob25lID0gZGF0YS5mcmllbmQuaW5mby5waG9uZS5tYXAocCA9PiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBudW1iZXI6IHBcclxuICAgIH1cclxuICB9KTtcclxuICBpZighZGF0YS5mcmllbmQuaW5mby5fcGhvbmUubGVuZ3RoKSB7XHJcbiAgICBkYXRhLmZyaWVuZC5pbmZvLl9waG9uZSA9IFt7bnVtYmVyOiAnJ31dXHJcbiAgfVxyXG59XHJcbndpbmRvdy5hcHAgPSBuZXcgVnVlKHtcclxuICBlbDogJyNhcHAnLFxyXG4gIGRhdGE6IHtcclxuICAgIGZyaWVuZDogZGF0YS5mcmllbmQsXHJcbiAgICBmYzogZGF0YS5mcmllbmRDYXRlZ29yaWVzLFxyXG4gICAgdGFyZ2V0VXNlcjogZGF0YS50YXJnZXRVc2VyLFxyXG4gICAgdGFyZ2V0VXNlck5hbWU6IGRhdGEudGFyZ2V0VXNlck5hbWUsXHJcbiAgICBpbkJsYWNrbGlzdDogZGF0YS5pbkJsYWNrbGlzdCxcclxuICAgIGZyaWVuZEltYWdlVXJsOiAnJyxcclxuICAgIHNob3dOb3RlOiBmYWxzZSxcclxuICB9LFxyXG4gIG1ldGhvZHM6IHtcclxuICAgIC8vIOiuv+mXrueUqOaIt+mmlumhtVxyXG4gICAgdmlzaXRVc2VySG9tZSgpIHtcclxuICAgICAgTktDLm1ldGhvZHMudmlzaXRVcmwoYC91LyR7dGhpcy50YXJnZXRVc2VyLnVpZH1gLCB0cnVlKVxyXG4gICAgfSxcclxuICAgIF9yZW1vdmVGcmllbmQoKSB7XHJcbiAgICAgIGNvbnN0IHRVaWQgPSB0aGlzLnRhcmdldFVzZXIudWlkO1xyXG4gICAgICByZXR1cm4gbmtjQVBJKCcvZnJpZW5kLycgKyB0VWlkLCAnREVMRVRFJywge30pO1xyXG4gICAgfSxcclxuICAgIC8vIOa3u+WKoOOAgeWIoOmZpOWlveWPi1xyXG4gICAgYWRkRnJpZW5kKGlzRnJpZW5kKSB7XHJcbiAgICAgIGNvbnN0IF9yZW1vdmVGcmllbmQgPSB0aGlzLl9yZW1vdmVGcmllbmQ7XHJcbiAgICAgIGlmKGlzRnJpZW5kKSB7XHJcbiAgICAgICAgLy8g5Yig6Zmk5aW95Y+LXHJcbiAgICAgICAgc3dlZXRRdWVzdGlvbign56Gu5a6a6KaB5Yig6Zmk6K+l5aW95Y+L77yfJylcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIF9yZW1vdmVGcmllbmQoKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIE5LQy5tZXRob2RzLmFwcFRvYXN0KCfliKDpmaTmiJDlip8nKTtcclxuICAgICAgICAgICAgTktDLm1ldGhvZHMuYXBwUmVsb2FkUGFnZSgpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChOS0MubWV0aG9kcy5hcHBUb2FzdClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDmt7vliqDlpb3lj4tcclxuICAgICAgICBOS0MubWV0aG9kcy52aXNpdFVybChgL21lc3NhZ2UvYWRkRnJpZW5kP3VpZD0ke3RoaXMudGFyZ2V0VXNlci51aWR9YCwgdHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICAvLyDmt7vliqDjgIHnp7vpmaTpu5HlkI3ljZVcclxuICAgIG1vdmVUb0JsYWNrbGlzdCgpIHtcclxuICAgICAgY29uc3QgdFVpZCA9IHRoaXMudGFyZ2V0VXNlci51aWQ7XHJcbiAgICAgIGNvbnN0IGluQmxhY2tsaXN0ID0gdGhpcy5pbkJsYWNrbGlzdDtcclxuICAgICAgY29uc3QgZnJpZW5kID0gdGhpcy5mcmllbmQ7XHJcbiAgICAgIGNvbnN0IF9yZW1vdmVGcmllbmQgPSB0aGlzLl9yZW1vdmVGcmllbmQ7XHJcbiAgICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgaWYoIWluQmxhY2tsaXN0ICYmIGZyaWVuZCkge1xyXG4gICAgICAgICAgICAvLyByZXR1cm4gX3JlbW92ZUZyaWVuZCgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgaWYoIWluQmxhY2tsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBOS0MubWV0aG9kcy5hZGRVc2VyVG9CbGFja2xpc3QodFVpZCwgJ21lc3NhZ2UnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBOS0MubWV0aG9kcy5yZW1vdmVVc2VyRnJvbUJsYWNrbGlzdCh0VWlkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICBpZighZGF0YSkgcmV0dXJuO1xyXG4gICAgICAgICAgLy8gTktDLm1ldGhvZHMuYXBwVG9hc3QoJ+aTjeS9nOaIkOWKnycpO1xyXG4gICAgICAgICAgTktDLm1ldGhvZHMuYXBwUmVsb2FkUGFnZSgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKE5LQy5tZXRob2RzLmFwcFRvYXN0KVxyXG4gICAgfSxcclxuICAgIC8vIOaJk+W8gOiBiuWkqemhtemdolxyXG4gICAgc2VuZFRvVXNlcigpIHtcclxuICAgICAgY29uc3QgdWlkID0gdGhpcy50YXJnZXRVc2VyLnVpZDtcclxuICAgICAgY29uc3QgdGFyZ2V0VXNlck5hbWUgPSB0aGlzLnRhcmdldFVzZXJOYW1lO1xyXG4gICAgICBOS0MubWV0aG9kcy5ybi5lbWl0KCd0b0NoYXQnLCB7XHJcbiAgICAgICAgdWlkOiB1aWQsXHJcbiAgICAgICAgdHlwZTogJ1VUVScsXHJcbiAgICAgICAgdXNlcm5hbWU6IHRhcmdldFVzZXJOYW1lXHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIC8vIOmAieaLqeWcsOWMulxyXG4gICAgc2VsZWN0TG9jYXRpb24oKSB7XHJcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICBOS0MubWV0aG9kcy5hcHBTZWxlY3RMb2NhdGlvbigpXHJcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICBzZWxmLmZyaWVuZC5pbmZvLmxvY2F0aW9uID0gZGF0YS5sb2NhdGlvbi5qb2luKCcgICcpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgLy8g5re75Yqg6IGU57O755S16K+dXHJcbiAgICBhZGRQaG9uZSgpIHtcclxuICAgICAgdGhpcy5mcmllbmQuaW5mby5waG9uZS5wdXNoKCcnKTtcclxuICAgIH0sXHJcbiAgICAvLyDliKDpmaTogZTns7vnlLXor51cclxuICAgIHJlbW92ZVBob25lKGluZGV4KSB7XHJcbiAgICAgIHRoaXMuZnJpZW5kLmluZm8uX3Bob25lLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9LFxyXG4gICAgLy8g6I635Y+W5aW95Y+L5Zu+54mH6ZO+5o6lXHJcbiAgICBzZXRGcmllbmRJbWFnZVVybCgpIHtcclxuICAgICAgdGhpcy5mcmllbmRJbWFnZVVybCA9IGAvZnJpZW5kLyR7dGhpcy50YXJnZXRVc2VyLnVpZH0vaW1hZ2U/dD0ke0RhdGUubm93KCl9YDtcclxuICAgIH0sXHJcbiAgICAvLyDpgInmi6nlm77niYdcclxuICAgIHNlbGVjdEZyaWVuZEltYWdlKCkge1xyXG4gICAgICB0aGlzLiRyZWZzLmlucHV0LnZhbHVlID0gbnVsbDtcclxuICAgICAgdGhpcy4kcmVmcy5pbnB1dC5jbGljaygpO1xyXG4gICAgfSxcclxuICAgIC8vIOWIoOmZpOWbvueJh1xyXG4gICAgcmVtb3ZlRnJpZW5kSW1hZ2UoKSB7XHJcbiAgICAgIHRoaXMuZnJpZW5kLmluZm8uaW1hZ2UgPSBmYWxzZTtcclxuICAgIH0sXHJcbiAgICAvLyDpgInmi6nlrozlm77niYflkI5cclxuICAgIHNlbGVjdGVkRnJpZW5kSW1hZ2UoKSB7XHJcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICBjb25zdCB7ZmlsZXN9ID0gdGhpcy4kcmVmcy5pbnB1dDtcclxuICAgICAgaWYoIWZpbGVzLmxlbmd0aCkgcmV0dXJuO1xyXG4gICAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07XHJcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpO1xyXG4gICAgICBOS0MubWV0aG9kcy5hcHBUb2FzdCgn5LiK5Lyg5Lit77yM6K+356iN5YCZJyk7XHJcbiAgICAgIG5rY1VwbG9hZEZpbGUoYC9mcmllbmQvJHtzZWxmLnRhcmdldFVzZXIudWlkfS9pbWFnZWAsICdQT1NUJywgZm9ybURhdGEpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgTktDLm1ldGhvZHMuYXBwVG9hc3QoJ+S4iuS8oOaIkOWKnycpO1xyXG4gICAgICAgICAgc2VsZi5zZXRGcmllbmRJbWFnZVVybCgpO1xyXG4gICAgICAgICAgc2VsZi5mcmllbmQuaW5mby5pbWFnZSA9IHRydWU7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goTktDLm1ldGhvZHMuYXBwVG9hc3QpO1xyXG4gICAgfSxcclxuICAgIC8vIOaYvuekuu+8jOmakOiXj+Wkh+azqOS/oeaBr1xyXG4gICAgc3dpdGNoTm90ZSgpIHtcclxuICAgICAgdGhpcy5zaG93Tm90ZSA9ICF0aGlzLnNob3dOb3RlO1xyXG4gICAgfSxcclxuICAgIC8vIOS/neWtmOWlveWPi+S/oeaBr1xyXG4gICAgc2F2ZUZyaWVuZEluZm8oKSB7XHJcbiAgICAgIGNvbnN0IHtmcmllbmQsIHRhcmdldFVzZXJ9ID0gdGhpcztcclxuICAgICAgZnJpZW5kLmluZm8ucGhvbmUgPSBmcmllbmQuaW5mby5fcGhvbmUubWFwKHAgPT4gcC5udW1iZXIpO1xyXG4gICAgICBua2NBUEkoYC9tZXNzYWdlL3NldHRpbmdzLyR7dGFyZ2V0VXNlci51aWR9YCwgJ1BVVCcsIHtcclxuICAgICAgICBpbmZvOiBmcmllbmQuaW5mbyxcclxuICAgICAgICBjaWQ6IGZyaWVuZC5jaWQsXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgTktDLm1ldGhvZHMuYXBwVG9hc3QoJ+S/neWtmOaIkOWKnycpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKE5LQy5tZXRob2RzLmFwcFRvYXN0KVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgbW91bnRlZCgpIHtcclxuICAgIHRoaXMuc2V0RnJpZW5kSW1hZ2VVcmwoKTtcclxuICB9XHJcbn0pXHJcbiJdfQ==
