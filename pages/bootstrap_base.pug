extends scratch.pug
block head

  meta(charset='UTF-8')
  meta(http-equiv="X-UA-Compatible" content="IE=edge,chrome=1")
  meta(name="viewport" content="width=device-width, initial-scale=1")
  meta(name="google-site-verification" content="daD64Dm9iV1usCNqLOqzBdBP_wqJYXNBr3ACy979VwY")
  link(rel='shortcut icon' href='/favicon.ico')
  +includeCSS('/bootstrap/css/bootstrap.css')
  +includeCSS('/Draft.css')
  +includeCSS('/katex.min.css')
  +includeCSS('/font-awesome/css/font-awesome.css')
  +includeCSS('/photoswipe/dist/photoswipe.css')
  +includeCSS('/photoswipe/dist/default-skin/default-skin.css')
  +includeCSS('/nkc_styles.css')
  +includeCSS('/publicModules/public.css')
  block title
    title bootstrap_base
  
block body
  if !state.apptype || state.apptype !== "app"
    block navbar
      include ./publicModules/navbar/navbar.pug

  block content
    h1 hello world!
  if !state.apptype || state.apptype !== "app"
    block footer
      include ./publicModules/footer/footer
  if data.user
    //- 添加好友的窗口，原生js（待改）
    include module_add_Friend.pug
    if data.user.generalSettings.lotterySettings.status
      include module_lottery
    -const {systemInfo, reminder, usersMessage} = data.user.generalSettings.messageSettings.beep;
    audio.hidde#beep(data-notice=`${systemInfo}`, data-reminder=`${reminder}`, data-message=`${usersMessage}`)
  +includeJS('/jquery/jquery-1.11.1.js')
  +includeJS('/jquery-ui-1.10.4.custom.js')
  +includeJS('/bootstrap/js/bootstrap.min.js')
  +includeJS('/twemoji/2/twemoji.min.js')
  +includeJS('/Promise/promise.min.js')
  +includeJS('/vue/dist/vue.js')
  script.
    Vue.config.productionTip = false;
  +includeJS('/qrcode/build/qrcode.js')
  +includeJS('/photoswipe/dist/photoswipe.js')
  +includeJS('/photoswipe/dist/photoswipe-ui-default.js')
  //- 旧版common.js兼容旧的页面
  +includeJS('/interface_common.js')
  +includeJS('/axios/axios.min.js')
  +includeJS('/publicModules/config.js')
  +includeJS('/moment/moment.js')
  +includeJS('/moment/locale/zh-cn.js')
  //- 新版common.js
  +includeJS('/publicModules/common.js')
  
  //-app使用的js
  if state.apptype
    +includeJS("/appAPi/api.js")
    +includeJS("/appAPi/app.js")

  if data.user
    script!=`NKC.config.hasLogged = true;`
    //- 接入即时通信
    +includeJS('/socket.io-client/dist/socket.io.js')
    +includeJS('/message/socket.js')

    if data.user.newVoteUp > 0
      script!=`screenTopAlert("您发表的内容新增了 ${data.user.newVoteUp} 个好评👍！")`
    -let kcb = data.user.generalSettings.draftFeeSettings.kcb;
    if kcb > 0
      script!=`screenTopAlert("您发表的内容被评为精选，共获得 ${kcb} 个科创币！")`


  block scripts


  :thru
    <link rel="stylesheet" href="/external_pkgs/highlight/styles/tomorrow.css">
    <script src="/external_pkgs/highlight/highlight.pack.js"></script>
  include ./publicModules/qrcode/qrcode
  script.
    if(window.HighlightEverything){window.HighlightEverything()}
    //- var qrcode = geid('androidQrcode');
    var qrcode = document.getElementById('androidQrcode');
    if (qrcode) {
      var path = window.location.origin;
      path = path + "/app?t=" + Date.now();
      QRCode.toCanvas(qrcode, path, {
        scale: 3,
        margin: 1,
        width: 114,
        color: {dark: '#333333'}
      }, function (err) {
        if (err) {
          screenTopWarning(err);
        }
      })
    }
    console.log('(c)2019 成都科创科学文化研究院')
    console.log('Project Repository: https://github.com/kccd/nkc')